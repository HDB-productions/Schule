<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>Koordinatensystem Generator</title>
    <style>
      :root {
        color-scheme: light dark;
      }
      body {
        font-family: "Segoe UI", Tahoma, sans-serif;
        margin: 0;
        padding: 2rem;
        background: #f5f5f5;
        color: #1f1f1f;
      }
      h1 {
        margin-top: 0;
        margin-bottom: 1rem;
        font-size: 1.75rem;
      }
      main {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        gap: 1.5rem;
      }
      form {
        display: grid;
        gap: 1rem;
      }
      fieldset {
        border: 1px solid #c9c9c9;
        border-radius: 0.5rem;
        padding: 1rem;
        background: #ffffff;
      }
      legend {
        font-weight: 600;
        padding: 0 0.5rem;
      }
      .field-grid {
        display: grid;
        gap: 0.75rem;
        grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      }
      label {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        font-size: 0.95rem;
      }
      input[type="number"] {
        padding: 0.4rem 0.5rem;
        border-radius: 0.4rem;
        border: 1px solid #bdbdbd;
        font-size: 0.95rem;
      }
      input[type="color"] {
        padding: 0;
        border: none;
        background: none;
        height: 2rem;
        width: 100%;
      }
      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
      }
      button {
        padding: 0.6rem 1.2rem;
        border-radius: 0.5rem;
        border: 1px solid #0f62fe;
        background: #0f62fe;
        color: #ffffff;
        font-size: 1rem;
        cursor: pointer;
      }
      button.secondary {
        background: transparent;
        color: #0f62fe;
      }
      #preview {
        background: #ffffff;
        border: 1px solid #c9c9c9;
        border-radius: 0.5rem;
        padding: 1rem;
      }
      #preview svg {
        width: 100%;
        height: auto;
        display: block;
        border: 1px solid #dddddd;
        background: #ffffff;
      }
      textarea {
        width: 100%;
        min-height: 160px;
        border-radius: 0.5rem;
        border: 1px solid #c9c9c9;
        padding: 0.75rem;
        font-family: "Fira Code", "Cascadia Code", monospace;
        font-size: 0.9rem;
        background: #ffffff;
      }
      @media (max-width: 700px) {
        body {
          padding: 1.25rem;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <header>
        <h1>Koordinatensystem Generator</h1>
        <p>
          Passe die Parameter an, um ein Koordinatensystem im SVG-Format zu
          erzeugen. Alle Längenangaben beziehen sich auf Millimeter (mm).
        </p>
      </header>
      <form id="config-form">
        <fieldset>
          <legend>Grundgröße</legend>
          <div class="field-grid">
            <label>
              Gesamtbreite (mm)
              <input
                type="number"
                name="width"
                min="10"
                step="1"
                value="150"
                required
              />
            </label>
            <label>
              Gesamthöhe (mm)
              <input
                type="number"
                name="height"
                min="10"
                step="1"
                value="150"
                required
              />
            </label>
            <label>
              Rand (mm)
              <input
                type="number"
                name="margin"
                min="0"
                step="0.5"
                value="10"
                required
              />
            </label>
            <label>
              Hintergrundfarbe
              <input type="color" name="background" value="#ffffff" />
            </label>
          </div>
        </fieldset>
        <fieldset>
          <legend>Feines Gitter</legend>
          <div class="field-grid">
            <label>
              Feines Gitter aktiv
              <input type="checkbox" name="showMinor" checked />
            </label>
            <label>
              Abstand (mm)
              <input
                type="number"
                name="minorSpacing"
                min="0"
                step="0.5"
                value="1"
              />
            </label>
            <label>
              Linienbreite (mm)
              <input
                type="number"
                name="minorStroke"
                min="0"
                step="0.05"
                value="0.05"
              />
            </label>
            <label>
              Linienfarbe
              <input type="color" name="minorColor" value="#d0d0d0" />
            </label>
          </div>
        </fieldset>
        <fieldset>
          <legend>Grobes Gitter</legend>
          <div class="field-grid">
            <label>
              Grobes Gitter aktiv
              <input type="checkbox" name="showMajor" checked />
            </label>
            <label>
              Abstand (mm)
              <input
                type="number"
                name="majorSpacing"
                min="0"
                step="1"
                value="5"
              />
            </label>
            <label>
              Linienbreite (mm)
              <input
                type="number"
                name="majorStroke"
                min="0"
                step="0.05"
                value="0.05"
              />
            </label>
            <label>
              Linienfarbe
              <input type="color" name="majorColor" value="#9b9b9b" />
            </label>
          </div>
        </fieldset>
        <fieldset>
          <legend>Achsen</legend>
          <div class="field-grid">
            <label>
              Linienbreite (mm)
              <input
                type="number"
                name="axisStroke"
                min="0"
                step="0.05"
                value="0.1"
              />
            </label>
            <label>
              Linienfarbe
              <input type="color" name="axisColor" value="#000000" />
            </label>
            <label>
              Pfeilgröße (mm)
              <input
                type="number"
                name="arrowSize"
                min="0"
                step="0.5"
                value="2"
              />
            </label>
          </div>
        </fieldset>
        <fieldset>
          <legend>Achsenmarkierungen</legend>
          <div class="field-grid">
            <label>
              Markierungen anzeigen
              <input type="checkbox" name="showTicks" checked />
            </label>
            <label>
              Abstand X (mm)
              <input
                type="number"
                name="tickSpacingX"
                min="0"
                step="0.5"
                value="10"
              />
            </label>
            <label>
              Abstand Y (mm)
              <input
                type="number"
                name="tickSpacingY"
                min="0"
                step="0.5"
                value="10"
              />
            </label>
            <label>
              Strichlänge (mm)
              <input
                type="number"
                name="tickLength"
                min="0"
                step="0.5"
                value="2"
              />
            </label>
            <label>
              Strichstärke (mm)
              <input
                type="number"
                name="tickStroke"
                min="0"
                step="0.05"
                value="0.1"
              />
            </label>
            <label>
              Strichfarbe
              <input type="color" name="tickColor" value="#000000" />
            </label>
            <label>
              Beschriftung anzeigen
              <input type="checkbox" name="showTickLabels" checked />
            </label>
            <label>
              Zahlenabstand (mm)
              <input
                type="number"
                name="tickLabelOffset"
                min="0"
                step="0.5"
                value="2"
              />
            </label>
            <label>
              Schriftgröße (mm)
              <input
                type="number"
                name="tickLabelFontSize"
                min="0"
                step="0.5"
                value="1"
              />
            </label>
            <label>
              Schriftfarbe
              <input type="color" name="tickLabelColor" value="#000000" />
            </label>
            <label>
              Schrittweite X (Einheiten)
              <input
                type="number"
                name="tickValueStepX"
                min="0"
                step="0.5"
                value="1"
              />
            </label>
            <label>
              Schrittweite Y (Einheiten)
              <input
                type="number"
                name="tickValueStepY"
                min="0"
                step="0.5"
                value="1"
              />
            </label>
          </div>
        </fieldset>
        <div class="actions">
          <button type="submit">SVG aktualisieren</button>
          <button type="button" class="secondary" id="save-svg">
            SVG speichern
          </button>
        </div>
      </form>
      <section id="preview" aria-live="polite"></section>
    </main>
    <script>
      (() => {
        const form = document.getElementById("config-form");
        const preview = document.getElementById("preview");
        const output = document.getElementById("svg-output");
        const saveButton = document.getElementById("save-svg");
        let currentSVG = "";
        const clampMargin = (value, width, height) =>
          Math.min(value, width / 2, height / 2);
        const parseNumber = (el, fallback, minValue = undefined) => {
          const value = Number.parseFloat(el.value);
          if (!Number.isFinite(value)) {
            return fallback;
          }
          if (typeof minValue === "number" && value < minValue) {
            return fallback;
          }
          return value;
        };
        const fmt = (value) =>
          Number.parseFloat(value.toFixed(4)).toString().replace(/\.0+$/, "");
        const buildGrid = (cfg, spacing, strokeWidth, color) => {
          if (!spacing || spacing <= 0 || strokeWidth <= 0) {
            return "";
          }
          const lines = [];
          const startX = cfg.margin;
          const endX = cfg.width - cfg.margin;
          const startY = cfg.margin;
          const endY = cfg.height - cfg.margin;
          const epsilon = 1e-6;
          let index = 0;
          while (true) {
            const x = startX + index * spacing;
            if (x > endX + epsilon) {
              break;
            }
            lines.push(
              `<line x1="${fmt(x)}" y1="${fmt(startY)}" x2="${fmt(
                x
              )}" y2="${fmt(endY)}" stroke="${color}" stroke-width="${fmt(
                strokeWidth
              )}mm" />`
            );
            index += 1;
          }
          index = 0;
          while (true) {
            const y = startY + index * spacing;
            if (y > endY + epsilon) {
              break;
            }
            lines.push(
              `<line x1="${fmt(startX)}" y1="${fmt(y)}" x2="${fmt(
                endX
              )}" y2="${fmt(y)}" stroke="${color}" stroke-width="${fmt(
                strokeWidth
              )}mm" />`
            );
            index += 1;
          }
          return lines.join("\n          ");
        };
        const buildAxes = (cfg) => {
          if (cfg.axisStroke <= 0) {
            return "";
          }
          const startX = cfg.margin;
          const endX = cfg.width - cfg.margin;
          const startY = cfg.margin;
          const endY = cfg.height - cfg.margin;
          const arrow = cfg.arrowSize;
          const strokeWidth = fmt(cfg.axisStroke);
          const axisColor = cfg.axisColor;
          const elements = [
            `<line x1="${fmt(startX)}" y1="${fmt(startY)}" x2="${fmt(
              endX
            )}" y2="${fmt(
              startY
            )}" stroke="${axisColor}" stroke-width="${strokeWidth}mm" stroke-linecap="square" />`,
            `<line x1="${fmt(startX)}" y1="${fmt(startY)}" x2="${fmt(
              startX
            )}" y2="${fmt(
              endY
            )}" stroke="${axisColor}" stroke-width="${strokeWidth}mm" stroke-linecap="square" />`,
          ];
          if (arrow > 0) {
            elements.push(
              `<path d="M ${fmt(endX - arrow)} ${fmt(
                startY - arrow / 2
              )} L ${fmt(endX)} ${fmt(startY)} L ${fmt(endX - arrow)} ${fmt(
                startY + arrow / 2
              )}" fill="none" stroke="${axisColor}" stroke-width="${strokeWidth}mm" stroke-linecap="round" stroke-linejoin="round" />`,
              `<path d="M ${fmt(startX - arrow / 2)} ${fmt(
                endY - arrow
              )} L ${fmt(startX)} ${fmt(endY)} L ${fmt(
                startX + arrow / 2
              )} ${fmt(
                endY - arrow
              )}" fill="none" stroke="${axisColor}" stroke-width="${strokeWidth}mm" stroke-linecap="round" stroke-linejoin="round" />`
            );
          }
          return elements.join("\n          ");
        };
        const buildTicks = (cfg) => {
          if (!cfg.showTicks) {
            return "";
          }
          const {
            tickSpacingX,
            tickSpacingY,
            tickLength,
            tickStroke,
            tickColor,
            tickLabelFontSize,
            tickLabelOffset,
            tickLabelColor,
            showTickLabels,
            tickValueStepX,
            tickValueStepY,
          } = cfg;
          if (
            (!tickSpacingX || tickSpacingX <= 0) &&
            (!tickSpacingY || tickSpacingY <= 0)
          ) {
            return "";
          }
          if (!tickLength || tickLength <= 0 || tickStroke <= 0) {
            return "";
          }
          const valueStepX = tickValueStepX > 0 ? tickValueStepX : 1;
          const valueStepY = tickValueStepY > 0 ? tickValueStepY : 1;
          const labelOffset = Math.max(0, tickLabelOffset || 0);
          const labelFontSize = tickLabelFontSize > 0 ? tickLabelFontSize : 3;
          const tickLen = Math.max(0, tickLength || 0);
          const startX = cfg.margin;
          const endX = cfg.width - cfg.margin;
          const startY = cfg.margin;
          const endY = cfg.height - cfg.margin;
          const strokeWidth = fmt(tickStroke);
          const formattedLength = tickLen;
          const labels = [];
          const elements = [];
          const createLabel = (x, y, value, anchor, baseline) => {
            if (!showTickLabels) {
              return;
            }
            labels.push(`
              <g transform="translate(${fmt(x)} ${fmt(y)}) scale(1 -1)">
                <text
                  text-anchor="${anchor}"
                  dominant-baseline="${baseline}"
                  font-size="${fmt(labelFontSize)}mm"
                  fill="${tickLabelColor}"
                >${value}</text>
              </g>`);
          };
          if (tickSpacingX && tickSpacingX > 0) {
            const count = Math.floor((endX - startX) / tickSpacingX);
            for (let i = 0; i <= count; i += 1) {
              const x = startX + i * tickSpacingX;
              const isArrowTick = i === count;
              if (!isArrowTick) {
                elements.push(
                  `<line x1="${fmt(x)}" y1="${fmt(startY)}" x2="${fmt(
                    x
                  )}" y2="${fmt(
                    startY - formattedLength
                  )}" stroke="${tickColor}" stroke-width="${strokeWidth}mm" stroke-linecap="round" />`
                );
                const labelValue = fmt(i * valueStepX);
                createLabel(
                  x,
                  startY - formattedLength - labelOffset,
                  labelValue,
                  "middle",
                  "hanging"
                );
              }
            }
          }
          if (tickSpacingY && tickSpacingY > 0) {
            const count = Math.floor((endY - startY) / tickSpacingY);
            for (let i = 0; i <= count; i += 1) {
              const y = startY + i * tickSpacingY;
              const isArrowTick = i === count;
              if (!isArrowTick) {
                elements.push(
                  `<line x1="${fmt(startX)}" y1="${fmt(y)}" x2="${fmt(
                    startX - formattedLength
                  )}" y2="${fmt(
                    y
                  )}" stroke="${tickColor}" stroke-width="${strokeWidth}mm" stroke-linecap="round" />`
                );
                const labelValue = fmt(i * valueStepY);
                createLabel(
                  startX - formattedLength - labelOffset,
                  y,
                  labelValue,
                  "end",
                  "middle"
                );
              }
            }
          }
          return [elements.join("\n          "), labels.join("\n          ")]
            .filter(Boolean)
            .join("\n          ");
        };
        const getConfig = () => {
          const elements = form.elements;
          const width = parseNumber(elements.width, 210, 1);
          const height = parseNumber(elements.height, 210, 1);
          const marginRaw = parseNumber(elements.margin, 10, 0);
          const cfg = {
            width,
            height,
            margin: clampMargin(marginRaw, width, height),
            background: elements.background.value || "#ffffff",
            showMinor: elements.showMinor.checked,
            minorSpacing: parseNumber(elements.minorSpacing, 5, 0),
            minorStroke: parseNumber(elements.minorStroke, 0.1, 0),
            minorColor: elements.minorColor.value || "#d0d0d0",
            showMajor: elements.showMajor.checked,
            majorSpacing: parseNumber(elements.majorSpacing, 10, 0),
            majorStroke: parseNumber(elements.majorStroke, 0.3, 0),
            majorColor: elements.majorColor.value || "#9b9b9b",
            axisStroke: parseNumber(elements.axisStroke, 0.5, 0),
            axisColor: elements.axisColor.value || "#000000",
            arrowSize: parseNumber(elements.arrowSize, 4, 0),
            showTicks: elements.showTicks.checked,
            tickSpacingX: parseNumber(elements.tickSpacingX, 10, 0),
            tickSpacingY: parseNumber(elements.tickSpacingY, 10, 0),
            tickLength: parseNumber(elements.tickLength, 3, 0),
            tickStroke: parseNumber(elements.tickStroke, 0.1, 0),
            tickColor: elements.tickColor.value || "#000000",
            showTickLabels: elements.showTickLabels.checked,
            tickLabelOffset: parseNumber(elements.tickLabelOffset, 2, 0),
            tickLabelFontSize: parseNumber(elements.tickLabelFontSize, 3, 0),
            tickLabelColor: elements.tickLabelColor.value || "#000000",
            tickValueStepX: parseNumber(elements.tickValueStepX, 1, 0),
            tickValueStepY: parseNumber(elements.tickValueStepY, 1, 0),
          };
          return cfg;
        };
        const buildSVG = (cfg) => {
          const gridMinor =
            cfg.showMinor && cfg.minorSpacing > 0
              ? buildGrid(
                  cfg,
                  cfg.minorSpacing,
                  cfg.minorStroke,
                  cfg.minorColor
                )
              : "";
          const gridMajor =
            cfg.showMajor && cfg.majorSpacing > 0
              ? buildGrid(
                  cfg,
                  cfg.majorSpacing,
                  cfg.majorStroke,
                  cfg.majorColor
                )
              : "";
          const axes = buildAxes(cfg);
          const ticks = buildTicks(cfg);
          return `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg"
     width="${fmt(cfg.width)}mm"
     height="${fmt(cfg.height)}mm"
     viewBox="0 0 ${fmt(cfg.width)} ${fmt(cfg.height)}">
  <rect x="0" y="0" width="${fmt(cfg.width)}" height="${fmt(
            cfg.height
          )}" fill="${cfg.background}" />
  <g transform="translate(0 ${fmt(cfg.height)}) scale(1 -1)">
    ${gridMinor ? `<g>\n          ${gridMinor}\n        </g>` : ""}
    ${gridMajor ? `<g>\n          ${gridMajor}\n        </g>` : ""}
    <g>
          ${axes}
    </g>
    ${ticks ? `<g>\n          ${ticks}\n        </g>` : ""}
  </g>
</svg>`;
        };
        const updateSVG = () => {
          const cfg = getConfig();
          const svg = buildSVG(cfg);
          currentSVG = svg;
          preview.innerHTML = svg;
          if (output) {
            output.value = svg;
          }
        };
        const downloadSVG = () => {
          if (!currentSVG) {
            updateSVG();
          }
          const blob = new Blob([currentSVG], { type: "image/svg+xml" });
          const blobUrl = URL.createObjectURL(blob);
          const link = document.createElement("a");
          link.href = blobUrl;
          link.download = "koordinatensystem.svg";
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          setTimeout(() => URL.revokeObjectURL(blobUrl), 1500);
        };
        form.addEventListener("submit", (event) => {
          event.preventDefault();
          updateSVG();
        });
        form.addEventListener("input", () => {
          updateSVG();
        });
        saveButton.addEventListener("click", downloadSVG);
        updateSVG();
      })();
    </script>
  </body>
</html>
