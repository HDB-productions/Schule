<!doctype html>
<html lang="de"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><title>Kommutativ und Assoziativgesetz ueben</title><style>
:root{--bg:#ecf4ff;--card:#fff;--bd:#c9d9ec;--txt:#1f2937;--mut:#475569;--ok:#1f8b4c;--er:#c13232}*{box-sizing:border-box}body{margin:0;background:linear-gradient(160deg,#e9f4ff,#fff8f0);font-family:"Trebuchet MS",Verdana,sans-serif;color:var(--txt);padding:14px}.app{max-width:980px;margin:auto;display:grid;gap:12px}.head,.card{background:var(--card);border:2px solid var(--bd);border-radius:14px;padding:12px}.head h1{margin:0 0 6px;color:#0e4f89;font-size:clamp(1.3rem,1.1rem + .8vw,1.95rem)}.head p{margin:0;color:var(--mut)}.law{margin-top:10px;padding:10px;border:2px solid #f3b2c0;background:#fff4f7;border-radius:10px}.law p{margin:4px 0}.x{font-family:Consolas,"Courier New",monospace;color:#1f3e64;overflow:auto;white-space:nowrap}.tools{display:flex;gap:10px;flex-wrap:wrap;align-items:center}.badge{background:#fef3c7;border:1px solid #e9be47;border-radius:999px;padding:6px 10px;font-weight:700;color:#704700}button{border:2px solid #1e3a5f;background:#f5fbff;color:#16324f;padding:8px 12px;border-radius:10px;font:700 .96rem inherit;cursor:pointer}button:hover{background:#e8f4ff}button:disabled{opacity:.55;cursor:not-allowed}.card h2{margin:0 0 4px;color:#0e4f89;font-size:1.08rem}.card p{margin:0;color:var(--mut)}.shell{margin-top:8px;overflow:auto}.row{display:flex;align-items:flex-end;gap:22px;min-width:640px;padding:2px 2px 5px}.seg{position:relative;flex:1 1 0;min-width:64px;padding:6px 4px 10px;border-radius:10px;user-select:none}.seg::after{content:"+";position:absolute;right:-15px;top:23px;font:800 1.45rem/1 sans-serif;color:#334155;pointer-events:none}.seg:last-child::after{content:""}.seg.drag{opacity:.45}.seg.drop{outline:2px dashed #1f6ab6}.seg.in{border-top:3px solid var(--g);border-bottom:3px solid var(--g);background:color-mix(in srgb,var(--g) 10%,#fff)}.seg.gs{border-left:3px solid var(--g);border-radius:11px 0 0 11px}.seg.ge{border-right:3px solid var(--g);border-radius:0 11px 11px 0}.seg.pick{box-shadow:inset 0 0 0 2px #1f6ab699}.n{text-align:center;font-weight:800;font-size:1.15rem;color:color-mix(in srgb,var(--c) 75%,#111);margin-bottom:4px}.b{height:12px;border-radius:999px;background:var(--c);box-shadow:inset 0 -2px 0 rgba(0,0,0,.12)}.eq{margin-top:8px;font-family:Consolas,"Courier New",monospace;color:#1f3e64;overflow:auto;white-space:nowrap}.act{margin-top:8px;display:flex;gap:10px;flex-wrap:wrap;align-items:center}.msg{min-height:22px;margin-top:6px;font-weight:700}.ok{color:var(--ok)}.err{color:var(--er)}.hide{display:none}.calc{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;font:1.02rem Consolas,"Courier New",monospace}.v{background:#edf2f7;padding:3px 6px;border-radius:6px}.inp{width:72px;border:2px solid #50759d;border-radius:7px;padding:3px 6px;font:inherit}.inp:focus{outline:2px solid #73a7df;border-color:#326fa9}
@media (max-width:760px){body{padding:8px}.row{min-width:600px}}
</style></head><body>
<main class="app"><section class="head"><h1>Vorteilhaft Addieren: Kommutativ- und Assoziativgesetz</h1><div class="law"><p><strong>Kommutativgesetz:</strong> a + b = b + a</p><p id="com" class="x"></p><p><strong>Assoziativgesetz:</strong> (a + b) + c = a + (b + c)</p><p id="ass" class="x"></p></div></section>
<section class="tools"><button id="neu" type="button">Neue Aufgabe</button><span id="score" class="badge">0 Aufgaben gelöst</span></section>
<section class="card"><h2>Originalaufgabe</h2><p>Die Summe bleibt gleich.</p><div class="shell"><div id="r0" class="row"></div></div><div id="eq0" class="eq"></div></section>
<section class="card"><h2>Schritt 1: Kommutativgesetz</h2><p>Ziehe Summanden so, dass passende Paare nebeneinander stehen.</p><div class="shell"><div id="r1" class="row"></div></div><div id="eq1" class="eq"></div><div class="act"><button id="b1" type="button">Schritt 1 pruefen</button></div><div id="m1" class="msg"></div></section>
<section id="c2" class="card hide"><h2>Schritt 2: Assoziativgesetz</h2><p>Klicke Start und Ende fuer jede Klammer (zwei Klammern).</p><div class="shell"><div id="r2" class="row"></div></div><div id="eq2" class="eq"></div><div class="act"><button id="clr" type="button">Klammern loeschen</button><button id="b2" type="button">Schritt 2 pruefen</button></div><div id="m2" class="msg"></div></section>
<section id="c3" class="card hide"><h2>Schritt 3: Geschickt ausrechnen</h2><p>Teilsummen und Endsumme eintragen.</p><div id="ce" class="eq"></div><div id="ci" class="calc"></div><div class="act"><button id="b3" type="button">Ergebnis pruefen</button></div><div id="m3" class="msg"></div></section>
</main>
<script>
(()=>{const C=["#1696d2","#e64b78","#66b548","#ef7f25","#7054c9"],GC=["#2f855a","#2563eb"],S={done:0,drag:"",pick:-1,g:[],i:{},s1:false,s2:false,ok:false,cd:null};
const E={com:document.getElementById("com"),ass:document.getElementById("ass"),score:document.getElementById("score"),neu:document.getElementById("neu"),r0:document.getElementById("r0"),eq0:document.getElementById("eq0"),r1:document.getElementById("r1"),eq1:document.getElementById("eq1"),b1:document.getElementById("b1"),m1:document.getElementById("m1"),c2:document.getElementById("c2"),r2:document.getElementById("r2"),eq2:document.getElementById("eq2"),clr:document.getElementById("clr"),b2:document.getElementById("b2"),m2:document.getElementById("m2"),c3:document.getElementById("c3"),ce:document.getElementById("ce"),ci:document.getElementById("ci"),b3:document.getElementById("b3"),m3:document.getElementById("m3")};
const ri=(a,b)=>Math.floor(Math.random()*(b-a+1))+a,sh=a=>{let x=a.slice();for(let i=x.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[x[i],x[j]]=[x[j],x[i]]}return x},sum=a=>a.reduce((p,c)=>p+c,0),key=p=>p.slice().sort().join("|"),val=id=>S.t.m[id].v,vals=ids=>ids.map(val),msg=(el,t,c)=>{el.textContent=t;el.className="msg"+(c?" "+c:"")};
const adj=(o,p)=>Math.abs(o.indexOf(p[0])-o.indexOf(p[1]))===1,ok1=(o,p)=>p.every(q=>adj(o,q));
function ex(o,g){let bs={},i=0,out=[];(g||[]).slice().sort((a,b)=>a.a-b.a).forEach(x=>bs[x.a]=x);while(i<o.length){if(bs[i]){let q=bs[i],v=[];for(let j=q.a;j<=q.b;j++)v.push(val(o[j]));out.push("("+v.join(" + ")+")");i=q.b+1}else{out.push(val(o[i]));i++}}return out.join(" + ")}
function hint(ps){return ps.map(p=>{let v=vals(p);return v[0]+" und "+v[1]}).join(" | ")}
function gen(){for(let t=0;t<280;t++){let u1=ri(1,9),u2=ri(1,9);while(u2===u1||u2===10-u1)u2=ri(1,9);let v=[ri(1,4)*10+u1,ri(1,4)*10+(10-u1),ri(1,4)*10+u2,ri(1,4)*10+(10-u2)],used=[u1,10-u1,u2,10-u2],eu=ri(0,9);for(let g=0;used.includes(eu)&&g<40;g++)eu=ri(0,9);v.push(ri(1,3)*10+eu);let tot=sum(v);if(tot<90||tot>220)continue;let ids=["t1","t2","t3","t4","t5"],m={};ids.forEach((id,i)=>m[id]={v:v[i],c:C[i]});let o=sh(ids),p=[["t1","t2"],["t3","t4"]],f=0;while(ok1(o,p)&&f<40){o=sh(ids);f++}return{m:m,orig:o,p:p,tot:tot}}return{m:{t1:{v:39,c:C[0]},t2:{v:11,c:C[1]},t3:{v:28,c:C[2]},t4:{v:12,c:C[3]},t5:{v:16,c:C[4]}},orig:["t1","t3","t2","t5","t4"],p:[["t1","t2"],["t3","t4"]],tot:106}}
function findG(i){for(let k=0;k<S.g.length;k++){let g=S.g[k];if(i>=g.a&&i<=g.b)return{g:g,k:k}}return null}
function row(box,o,opt){box.innerHTML="";o.forEach((id,i)=>{let t=S.t.m[id],d=document.createElement("div");d.className="seg";d.dataset.id=id;d.dataset.i=i;d.style.flexGrow=Math.max(t.v,1);d.style.setProperty("--c",t.c);if(opt.drag){d.draggable=true;d.ondragstart=e=>{S.drag=id;d.classList.add("drag");if(e.dataTransfer){e.dataTransfer.effectAllowed="move";e.dataTransfer.setData("text/plain",id)}};d.ondragend=()=>{S.drag="";d.classList.remove("drag");E.r1.querySelectorAll(".drop").forEach(x=>x.classList.remove("drop"))};d.ondragover=e=>{e.preventDefault();d.classList.add("drop")};d.ondragleave=()=>d.classList.remove("drop");d.ondrop=e=>{e.preventDefault();d.classList.remove("drop");move(id,e.clientX<d.getBoundingClientRect().left+d.offsetWidth/2)}}if(opt.grp){let gm=findG(i);if(gm){d.classList.add("in");d.style.setProperty("--g",GC[gm.k%GC.length]);if(i===gm.g.a)d.classList.add("gs");if(i===gm.g.b)d.classList.add("ge")}if(S.pick>=0&&i===S.pick)d.classList.add("pick")}d.innerHTML='<div class="n">'+t.v+'</div><div class="b"></div>';box.appendChild(d)})}
function move(t,before){if(!S.drag||S.drag===t||S.s1)return;let o=S.o.slice(),f=o.indexOf(S.drag);if(f<0)return;o.splice(f,1);let at=o.indexOf(t);if(at<0)return;if(!before)at++;o.splice(at,0,S.drag);S.o=o;draw1()}
function forms(){let o=ex(S.t.orig),end=S.ok?" = "+S.t.tot:" = ?";E.com.textContent="Mit deiner Aufgabe: "+o+(S.s1?" = "+ex(S.o)+end:" = ? (erst nach Schritt 1)");E.ass.textContent=S.s2?"Mit deiner Aufgabe: "+ex(S.o,S.g)+end:"Mit deiner Aufgabe: (a + b) + c = a + (b + c)"}
function draw0(){row(E.r0,S.t.orig,{drag:false});E.eq0.textContent=ex(S.t.orig)+" = "+S.t.tot}
function draw1(){row(E.r1,S.o,{drag:!S.s1});E.eq1.textContent=ex(S.o);E.b1.disabled=S.s1}
function draw2(){E.c2.classList.toggle("hide",!S.s1);if(!S.s1)return;row(E.r2,S.o,{grp:true});E.eq2.textContent=ex(S.o,S.g);E.clr.disabled=S.s2||S.g.length===0;E.b2.disabled=S.s2}
function calc(){let bs={},tok=[],out=[];S.g.slice().sort((a,b)=>a.a-b.a).forEach(g=>bs[g.a]=g);for(let i=0,gi=1;i<S.o.length;){if(bs[i]){let g=bs[i],id=S.o.slice(g.a,g.b+1),v=vals(id),tx="("+v.join(" + ")+")";tok.push({t:"g",k:"g"+gi,e:sum(v)});out.push(tx);gi++;i=g.b+1}else{let x=val(S.o[i]);tok.push({t:"s",e:x});out.push(String(x));i++}}return{tok:tok,ex:out.join(" + "),tot:S.t.tot}}
function inp(k){let i=document.createElement("input");i.className="inp";i.placeholder="?";i.value=S.i[k]||"";i.oninput=()=>S.i[k]=i.value.trim();return i}
function draw3(){E.c3.classList.toggle("hide",!S.s2);if(!S.s2){E.ce.textContent="";E.ci.innerHTML="";return}S.cd=calc();E.ce.textContent=S.cd.ex;E.ci.innerHTML="";S.cd.tok.forEach((t,ix)=>{if(ix){let p=document.createElement("span");p.textContent="+";E.ci.appendChild(p)}if(t.t==="g")E.ci.appendChild(inp(t.k));else{let s=document.createElement("span");s.className="v";s.textContent=t.e;E.ci.appendChild(s)}});let eq=document.createElement("span");eq.textContent="=";E.ci.appendChild(eq);E.ci.appendChild(inp("fin"))}
function draw(){forms();draw0();draw1();draw2();draw3();E.score.textContent=S.done+" Aufgaben gelöst"}
function reset(){S.t=gen();S.o=S.t.orig.slice();S.s1=false;S.s2=false;S.g=[];S.pick=-1;S.i={};S.cd=null;S.ok=false;msg(E.m1,"","");msg(E.m2,"","");msg(E.m3,"","");draw()}
const ov=(a,b)=>S.g.some(g=>!(b<g.a||a>g.b)),pInt=x=>/^[-]?\d+$/.test((x||"").trim())?Number(x):null;
function ck1(){if(ok1(S.o,S.t.p)){S.s1=true;msg(E.m1,"Richtig. Die passenden Summanden stehen nebeneinander.","ok");draw();return}let miss=S.t.p.filter(p=>!adj(S.o,p));msg(E.m1,"Noch nicht. Tipp: "+hint(miss)+" zusammenstellen.","err")}
function ck2(){if(S.g.length!==S.t.p.length){msg(E.m2,"Setze zwei Klammern um die geschickten Paare.","err");return}let u=[];for(let g of S.g){let ids=S.o.slice(g.a,g.b+1);if(ids.length!==2){msg(E.m2,"Jede Klammer soll hier genau zwei Summanden enthalten.","err");return}u.push(key(ids))}u.sort();let exk=S.t.p.map(key).sort(),ok=exk.length===u.length&&exk.every((k,i)=>k===u[i]);if(!ok){msg(E.m2,"Noch nicht optimal. Nutze die Paare "+hint(S.t.p)+".","err");return}S.s2=true;S.i={};msg(E.m2,"Sehr gut. Die Klammern sind vorteilhaft.","ok");draw()}
function ck3(){if(!S.cd)return;for(let t of S.cd.tok){if(t.t==="g"){let n=pInt(S.i[t.k]||"");if(n===null||n!==t.e){msg(E.m3,"Eine Teilsumme stimmt noch nicht.","err");return}}}let f=pInt(S.i.fin||"");if(f===null||f!==S.cd.tot){msg(E.m3,"Das Endergebnis ist noch nicht korrekt.","err");return}if(!S.ok){S.ok=true;S.done++;E.score.textContent=S.done+" Aufgaben gelöst"}msg(E.m3,"Perfekt. Aufgabe vollständig richtig gerechnet.","ok")}
E.neu.onclick=reset;E.b1.onclick=ck1;E.clr.onclick=()=>{if(S.s2)return;S.g=[];S.pick=-1;msg(E.m2,"Klammern gelöscht.","");draw2()};E.b2.onclick=ck2;E.b3.onclick=ck3;
E.r1.ondragover=e=>{if(!S.s1)e.preventDefault()};E.r1.ondrop=e=>{if(!S.drag||S.s1)return;if(e.target===E.r1){e.preventDefault();let o=S.o.slice(),f=o.indexOf(S.drag);if(f>-1){o.splice(f,1);o.push(S.drag);S.o=o;draw1()}}};
E.r2.onclick=e=>{if(!S.s1||S.s2)return;let d=e.target.closest(".seg");if(!d||!E.r2.contains(d))return;let i=Number(d.dataset.i);if(S.pick<0){S.pick=i;msg(E.m2,"Start gewählt, jetzt Endfeld klicken.","");draw2();return}let a=Math.min(S.pick,i),b=Math.max(S.pick,i);S.pick=-1;if(b-a<1){msg(E.m2,"Markiere mindestens zwei Summanden.","err");draw2();return}if(S.g.length>=2){msg(E.m2,"Für diese Aufgabe genügen zwei Klammern.","err");draw2();return}if(ov(a,b)){msg(E.m2,"Klammern dürfen sich nicht überschneiden.","err");draw2();return}S.g.push({a:a,b:b});S.g.sort((x,y)=>x.a-y.a);msg(E.m2,"Klammer gesetzt.","");draw2()};
reset();})();
</script></body></html>
