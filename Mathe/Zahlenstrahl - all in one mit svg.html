<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Zahlenstrahl</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .container {
            position: relative;
            width: 900px;
            height: 200px; /* Erhöht, um Platz für Markierungen und Containername zu bieten */
            margin: 20px auto;
            border: 1px solid #ccc;
            padding: 10px;
            box-sizing: border-box;
        }
        svg {
            border: 1px solid black;
            display: block; /* Verhindert unerwünschte Abstände */
            margin: 0 auto; /* Zentriert das SVG innerhalb des Containers */
        }
        /* Stil für Markierungen innerhalb des SVG */
        .markierung {
            font-size: 20px;
            pointer-events: none; /* Markierungen reagieren nicht auf Mausereignisse */
        }
        .beschriftung {
            font-size: 14px;
            pointer-events: none;
        }
        /* Stil für Formulare */
        .forms-container {
            display: flex;
            justify-content: space-between;
            gap: 5px;
            width: 100%;
            max-width: 1800px;
            margin: 10px auto;
            flex-wrap: wrap;
        }
        .form-container {
            flex: 1;
            min-width: 250px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .form-container h3 {
            margin-top: 0;
            text-align: center;
        }
        .form-group {
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            
        }
        .form-group label {
            width: 200px;
            margin-right: 5px;
            text-align: right;
            
        }
        .form-group input, .form-group select {
            flex: 1;
            padding: 5px; /* Abstand um den Text herum */
            width: 100%; /* Füllt den verfügbaren Platz */
            min-width: 50px; /* Mindestbreite für kleine Bildschirme */
            
        }

        .form-group input[type="checkbox"] {
            width: auto;
            margin-left: 0;

        }
        .form-group button {
            padding: 5px 10px;
            cursor: pointer;
            position: relative;
            margin:auto;  

        }
        @media (max-width: 600px) {
            .forms-container {
                flex-direction: column;
                width: 100%;
            }
            .form-group label {
                width: 100%;
                text-align: left;
                margin-bottom: 5px;
            }
            .form-group input, .form-group select, .form-group button {
                width: 100%;
                margin-left: 0;
            }
            .form-group button {
                margin-left: 0;
            }
        }
        /* Stil für Container-Namen */
        .container-name {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 12px;
            border: 1px solid #ccc;
        }
        /* Cursor-Stile für bewegbare Elemente */
        .movable {
            cursor: grab;
        }
        .movable:active {
            cursor: grabbing;
        }
        /* Stil für die Markierungsauflistung */
        #markierungenTabelle {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        #markierungenTabelle th, #markierungenTabelle td {
            border: 1px solid #ccc;
            padding: 5px;
            text-align: left;
        }
        #markierungenTabelle th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>

<h2>Zahlenstrahl mit Markierung</h2>

<!-- Container für die Formulare -->
<div class="forms-container">
    <!-- Formular zum Zeichnen eines Zahlenstrahls -->
    <div class="form-container">
        <h3>Zahlenstrahl zeichnen</h3>
        <form id="zahlenstrahlForm">
            <div class="form-group">
                <label for="min">Min:</label>
                <input type="number" id="min" name="min" step="any" value="0" required>
            </div>
            <div class="form-group">
                <label for="max">Max:</label>
                <input type="number" id="max" name="max" step="any" value="100" required>
            </div>
            <div class="form-group">
                <label for="skalierung">Skalierung (z.B. -4 für 10⁻⁴):</label>
                <input type="number" id="skalierung" name="skalierung" step="1" value="1" required>
            </div>
            <div class="form-group">
                <label for="containerID">Container ID:</label>
                <input type="text" id="containerID" name="containerID" value="kontainer" required>
            </div>
            <div class="form-group">
                <label for="farbe">Farbe der Beschriftung:</label>
                <input type="color" id="farbe" name="farbe" value="#000000">
            </div>
            <div class="form-group">
                <button type="submit">Zeichne Zahlenstrahl</button>
            </div>
        </form>
    </div>

    <!-- Formular zum Markieren einer Zahl (Kreuz) -->
    <div class="form-container">
        <h3>Zahl markieren (Kreuz)</h3>
        <form id="kreuzForm">
            <div class="form-group">
                <label for="kreuzContainerID">Container ID:</label>
                <input type="text" id="kreuzContainerID" name="kreuzContainerID" value="kontainer" required>
            </div>
            <div class="form-group">
                <label for="kreuzZahl">Zahl:</label>
                <input type="number" id="kreuzZahl" name="kreuzZahl" step="any" value="50" required>
            </div>
            <div class="form-group">
                <label for="kreuzFarbe">Farbe:</label>
                <input type="color" id="kreuzFarbe" name="kreuzFarbe" value="#ff0000">
            </div>
            <div class="form-group">
                <label for="kreuzSichtbar">Zahlenwert anzeigen:</label>
                <input type="checkbox" id="kreuzSichtbar" name="kreuzSichtbar" checked>
            </div>
            <div class="form-group">
                <label for="kreuzBewegbar">Bewegbar:</label>
                <input type="checkbox" id="kreuzBewegbar" name="kreuzBewegbar" checked>
            </div>
            <div class="form-group">
                <button type="submit">Markiere Kreuz</button>
            </div>
        </form>
    </div>

    <!-- Formular zum Erstellen eines Pfeils -->
    <div class="form-container">
        <h3>Pfeil erstellen</h3>
        <form id="pfeilForm">
            <div class="form-group">
                <label for="pfeilContainerID">Container ID:</label>
                <input type="text" id="pfeilContainerID" name="pfeilContainerID" value="kontainer" required>
            </div>
            <div class="form-group">
                <label for="pfeilStart">Startzahl:</label>
                <input type="number" id="pfeilStart" name="pfeilStart" step="any" value="50" required>
            </div>
            <div class="form-group">
                <label for="pfeilOperator">Operator:</label>
                <select id="pfeilOperator" name="pfeilOperator" required>
                    <option value="+">+</option>
                    <option value="-">-</option>
                </select>
            </div>
            <div class="form-group">
                <label for="pfeilWert">Wert:</label>
                <input type="number" id="pfeilWert" name="pfeilWert" step="any" value="10" required>
            </div>
            <div class="form-group">
                <label for="pfeilFarbe">Farbe:</label>
                <input type="color" id="pfeilFarbe" name="pfeilFarbe" value="#0000FF">
            </div>
            <div class="form-group">
                <label for="pfeilSichtbar">Beschriftung anzeigen:</label>
                <input type="checkbox" id="pfeilSichtbar" name="pfeilSichtbar" checked>
            </div>
            <div class="form-group">
                <label for="pfeilBewegbar">Bewegbar:</label>
                <input type="checkbox" id="pfeilBewegbar" name="pfeilBewegbar" checked>
            </div>
            <div class="form-group">
                <button type="submit">Erstelle Pfeil</button>
            </div>
        </form>
    </div>

    <!-- Formular zum Löschen einer Markierung -->
    <div class="form-container">
        <h3>Markierung löschen</h3>
        <form id="loescheMarkierungForm">
            <div class="form-group">
                <label for="markID">Markierungs-ID:</label>
                <input type="text" id="markID" name="markID" placeholder="z.B. mark-1" required>
            </div>
            <div class="form-group">
                <button type="submit">Lösche Markierung</button>
            </div>
        </form>
    </div>

    <!-- Neues Formular zum Auflisten der Markierungen -->
    <div class="form-container">
        <h3>Markierungen auflisten</h3>
        <form id="listeMarkierungenForm">
            <div class="form-group">
                <label for="listeContainerID">Container ID:</label>
                <input type="text" id="listeContainerID" name="listeContainerID" value="kontainer" required>
            </div>
            <div class="form-group">
                <button type="submit">Liste Markierungen</button>
            </div>
        </form>
        <!-- Bereich zur Anzeige der Markierungen -->
        <div id="markierungenAnzeige">
            <!-- Tabelle zur Anzeige der Markierungen wird hier eingefügt -->
        </div>
    </div>
</div>

<!-- Container für die Zahlenstrahlen -->
<div id="kontainer" class="container">
    <div class="container-name">ID: kontainer</div>
</div>
<div id="andererKontainer" class="container">
    <div class="container-name">ID: andererKontainer</div>
</div>

<script>
// Globale Marker-Zähler für eindeutige Marker-IDs
let markerCounter = 0;
let markCounter = 0; // Neuer Zähler für Markierungen

// Variable zum Speichern des aktuell ausgewählten Elements
let selectedElement = null;
let selectedSVG = null;
let offsetX = 0;

/**
 * Zeichnet einen Zahlenstrahl in ein SVG-Element innerhalb eines Containers.
 * @param {number} Min - Der minimale Wert des Zahlenstrahls.
 * @param {number} Max - Der maximale Wert des Zahlenstrahls.
 * @param {number} Skalierung - Die Skalierungseinheit (Exponent der Hauptskalierung, z.B. -4 für 10⁻⁴ = 0,0001).
 * @param {string} KontainerID - Die ID des Container-Elements.
 * @param {string} [farbe='black'] - Die Farbe der Beschriftungen.
 */
function zeichneZahlenstrahl(Min, Max, Skalierung, KontainerID, farbe = 'black') {
    // Berechnung der Skalierungseinheiten
    const HauptskalierungEinheit = Math.pow(10, Skalierung);
    const FeinskalaEinheit = HauptskalierungEinheit / 10;

    // Bestimmen der Dezimalstellen
    function getDecimalPlaces(feinskalaEinheit) {
        let places = 0;
        while (feinskalaEinheit < 1 && places < 20) { // Erhöht die Begrenzung auf 20 Dezimalstellen
            feinskalaEinheit *= 10;
            places++;
        }
        return places;
    }
    const decimalPlaces = getDecimalPlaces(FeinskalaEinheit);

    // Kontainer-Element
    const kontainer = document.getElementById(KontainerID);
    if (!kontainer) {
        alert('Kontainer mit der angegebenen ID nicht gefunden.');
        return;
    }
    kontainer.innerHTML = `<div class="container-name">ID: ${KontainerID}</div>`; // Inhalt leeren und Containername hinzufügen
    kontainer.style.position = 'relative';

    // SVG erstellen
    const svgNS = "http://www.w3.org/2000/svg";
    const svg = document.createElementNS(svgNS, 'svg');
    svg.setAttribute('width', '800');
    svg.setAttribute('height', '150'); // Erhöht, um mehr Platz für Bewegungen zu bieten
    svg.style.display = 'block';
    svg.style.margin = '0 auto';
    kontainer.appendChild(svg);

    // Zahlenstrahl zeichnen
    const paddingLeft = 50;
    const paddingRight = 50;
    const lineY = 75;

    // Hauptlinie zeichnen
    const line = document.createElementNS(svgNS, 'line');
    line.setAttribute('x1', paddingLeft);
    line.setAttribute('y1', lineY);
    line.setAttribute('x2', 800 - paddingRight);
    line.setAttribute('y2', lineY);
    line.setAttribute('stroke', 'black');
    line.setAttribute('stroke-width', '2');
    svg.appendChild(line);

    const totalWidth = 800 - paddingLeft - paddingRight;
    const range = Max - Min;
    const pixelsPerUnit = totalWidth / range;

    // Hauptskalierung zeichnen
    const startHaupt = Math.ceil(Min / HauptskalierungEinheit) * HauptskalierungEinheit;
    const numSteps = Math.round((Max - startHaupt) / HauptskalierungEinheit);

    for (let i = 0; i <= numSteps; i++) {
        let x = startHaupt + i * HauptskalierungEinheit;
        x = parseFloat(x.toFixed(decimalPlaces));
        if (x > Max) x = Max;

        const xpos = paddingLeft + (x - Min) * pixelsPerUnit;

        // Tick für Hauptskalierung
        const tick = document.createElementNS(svgNS, 'line');
        tick.setAttribute('x1', xpos);
        tick.setAttribute('y1', lineY - 15);
        tick.setAttribute('x2', xpos);
        tick.setAttribute('y2', lineY + 15);
        tick.setAttribute('stroke', 'black');
        tick.setAttribute('stroke-width', '2');
        svg.appendChild(tick);

        // Beschriftung
        const text = document.createElementNS(svgNS, 'text');
        text.setAttribute('x', xpos);
        text.setAttribute('y', lineY + 30);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('fill', farbe);
        text.style.fontSize = '14px';
        text.textContent = x.toFixed(decimalPlaces);
        svg.appendChild(text);
    }

    // Feinskala zeichnen
    const startFein = Math.ceil(Min / FeinskalaEinheit) * FeinskalaEinheit;
    const numFeinSteps = Math.round((Max - startFein) / FeinskalaEinheit);

    for (let j = 0; j <= numFeinSteps; j++) {
        let xFein = startFein + j * FeinskalaEinheit;
        xFein = parseFloat(xFein.toFixed(decimalPlaces));
        if (xFein > Max) xFein = Max;

        const xposFein = paddingLeft + (xFein - Min) * pixelsPerUnit;

        // Tick für Feinskala
        const tickFein = document.createElementNS(svgNS, 'line');
        tickFein.setAttribute('x1', xposFein);
        tickFein.setAttribute('y1', lineY - 7);
        tickFein.setAttribute('x2', xposFein);
        tickFein.setAttribute('y2', lineY + 7);
        tickFein.setAttribute('stroke', 'black');
        tickFein.setAttribute('stroke-width', '1');
        svg.appendChild(tickFein);
    }

    // Speichere die Eigenschaften des Zahlenstrahls im Container für spätere Referenz
    kontainer.dataset.min = Min;
    kontainer.dataset.max = Max;
    kontainer.dataset.skalierung = Skalierung;
    kontainer.dataset.paddingLeft = paddingLeft;
    kontainer.dataset.paddingRight = paddingRight;
    kontainer.dataset.lineY = lineY;
    kontainer.dataset.canvasWidth = 800;
    kontainer.dataset.canvasHeight = 150;
    kontainer.dataset.decimalPlaces = decimalPlaces;
    kontainer.dataset.feinskalaEinheit = FeinskalaEinheit;
    kontainer.dataset.pixelsPerUnit = pixelsPerUnit;
}

/**
 * Hilfsfunktion zum Parsen der Transform-Attribute.
 * @param {string} transform - Der Transform-String (z.B. "translate(50,0)").
 * @returns {object} - Ein Objekt mit x und y Werten.
 */
function parseTransform(transform) {
    const result = /translate\(\s*([-\d.]+)[ ,]([-\d.]+)\s*\)/.exec(transform);
    if (result) {
        return { x: parseFloat(result[1]), y: parseFloat(result[2]) };
    }
    return { x: 0, y: 0 };
}

/**
 * Markiert eine bestimmte Zahl auf einem bestehenden Zahlenstrahl.
 * Fügt ein "×" und optional eine Beschriftung des Zahlenwerts hinzu.
 * Macht das Element anklickbar und verschiebbar, je nach Einstellung.
 * @param {string} KontainerID - Die ID des Container-Elements, das den Zahlenstrahl enthält.
 * @param {number} zahl - Die Zahl, die markiert werden soll.
 * @param {string} [farbe='black'] - Die Farbe der Markierung und Beschriftung.
 * @param {boolean} [sichtbar=true] - Bestimmt, ob die Beschriftung des Zahlenwerts angezeigt werden soll.
 * @param {boolean} [bewegbar=true] - Bestimmt, ob das Objekt verschiebbar ist.
 * @returns {string|null} - Die eindeutige ID der erstellten Markierung oder null bei Fehler.
 */
function markiereZahl(KontainerID, zahl, farbe = 'black', sichtbar = true, bewegbar = true) {
    // Kontainer-Element abrufen
    const kontainer = document.getElementById(KontainerID);
    if (!kontainer) {
        alert('Kontainer mit der angegebenen ID nicht gefunden.');
        return null;
    }

    // Überprüfen, ob ein SVG-Zahlenstrahl vorhanden ist
    const svg = kontainer.querySelector('svg');
    if (!svg) {
        alert('Es wurde kein Zahlenstrahl im angegebenen Kontainer gefunden.');
        return null;
    }

    // Aus den Datenattributen die notwendigen Werte abrufen
    const Min = parseFloat(kontainer.dataset.min);
    const Max = parseFloat(kontainer.dataset.max);
    const Skalierung = parseFloat(kontainer.dataset.skalierung);
    const paddingLeft = parseFloat(kontainer.dataset.paddingLeft);
    const paddingRight = parseFloat(kontainer.dataset.paddingRight);
    const lineY = parseFloat(kontainer.dataset.lineY);
    const canvasWidth = parseFloat(kontainer.dataset.canvasWidth);
    const decimalPlaces = parseInt(kontainer.dataset.decimalPlaces, 10);
    const pixelsPerUnit = parseFloat(kontainer.dataset.pixelsPerUnit);
    const FeinskalaEinheit = parseFloat(kontainer.dataset.feinskalaEinheit);

    // Überprüfen, ob die Zahl innerhalb des Bereichs liegt
    if (zahl < Min || zahl > Max) {
        alert(`Die Zahl ${zahl} liegt außerhalb des Zahlenstrahls (${Min} bis ${Max}).`);
        return null;
    }

    // Berechnung der x-Position der Zahl
    const xpos = paddingLeft + (zahl - Min) * pixelsPerUnit;

    // Erstellen eines Gruppen-Elements
    const svgNS = "http://www.w3.org/2000/svg";
    const group = document.createElementNS(svgNS, 'g');

    // Zuweisen einer eindeutigen ID
    markCounter++;
    const markID = `mark-${markCounter}`;
    group.setAttribute('id', markID);

    // Optional: Bewegbarkeit als Klasse hinzufügen
    if (bewegbar) {
        group.classList.add('movable', 'cross');
    } else {
        group.classList.add('cross');
    }

    group.setAttribute('transform', `translate(${xpos},0)`);
    group.dataset.value = parseFloat(zahl.toFixed(decimalPlaces)); // Runden des Wertes

    // Erstellen des "×" Symbols
    const crossSize = 10; // Größe des "×"

    // Erstes Linie des "×"
    const line1 = document.createElementNS(svgNS, 'line');
    line1.setAttribute('x1', -crossSize / 2);
    line1.setAttribute('y1', lineY - crossSize / 2);
    line1.setAttribute('x2', crossSize / 2);
    line1.setAttribute('y2', lineY + crossSize / 2);
    line1.setAttribute('stroke', farbe);
    line1.setAttribute('stroke-width', '2');
    group.appendChild(line1);

    // Zweites Linie des "×"
    const line2 = document.createElementNS(svgNS, 'line');
    line2.setAttribute('x1', crossSize / 2);
    line2.setAttribute('y1', lineY - crossSize / 2);
    line2.setAttribute('x2', -crossSize / 2);
    line2.setAttribute('y2', lineY + crossSize / 2);
    line2.setAttribute('stroke', farbe);
    line2.setAttribute('stroke-width', '2');
    group.appendChild(line2);

    // Optional: Beschriftung der Zahl
    if (sichtbar) {
        const text = document.createElementNS(svgNS, 'text');
        text.setAttribute('x', 0);
        text.setAttribute('y', lineY + crossSize + 25); // Position unterhalb des "×"
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('fill', farbe);
        text.style.fontSize = '14px';
        text.textContent = parseFloat(zahl.toFixed(decimalPlaces));
        group.appendChild(text);
    }

    // Optional: Anzeige der Markierungs-ID als Tooltip
    group.setAttribute('title', `Markierung ID: ${markID}`);

    // Append the group to the SVG
    svg.appendChild(group);

    // Rückgabe der Markierungs-ID
    return markID;
}

/**
 * Markiert einen Pfeil auf einem bestehenden Zahlenstrahl.
 * Fügt einen Pfeil von einer Startzahl um einen bestimmten Wert hinzu und optional eine Beschriftung der Veränderung.
 * Macht das Element anklickbar und verschiebbar, je nach Einstellung.
 * @param {string} KontainerID - Die ID des Container-Elements, das den Zahlenstrahl enthält.
 * @param {number} start - Die Zahl, bei der der Pfeil startet.
 * @param {string} operator - Der Operator ('+' oder '-'), der die Richtung der Veränderung bestimmt.
 * @param {number} value - Der Wert, um den der Pfeil verlängert wird (muss positiv sein).
 * @param {string} [farbe='black'] - Die Farbe des Pfeils und der Beschriftung.
 * @param {boolean} [sichtbar=true] - Bestimmt, ob oberhalb des Pfeils eine Beschriftung der Veränderung angezeigt wird.
 * @param {boolean} [bewegbar=true] - Bestimmt, ob das Objekt verschiebbar ist.
 * @returns {string|null} - Die eindeutige ID der erstellten Markierung oder null bei Fehler.
 */
function markierePfeil(KontainerID, start, operator, value, farbe = 'black', sichtbar = true, bewegbar = true) {
    // Validierung des Operators
    if (operator !== '+' && operator !== '-') {
        alert("Der Operator muss entweder '+' oder '-' sein.");
        return null;
    }

    // Validierung des Wertes
    if (value < 0) {
        alert("Der Wert muss positiv sein.");
        return null;
    }

    // Berechnung der Veränderung basierend auf dem Operator
    const change = operator === '+' ? value : -value;
    const end = start + change;

    // Kontainer-Element abrufen
    const kontainer = document.getElementById(KontainerID);
    if (!kontainer) {
        alert('Kontainer mit der angegebenen ID nicht gefunden.');
        return null;
    }

    // Überprüfen, ob ein SVG-Zahlenstrahl vorhanden ist
    const svg = kontainer.querySelector('svg');
    if (!svg) {
        alert('Es wurde kein Zahlenstrahl im angegebenen Kontainer gefunden.');
        return null;
    }

    // Aus den Datenattributen die notwendigen Werte abrufen
    const Min = parseFloat(kontainer.dataset.min);
    const Max = parseFloat(kontainer.dataset.max);
    const Skalierung = parseFloat(kontainer.dataset.skalierung);
    const paddingLeft = parseFloat(kontainer.dataset.paddingLeft);
    const paddingRight = parseFloat(kontainer.dataset.paddingRight);
    const lineY = parseFloat(kontainer.dataset.lineY);
    const canvasWidth = parseFloat(kontainer.dataset.canvasWidth);
    const decimalPlaces = parseInt(kontainer.dataset.decimalPlaces, 10);
    const pixelsPerUnit = parseFloat(kontainer.dataset.pixelsPerUnit);
    const FeinskalaEinheit = parseFloat(kontainer.dataset.feinskalaEinheit);

    // Überprüfen, ob die Zahl innerhalb des Bereichs liegt
    if (start < Min || start > Max) {
        alert(`Die Startzahl ${start} liegt außerhalb des Zahlenstrahls (${Min} bis ${Max}).`);
        return null;
    }
    if (end < Min || end > Max) {
        alert(`Die Endzahl ${end} liegt außerhalb des Zahlenstrahls (${Min} bis ${Max}).`);
        return null;
    }

    // Berechnung der x-Positionen der Start- und Endzahlen
    const xStart = paddingLeft + (start - Min) * pixelsPerUnit;
    const xEnd = paddingLeft + (end - Min) * pixelsPerUnit;

    // Definieren eines einzigartigen Marker-IDs
    markerCounter++;
    const markerId = `arrowhead-${markerCounter}`;

    // Definieren des Pfeilkopfs
    const svgNS = "http://www.w3.org/2000/svg";
    const defs = svg.querySelector('defs') || (() => {
        const newDefs = document.createElementNS(svgNS, 'defs');
        svg.appendChild(newDefs);
        return newDefs;
    })();

    const marker = document.createElementNS(svgNS, 'marker');
    marker.setAttribute('id', markerId);
    marker.setAttribute('markerWidth', '10');
    marker.setAttribute('markerHeight', '7');
    marker.setAttribute('refX', '10');
    marker.setAttribute('refY', '3.5');
    marker.setAttribute('orient', 'auto');
    marker.setAttribute('markerUnits', 'strokeWidth');

    const arrowPath = document.createElementNS(svgNS, 'path');
    arrowPath.setAttribute('d', 'M0,0 L10,3.5 L0,7 Z');
    arrowPath.setAttribute('fill', farbe);
    marker.appendChild(arrowPath);
    defs.appendChild(marker);

    // Erstellen der Pfeillinie
    const line = document.createElementNS(svgNS, 'line');
    line.setAttribute('x1', 0);
    line.setAttribute('y1', lineY);
    line.setAttribute('x2', (end - start) * pixelsPerUnit);
    line.setAttribute('y2', lineY);
    line.setAttribute('stroke', farbe);
    line.setAttribute('stroke-width', '2');
    line.setAttribute('marker-end', `url(#${markerId})`);

    // Erstellen eines Gruppen-Elements
    const group = document.createElementNS(svgNS, 'g');

    // Zuweisen einer eindeutigen ID
    markCounter++;
    const markID = `mark-${markCounter}`;
    group.setAttribute('id', markID);

    // Optional: Bewegbarkeit als Klasse hinzufügen
    if (bewegbar) {
        group.classList.add('movable', 'arrow');
    } else {
        group.classList.add('arrow');
    }

    // Runden der Start- und Änderungswerte entsprechend decimalPlaces
    const gerundeterStart = parseFloat(start.toFixed(decimalPlaces));
    const gerundeterChange = parseFloat(change.toFixed(decimalPlaces));

    group.setAttribute('transform', `translate(${xStart},0)`);
    group.dataset.start = gerundeterStart;
    group.dataset.change = gerundeterChange;

    group.appendChild(line);

    // Optional: Beschriftung der Veränderung
    if (sichtbar) {
        const midX = ((end - start) * pixelsPerUnit) / 2;
        const midY = lineY - 15; // Position über dem Pfeil

        // Bestimmen des Vorzeichens der Veränderung für die Beschriftung
        const sign = gerundeterChange >= 0 ? '+' : '';
        const labelText = `${sign}${gerundeterChange}`;

        const text = document.createElementNS(svgNS, 'text');
        text.setAttribute('x', midX);
        text.setAttribute('y', midY);
        text.setAttribute('text-anchor', 'middle');
        text.setAttribute('fill', farbe);
        text.style.fontSize = '14px';
        text.textContent = labelText;
        group.appendChild(text);
    }

    // Optional: Anzeige der Markierungs-ID als Tooltip
    group.setAttribute('title', `Markierung ID: ${markID}`);

    // Append the group to the SVG
    svg.appendChild(group);

    // Rückgabe der Markierungs-ID
    return markID;
}

/**
 * Funktion zum Starten des Dragging.
 * @param {MouseEvent} evt - Das Mausereignis.
 */
function startDrag(evt) {
    const target = evt.target.closest('g.movable');
    if (target) {
        selectedElement = target;
        selectedSVG = target.ownerSVGElement;
        const mousePos = getMousePosition(evt, selectedSVG);
        const transform = selectedElement.getAttribute('transform');
        const translate = parseTransform(transform);
        offsetX = mousePos.x - translate.x;
        document.addEventListener('mousemove', onDrag);
        document.addEventListener('mouseup', endDrag);
        evt.preventDefault();
    }
}

/**
 * Funktion zum Beenden des Dragging.
 * @param {MouseEvent} evt - Das Mausereignis.
 */
function endDrag(evt) {
    selectedElement = null;
    selectedSVG = null;
    document.removeEventListener('mousemove', onDrag);
    document.removeEventListener('mouseup', endDrag);
}

/**
 * Funktion zum Bewegen des Elements während des Dragging.
 * @param {MouseEvent} evt - Das Mausereignis.
 */
function onDrag(evt) {
    if (selectedElement && selectedSVG) {
        const containerID = selectedSVG.parentElement.id;
        const container = document.getElementById(containerID);
        if (!container) return;

        const FeinskalaEinheit = parseFloat(container.dataset.feinskalaEinheit);
        const pixelsPerUnit = parseFloat(container.dataset.pixelsPerUnit);
        const paddingLeft = parseFloat(container.dataset.paddingLeft);
        const Min = parseFloat(container.dataset.min);
        const Max = parseFloat(container.dataset.max);
        const canvasWidth = parseFloat(container.dataset.canvasWidth);
        const decimalPlaces = parseInt(container.dataset.decimalPlaces, 10);

        const mousePos = getMousePosition(evt, selectedSVG);
        let newX = mousePos.x - offsetX;

        // Begrenzung auf den Zahlenstrahl
        const MinX = paddingLeft;
        const MaxX = canvasWidth - parseFloat(container.dataset.paddingRight);

        if (newX < MinX) newX = MinX;
        if (newX > MaxX) newX = MaxX;

        // Snap to grid
        const gridValue = Math.round((newX - paddingLeft) / (pixelsPerUnit * FeinskalaEinheit)) * FeinskalaEinheit;
        const snappedX = paddingLeft + gridValue * pixelsPerUnit;

        // Begrenzung nach dem Snapping
        let finalX = snappedX;
        if (finalX < MinX) finalX = MinX;
        if (finalX > MaxX) finalX = MaxX;

        // Aktualisieren der Transform-Eigenschaft
        selectedElement.setAttribute('transform', `translate(${finalX},0)`);

        // Überprüfen, ob es sich um ein Kreuz oder einen Pfeil handelt
        if (selectedElement.classList.contains('cross')) {
            const newValue = parseFloat((Min + gridValue).toFixed(decimalPlaces));
            selectedElement.dataset.value = newValue;

            const text = selectedElement.querySelector('text');
            if (text) {
                text.textContent = newValue.toFixed(decimalPlaces);
            }
        } else if (selectedElement.classList.contains('arrow')) {
            // Berechnung des neuen Startwerts
            const newStart = parseFloat((Min + gridValue).toFixed(decimalPlaces));
            selectedElement.dataset.start = newStart;

            // Update des Titel-Attributs
            const change = parseFloat(selectedElement.dataset.change).toFixed(decimalPlaces);
            selectedElement.setAttribute('title', `Markierung ID: ${selectedElement.id}, Start: ${newStart}, Änderung: ${change}`);

            // Aktualisieren der Beschriftung der Veränderung, falls vorhanden
            const text = selectedElement.querySelector('text');
            if (text) {
                const sign = parseFloat(change) >= 0 ? '+' : '';
                text.textContent = `${sign}${parseFloat(change)}`;
            }
        }
    }
}

/**
 * Hilfsfunktion zum Berechnen der Mausposition relativ zum SVG.
 * @param {MouseEvent} evt - Das Mausereignis.
 * @param {SVGSVGElement} svg - Das SVG-Element.
 * @returns {object} - Ein Objekt mit x und y Koordinaten.
 */
function getMousePosition(evt, svg) {
    const CTM = svg.getScreenCTM();
    return {
        x: (evt.clientX - CTM.e) / CTM.a,
        y: (evt.clientY - CTM.f) / CTM.d
    };
}

// Event-Listener für Dragging starten
document.addEventListener('mousedown', startDrag);

/**
 * Funktion zum Löschen einer Markierung anhand ihrer ID
 * @param {string} markID - Die eindeutige ID der Markierung (z.B. "mark-1")
 */
function loescheMarkierung(markID) {
    const mark = document.getElementById(markID);
    if (mark) {
        mark.parentNode.removeChild(mark);
        alert(`Markierung ${markID} wurde gelöscht.`);
    } else {
        alert(`Markierung mit ID ${markID} nicht gefunden.`);
    }
}

/**
 * Funktion zum Auflisten aller Markierungen in einem Container
 * @param {string} containerID - Die ID des Containers
 */
function listeMarkierungen(containerID) {
    const container = document.getElementById(containerID);
    if (!container) {
        alert('Kontainer mit der angegebenen ID nicht gefunden.');
        return;
    }

    const svg = container.querySelector('svg');
    if (!svg) {
        alert('Es wurde kein SVG-Zahlenstrahl im angegebenen Container gefunden.');
        return;
    }

    const markierungen = svg.querySelectorAll('g[id^="mark-"]');
    if (markierungen.length === 0) {
        alert('Keine Markierungen im angegebenen Container gefunden.');
        return;
    }

    // Erstellen einer Tabelle zur Anzeige der Markierungen
    let tableHTML = `
        <table id="markierungenTabelle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Typ</th>
                    <th>Startwert</th>
                    <th>Änderung</th>
                    <th>Farbe</th>
                    <th>Position (x)</th>
                    <th>Position (y)</th>
                </tr>
            </thead>
            <tbody>
    `;

    markierungen.forEach(mark => {
        const markID = mark.id;
        const classes = mark.classList;
        let typ = 'Unbekannt';
        if (classes.contains('cross')) typ = 'Kreuz';
        if (classes.contains('arrow')) typ = 'Pfeil';

        const transform = parseTransform(mark.getAttribute('transform'));
        const posX = transform.x.toFixed(2);
        const posY = transform.y.toFixed(2);

        // Farbe extrahieren
        let farbe = 'Unbekannt';
        if (typ === 'Kreuz') {
            const line1 = mark.querySelector('line:nth-child(1)');
            farbe = line1 ? line1.getAttribute('stroke') : 'Unbekannt';
        } else if (typ === 'Pfeil') {
            const line = mark.querySelector('line');
            farbe = line ? line.getAttribute('stroke') : 'Unbekannt';
        }

        // Weitere Daten je nach Typ sammeln
        let weitereDaten = '';
        if (typ === 'Kreuz') {
            const value = mark.dataset.value;
            weitereDaten = `Wert: ${value}`;
        } else if (typ === 'Pfeil') {
            const start = mark.dataset.start;
            const change = mark.dataset.change;
            weitereDaten = `Start: ${start}, Änderung: ${change}`;
        }

        tableHTML += `
            <tr>
                <td>${markID}</td>
                <td>${typ}</td>
                <td>${typ === 'Pfeil' ? mark.dataset.start : mark.dataset.value}</td>
                <td>${typ === 'Pfeil' ? mark.dataset.change : '—'}</td>
                <td style="background-color: ${farbe};">${farbe}</td>
                <td>${posX}</td>
                <td>${posY}</td>
            </tr>
        `;
    });

    tableHTML += `
            </tbody>
        </table>
    `;

    // Anzeige der Tabelle im markierungenAnzeige-Bereich
    document.getElementById('markierungenAnzeige').innerHTML = tableHTML;
}

/**
 * Event-Listener für das Zeichnen des Zahlenstrahls
 */
document.getElementById('zahlenstrahlForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Verhindert das Neuladen der Seite

    // Werte aus dem Formular holen
    const min = parseFloat(document.getElementById('min').value);
    const max = parseFloat(document.getElementById('max').value);
    const skalierung = parseFloat(document.getElementById('skalierung').value);
    const containerID = document.getElementById('containerID').value.trim();
    const farbe = document.getElementById('farbe').value || '#000000';

    // Validierung der Eingaben
    if (min >= max) {
        alert('Min muss kleiner als Max sein.');
        return;
    }

    // Zeichne den Zahlenstrahl
    zeichneZahlenstrahl(min, max, skalierung, containerID, farbe);
});

/**
 * Event-Listener für das Markieren eines Kreuzes
 */
document.getElementById('kreuzForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Verhindert das Neuladen der Seite

    // Werte aus dem Formular holen
    const markContainerID = document.getElementById('kreuzContainerID').value.trim();
    const zahl = parseFloat(document.getElementById('kreuzZahl').value); // Nutzung von parseFloat statt parseInt
    const markFarbe = document.getElementById('kreuzFarbe').value || '#000000';
    const sichtbar = document.getElementById('kreuzSichtbar').checked;
    const bewegbar = document.getElementById('kreuzBewegbar').checked;

    // Markiere die Zahl als Kreuz und erhalte die Markierungs-ID
    const markID = markiereZahl(markContainerID, zahl, markFarbe, sichtbar, bewegbar);
    if (markID) {
        console.log(`Kreuz ID: ${markID}`);
    }
});

/**
 * Event-Listener für das Erstellen eines Pfeils
 */
document.getElementById('pfeilForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Verhindert das Neuladen der Seite

    // Werte aus dem Formular holen
    const pfeilContainerID = document.getElementById('pfeilContainerID').value.trim();
    const start = parseFloat(document.getElementById('pfeilStart').value);
    const operator = document.getElementById('pfeilOperator').value;
    const value = parseFloat(document.getElementById('pfeilWert').value);
    const pfeilFarbe = document.getElementById('pfeilFarbe').value || '#000000';
    const sichtbar = document.getElementById('pfeilSichtbar').checked;
    const bewegbar = document.getElementById('pfeilBewegbar').checked;

    // Markiere den Pfeil und erhalte die Markierungs-ID
    const markID = markierePfeil(pfeilContainerID, start, operator, value, pfeilFarbe, sichtbar, bewegbar);
    if (markID) {
        console.log(`Pfeil ID: ${markID}`);
    }
});

/**
 * Event-Listener für das Löschen einer Markierung
 */
document.getElementById('loescheMarkierungForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Verhindert das Neuladen der Seite

    const markID = document.getElementById('markID').value.trim();
    if (markID) {
        loescheMarkierung(markID);
    } else {
        alert('Bitte gib eine gültige Markierungs-ID ein.');
    }
});

/**
 * Event-Listener für das Auflisten der Markierungen
 */
document.getElementById('listeMarkierungenForm').addEventListener('submit', function(event) {
    event.preventDefault(); // Verhindert das Neuladen der Seite

    const containerID = document.getElementById('listeContainerID').value.trim();
    if (containerID) {
        listeMarkierungen(containerID);
    } else {
        alert('Bitte gib eine gültige Container-ID ein.');
    }
});

/**
 * Beispielaufrufe der Funktion beim Laden der Seite
 */
window.onload = function() {
    // Zeichne zwei Zahlenstrahen als Beispiel
    zeichneZahlenstrahl(-10, 10, 1, 'kontainer', '#000000');
    zeichneZahlenstrahl(0, 100, 1, 'andererKontainer', '#000000');

    // Markiere eine Zahl als Kreuz
    const kreuzID = markiereZahl('kontainer', 0, '#FF0000', true, true); // Bewegbar
    if (kreuzID) {
        console.log(`Kreuz ID: ${kreuzID}`);
    }

    // Zeichnet einen Pfeil von 8 um +1 auf dem ersten Zahlenstrahl
    const pfeil1ID = markierePfeil('kontainer', 8, '+', 1, '#00FF00', true, true); // Bewegbar
    if (pfeil1ID) {
        console.log(`Pfeil ID: ${pfeil1ID}`);
    }

    // Zeichnet einen Pfeil von 50 um -30 auf dem zweiten Zahlenstrahl
    const pfeil2ID = markierePfeil('andererKontainer', 50, '-', 30, '#0000FF', true, false); // Nicht bewegbar
    if (pfeil2ID) {
        console.log(`Pfeil ID: ${pfeil2ID}`);
    }
}
</script>

</body>
</html>
