/**
 * Copyright 2014-2021 Edulo.com
 * http://www.edulo.com/
 */

!function(){var u=new AModule("audio_player");u.noSaveData=!0,u.initContent=function(e){e.JSON.url=""},u.players={},u.refreshContent=function(t){if("true"==t.JSON.noplayer){var e="";t.JSON.width&&"auto"!=t.JSON.width&&(e+="width:"+t.JSON.width+";"),t.htmlElement.html('<div class="audioImgPlayer" style="display:inline-block;position:relative;'+e+'"></div>');var n=null;t.JSON.image&&""!=t.JSON.image?(n=$('<img class="contentImage" alt="" style="width:100%">')).attr("src",widget.getMediaURLPath(t.JSON.image)):n=$('<div class="checkBtn" style="min-width:60px;min-height:60px;line-height:40px;width:60px;height:60px;margin:0"><i class="fa fa-volume-up"></i></div>');var i=$('<svg style="position:absolute;pointer-events:none;left:50%;margin-left:-30px;top:50%;margin-top:-30px;width:60px;height:60px" width="60" height="60"> <circle stroke="rgba(255,255,255,0.2)" stroke-width="10" fill="transparent" r="22" cx="30"cy="30" style="transition: 0.35s stroke-dashoffset;transform: rotate(-90deg);transform-origin: 50% 50%;"/><circle class="progress-ring__circle" stroke="rgba(255,255,255,0.8)" stroke-width="10" fill="transparent" r="22" cx="30"cy="30" style="transition: 0.35s stroke-dashoffset;transform: rotate(-90deg);transform-origin: 50% 50%;"/></svg>');i.hide(),$(".audioImgPlayer",t.htmlElement).append(n),$(".audioImgPlayer",t.htmlElement).append(i);var a=$(".progress-ring__circle",i).get(0),r=2*a.r.baseVal.value*Math.PI;a.style.strokeDasharray=r+" "+r,a.style.strokeDashoffset=r;var o=new Audio,l=0;function s(e){var t=r-e/100*r;a.style.strokeDashoffset=t}function d(){if(c)if(0!=l){var e=100*o.currentTime/l;s(e),99.9<e?u.players[t.id].stop():setTimeout(d,100)}else setTimeout(d,100)}var c=!1;u.players[t.id]={audio:o,stop:function(){c=!1,o.pause(),o.currentTime=0,i.hide()},play:function(){for(k in u.players)if(u.players[k])try{u.players[k].stop()}catch(e){}c=!0,s(0),o.play(),d(),i.show()}},n.on("click",function(){c?u.players[t.id].stop():u.players[t.id].play()}),u.editor||t.JSON.url&&""!=t.JSON.url?o.src=u.editor?"/api/sample.mp3":widget.getMediaURLPath(t.JSON.url,!0):u.players[t.id].play=function(){},o.addEventListener("playing",function(e){l=e.target.duration})}else t.htmlElement.html('<div style="width:100%;display:inline-block"><audio controls preload="none"><source src="'+(u.editor?"/api/sample.mp3":widget.getMediaURLPath(t.JSON.url))+'"></source></audio></div>'),$("audio",t.htmlElement).audioPlayer({classPrefix:"audioplayer",strPlay:"Play",strPause:"Pause",strVolume:"Volume"}),$(".audioplayer",t.htmlElement).addClass("audioplayer-novolume")},u.refreshEditorSidebarContent=function(e,t){e.append(u.editor.getAudioFileInput(u.translate("AudioFile"),t.JSON.url,function(e){t.JSON.url=e})),e.append(u.editor.getToggleCheck(u.translate("useAudioPlayer"),"true"!=t.JSON.noplayer?"true":"false",function(e){t.JSON.noplayer="true"==e?"false":"true","false"==t.JSON.noplayer&&(delete t.JSON.image,delete t.JSON.width),u.editor.updateContentSidebar()})),"true"==t.JSON.noplayer&&(e.append(u.editor.getImageFileInput(u.translate("image"),t.JSON.image,function(e){t.JSON.image=e,u.editor.updateContentSidebar()})),t.JSON.image&&""!=t.JSON.image&&e.append(u.editor.getSelectInput(u.translate("Size"),["auto","100%","90%","80%","75%","70%","66%","60%","50%","40%","33%","30%","25%","20%","10%"],t.JSON.width,function(e){t.JSON.width=e})))}}(),function(){var r=new AModule("check_solution");r.buttonCheck=null,r.buttonHelp=null,r.buttonReset=null,r.showHelped=!0,r.hasCheckableElements=!1,r.delay=function(e,t){"instant"==r.JSON.speed?e&&e():setTimeout(e,r.getNextDelay(t))},r.getNextDelay=function(e){var t=50;return"normal"==r.JSON.speed&&(t=50),"fast"==r.JSON.speed&&(t=10),"instant"==r.JSON.speed&&(t=1),void 0===e&&(e=1),r.globalCheckSolutinDelay++*(t*e)},r.wasReloaded=!1,r.reloadCheck=function(e){if(!r.wasReloaded&&!r.editor&&(widget.forceCheck||"1"!=widget.JSON.asTest)&&(widget.forceCheck||"1"==helper.getLocalStorage("widgetchecked|"+widget.JSON.id))){var t=r.wasReloaded=!0,n=(r.isOK=!1,r.JSON.speed);r.JSON.speed="instant",r.globalCheckSolutinDelay=0,widget.forEachContent(function(e){return e.isChecked=!0,"checkSolution"in e.module&&0==e.module.checkSolution(e)&&(t=!1),"hasStillHelp"in e.module&&e.module.hasStillHelp(e)&&!0,!0},function(){r.isOK=t,"function"==typeof e&&e(),r.JSON.speed=n,widget.setSolved&&widget.setSolved()})}},r.check=function(n){if(!r.editor){r.buttonCheck&&r.buttonCheck.attr("disabled","disabled"),r.buttonHelp&&r.buttonHelp.attr("disabled","disabled");var i=!(r.globalCheckSolutinDelay=0);r.isOK=!1;widget.forEachContent(function(e){return e.isChecked=!0,"checkSolution"in e.module&&0==e.module.checkSolution(e)&&(i=!1),"hasStillHelp"in e.module&&e.module.hasStillHelp(e)&&!0,!0},function(){r.isOK=i;var e=function(){r.delay(function(){r.buttonCheck&&r.buttonCheck.removeAttr("disabled"),r.buttonHelp&&r.buttonHelp.removeAttr("disabled"),"function"==typeof n&&n()})};if(widget.JSON.remoteUserData&&""!=widget.JSON.remoteUserData)e();else{r.markWidgetChecked();var t=widget.findModule("save_load");t?t.save(e):e(),widget.setSolved&&widget.setSolved()}})}},r.help=function(a){if(!r.editor){r.buttonCheck&&r.buttonCheck.attr("disabled","disabled"),r.buttonHelp&&r.buttonHelp.attr("disabled","disabled");var t=!1;return widget.forEachContent(function(i){if(i.parent){if(!(e=function e(t){if(t.parent&&!(n=e(t.parent)))return!1;if("helpSolution"in t.module){var n=t.module.helpSolution(t);if(a||n||widget.scrollingToElement||widget.scrollToElement(i.htmlElement),!n)return!1}return!0}(i.parent)))return!1}if("helpSolution"in i.module){var e=i.module.helpSolution(i);if(a||e||widget.scrollingToElement||widget.scrollToElement(i.htmlElement),!e)return!1}return!0},function(e){(t=e)||a?(r.buttonCheck&&r.buttonCheck.removeAttr("disabled"),r.buttonHelp&&r.buttonHelp.removeAttr("disabled")):setTimeout(function(){r.buttonCheck&&r.buttonCheck.removeAttr("disabled"),r.buttonHelp&&r.buttonHelp.removeAttr("disabled")},2e3),r.markWidgetChecked()}),t}},r.markWidgetChecked=function(){if(!widget.JSON.remoteUserData||""==widget.JSON.remoteUserData){helper.setLocalStorage("widgetchecked|"+widget.JSON.id,"1"),window.parent&&window.parent.postMessage("WIDGETINPUTCHECKED|"+widget.JSON.id,"*"),console.log("Autocheck "+widget.JSON.id);var e=widget.findModule("save_load");e&&e.save()}},r.durationToString=function(e){var t=Math.floor(e/3600),n=Math.floor(e%3600/60),i=Math.floor(e%60),a="";return 0<t&&(a+=t+":"+(n<10?"0":"")),a+=n+":"+(i<10?"0":""),a+=""+i},r.refreshModule=function(){r.buttonCheck&&r.buttonCheck.remove(),r.buttonHelp&&r.buttonHelp.remove(),r.buttonReset&&r.buttonReset.remove(),r.buttonCheck=null,r.buttonHelp=null,r.buttonReset=null,r.hasResetableElements=!1,r.hasCheckableElements="1"==widget.JSON.asTest,r.checkableCount=0,widget.forEachContent(function(e){if("checkSolution"in e.module)if("getCheckableElements"in e.module){var t=e.module.getCheckableElements(e);0<t.length&&(r.hasCheckableElements=!0),"container"!=e.module.name&&(r.checkableCount+=t.length)}else r.hasCheckableElements=!0;return"clearUserInput"in e.module&&(r.hasResetableElements=!0),!0}),widget.contentWrapper.css("bottom",""),widget.hasResetButton=!1;var e=widget.hasBottomButtons=!1;if(r.hasCheckableElements||"1"==widget.JSON.asTest||setTimeout(r.markWidgetChecked,500),"1"==widget.JSON.asTest&&!r.editor){var t=0;r.testDoneInterval=setInterval(function(){if(!widget.user&&widget.testData)if(widget.testData.d){var e=widget.testData.d-widget.testData.s;$(".rightMenu.item-2").html('<i class="fa fa-clock-o"></i> '+r.durationToString(e))}else r.buttonFinish||(r.buttonFinish=$('<i class="fa fa-fw fa-sign-in" style="cursor:pointer" title="'+r.translate("FinishTestBtn")+'"></i>').on("click",function(){r.finishTest()}),$(".rightMenu.item-2").html(""),$(".rightMenu.item-2").append(r.buttonFinish));if(widget.testData&&widget.testData.d){$("#testOverlay").hide();e=widget.testData.d-widget.testData.s;t!=e&&window.parent&&window.parent.postMessage("TESTTIME|"+r.durationToString(e),"*"),t=e}widget.testData&&widget.testData.s&&$("#testOverlayStartBtn").html('<i class="fa fa-play"></i> '+r.translate("ContinueTestBtn"))},250)}if(!r.hasResetableElements||"1"==widget.JSON.asTest||widget.JSON.remoteUserData&&""!=widget.JSON.remoteUserData||r.editor||(r.buttonReset=$('<i class="fa fa-fw fa-trash-o" style="cursor:pointer" title="'+r.translate("Reset")+'"></i>').on("click",function(){var e=widget.findModule("save_load");e&&e.reset()}),widget.user||($(".rightMenu.item-2").html(""),$(".rightMenu.item-2").append(r.buttonReset)),window.parent&&window.parent.postMessage("HASRESETBUTTON","*"),widget.hasResetButton=!0),!r.hasCheckableElements||widget.JSON.remoteUserData&&""!=widget.JSON.remoteUserData)widget.contentWrapper.css("bottom","0px");else if("1"!=widget.JSON.asTest&&(r.buttonCheck=$('<button type="button" class="checkBtn">'+r.translate("Check")+"</button>").on("click",r.check),widget.add2FooterToolbar(r.buttonCheck),0==r.checkableCount?r.buttonCheck.hide():e=!0),"1"!=widget.JSON.asTest&&"1"!=widget.JSON.noSolution&&(r.buttonHelp=$('<button type="button" class="checkBtn">'+r.translate("Solution")+"</button>").on("click",function(){r.help()}),widget.add2FooterToolbar(r.buttonHelp),e=!0),e||widget.contentWrapper.css("bottom","0px"),widget.hasBottomButtons=e,"1"==widget.JSON.asTest&&!r.editor&&0==$("#testOverlay").length){var n=$('<div id="testOverlay"><div id="testOverlayStart"><img src="img/exam.png"/><p>'+r.translate("StartTestHint")+'</p><div id="testOverlayStartBtn" style="margin-bottom:5em" class="checkBtn"><i class="fa fa-play"></i> '+r.translate("StartTestBtn")+'</div></div><div id="testOverlayEnd" style="display:none"><img src="img/exam.png"/><p>'+r.translate("EndTestHint")+'</p><div id="testOverlayBackBtn" class="checkBtn"> '+r.translate("BackTestBtn")+'</div><div id="testOverlayEndBtn" style="margin-bottom:5em" class="checkBtn"><i class="fa fa-check"></i> '+r.translate("FinishTestBtn")+"</div></div></div>");$("#testOverlayStartBtn",n).on("click",function(e){$("#testOverlay").fadeOut(),widget.testData||(widget.testData={}),widget.testData.st=widget.JSON.serverTime,widget.testData.ct=widget.JSON.clientTime,widget.testData.s=widget.testData.s?widget.testData.s:Math.floor((new Date).getTime()/1e3),window.parent&&window.parent.postMessage("TESTSTART|"+widget.JSON.id,"*"),r.testInterval=setInterval(function(){var e=widget.testData.c,t=Math.floor((new Date).getTime()/1e3);t<e&&(widget.testData.s-=e-t,widget.testData.m=!0);var n=(widget.testData.c=t)-widget.testData.s;window.parent&&window.parent.postMessage("TESTTIME|"+r.durationToString(n),"*")},1e3);var t=widget.findModule("save_load");t&&t.save()}),$("#testOverlayBackBtn",n).on("click",function(e){$("#testOverlay").fadeOut(),window.parent&&window.parent.postMessage("TESTCONTINUE|"+widget.JSON.id,"*")}),$("#testOverlayEndBtn",n).on("click",function(e){$("#testOverlay").fadeOut(),clearInterval(r.testInterval),widget.testData.d=widget.testData.ft,window.parent&&window.parent.postMessage("TESTFINISHED|"+widget.JSON.id,"*");var t=widget.findModule("save_load");t&&t.save(),widget.setSolved&&widget.setSolved()}),$("body").append(n)}},r.finishTest=function(){$("#testOverlay").fadeIn(),$("#testOverlayEnd").css({display:"flex"}),$("#testOverlayStart").css({display:"none"}),widget.testData.ft=Math.floor((new Date).getTime()/1e3);var e=widget.testData.ft-widget.testData.s;window.parent&&window.parent.postMessage("TESTTIME|"+r.durationToString(e),"*"),window.parent&&window.parent.postMessage("TESTWAITFINISH","*")},r.init=function(){},r.initEditor=function(e){}}(),function(){var w=new AModule("cloud");w.user=null,w.loginPopup=null,w.forgotPassPopup=null,w.registerPopup=null,w.resultsPopup=null,w.userSettingsPopup=null,w.loginLastTime=0,w.loginAsked=!1,w.lastSyncRequest=null,w.getProgressbar=function(e){if("1"!=e.accessed||"1"!=e.checked)return'<div class="progress" style="margin:0"><div class="progress-bar" style="width: 0%"></div></div>';var t=e.counter_total,n=e.counter_correct-e.counter_helped,i=e.counter_helped,a=e.counter_wrong;if("0"==t)return'<div class="progress" style="margin:0"><div class="progress-bar progress-bar-success" style="width: 100%"></div></div>';if(0<t){return'<div class="progress" style="margin:0"><div class="progress-bar progress-bar-success" style="width: '+100*n/t+'%"></div><div class="progress-bar progress-bar-warning" style="width: '+100*i/t+'%"></div><div class="progress-bar progress-bar-danger" style="width: '+100*a/t+'%"></div></div>'}},w.buildResultSheet=function(e){for(var t,n,i=$('<div class="resultSheet"></div>'),a=JSON.parse(helper.getLocalStorage("collectiondata|"+widget.JSON.collectionid)),r=[{name:"",widgets:[]}],o=0;o<a.length;o++){var l=null;a[o].Chapter||(a[o].Chapter="");for(var s=0;s<r.length;s++)r[s].name==a[o].Chapter&&(l=r[s]);null==l&&(l={name:a[o].Chapter,widgets:[]},r.push(l)),l.widgets.push(a[o])}for(var d=0;d<r.length;d++){var c=!1,u=(n=r[d],$("<div>"+(""!=n.name?"<b>"+n.name+"</b><br>":"")+'<table style="width:100%;border:0" class="tablecontent"></table></div>'));for(s=0;s<r[d].widgets.length;s++)for(o=0;o<e.length;o++)e[o].ID==r[d].widgets[s].ID&&($(".tablecontent",u).append((t=e[o],$('<tr class="liveResultsRow"><td class="caption'+(t.ID==widget.JSON.id?" current":"")+'">'+t.Title+"</td><td>"+w.getProgressbar(t)+"</td></tr>"))),c=!0);c&&i.append(u)}return i},w.openResultDialog=function(){if(!(null!=w.resultsPopup&&0<w.resultsPopup.parent().length)&&(w.resultsPopup=widget.largePopup(w.translate("Results"),'<div class="content"></div>',[{close:!0},{text:w.translate("OK")}]),widget.JSON.collectionid&&"0"!=widget.JSON.collectionid)){for(var e=JSON.parse(helper.getLocalStorage("collectiondata|"+widget.JSON.collectionid)),t=0;t<e.length;t++){var n=helper.getLocalStorage("widgetinput|"+e[t].ID);if(null===n)e[t].accessed="0";else{var i=JSON.parse(n);e[t].counter_total=0,e[t].counter_correct=0,e[t].counter_helped=0;for(var a=e[t].counter_wrong=0;a<i.contents.length;a++)e[t].counter_total+=i.contents[a].counter&&i.contents[a].counter.total?i.contents[a].counter.total:0,e[t].counter_correct+=i.contents[a].counter&&i.contents[a].counter.correct?i.contents[a].counter.correct:0,e[t].counter_helped+=i.contents[a].counter&&i.contents[a].counter.helped?i.contents[a].counter.helped:0,e[t].counter_wrong+=i.contents[a].counter&&i.contents[a].counter.wrong?i.contents[a].counter.wrong:0;e[t].accessed="1",e[t].checked=helper.getLocalStorage("widgetchecked|"+e[t].ID)}}$(".content",w.resultsPopup).append(w.buildResultSheet(e)),setTimeout(function(){var e=$(".current",w.resultsPopup),t=$(".smallPopupContainerContent",w.resultsPopup);0<e.length&&t.scrollTop(e.offset().top-t.offset().top+t.scrollTop()-20)},100)}},w.buildLiveResult=function(e){return $('<iframe style="border:0;width:100%;height:98%" src="'+w.JSON.serverRoot+w.JSON.liveResultsEndPoint+"?livewidget="+widget.JSON.id+"&collectionid="+(widget.JSON.collectionid?widget.JSON.collectionid:0)+"&userdata="+e.ID+"&r="+Math.random()+'"></iframe>')},w.openTeacherResultDialog=function(){null!=w.teacherResultsPopup&&0<w.teacherResultsPopup.parent().length||(w.teacherResultsPopup=widget.smallPopup(w.translate("StudentResults"),'<div class="content"></div><span class="errorTextSpan"></span>',[{close:!0},{text:w.translate("OK")}]),$.post(w.JSON.serverRoot+w.JSON.liveResultsEndPoint,{collectionid:widget.JSON.collectionid?widget.JSON.collectionid:0,widgetid:widget.JSON.id},function(e){if("FAILED"==e.result&&$(".errorTextSpan",w.teacherResultsPopup).html(w.translate(e.error)),"OK"==e.result){function i(e,t){var n=$('<div style="border:1px solid #eee;padding:5px;clear:both;"><span style="float:right;"><div style="padding:0;margin:0" class="checkBtn liveView"><i class="fa fa-check"></i> '+w.translate("Exercise")+"</div> "+(widget.JSON.collectionid&&"0"!=widget.JSON.collectionid?'<div style="padding:0;margin:0" class="checkBtn summaryView"><i class="fa fa-bar-chart"></i> '+w.translate("Summary")+"</div>":"")+"</span>"+t[e].Name+" "+t[e].Surname+"</div>");return $(".liveView",n).on("click",function(){!function e(t,n){var i=[{close:!0}];i.push({head:!0,classname:"clearBtn",style:"margin:0px;padding:0px;float:left",text:'<i class="fa fa-arrow-left"></i>',onclick:function(){return!(t<1||(e(t-1,n),0))}}),i.push({head:!0,classname:"clearBtn",style:"margin:0px;padding:0px;float:right;margin-right:20px",text:'<i class="fa fa-arrow-right"></i>',onclick:function(){return!(t>n.length-2||(e(t+1,n),0))}});var a=widget.fullscreenPopup(w.translate("ResultsOf",n[t]),'<div class="fullscreencontent" style="width:100%;height:100%"></div>',i);$(".fullscreencontent",a).append(w.buildLiveResult(n[t]))}(e,t)}),$(".summaryView",n).on("click",function(){!function e(t,n){var i=[{close:!0}];i.push({head:!0,classname:"clearBtn",style:"margin:0px;padding:0px;float:left",text:'<i class="fa fa-arrow-left"></i>',onclick:function(){return!(t<1||(e(t-1,n),0))}}),i.push({head:!0,classname:"clearBtn",style:"margin:0px;padding:0px;float:right;margin-right:20px",text:'<i class="fa fa-arrow-right"></i>',onclick:function(){return!(t>n.length-2||(e(t+1,n),0))}});var a=widget.largePopup(w.translate("ResultsOf",n[t]),'<div class="content"></div>',i);$(".content",a).append(w.buildResultSheet(n[t].results)),setTimeout(function(){var e=$(".current",a),t=$(".smallPopupContainerContent",a);0<e.length&&t.scrollTop(e.offset().top-t.offset().top+t.scrollTop()-20)},100)}(e,t)}),n}function t(n){var e=$('<div style="border:1px solid #eee;padding:5px;clear:both"><span style="float:right"><div class="checkBtn" style="padding:0;margin:0">'+w.translate("Results")+' <i class="fa fa-arrow-right"></i></div></span><b>'+n.Name+"</b></div>");return $(".checkBtn",e).on("click",function(){for(var e=widget.smallPopup(w.translate("ResultsIn",n),'<div class="content"></div>',[{close:!0},{text:"OK"}]),t=0;t<n.students.length;t++)$(".content",e).append(i(t,n.students))}),e}for(var n=$("<div></div>"),a=0;a<e.classes.length;a++)n.append(t(e.classes[a]));$(".content",w.teacherResultsPopup).append(n)}}).fail(function(){$(".errorTextSpan",w.teacherResultsPopup).html(w.translate("RequiresInternet"))}))},w.openRegisterDialog=function(o){null!=w.registerPopup&&0<w.registerPopup.parent().length||(w.registerPopup=widget.smallPopup(w.translate("Register"),w.translate("RegisterStart")+'<br><br><div class="loginPanelLabel">'+w.translate("Name")+':</div><div class="loginPanelInput"><input class="loginPanelName" maxlength="30" type="text"></div><div class="loginPanelLabel">'+w.translate("Surname")+':</div><div class="loginPanelInput"><input class="loginPanelSurname" maxlength="30" type="text"></div><div class="loginPanelLabel">'+w.translate("Email")+':</div><div class="loginPanelInput"><input class="loginPanelEmail" maxlength="50" type="text"></div><div class="loginPanelLabel">'+w.translate("Email")+'*</div><div class="loginPanelInput"><input class="loginPanelEmail2" maxlength="50" type="text" placeholder="'+w.translate("RetypeEmail")+'"></div><div class="loginPanelLabel">'+w.translate("Password")+':</div><div class="loginPanelInput"><input class="loginPanelPassword" maxlength="30" type="password"></div><br><span class="errorTextSpan"></span><br>',[{close:!0,onclick:function(){return w.openLoginDialog(o),!0}},{text:w.translate("Cancel"),icon:"fa fa-chevron-circle-left",classname:"clearBtn",onclick:function(){return w.openLoginDialog(o),!0}},{text:w.translate("Register"),icon:"fa fa-sign-in",onclick:function(t){var e=$(".loginPanelName",t),n=$(".loginPanelSurname",t),i=$(".loginPanelEmail",t),a=$(".loginPanelEmail2",t),r=$(".loginPanelPassword",t);return""==$.trim(e.val())?e.focus():""==$.trim(n.val())?n.focus():""==$.trim(i.val())?i.focus():""==$.trim(r.val())?r.focus():$.trim(i.val())!=$.trim(a.val())?(a.val(""),a.focus()):$.post(w.JSON.serverRoot+w.JSON.createNewUserEndPoint,{email:$.trim(i.val()),pass:$.trim(r.val()),name:$.trim(e.val()),surname:$.trim(n.val())},function(e){"FAILED"==e.result&&$(".errorTextSpan",t).html(w.translate(e.error)),"OK"==e.result&&(t.remove(),null!=w.loginPopup&&w.loginPopup.remove(),helper.setLocalStorage("widgetuser",JSON.stringify(e.user)),w.login(o))}).fail(function(){$(".errorTextSpan",t).html(w.translate("RequiresInternet"))}),!1}}]))},w.openUserSettingsDialog=function(){null!=w.userSettingsPopup&&0<w.userSettingsPopup.parent().length||(w.userSettingsPopup=widget.smallPopup(w.translate("AccountSettings"),w.translate("AccountSettingsStart")+" <i>"+(w.user?w.user.email:"")+"</i><br><br>",[{close:!0},{text:w.translate("Logout"),icon:"fa fa-sign-out",classname:"clearBtn",onclick:function(e){helper.setLocalStorage("widgetuser",null),helper.setLocalStorage("salt",null),helper.setLocalStorage("userid",null),w.user=null,widget.user=w.user,widget.userID=0,widget.isTeacher=!1,w.loginLastTime=0,w.refreshUserBtn(),$.post(w.JSON.serverRoot+w.JSON.logoutUserEndPoint,{},function(e){});var t=helper.getLocalStorage("allwidgets");t&&(allwidgets=JSON.parse(t));for(var n=0;n<allwidgets.length;n++)allwidgets[n].id&&(helper.setLocalStorage("widgetinput|"+allwidgets[n].id,null),helper.setLocalStorage("widgetchecked|"+allwidgets[n].id,null),delete allwidgets[n].synctime);helper.setLocalStorage("allwidgets",JSON.stringify(allwidgets)),widget.forEachContent(function(e){e.isChecked&&(e.isChecked=!1),"clearUserInput"in e.module&&e.module.clearUserInput(e)});var i=widget.findModule("help_solution");return i&&i.hideButton(),w.button&&w.button.removeAttr("disabled"),!0}},{text:w.translate("OK")}]))},w.openTeacherClassesDialog=function(){var e;if(!(null!=w.teacherClassesPopup&&0<w.teacherClassesPopup.parent().length)&&(w.user&&"1"==w.user.teacher)){w.teacherClassesPopup=widget.smallPopup(w.translate("TeacherClasses"),'<div class="classList"></div>',[{close:!0},{text:w.translate("OK")}]),0<w.user.teacherclasses.length&&$(".classList",w.classSettingsPopup).append($("<div>"+w.translate("TeacherClassesStart")+"<br><br></div>"));for(var t=0;t<w.user.teacherclasses.length;t++)$(".classList",w.teacherClassesPopup).append((e=w.user.teacherclasses[t],$('<div style="border:1px solid #eee;padding:5px"><span style="float:right;margin-right:20px; font-family:monospace"><i class="fa fa-key"></i> '+e.GUID+"</span><b>"+e.Name+"</b></div>")));0<w.user.classes.length&&$(".classList",w.teacherClassesPopup).append($("<br>"))}},w.openClassSettingsDialog=function(){if(!(null!=w.classSettingsPopup&&0<w.classSettingsPopup.parent().length)&&w.user){function e(e){var t=$('<div style="border:1px solid #eee;padding:5px"><span style="float:right;cursor:pointer" class="removeFromClass"><i class="fa fa-trash-o"></i></span><span style="float:right;margin-right:20px;font-family:monospace"><i class="fa fa-key"></i> '+e.GUID+"</span><b>"+e.Name+"</b> von <b>"+(0<e.TeacherName.length?e.TeacherName[0]+".":"")+" "+e.TeacherSurname+"</b></div>");return $(".removeFromClass",t).on("click",function(){$.post(w.JSON.serverRoot+w.JSON.classUserEndPoint,{unjoinclass:e.GUID},function(e){w.classSettingsPopup.remove(),w.loginLastTime=0,w.login(function(){w.openClassSettingsDialog()})})}),t}w.classSettingsPopup=widget.smallPopup(w.translate("ClassSettings"),'<div class="classList"></div>'+w.translate("ProvideClassCode")+'<br><br><div class="loginPanelLabel">'+w.translate("ClassCode")+':</div><div class="loginPanelInput"><input class="loginPanelCode" type="text" value="'+(w.user.currentClassCode?w.user.currentClassCode:"")+'"></div><span class="errorTextSpan"></span>',[{close:!0},{text:w.translate("Join"),style:"width:250px",icon:"fa fa-sign-in",onclick:function(t){var e=$(".loginPanelCode",t);return $.post(w.JSON.serverRoot+w.JSON.classUserEndPoint,{joinclass:$.trim(e.val())},function(e){"FAILED"==e.result&&$(".errorTextSpan",t).html(w.translate(e.error)),"OK"==e.result&&(t.remove(),w.loginLastTime=0,w.login())}).fail(function(){$(".errorTextSpan",t).html(w.translate("RequiresInternet"))}),!1}}]),0<w.user.classes.length&&$(".classList",w.classSettingsPopup).append($("<div>"+w.translate("ClassSettingsStart")+"<br><br></div>"));for(var t=0;t<w.user.classes.length;t++)$(".classList",w.classSettingsPopup).append(e(w.user.classes[t]));0<w.user.classes.length&&$(".classList",w.classSettingsPopup).append($("<br>"))}},w.openForgotPasswordDialog=function(i,t){w.forgotPassPopup=widget.smallPopup(w.translate("ForgotPassword"),w.translate("ForgotPasswordStart")+'<br><br><div class="loginPanelLabel">'+w.translate("Email")+':</div><div class="loginPanelInput"><input class="loginPanelEmail" type="text" value="'+(t||"")+'"></div><span class="errorTextSpan"></span>',[{text:w.translate("back"),icon:"fa fa-arrow-left",classname:"clearBtn",onclick:function(e){w.openLoginDialog(i,t)}},{text:w.translate("sendPassword"),icon:"fa fa-sign-in",style:"width:250px",onclick:function(t){var n=$(".loginPanelEmail",t);$.post(w.JSON.serverRoot+w.JSON.forgotPasswordEndPoint,{email:$.trim(n.val())},function(e){"FAILED"==e.result&&$(".errorTextSpan",t).html(w.translate(e.error)),"OK"==e.result&&(t.remove(),widget.smallPopup(w.translate("passwordSend"),w.translate("passwordSendNotice",{email:$.trim(n.val())}),[{text:w.translate("OK"),icon:"fa fa-check",onclick:function(e){w.openLoginDialog(i,$.trim(n.val()))}}]))}).fail(function(){$(".errorTextSpan",t).html(w.translate("RequiresInternet"))})}}])},w.openResetPasswordDialog=function(n,i,a){null!=w.resetPasswordPopup&&0<w.resetPasswordPopup.parent().length||(w.resetPasswordPopup=widget.smallPopup(w.translate("changePassword"),w.translate("changePasswordStart")+'<br><br><div class="loginPanelLabel">'+w.translate("Password")+':</div><div class="loginPanelInput"><input class="loginPanelPassword" type="password"></div>',[{text:w.translate("Save"),icon:"fa fa-save",onclick:function(t){var e=$(".loginPanelPassword",t);return""==$.trim(e.val())?e.focus():$.post(w.JSON.serverRoot+w.JSON.loginUserEndPoint,{email:n,pass:i,newpass:$.trim(e.val())},function(e){"OK"==e.result&&(t.remove(),helper.setLocalStorage("widgetuser",JSON.stringify(e.user)),w.loginLastTime=0,w.login(a))}),!1}}]))},w.openLoginDialog=function(a,e){null!=w.loginPopup&&0<w.loginPopup.parent().length||(w.loginPopup=widget.smallPopup(w.translate("Login"),w.translate("LoginStart")+'<br><br><div class="loginPanelLabel">'+w.translate("Email")+':</div><div class="loginPanelInput"><input class="loginPanelEmail" type="text" value="'+(null!=w.user?w.user.email:e||"")+'"></div><div class="loginPanelLabel">'+w.translate("Password")+':</div><div class="loginPanelInput"><input class="loginPanelPassword" type="password"></div><br><span class="errorTextSpan"></span><br><div class="loginForgotPasswortPanel">'+w.translate("ForgotPassword?")+"</div>",[{close:!0},{text:w.translate("Register"),icon:"fa fa-edit",classname:"clearBtn",onclick:function(e){w.openRegisterDialog(a)}},{text:w.translate("Login"),icon:"fa fa-sign-in",onclick:function(t){var n=$(".loginPanelEmail",t),i=$(".loginPanelPassword",t);return""==$.trim(n.val())?n.focus():""==$.trim(i.val())?i.focus():$.post(w.JSON.serverRoot+w.JSON.loginUserEndPoint,{email:$.trim(n.val()),pass:$.trim(i.val())},function(e){"FAILED"==e.result&&$(".errorTextSpan",t).html(w.translate(e.error)),"OK"==e.result&&(t.remove(),helper.setLocalStorage("widgetuser",JSON.stringify(e.user)),w.loginLastTime=0,w.login(a)),"RESETPASSWORD"==e.result&&(t.remove(),w.openResetPasswordDialog($.trim(n.val()),$.trim(i.val()),a))}).fail(function(){$(".errorTextSpan",t).html(w.translate("RequiresInternet"))}),!1}}]),$(".loginForgotPasswortPanel",w.loginPopup).on("click",function(){var e=$(".loginPanelEmail",w.loginPopup);w.openForgotPasswordDialog(a,$.trim(e.val()))}))},w.openTeacherExerciseDialog=function(){null!=w.teacherExercisePopup&&0<w.teacherExercisePopup.parent().length||(w.teacherExercisePopup=widget.smallPopup(w.translate("AboutExcercise"),'<table style="width:100%;border:0"><tr><td>ID:</td><td>'+widget.JSON.id+"</td></tr><tr><td>Name:</td><td>"+widget.JSON.name+'</td></tr><tr><td valign="top">Titel:</td><td>'+widget.JSON.title+'</td></tr><tr><td>URL:</td><td><a href="'+w.JSON.serverRoot+widget.JSON.GUID+'">'+w.JSON.serverRoot+widget.JSON.GUID+"</a></td></tr>"+(widget.JSON.collectionid?"<tr><td>&nbsp;</td></tr><tr><td>Sammlung:</td><td>"+widget.JSON.collectionname+"</td></tr>":"")+"</table>",[{close:!0},{text:"OK"}]))},w.refreshUserBtn=function(){if($(".userAccount",widget.headlineElement).remove(),"true"==w.JSON.active&&!w.editor&&"1"!=helper.getURLParam("inapp")){var t;if(w.user){if((t=$('<div class="userAccount"><span><i class="fa fa-user"></i> '+w.user.name+' <i class="arrowCaret fa fa-caret-down"></i></span><ul style="font-size: 100%; left: auto; right: 0; z-index:999" class="dropdown-menu"></ul></div>')).on("click",function(e){e.stopPropagation(),$(".dropdown-menu",t).toggle(),$(".arrowCaret").hasClass("fa-caret-down")?($(".arrowCaret").removeClass("fa-caret-down"),$(".arrowCaret").addClass("fa-caret-up")):($(".arrowCaret").removeClass("fa-caret-up"),$(".arrowCaret").addClass("fa-caret-down")),$("body").one("click",function(){$(".dropdown-menu",t).hide(),$(".arrowCaret").removeClass("fa-caret-up"),$(".arrowCaret").addClass("fa-caret-down")})}),"1"!=w.user.teacher&&(widget.JSON.collectionid&&"0"!=widget.JSON.collectionid&&$(".dropdown-menu",t).append($('<li><a href="#">'+w.translate("MyResults")+"</a></li>").on("click",function(){w.openResultDialog()})),$(".dropdown-menu",t).append($('<li><a href="#">'+w.translate("MyClasses")+"</a></li>").on("click",function(){w.openClassSettingsDialog()})),$(".dropdown-menu",t).append($('<li><a href="#">'+w.translate("Settings")+"</a></li>").on("click",function(){w.openUserSettingsDialog()}))),"1"==w.user.teacher){$(".dropdown-menu",t).append($('<li><a href="#">'+w.translate("StudentResults")+"</a></li>").on("click",function(){w.openTeacherResultDialog()})),$(".dropdown-menu",t).append($('<li><a href="#">'+w.translate("ClassCodes")+"</a></li>").on("click",function(){w.openTeacherClassesDialog()}));var n=widget.findModule("check_solution");n&&n.hasCheckableElements&&$(".dropdown-menu",t).append($('<li><a href="#">'+w.translate("solveExercise")+"</a></li>").on("click",function(){var e=n.JSON.speed;for(n.JSON.speed="instant";!n.help(););n.check(),n.JSON.speed=e})),$(".dropdown-menu",t).append($("<li><hr/></li>")),$(".dropdown-menu",t).append($('<li><a href="#">'+w.translate("Settings")+"</a></li>").on("click",function(){w.openUserSettingsDialog()}))}"1"==w.user.admin&&($(".dropdown-menu",t).append($("<li><hr/></li>")),$(".dropdown-menu",t).append($('<li><a href="#">'+w.translate("AboutExcercise")+"</a></li>").on("click",function(){w.openTeacherExerciseDialog()})))}else(t=$('<div class="userAccount"><i class="fa fa-user"></i> '+w.translate("Login")+"</div>")).on("click",function(){w.openLoginDialog()});$(".rightMenu.item0",widget.headlineElement).append(t),$(window).trigger("resize")}},w.login=function(n,i){var e=helper.getLocalStorage("widgetuser");if(null!==e||null!=w.user){if(w.user=JSON.parse(e),widget.user=w.user,widget.userID=w.user.id,widget.isTeacher="1"==w.user.teacher,0!=w.loginLastTime)if(((new Date).getTime()-w.loginLastTime.getTime())/1e3<600)return void("function"==typeof n&&n());$.post(w.JSON.serverRoot+w.JSON.loginUserEndPoint,{uid:w.user.id,salt:w.user.salt},function(e){if("FAILED"==e.result&&(widget.smallPopup(w.translate("LoginError"),w.translate(e.error),[{text:w.translate("OK"),onclick:function(e){return w.openLoginDialog(n),!0}}]),w.user=null,widget.user=null,"function"==typeof i&&i()),"OK"==e.result){helper.setLocalStorage("widgetuser",JSON.stringify(e.user)),w.user=e.user,widget.user=w.user,widget.userID=w.user.id,widget.isTeacher="1"==w.user.teacher,w.loginLastTime=new Date,w.refreshUserBtn();var t=helper.getLocalStorage("widgetinput|"+widget.JSON.id);w.sync(function(){var e=widget.findModule("save_load");e?e.load(n,t?JSON.parse(t):null):"function"==typeof n&&n()})}}).fail(function(){w.loginLastTime=new Date,w.refreshUserBtn();var e=helper.getLocalStorage("widgetinput|"+widget.JSON.id),t=widget.findModule("save_load");t?t.load(n,e?JSON.parse(e):null):"function"==typeof n&&n()})}else 0==w.loginAsked?(w.loginAsked=!0,$.post(w.JSON.serverRoot+w.JSON.checkOnlineEndPoint,{},function(){w.openLoginDialog(n)}).fail(i)):"function"==typeof i&&i()},w.firstSync=!0,w.sync=function(S){"1"!=helper.getURLParam("inapp")?"true"!=w.JSON.active||w.editor||widget.JSON.remoteUserData&&""!=widget.JSON.remoteUserData?"function"==typeof S&&S():w.login(function(){null!=w.lastSyncRequest&&w.lastSyncRequest.abort();var e=[],t=[],n=[],v=Math.floor((new Date).getTime()/1e3),i=helper.getLocalStorage("allwidgets");i&&(n=JSON.parse(i));for(var a=0;a<n.length;a++)n[a].id&&(null===helper.getLocalStorage("widgetinput|"+n[a].id)&&(n[a].synctime=0),e.push(n[a].id),w.firstSync||n[a].id!=widget.JSON.id||(n[a].synctime=v),t.push(n[a].synctime));JSON.parse(helper.getLocalStorage("widgetinput|"+widget.JSON.id));var r={uid:w.user.id,widgetid:widget.JSON.id,allwidgets:e.join(","),allwidgetsynctimes:t.join(",")};w.firstSync&&widget.JSON.collectionid&&"0"!=widget.JSON.collectionid&&(r.collectionid=widget.JSON.collectionid),r["widgetinput|"+widget.JSON.id]=helper.getLocalStorage("widgetinput|"+widget.JSON.id);var o=helper.getLocalStorage("widgetchecked|"+widget.JSON.id);r["widgetchecked|"+widget.JSON.id]="1"==o?"1":"0",w.lastSyncRequest=$.post(w.JSON.serverRoot+w.JSON.syncDataEndPoint,r,function(e){if("OK"==e.result){w.firstSync=!1,e.collectiondata&&helper.setLocalStorage("collectiondata|"+widget.JSON.collectionid,JSON.stringify(e.collectiondata));for(var t=0;t<e.widgets.length;t++)helper.setLocalStorage("widgetinput|"+e.widgets[t].id,JSON.stringify(e.widgets[t])),helper.setLocalStorage("widgetchecked|"+e.widgets[t].id,e.checked[t]+"");var n=[],i=helper.getLocalStorage("allwidgets");i&&(n=JSON.parse(i));var a=e.sendwidgets.split(",");for(t=0;t<e.widgets.length;t++){for(var r=!1,o=0;o<n.length;o++){n[o].id==e.widgets[t].id&&(r=!0);break}if(!r&&e.collectiondata){var l={id:e.widgets[t].id};for(o=0;o<e.collectiondata.length;o++)if(e.collectiondata[o].ID==l.id){l.name=e.collectiondata[o].Name,l.title=e.collectiondata[o].Title,l.collectionname=widget.JSON.collectionname,l.collectionid=widget.JSON.collectionid,n.push(l);break}}}var s=e.synctimes.split(",");for(t=0;t<a.length;t++)for(o=0;o<n.length;o++)n[o].id==a[t]&&(n[o].synctime=s[t]);var d=e.requests.split(",");for(t=0;t<d.length;t++)for(o=0;o<n.length;o++)n[o].id!=d[t]||n[o].synctime||(n[o].synctime=v);helper.setLocalStorage(n,JSON.stringify(n)),"function"==typeof S&&S();var c=[],u=[],p={uid:w.user.id,widgetid:widget.JSON.id},g=!1;for(t=0;t<d.length;t++)if(""!=$.trim(d[t])){g=!0;var h=helper.getLocalStorageKeys();for(o=0;o<h.length;o++){var f=h[o];if(f=="widgetinput|"+d[t]){p[f]=helper.getLocalStorage(f);var m=helper.getLocalStorage("widgetchecked|"+d[t]);p["widgetchecked|"+d[t]]="1"==m?"1":"0";break}}c.push(d[t]);for(o=0;o<n.length;o++)n[o].id==d[t]&&u.push(n[o].synctime?n[o].synctime:v)}g&&(p.allwidgets=c.join(","),p.allwidgetsynctimes=u.join(","),$.post(w.JSON.serverRoot+w.JSON.syncDataEndPoint,p))}else alert("ERROR: "+e.result+"\n"+w.translate(e.error))},"json").fail(S)},S):"function"==typeof S&&S()},w.reset=function(t){if("true"==w.JSON.active&&!w.editor&&w.user&&"1"!=helper.getURLParam("inapp")){var e={uid:w.user.id,widgetid:widget.JSON.id};$.post(w.JSON.serverRoot+w.JSON.resetDataEndPoint,e,function(e){"OK"!=e.result&&alert(e.result),"function"==typeof t&&t()},"json").fail(t)}else"function"==typeof t&&t()},w.refreshModule=function(){if(w.refreshUserBtn(),widget.JSON.remoteUserData&&""!=widget.JSON.remoteUserData){var e=widget.findModule("check_solution");if(e&&e.hasCheckableElements){var t=e.JSON.speed;e.JSON.speed="instant",e.showHelped=!0,e.check(),e.JSON.speed=t}}},w.init=function(){"file:"==window.location.protocol&&(w.JSON.active="false"),w.sync()},w.initEditor=function(n){w.editorTile=n.addTile(w.JSON.title,{icon:'<i class="fa fa-cloud"></i>'}),w.editorTile.on("click",function(){var t=w.JSON.active;n.showModalDialog("<h1>"+w.translate("title_cloud")+" "+w.translate("Modul")+"</h1>",[{text:w.translate("Cancel"),classname:"btn-default",icon:"fa fa-times"},{text:w.translate("Save"),icon:"fa fa-save",onclick:function(e){return w.JSON.active=t,n.inputValueChanged(),!0}}],function(e){e.append(w.editor.getSelectInput(w.translate("status")+":",[w.translate("active"),w.translate("inactive")],"true"==w.JSON.active?w.translate("active"):w.translate("inactive"),function(e){t=e==w.translate("active")?"true":"false"}))})})}}(),function(){var h=new AModule("cloze_dropdown");h.maxClozeLength=0,h.initContent=function(e){e.JSON.text="<p>"+h.translate("cloze_text_preset")+"</p>",e.JSON.clozes=[],e.clozeInputs=[]},h.getConnectedValues=function(n,e){var i=JSON.parse(JSON.stringify(n.JSON.values));if(e.JSON&&e.JSON.clozes&&"true"==n.JSON.connected&&n.JSON.connections&&0<n.JSON.connections.length){var t=$.trim(n.inputElement.val());$.each(e.clozeInputs,function(e,t){t.JSON.id!=n.JSON.id&&0<=n.JSON.connections.indexOf(t.JSON.id)&&(i=i.concat(t.JSON.values))});for(var a=!1,r=0;r<e.clozeInputs.length;r++){var o=e.clozeInputs[r];if(!(n.JSON.connections.indexOf(o.JSON.id)<0))if(o.JSON.id!=n.JSON.id){if(o.inputElement){var l=$.trim(o.inputElement.val());if(a&&l==t)continue;for(var s=0;s<i.length;s++)if("true"==i[s].correct&&i[s].value==l){i.splice(s,1);break}}}else a=!0}i.sort(function(e,t){return e.value.localeCompare(t.value)})}return i},h.checkSingleClozeInput=function(e,t){for(var n=$.trim(e.inputElement.val()),i=!1,a=!1,r=h.getConnectedValues(e,t),o=0;o<r.length;o++)if("true"==r[o].correct&&(a=!0),"true"==r[o].correct&&r[o].value==n){i=!0;break}return a||""!=n||(i=!0),e.correct=i?"true":"false",i},h.getCheckableElements=function(e){var t=[];if("true"==e.JSON.nocheck)return t;if(e.clozeInputs)for(var n=0;n<e.clozeInputs.length;n++){var i=e.clozeInputs[n];"true"!=i.JSON.predefined&&t.push(i)}return t},h.addAlternativeHint=function(n){var i=0;if(!("true"==n.JSON.connected&&n.JSON.connections&&0<n.JSON.connections.length)){for(var e=0;e<n.JSON.values.length;e++)"true"==n.JSON.values[e].correct&&""!=n.JSON.values[e].value&&i++;"<p><br></p>"==n.JSON.altText&&(n.JSON.altText=""),(1<i||""!=$.trim(n.JSON.altText))&&(n.inputElement.addClass("alternatives"),$(".clozeSolutionIcon",n.inputElement.parent()).on("click",function(){for(var e=h.translate("alternateSolutionStart")+':<br><div style="height:0.5em"></div>',t=0;t<n.JSON.values.length;t++)"true"==n.JSON.values[t].correct&&""!=$.trim(n.inputElement.val())&&$.trim(n.inputElement.val())!=n.JSON.values[t].value&&(e+='<div class="alternativelist"><i>'+n.JSON.values[t].value+"</i></div>");widget.smallPopup(h.translate("alternateText"),(n.JSON.altText&&""!=n.JSON.altText?n.JSON.altText+"<br>":"")+(1<i?e:""),[{close:!0},{text:h.translate("OK")}])}))}},h.addLastInputHint=function(e){e.inputElement.hasClass("helped")&&e.last&&""!=e.last&&$(".clozeSolutionIcon",e.inputElement.parent()).on("click",function(){widget.elementPopup(e.inputElement.parent(),"<del style='background:#ffe6e6'>"+e.last+"</del>")})},h.checkSolution=function(a){if("true"==a.JSON.nocheck)return!0;var r=widget.findModule("check_solution"),o=!0;return $.each(a.clozeInputs,function(e,t){if("true"!=t.JSON.predefined){t.inputElement.removeClass("helped correct wrong alternatives"),$(".clozeCarretIcon",t.inputElement.parent()).show(),$(".clozeSolutionIcon",t.inputElement.parent()).hide();var n=$.trim(t.inputElement.val()),i=h.checkSingleClozeInput(t,a);a.isChecked&&!i&&""!=n&&(t.helped="true"),i?(t.inputElement.addClass("correct"),r.showHelped&&"true"==t.helped&&t.inputElement.addClass("helped"),$(".clozeSolutionIcon",t.inputElement.parent()).off(),h.addLastInputHint(t),h.addAlternativeHint(t),r.delay(function(){$(".clozeCarretIcon",t.inputElement.parent()).hide(),$(".clozeSolutionIcon",t.inputElement.parent()).fadeIn()})):(t.inputElement.addClass("wrong"),t.last=n,r.delay(function(){$(".clozeCarretIcon",t.inputElement.parent()).hide(),$(".clozeSolutionIcon",t.inputElement.parent()).fadeIn()}),o=!1)}}),o},h.helpSolution=function(e){if("true"==e.JSON.nocheck)return!0;for(var t=0;t<e.clozeInputs.length;t++){var n=e.clozeInputs[t];if("true"!=n.JSON.predefined&&!h.checkSingleClozeInput(n,e)){n.inputElement.removeClass("helped correct wrong alternatives");for(var i="",a=h.getConnectedValues(n,e),r=0;r<a.length;r++)if("true"==a[r].correct){i=a[r].value;break}return widget.scrollToElement(n.inputElement),n.inputElement.effect("highlight"),n.helped="true",n.last=n.inputElement.val(),n.inputElement.val(i),!1}}return!0},h.findClozeByID=function(e,t){for(var n=null,i=0;i<e.JSON.clozes.length;i++)e.JSON.clozes[i].id==t&&(n=e.JSON.clozes[i]);return null==n&&(n={id:t,values:[{value:"",correct:"true"}]},e.JSON.clozes.push(n)),n},h.refreshContent=function(u){u.htmlElement.html(""!=$.trim(u.JSON.text)?u.JSON.text:"&nbsp;&nbsp;&nbsp;"),u.clozeInputs=[];var i=0;helper.findAndReplaceInElement(u.htmlElement,/##([0-9]+)##/g,function(e,t){var n=h.findClozeByID(u,t);return i++,u.clozeInputs.push({id:i,clozeID:t,JSON:n}),'<div class="inputcontainer '+("center"==n.inneralign?"center ":"")+("right"==n.inneralign?"rtl ":"")+'"><select class="clozedropdown inputline '+("true"==n.predefined?"disabled":"")+(n.displayMode&&"normal"!=n.displayMode?" "+n.displayMode:"")+'" type="text" id="'+u.id+"_cloze_text_input_"+i+'"></select><div class="clozeSolutionIcon"></div><div class="clozeCarretIcon"><i class="fa fa-sort-down"></i></div></div>'}),$.each(u.clozeInputs,function(e,t){t.inputElement=$("#"+u.id+"_cloze_text_input_"+t.id,u.htmlElement),FastClick.attach(t.inputElement.get(0))});var p=!1,g=[];if($.each(u.clozeInputs,function(e,t){for(var n=0;n<t.JSON.values.length;n++)"true"!=t.JSON.values[n].correct&&""!=t.JSON.values[n].value&&(p=!0),g.push(t.JSON.values[n])}),!p){for(var e=0;e<g.length;e++)for(var t=e+1;t<g.length;t++)if(g[t].value==g[e].value){g.splice(t,1);break}g.sort(function(e,t){return e.value.localeCompare(t.value)})}$.each(u.clozeInputs,function(e,t){var n=h.getConnectedValues(t,u);p||(n=g);var i="";i+='<option value="">&nbsp;</option>';var a=!0;for(e=0;e<n.length;e++){var r=!1;"true"==t.JSON.predefined&&"true"==n[e].correct&&a&&(r=!(a=!1)),i+="<option "+(r?"selected":"")+' value="'+n[e].value.replace(/"/g,"&quot;")+'">'+n[e].value+"</option>"}t.inputElement.html(i),t.inputElement.on("change",function(){t.inputElement.removeClass("helped correct wrong alternatives"),$(".clozeCarretIcon",t.inputElement.parent()).show(),h.checkSingleClozeInput(t,u);var e=widget.findModule("save_load");e&&e.save()}),h.checkSingleClozeInput(t,u);for(var o=t.JSON,l=0,s=0;s<n.length;s++)l=Math.max(l,helper.measureTextWidth(n[s].value.length<3?n[s].value.toUpperCase():n[s].value,"inputcontainer > cloze inputline "+(o.displayMode&&"normal"!=o.displayMode?" "+o.displayMode:"")));var d="",c=o.displayMode&&"normal"!=o.displayMode?0:4;o.size&&"auto"!=o.size||(d=3+l+c+"px"),0==isNaN(parseInt(o.size))&&(d=3+parseInt(15*o.size)+c+"px"),"100%"==o.size&&(d="100%",t.inputElement.parent().css("width",d)),t.inputElement.css("width",d)})},h.saveUserInput=function(e,t){if(e.clozeInputs)for(var n=0;n<e.clozeInputs.length;n++)"true"!=e.clozeInputs[n].JSON.predefined&&(t.input.push({id:e.clozeInputs[n].JSON.id,v:e.clozeInputs[n].inputElement.val(),l:e.clozeInputs[n].last?e.clozeInputs[n].last:"",c:e.clozeInputs[n].correct,h:e.clozeInputs[n].helped}),"true"==e.clozeInputs[n].correct?t.counter.correct++:""!=e.clozeInputs[n].inputElement.val()&&t.counter.wrong++,"true"==e.clozeInputs[n].correct&&"true"==e.clozeInputs[n].helped&&t.counter.helped++,t.counter.total++)},h.clearUserInput=function(e){if(e.clozeInputs)for(var t=0;t<e.clozeInputs.length;t++)"true"!=e.clozeInputs[t].JSON.predefined&&(e.clozeInputs[t].inputElement.val(""),e.clozeInputs[t].last=null,e.clozeInputs[t].helped="false",e.clozeInputs[t].correct="false",e.clozeInputs[t].inputElement.removeClass("helped correct wrong alternatives"),$(".clozeCarretIcon",e.clozeInputs[t].inputElement.parent()).show())},h.loadUserInput=function(e,t){if(t)for(var n=0;n<t.length;n++)if(e.clozeInputs)for(var i=0;i<e.clozeInputs.length;i++)"true"!=e.clozeInputs[i].JSON.predefined&&e.clozeInputs[i].JSON.id==t[n].id&&(e.clozeInputs[i].inputElement&&e.clozeInputs[i].inputElement.val(t[n].v),e.clozeInputs[i].last=t[n].l&&""!=t[n].l?t[n].l:null,e.clozeInputs[i].helped=t[n].h,e.clozeInputs[i].correct=t[n].c)},h.getInputHTMLElements=function(e){var n=[];return $.each(e.clozeInputs,function(e,t){n.push({e:t.inputElement.parent(),id:t.JSON.id})}),n},h.upgradeUserInputVersion=function(e,t,n){if("1"==t)for(var i=0;i<n.length;i++);},h.upgradeContentVersion=function(e,t){if("1"==t)for(var n=0;n<e.JSON.clozes.length;n++)"true"==e.JSON.clozes[n].rtl&&(e.JSON.clozes[n].inneralign="right"),delete e.JSON.clozes[n].rtl},h.refreshModule=function(){},h.init=function(){},h.findNextUnusedID=function(e){for(var t=1;;){if(!new RegExp("##("+t+")##","gi").exec(e.JSON.text))return t;t++}},h.refreshEditorSidebarContent=function(e,s){var l=$("<div>"+h.translate("Text")+':<br><div class="richtext">'+s.JSON.text+'</div><div class="clozeWarning"></div><br><div class="clozeButtons" style="padding-right:20px"></div><div class="clozeList sidebarBlockElement"></div></div>');e.append(l),h.editor.makeRichTextEditor({target:$(".richtext",l),buttons:[{title:h.translate("InsertCloze"),icon:"fa fa-edit",click:function(e,t){var n=0,i=t;if(i=$.trim(i),t.match(/^##([0-9]+)##$/)){var a=t.match(/[0-9]+/);n=a[0],i=""}else n=h.findNextUnusedID(s);for(var r=h.findClozeByID(s,n),o=!1,l=0;l<r.values.length;l++)r.values[l].value==$.trim(i)&&(o=!0);return 0==o&&(0<r.values.length&&""==r.values[0].value?(r.values[0].value=$.trim(i),r.values[0].correct="true"):r.values.push({value:$.trim(i),visible:"true",correct:"true"})),setTimeout(function(){h.editorShowClozeDetail(n,s)},1),"##"+n+"##"+(""==t?" ":"")}},{title:h.translate("ConvertToClozes"),icon:"fa fa-bars",click:function(e,t){var n=e.content.code();return n=n.replace(/(<p[^>]*?>)(.*?)<\/p>/g,function(e,t,n){for(var i=1,a=0;a<s.JSON.clozes.length;a++)i<=parseInt(s.JSON.clozes[a].id)&&(i=parseInt(s.JSON.clozes[a].id)+1);return h.findClozeByID(s,i).values[0]={value:$.trim(n),visible:"true",correct:"true"},t+"##"+i+"##</p>"}),e.content.html(n),setTimeout(function(){h.editorRefreshClozeButtonList(s,s.JSON.clozes[s.JSON.clozes.length-1].id)},1),""}}],onChange:function(e){s.JSON.text=e;for(var t,n="",i=new RegExp("##([0-9]+)##","gi"),a={};t=i.exec(e);)a[t[1]]||(a[t[1]]=0),a[t[1]]++;var r=[];for(var o in a)1<a[o]&&r.push(o);0<r.length&&(n+='<div style="color:red;margin:0.5em">Achtung: Lücke '+r.join(" und ")+" wurde mehrfach verwendet. Bitte korrigieren!</div>"),$(".clozeWarning",l).html(n),h.editorRefreshClozeButtonList(s,s.currentClozeID)},onHoverText:function(e){var t=e.match(/##([0-9]+)##/);if(t){var n=t[0].replace(/#/g,"");h.editorShowClozeDetail(n,s)}}}),h.editorRefreshClozeButtonList(s,-1),h.editor.advancedMode&&(e.append($("<hr>")),e.append(h.editor.getToggleCheck(h.translate("withCorrection"),"true"==s.JSON.nocheck?"false":"true",function(e){s.JSON.nocheck="false"==e?"true":"false"})))},h.editorRefreshClozeButtonList=function(r,o){var e=$(".clozeButtons",r.sidebarElement);e.html(""),r.currentClozeID=o;var l=0;-1!=o&&h.findClozeByID(r,o);var s=$('<div class="btn-group"></div>');$.each(r.JSON.clozes,function(e,t){if(new RegExp("##"+t.id+"##","gi").exec(r.JSON.text)){var n=$('<div class="btn btn-'+(t.id==o?"primary":"gray")+' btn-xs">'+h.translate("Cloze")+" "+t.id+"</div>");n.on("click",function(){h.editorShowClozeDetail(t.id,r)}),s.append(n),l++}else{o==t.id&&(o=-1,r.currentClozeID=o,$(".clozeList",r.sidebarElement).html(""));for(var i=0;i<r.JSON.clozes.length;i++)if(r.JSON.clozes[i].connections)for(var a=0;a<r.JSON.clozes[i].connections.length;a++)if(r.JSON.clozes[i].connections[a]==t.id){r.JSON.clozes[i].connections.splice(a,1);break}delete t.connections}});var t=$('<div class="sidebarBlockInputButtons btn-group" style="margin-top:0px"></div>');e.append(t),0==l&&s.append(h.translate("noClozes")),e.append(s)},h.editorShowClozeDetail=function(e,r){h.editorRefreshClozeButtonList(r,e);var t=$(".clozeList",r.sidebarElement);if(t.html(""),t.addClass("sideBarSubFrame"),1!=e||0!=r.JSON.clozes.length){var o=h.findClozeByID(r,e),l=function(){h.editorShowClozeDetail(e,r),s()},a=$("<div></div>");a.append($('<div class="solutionWarning"></div>'));var s=function(){for(var e="",t=0;t<o.values.length;t++){for(var n=0,i=t;i<o.values.length;i++)o.values[t].value==o.values[i].value&&n++;1<n&&(e+='<div style="color:red;margin:0.5em">Achtung: Lösung '+o.values[t].value+" wurde mehrfach verwendet. Bitte korrigieren!</div>")}$(".solutionWarning",a).html(e)};if(h.editor.buildSortableList(a,o.values,function(e,t){var n=$('<input class="form-control input-sm" style="display:block" type="text">');n.get(0).oninput=function(e){h.editor.widget.replaceGermanQuotes(e)},n.val(t.value),n.on("change keyup",function(){t.value=$.trim($(this).val()),s(),h.editor.inputValueChanged()}),h.refreshEditorSidebarContentFocusLast&&o.values.length-1==e&&(h.refreshEditorSidebarContentFocusLast=!1,setTimeout(function(){n.focus()},10));var i=h.editor.getSmallIconBtn("true"==t.correct?"fa-check-square-o":"fa-square-o",function(){t.correct="true"==t.correct?"false":"true",h.editor.inputValueChanged(),l()});i.css({position:"absolute","margin-left":"-30px","margin-top":"-26px"}),i.attr("title","Antwort ist richtig / falsch"),i.tooltip();var a=$("<div></div>");return a.append(n),a.append(i),a},function(){return h.refreshEditorSidebarContentFocusLast=!0,{value:"",correct:"false"}},function(){l()}),t.append(h.editor.getCustomInput(h.translate("Answers"),a)),s(),h.editor.advancedMode){t.append(h.editor.getRichTextInput(h.translate("alternateSolutionIntro"),o.altText,function(e){o.altText=e},!0,!0)),t.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(h.editor.getApplyToAllBtn(function(){h.editor.openApplyAttributeToAllDialog(r,"clozes.size",o.size,l)}))),t.append(h.editor.getSelectInput(h.translate("Size"),["auto","100%","1","2","3","4","5","6","8","10","12","15","20","25","30","35","40","45","50"],o.size,function(e){o.size=e,l()})),t.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(h.editor.getApplyToAllBtn(function(){h.editor.openApplyAttributeToAllDialog(r,"clozes.displayMode",o.displayMode,l)}))),t.append(h.editor.getSelectInput(h.translate("displayMode"),["normal","underlined","box"],o.displayMode,function(e){o.displayMode=e,l()}));var n=o.inneralign?o.inneralign:"";t.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(h.editor.getApplyToAllBtn(function(){h.editor.openApplyAttributeToAllDialog(r,"clozes.inneralign",o.inneralign,l)}))),t.append(h.editor.getContentAlignSelectInput(h.translate("editor_styleAlign"),n,function(e){o.inneralign=e,l()}));var d=function(n,i){if(delete i.connected,delete i.connections,n.connections){var e=n.connections.indexOf(i.id);-1!=e&&n.connections.splice(e,1);for(var a=0;a<n.connections.length;a++)$.each(r.JSON.clozes,function(e,t){t.id==n.connections[a]&&t.connections&&-1<t.connections.indexOf(i.id)&&d(t,i)});$.each(r.JSON.clozes,function(e,t){t.connections&&0==t.connections.length&&(delete t.connected,delete t.connections)})}},c=function(n,i){n.connected="true",i.connected="true",n.connections||(n.connections=[]),n.connections.push(i.id),i.connections||(i.connections=[]),i.connections.push(n.id);for(var a=0;a<n.connections.length;a++)$.each(r.JSON.clozes,function(e,t){t.id==n.connections[a]&&(t.connections&&-1!=t.connections.indexOf(i.id)||c(i,t))});for(a=0;a<i.connections.length;a++)$.each(r.JSON.clozes,function(e,t){t.id==i.connections[a]&&(t.connections&&-1!=t.connections.indexOf(n.id)||c(t,n))})};if(t.append(h.editor.getToggleCheck(h.translate("connectedClozes"),o.connected,function(e){"true"==(o.connected=e)?o.connections=[]:function(n){if(n.connections)for(var i=0;i<n.connections.length;i++)$.each(r.JSON.clozes,function(e,t){n.connections&&t.id==n.connections[i]&&t.id!=n.id&&(delete t.connected,delete t.connections)});delete n.connected,delete n.connections}(o),l()})),"true"==o.connected){var i=$('<div class="btn-group"><i class="fa fa-link fa-fw" style="float:left;margin-top:5px"></i> </div>');$.each(r.JSON.clozes,function(e,t){var n;new RegExp("##"+t.id+"##","gi").exec(r.JSON.text)&&(t.id!=o.id?(n=$('<div class="btn btn-'+(-1!=o.connections.indexOf(t.id)?"primary":"gray")+' btn-xs">'+h.translate("Cloze")+" "+t.id+"</div>")).on("click",function(){-1==o.connections.indexOf(t.id)?c(o,t):d(o,t),h.editor.inputValueChanged(),l()}):n=$('<div class="btn btn-primary btn-xs" style="pointer-events:none">'+h.translate("Cloze")+" "+t.id+"</div>"),i.append(n))}),t.append(i)}}t.append(h.editor.getToggleCheck(h.translate("predefined"),o.predefined,function(e){o.predefined=e,l()}))}}}(),function(){var u=new AModule("cloze_text");u.maxClozeLength=0,u.initContent=function(e){e.JSON.text="<p>"+u.translate("cloze_text_preset")+"</p>",e.JSON.clozes=[],e.clozeInputs=[]},u.getConnectedValues=function(n,e){var i=JSON.parse(JSON.stringify(n.JSON.values));if(e.JSON&&e.JSON.clozes&&"true"==n.JSON.connected&&n.JSON.connections&&0<n.JSON.connections.length){var t=$.trim(n.inputElement.val());$.each(e.clozeInputs,function(e,t){t.JSON.id!=n.JSON.id&&0<=n.JSON.connections.indexOf(t.JSON.id)&&(i=i.concat(t.JSON.values))});for(var a=!1,r=0;r<e.clozeInputs.length;r++){var o=e.clozeInputs[r];if(!(n.JSON.connections.indexOf(o.JSON.id)<0))if(o.JSON.id!=n.JSON.id){if(o.inputElement){var l=$.trim(o.inputElement.val());if(a&&l==t)continue;for(var s=0;s<i.length;s++)if(i[s].value==l){i.splice(s,1);break}}}else a=!0}}return i},u.checkSingleClozeInput=function(e,t){for(var n=u.getConnectedValues(e,t),i=$.trim(e.inputElement.val()),a=!1,r=0;r<n.length;r++)if(helper.compareSanitized(n[r].value,i,!0)||"false"==e.JSON.casesense&&helper.compareSanitized(n[r].value.toLowerCase(),i.toLowerCase(),!0)){a=!0;break}return"true"==e.JSON.unchecked&&(a=""!=i),e.correct=a?"true":"false",a},u.getCheckableElements=function(e){var t=[];if("true"==e.JSON.nocheck)return t;if(e.clozeInputs)for(var n=0;n<e.clozeInputs.length;n++){var i=e.clozeInputs[n];"true"!=i.JSON.predefined&&t.push(i)}return t},u.addAlternativeHint=function(a,e){var i=0,r=[],o=$.trim(a.inputElement.val());if(a.JSON&&"true"==a.JSON.connected&&a.JSON.connections&&0<a.JSON.connections.length){for(var t=0,n=0;n<a.JSON.connections.length;n++)t=Math.max(t,a.JSON.connections[n]);if(t!=a.JSON.id)return;$.each(e.clozeInputs,function(e,t){if(0<=a.JSON.connections.indexOf(t.JSON.id))for(var n=0;n<t.JSON.values.length;n++)r.indexOf(t.JSON.values[n].value)<0&&r.push(t.JSON.values[n].value)});var l=0;if($.each(e.clozeInputs,function(e,t){for(var n=$.trim(t.inputElement.val()),i=0;i<r.length;i++)(helper.compareSanitized(n,r[i],!0)||"false"==a.JSON.casesense&&helper.compareSanitized(n.toLowerCase(),r[i].toLowerCase(),!0))&&(r.splice(i,1),l++,i--)}),l<a.JSON.connections.length)return;for(n=0;n<r.length;n++)r[n]={value:r[n],visible:"true"};i=r.length+1}else{for(var s=0;s<a.JSON.values.length;s++)"false"!=a.JSON.values[s].visible&&""!=a.JSON.values[s].value?i++:"false"==a.JSON.values[s].visible&&""!=a.JSON.values[s].value&&widget.isTeacher?i++:"false"==a.JSON.values[s].visible&&(helper.compareSanitized(a.JSON.values[s].value,o,!0)||"false"==a.JSON.casesense&&helper.compareSanitized(a.JSON.values[s].value.toLowerCase(),o.toLowerCase(),!0))&&i++;"<p><br></p>"==a.JSON.altText&&(a.JSON.altText=""),r=a.JSON.values}(1<i||""!=$.trim(a.JSON.altText))&&(a.inputElement.addClass("alternatives"),$(".clozeSolutionIcon",a.inputElement.parent()).on("click",function(){for(var e=u.translate("alternateSolutionStart")+':<br><div style="height:0.5em"></div>',t="",n=0;n<r.length;n++)""!=o&&(helper.compareSanitized(r[n].value,o,!0)||"false"==a.JSON.casesense&&helper.compareSanitized(r[n].value.toLowerCase(),o.toLowerCase(),!0)||("false"!=r[n].visible&&(e+='<div class="alternativelist"><i>'+r[n].value+"</i></div>"),"false"==r[n].visible&&widget.isTeacher&&(t+='<div class="alternativelist"><i>'+r[n].value+"</i></div>")));"true"==a.JSON.unchecked?""!=$.trim(a.JSON.altText)&&widget.smallPopup(u.translate("alternateSolution"),a.JSON.altText,[{close:!0},{text:u.translate("OK")}]):widget.smallPopup(u.translate("alternateText"),(a.JSON.altText&&""!=a.JSON.altText?a.JSON.altText+"<br>":"")+(1<i?e:"")+(""!=t?"<br>"+u.translate("alternateSolutionTeacherOnly")+":<br>"+t:""),[{close:!0},{text:u.translate("OK")}])}))},u.addLastInputHint=function(n){n.inputElement.hasClass("helped")&&n.last&&""!=n.last&&$(".clozeSolutionIcon",n.inputElement.parent()).on("click",function(){var e=$.trim(n.inputElement.val()),t=widget.stringDiffAsHTML(n.last,e);widget.elementPopup(n.inputElement,t)})},u.checkSolution=function(a){if("true"==a.JSON.nocheck)return!0;var r=widget.findModule("check_solution"),o=!0;return $.each(a.clozeInputs,function(e,t){if("true"!=t.JSON.predefined){var n=$.trim(t.inputElement.val());t.inputElement.removeClass("helped correct wrong alternatives"),$(".clozeSolutionIcon",t.inputElement.parent()).hide();var i=u.checkSingleClozeInput(t,a);a.isChecked&&!i&&""!=n&&(t.helped="true"),i?(t.inputElement.addClass("correct"),r.showHelped&&"true"==t.helped&&t.inputElement.addClass("helped"),$(".clozeSolutionIcon",t.inputElement.parent()).off(),u.addLastInputHint(t),u.addAlternativeHint(t,a),r.delay(function(){$(".clozeSolutionIcon",t.inputElement.parent()).fadeIn()})):(t.inputElement.addClass("wrong"),r.delay(function(){$(".clozeSolutionIcon",t.inputElement.parent()).fadeIn()}),""!=n&&(t.last=n),o=!1)}}),o},u.helpSolution=function(e){if("true"==e.JSON.nocheck)return!0;for(var t=0;t<e.clozeInputs.length;t++){var n=e.clozeInputs[t];if("true"!=n.JSON.predefined&&!u.checkSingleClozeInput(n,e)){if("true"==n.JSON.unchecked)return n.inputElement.effect("highlight"),n.helped="true",n.inputElement.val("..."),n.inputElement.trigger("keydown"),widget.scrollToElement(n.inputElement),!1;n.inputElement.removeClass("helped correct wrong alternatives");var i=$.trim(n.inputElement.val()),a=u.getConnectedValues(n,e);0<a.length&&(selectedValue=a[0]);for(var r=9999999,o=null,l=0;l<a.length;l++){if(""==i){if("false"==a[l].visible)continue;selectedValue=a[l];break}var s=widget.stringDiffLevenshtein(i,a[l].value);s<r&&(r=s,o=a[l])}if(o&&(selectedValue=o),""!=i){var d=widget.stringDiffAsHTML(i,selectedValue.value);widget.elementPopup(n.inputElement,d)}return widget.scrollToElement(n.inputElement),n.inputElement.effect("highlight"),n.helped="true",n.last=i,n.inputElement.val(selectedValue.value),n.inputElement.trigger("keydown"),!1}}return!0},u.findClozeByID=function(e,t){for(var n=null,i=null,a=0;a<e.JSON.clozes.length;a++)e.JSON.clozes[a].id==t&&(n=e.JSON.clozes[a]),i=e.JSON.clozes[a];return null==n&&(n={id:t,casesense:"true",multiline:"false",displayMode:i?i.displayMode:"normal",unchecked:"false",values:[{value:"",visible:"true"}]},e.JSON.clozes.push(n)),n},u.checkNumericContent=function(e){for(var t=!1,n=0;n<e.length;n++)for(var i=0;i<e[n].JSON.values.length;i++)if("false"!=e[n].JSON.values[i].visible){if($.trim(e[n].JSON.values[i].value).match(/[^0-9\.\-\+,\(\)\*\%]/)||"-"==$.trim(e[n].JSON.values[i].value))return!1;""!=$.trim(e[n].JSON.values[i].value)&&(t=!0)}return t},u.openNumericPanel=function(i){var e=$('<div class="numericPanel"></div>'),t=[["7","8","9","⌫"],["4","5","6","-"],["1","2","3","+"],["0",".","(",")"]],a=!0;function n(t,n){t.downFlag=!1,t.on("touchstart",function(e){e.preventDefault(),e.stopPropagation(),t.trigger("click"),t.downFlag=!0,setTimeout(function(){t.downFlag=!1},200)}),t.on("touchstart click",function(e){e.preventDefault(),e.stopPropagation(),t.downFlag||("⌫"==n?i.inputElement.val(i.inputElement.val().slice(0,-1)):i.inputElement.val((a?"":i.inputElement.val())+n),a=!1,i.inputElement.removeClass("helped correct wrong alternatives"),i.inputElement.trigger("change"))})}for(var r=0;r<t.length;r++){for(var o=$('<div class="numericPanelRow"></div>'),l=0;l<t[r].length;l++){var s=$('<div class="numericBtn">'+t[r][l]+"</div>");n(s,t[r][l]),o.append(s)}e.append(o)}var d=widget.elementPopup(i.inputElement,e,"auto",!0);setTimeout(function(){$(document).one("touchstart click",function(){d.remove()})},1e3)},u.refreshContent=function(r){for(var e=0;e<r.JSON.clozes.length;e++)r.JSON.clozes[e].connections&&helper.uniqueArray(r.JSON.clozes[e].connections);r.htmlElement.html(""!=$.trim(r.JSON.text)?r.JSON.text:"&nbsp;&nbsp;&nbsp;"),r.clozeInputs=[];var o=0;helper.findAndReplaceInElement(r.htmlElement,/##([0-9]+)##/g,function(e,t){var n=u.findClozeByID(r,t),i={id:++o,clozeID:t,JSON:n};if(r.clozeInputs.push(i),"true"!=n.underlineOnly||n.displayMode&&"normal"!=n.displayMode||(n.displayMode="underlined"),n.underlineOnly&&delete n.underlineOnly,"true"!=n.multiline)return'<div class="inputcontainer '+("center"==n.inneralign?"center ":"")+("right"==n.inneralign?"rtl ":"")+'"><input oninput="widget.replaceGermanQuotes(event)" class="cloze inputline '+(n.displayMode&&"normal"!=n.displayMode?n.displayMode+" ":"")+("true"==n.unchecked?"unchecked ":"")+'" type="text" autocorrect="off" autocomplete="off" autocapitalize="off" spellcheck="false" '+("true"==n.predefined?'readonly="readonly" ':"")+'id="'+r.id+"_cloze_text_input_"+o+'"'+("true"==n.predefined&&0<n.values.length?'value="'+n.values[0].value.replace(/"/g,"&quot;")+'" ':"")+'/><div class="clozeSolutionIcon"></div></div>';n.lines&&""!=n.lines||(n.lines="2");var a="min-height:"+parseInt(n.lines)*("true"==n.dlh?3:1.5)+"em";return'<div class="inputcontainer '+("center"==n.inneralign?"center ":"")+("right"==n.inneralign?"rtl ":"")+'"><textarea oninput="widget.replaceGermanQuotes(event)" style="'+a+'" class="cloze multiline '+("true"==n.dlh?"doubleLineHeight ":"")+("true"==n.unchecked?"unchecked ":"")+'" autocorrect="off" autocomplete="off" autocapitalize="off" spellcheck="false" id="'+r.id+"_cloze_text_input_"+o+'"'+("true"==n.predefined?'readonly="readonly" ':"")+">"+("true"==n.predefined&&0<n.values.length?n.values[0].value:"")+'</textarea><div class="clozeSolutionIcon"></div></div>'}),$.each(r.clozeInputs,function(e,t){t.inputElement=$("#"+r.id+"_cloze_text_input_"+t.id,r.htmlElement),"true"==t.JSON.multiline&&setTimeout(function(){widget.autoExpandTextarea(t.inputElement)},1),"true"!=t.JSON.predefined&&u.checkNumericContent(r.clozeInputs)&&t.inputElement.on("click touchstart",function(e){e.preventDefault(),e.stopPropagation(),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&t.inputElement.blur(),u.openNumericPanel(t)}),t.inputElement.on("keydown",function(){t.inputElement.removeClass("helped correct wrong alternatives")}),"true"!=t.JSON.multiline&&t.inputElement.on("keypress",function(e){if(13==e.which){e.preventDefault();var t=$(":focusable"),n=t.index(document.activeElement)+1;n>=t.length&&(n=0),t.eq(n).focus()}}),t.inputElement.on("change",function(){u.checkSingleClozeInput(t,r);var e=widget.findModule("save_load");e&&e.save()}),u.checkSingleClozeInput(t,r)})},u.saveUserInput=function(e,t){if(e.clozeInputs)for(var n=0;n<e.clozeInputs.length;n++)"true"!=e.clozeInputs[n].JSON.predefined&&(t.input.push({id:e.clozeInputs[n].JSON.id,v:e.clozeInputs[n].inputElement.val(),l:e.clozeInputs[n].last?e.clozeInputs[n].last:"",c:e.clozeInputs[n].correct,h:e.clozeInputs[n].helped}),"true"==e.clozeInputs[n].correct?t.counter.correct++:""!=e.clozeInputs[n].inputElement.val()&&t.counter.wrong++,"true"==e.clozeInputs[n].correct&&"true"==e.clozeInputs[n].helped&&t.counter.helped++,t.counter.total++)},u.clearUserInput=function(e){if(e.clozeInputs)for(var t=0;t<e.clozeInputs.length;t++)"true"!=e.clozeInputs[t].JSON.predefined&&(e.clozeInputs[t].inputElement.val(""),e.clozeInputs[t].last=null,e.clozeInputs[t].helped="false",e.clozeInputs[t].correct="false",e.clozeInputs[t].inputElement.removeClass("helped correct wrong alternatives"))},u.loadUserInput=function(e,t){if(t)for(var n=0;n<t.length;n++)if(e.clozeInputs)for(var i=0;i<e.clozeInputs.length;i++)"true"!=e.clozeInputs[i].JSON.predefined&&e.clozeInputs[i].JSON.id==t[n].id&&(e.clozeInputs[i].inputElement&&(e.clozeInputs[i].inputElement.val(t[n].v),"true"==e.clozeInputs[i].JSON.multiline&&widget.autoExpandTextarea(e.clozeInputs[i].inputElement)),e.clozeInputs[i].last=t[n].l&&""!=t[n].l?t[n].l:null,e.clozeInputs[i].helped=t[n].h,e.clozeInputs[i].correct=t[n].c)},u.getInputHTMLElements=function(e){var n=[];return $.each(e.clozeInputs,function(e,t){n.push({e:t.inputElement,id:t.JSON.id})}),n},u.upgradeUserInputVersion=function(e,t,n){if("1"==t)for(var i=0;i<n.length;i++);},u.upgradeContentVersion=function(e,t){if("1"==t)for(var n=0;n<e.JSON.clozes.length;n++)"true"==e.JSON.clozes[n].rtl&&(e.JSON.clozes[n].inneralign="right"),delete e.JSON.clozes[n].rtl},u.refreshModule=function(){u.maxClozeLength=0,widget.forEachContent(function(e){if(e.module==u){for(var t=0,n=0;n<e.JSON.clozes.length;n++)for(var i=e.JSON.clozes[n],a=0;a<i.values.length;a++)"true"!=i.underlineOnly||i.displayMode&&"normal"!=i.displayMode||(i.displayMode="underlined"),i.underlineOnly&&delete i.underlineOnly,t=Math.max(t,helper.measureTextWidth(i.values[a].value.length<3?i.values[a].value.toUpperCase():i.values[a].value,"inputcontainer > cloze inputline "+("normal"!=i.displayMode?i.displayMode:"")));return u.maxClozeLength=Math.max(u.maxClozeLength,t),!0}}),widget.forEachContent(function(e){if(e.module==u){for(var r=0,o=[],t=0;t<e.JSON.clozes.length;t++)for(var n=e.JSON.clozes[t],i=o[n.id]=0;i<n.values.length;i++){var a=helper.measureTextWidth(n.values[i].value.length<3?n.values[i].value.toUpperCase():n.values[i].value,"inputcontainer > cloze inputline "+("normal"!=n.displayMode?n.displayMode:""));r=Math.max(r,a),o[n.id]=Math.max(o[n.id],a)}return $.each(e.clozeInputs,function(e,t){var n=t.JSON,i="",a="normal"!=n.displayMode?0:4;n.size&&"auto"!=n.size||(i=3+u.maxClozeLength+a+"px"),0==isNaN(parseInt(n.size))&&(i=3+parseInt(15*n.size)+a+"px"),"longest"==n.size&&(i=3+r+a+"px"),"100%"==n.size&&(i="100%",t.inputElement.parent().css("width",i)),"textlength"==n.size&&(i=3+o[n.id]+a+"px"),t.inputElement.css("width",i)}),!0}})},u.init=function(){},u.findNextUnusedID=function(e){for(var t=1;;){if(!new RegExp("##("+t+")##","gi").exec(e.JSON.text))return t;t++}},u.refreshEditorSidebarContent=function(e,s){var l=$("<div>"+u.translate("Text")+':<br><div class="richtext">'+s.JSON.text+'</div><div class="clozeWarning"></div><br><div class="clozeButtons" style="padding-right:20px"></div><div class="clozeList sidebarBlockElement"></div></div>');e.append(l),u.editor.makeRichTextEditor({target:$(".richtext",l),buttons:[{title:u.translate("InsertCloze"),icon:"fa fa-edit",click:function(e,t){var n=0,i=t;if(i=$.trim(i),t.match(/^##([0-9]+)##$/)){var a=t.match(/[0-9]+/);n=a[0],i=""}else n=u.findNextUnusedID(s);for(var r=u.findClozeByID(s,n),o=!1,l=0;l<r.values.length;l++)r.values[l].value==$.trim(i)&&(o=!0);return 0==o&&(0<r.values.length&&""==r.values[0].value?r.values[0].value=$.trim(i):r.values.push({value:$.trim(i),visible:"true"})),setTimeout(function(){u.editorShowClozeDetail(n,s)},1),"##"+n+"##"+(""==t?" ":"")}},{title:u.translate("ConvertToClozes"),icon:"fa fa-bars",click:function(e,t){var n=e.content.code();return n=n.replace(/(<p[^>]*?>)(.*?)<\/p>/g,function(e,t,n){for(var i=1,a=0;a<s.JSON.clozes.length;a++)i<=parseInt(s.JSON.clozes[a].id)&&(i=parseInt(s.JSON.clozes[a].id)+1);return u.findClozeByID(s,i).values[0]={value:$.trim(n),visible:"true"},t+"##"+i+"##</p>"}),e.content.html(n),setTimeout(function(){u.editorRefreshClozeButtonList(s,s.JSON.clozes[s.JSON.clozes.length-1].id)},1),""}}],onChange:function(e){s.JSON.text=e;for(var t,n="",i=new RegExp("##([0-9]+)##","gi"),a={};t=i.exec(e);)a[t[1]]||(a[t[1]]=0),a[t[1]]++;var r=[];for(var o in a)1<a[o]&&r.push(o);0<r.length&&(n+='<div style="color:red;margin:0.5em">Achtung: Lücke '+r.join(" und ")+" wurde mehrfach verwendet. Bitte korrigieren!</div>"),$(".clozeWarning",l).html(n),u.editorRefreshClozeButtonList(s,s.currentClozeID)},onHoverText:function(e){var t=e.match(/##([0-9]+)##/);if(t){var n=t[0].replace(/#/g,"");u.editorShowClozeDetail(n,s)}}}),u.editorRefreshClozeButtonList(s,-1),u.editor.advancedMode&&(e.append($("<hr>")),e.append(u.editor.getToggleCheck(u.translate("withCorrection"),"true"==s.JSON.nocheck?"false":"true",function(e){s.JSON.nocheck="false"==e?"true":"false"})))},u.editorRefreshClozeButtonList=function(r,o){var e=$(".clozeButtons",r.sidebarElement);e.html(""),r.currentClozeID=o;var l=0;-1!=o&&u.findClozeByID(r,o);var s=$('<div class="btn-group"></div>');$.each(r.JSON.clozes,function(e,t){if(new RegExp("##"+t.id+"##","gi").exec(r.JSON.text)){var n=$('<div class="btn btn-'+(t.id==o?"primary":"gray")+' btn-xs">'+u.translate("Cloze")+" "+t.id+"</div>");n.on("click",function(){u.editorShowClozeDetail(t.id,r)}),s.append(n),l++}else{o==t.id&&(o=-1,r.currentClozeID=o,$(".clozeList",r.sidebarElement).html(""));for(var i=0;i<r.JSON.clozes.length;i++)if(r.JSON.clozes[i].connections)for(var a=0;a<r.JSON.clozes[i].connections.length;a++)if(r.JSON.clozes[i].connections[a]==t.id){r.JSON.clozes[i].connections.splice(a,1);break}delete t.connections}});var t=$('<div class="sidebarBlockInputButtons btn-group" style="margin-top:0px"></div>');e.append(t),0==l&&s.append(u.translate("noClozes")),e.append(s)},u.editorShowClozeDetail=function(e,r){u.editorRefreshClozeButtonList(r,e);var t=$(".clozeList",r.sidebarElement);if(t.html(""),t.addClass("sideBarSubFrame"),1!=e||0!=r.JSON.clozes.length){var o=u.findClozeByID(r,e),l=function(){u.editorShowClozeDetail(e,r),s()};u.editor.advancedMode&&(t.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"clozes.unchecked",o.unchecked,l)}))),t.append(u.editor.getToggleCheck(u.translate("hasCheck"),"true"!=o.unchecked?"true":"false",function(e){o.unchecked="true"==e?"false":"true",l()})));var a=$("<div></div>");a.append($('<div class="solutionWarning"></div>'));var s=function(){for(var e="",t=0;t<o.values.length;t++){for(var n=0,i=t;i<o.values.length;i++)o.values[t].value==o.values[i].value&&n++;1<n&&(e+='<div style="color:red;margin:0.5em">Achtung: Lösung '+o.values[t].value+" wurde mehrfach verwendet. Bitte korrigieren!</div>")}$(".solutionWarning",a).html(e)};if(u.editor.buildSortableList(a,o.values,function(e,t){var n=$('<input class="form-control input-sm" style="display:block" type="text">');n.get(0).oninput=function(e){u.editor.widget.replaceGermanQuotes(e)},n.val(t.value),n.on("change keyup",function(){t.value=$.trim($(this).val()),s(),u.editor.inputValueChanged()}),u.refreshEditorSidebarContentFocusLast&&o.values.length-1==e&&(u.refreshEditorSidebarContentFocusLast=!1,setTimeout(function(){n.focus()},10));var i=u.editor.getSmallIconBtn("fa-eye"+("false"==t.visible?"-slash":""),function(){t.visible="true"==t.visible?"false":"true",u.editor.inputValueChanged(),l()});i.css({position:"absolute","margin-left":"-30px","margin-top":"-26px"}),i.attr("title","als Alternative angezeigen"),i.tooltip();var a=$("<div></div>");return a.append(n),a.append(i),a},function(){return u.refreshEditorSidebarContentFocusLast=!0,{value:"",visible:"true"}},function(){l()}),"true"!=o.unchecked&&(t.append(u.editor.getCustomInput(u.translate("Solutions"),a)),s()),u.editor.advancedMode){t.append(u.editor.getRichTextInput("true"==o.unchecked?u.translate("alternateSolution"):u.translate("alternateSolutionIntro"),o.altText,function(e){o.altText=e},!0,!0)),t.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"clozes.size",o.size,l)}))),t.append(u.editor.getSelectInput(u.translate("Size"),["auto","longest","textlength","100%","1","2","3","4","5","6","8","10","12","15","20","25","30","35","40","45","50"],o.size,function(e){o.size=e,l()})),t.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"clozes.displayMode",o.displayMode,l)}))),t.append(u.editor.getSelectInput(u.translate("displayMode"),["normal","underlined","box"],o.displayMode,function(e){o.displayMode=e,l()}));var n=o.inneralign?o.inneralign:"";t.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"clozes.inneralign",o.inneralign,l)}))),t.append(u.editor.getContentAlignSelectInput(u.translate("editor_styleAlign"),n,function(e){o.inneralign=e,l()})),"true"!=o.unchecked&&(t.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"clozes.casesense",o.casesense,l)}))),t.append(u.editor.getToggleCheck(u.translate("casesense"),o.casesense,function(e){o.casesense=e,l()}))),t.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"clozes.multiline",o.multiline,l)}))),t.append(u.editor.getToggleCheck(u.translate("multiline"),o.multiline,function(e){o.multiline=e,l()})),"true"==o.multiline&&(t.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"clozes.lines",o.lines,l)}))),t.append(u.editor.getNumberInput(u.translate("lines"),o.lines,function(e){o.lines=e},2,20)),u.editor.advancedMode&&(t.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"clozes.dlh",o.dlh,l)}))),t.append(u.editor.getToggleCheck(u.translate("doubleLineHeight"),o.dlh,function(e){o.dlh=e}))));var d=function(n,i){if(delete i.connected,delete i.connections,n.connections){var e=n.connections.indexOf(i.id);-1!=e&&n.connections.splice(e,1);for(var a=0;a<n.connections.length;a++)$.each(r.JSON.clozes,function(e,t){t.id==n.connections[a]&&t.connections&&-1<t.connections.indexOf(i.id)&&d(t,i)});$.each(r.JSON.clozes,function(e,t){t.connections&&0==t.connections.length&&(delete t.connected,delete t.connections)})}},c=function(n,i){n.connected="true",i.connected="true",n.connections||(n.connections=[]),n.connections.push(i.id),i.connections||(i.connections=[]),i.connections.push(n.id);for(var a=0;a<n.connections.length;a++)$.each(r.JSON.clozes,function(e,t){t.id==n.connections[a]&&(t.connections&&-1!=t.connections.indexOf(i.id)||c(i,t))});for(a=0;a<i.connections.length;a++)$.each(r.JSON.clozes,function(e,t){t.id==i.connections[a]&&(t.connections&&-1!=t.connections.indexOf(n.id)||c(t,n))})};if(t.append(u.editor.getToggleCheck(u.translate("connectedClozes"),o.connected,function(e){"true"==(o.connected=e)?o.connections=[]:function(n){if(n.connections)for(var i=0;i<n.connections.length;i++)$.each(r.JSON.clozes,function(e,t){n.connections&&t.id==n.connections[i]&&t.id!=n.id&&(delete t.connected,delete t.connections)});delete n.connected,delete n.connections}(o),l()})),"true"==o.connected){var i=$('<div class="btn-group"><i class="fa fa-link fa-fw" style="float:left;margin-top:5px"></i> </div>');$.each(r.JSON.clozes,function(e,t){var n;new RegExp("##"+t.id+"##","gi").exec(r.JSON.text)&&(t.id!=o.id?(n=$('<div class="btn btn-'+(-1!=o.connections.indexOf(t.id)?"primary":"gray")+' btn-xs">'+u.translate("Cloze")+" "+t.id+"</div>")).on("click",function(){-1==o.connections.indexOf(t.id)?c(o,t):d(o,t),u.editor.inputValueChanged(),l()}):n=$('<div class="btn btn-primary btn-xs" style="pointer-events:none">'+u.translate("Cloze")+" "+t.id+"</div>"),i.append(n))}),t.append(i)}}"true"!=o.unchecked&&t.append(u.editor.getToggleCheck(u.translate("predefined"),o.predefined,function(e){o.predefined=e,l()}))}}}(),function(){var o=new AModule("container");o.initContent=function(e){e.JSON.contents=[],e.JSON.fixedColumn="false",e.JSON.height="100%",e.JSON.popup="false",e.JSON.popupOpen="true",e.JSON.backgroundURL="",e.JSON.isSolution="false",e.JSON.openText=o.translate("showMore"),e.JSON.closeText=o.translate("showLess"),e.scrollPanel=null},o.setOpenClosed=function(e,t,n){if(e.isOpen!=t){var i=$("> .popupContainerCaption",e.htmlElement);i&&e.popupContainerContent&&(e.isOpen?(e.isOpen=!1,e.popupContainerContent.slideUp({duration:n?0:"default",complete:function(){i.removeClass("open"),i.html('<i class="fa fa-fw fa-caret-right"></i> '+e.JSON.openText),widget.refreshScrollbars(),widget.refreshMath()},progress:function(){widget.refreshScrollbars()}})):(e.isOpen=!0,i.addClass("open"),i.html('<i class="fa fa-fw fa-caret-down"></i> '+e.JSON.closeText),e.popupContainerContent.slideDown({duration:n?0:"default",complete:function(){var n=function(e){for(var t=0;t<e.contents.length;t++)e.contents[t].module&&e.contents[t].module.refreshInsideContainer&&e.contents[t].module.refreshInsideContainer(e.contents[t]),e.contents[t].contents&&n(e.contents[t])};n(e),widget.refreshScrollbars(),widget.refreshMath()},progress:function(){widget.refreshScrollbars()}})),widget.refreshMath())}},o.refreshContent=function(a){if("true"==a.JSON.isSolution&&(widget.isEditor||a.isSolved||a.htmlElement.hide(),(widget.isSavingThumb||widget.isPrint)&&a.htmlElement.hide()),0==a.contents.length)widget.addContent({type:"container_placeholder"},a);else{for(var e=null,t=!1,n=0;n<a.contents.length;n++)"container_placeholder"==a.contents[n].JSON.type?e=a.contents[n]:t=!0;t&&e&&widget.removeContent(e)}if(a.scrollPanel=null,a.popupContainerContent=null,"false"==a.JSON.fixedColumn)if("true"==a.JSON.popup){a.popupContainerContent=$('<div class="popupContainerContent containerContent"></div>'),!1!==a.isOpen&&!0!==a.isOpen&&(a.isOpen=!!(widget.isEditor&&!widget.isSavingThumb||widget.isPrint&&widget.isPrintAll)||"true"==a.JSON.popupOpen);var i=$('<div class="popupContainerCaption"></div>');a.isOpen?(i.html('<i class="fa fa-fw fa-caret-down"></i> '+a.JSON.closeText),i.addClass("open")):(i.html('<i class="fa fa-fw fa-caret-right"></i> '+a.JSON.openText),a.popupContainerContent.hide()),i.on("click",function(e){return o.setOpenClosed(a,!a.isOpen),e.preventDefault(),!1}),i.on("open",function(e){return o.setOpenClosed(a,!0),!1}),i.on("close",function(e){return o.setOpenClosed(a,!1),!1}),a.htmlElement.append(i),FastClick.attach(i.get(0)),a.htmlElement.append(a.popupContainerContent)}else a.htmlElement.addClass("containerContent");else{function r(){var e=a.htmlElement.parent().get(0)==widget.contentElement.get(0)?widget.contentWrapper.height()-0:a.htmlElement.parent().height()-0,t=a.JSON.height&&""!=a.JSON.height?parseInt(a.JSON.height):100,n=window.getComputedStyle(a.htmlElement.get(0)),i=Math.floor(e*(t/100));return i-=parseFloat(n.marginTop)+parseFloat(n.marginBottom),i-=parseFloat(n.borderTopWidth)+parseFloat(n.borderBottomWidth)}a.htmlElement.html('<div class="columnContainer"></div>'),a.scrollPanel=$(".columnContainer",a.htmlElement),a.htmlElement.css("height",r()),widget.reinitialiseScrollpane(a.scrollPanel),$(".jspPane",a.scrollPanel).addClass("containerContent"),a.resizeHandler||(a.resizeHandler=function(){a.htmlElement.css("height",r()),widget.reinitialiseScrollpane(widget.contentWrapper),widget.reinitialiseScrollpane(a.scrollPanel)},$(window).on("resize",a.resizeHandler)),setTimeout(function(){a.htmlElement.css("height",r()),widget.reinitialiseScrollpane(widget.contentWrapper),widget.reinitialiseScrollpane(a.scrollPanel)},1)}a.JSON.backgroundURL&&""!=a.JSON.backgroundURL&&(a.htmlElement.css("background-repeat","no-repeat"),a.htmlElement.css("background-image","url('"+widget.getMediaURLPath(a.JSON.backgroundURL)+"')"),a.JSON.backgroundSize&&""!=a.JSON.backgroundSize&&a.htmlElement.css("background-size",""+a.JSON.backgroundSize),a.JSON.backgroundPosition&&""!=a.JSON.backgroundPosition&&a.htmlElement.css("background-position",a.JSON.backgroundPosition+" "+a.JSON.backgroundPositionV)),a.JSON.fontSize&&""!=a.JSON.fontSize&&"100%"!=a.JSON.fontSize&&a.htmlElement.css("font-size",a.JSON.fontSize)},o.scrollToElement=function(e,t,n,i,a){null!=e.scrollPanel&&("string"==typeof t?e.scrollPanel.data("jsp").scrollToElement("#"+t,!!n,!i,a):e.scrollPanel.data("jsp").scrollToElement(t,!!n,!i,a))},o.refreshModule=function(){widget.contentElement.css({"padding-top":"20px","padding-bottom":"20px"}),widget.forEachContent(function(e){if(e.module!=o)return!0;if(e.JSON.fixedColumn&&"false"!=e.JSON.fixedColumn){widget.contentElement.css({"padding-top":"0px","padding-bottom":"0px"});var t=$(".jspPane",e.scrollPanel);for(n=0;n<e.contents.length;n++)t.append(e.contents[n].htmlElement);widget.reinitialiseScrollpane(e.scrollPanel)}else for(var n=0;n<e.contents.length;n++)e.popupContainerContent?e.popupContainerContent.append(e.contents[n].htmlElement):e.htmlElement.append(e.contents[n].htmlElement);return!0})},o.init=function(){},o.checkSolution=function(e){return e.JSON.isSolution,!0},o.hasStillHelp=function(e){return"true"==e.JSON.isSolution&&!e.isSolved&&!e.isDoneSolved},o.helpSolution=function(e){if("true"!=e.JSON.isSolution||widget.JSON.remoteClassData)return!0;var t=widget.findModule("check_solution");if(t&&t.isOK){if(!e.isDoneSolved&&!e.isSolved){e.htmlElement.show(),widget.refreshMath(),widget.refreshScrollbars();for(var n=0;n<e.contents.length;n++)e.contents[n].module&&e.contents[n].module.refreshInsideContainer&&e.contents[n].module.refreshInsideContainer(e.contents[n]);widget.scrollingToElement||(widget.scrollToElement(e.htmlElement,!0),setTimeout(function(){widget.scrollToElement(e.htmlElement,!0),widget.refreshMath(),widget.refreshScrollbars()},500))}return e.isDoneSolved=!0}var i=!!e.isSolved;if(!i){e.isSolved=!0,e.htmlElement.show(),widget.refreshMath(),widget.refreshScrollbars();for(n=0;n<e.contents.length;n++)e.contents[n].module&&e.contents[n].module.refreshInsideContainer&&e.contents[n].module.refreshInsideContainer(e.contents[n]);setTimeout(function(){widget.scrollToElement(e.htmlElement,!0),widget.refreshMath(),widget.refreshScrollbars()},500)}return i},o.getCheckableElements=function(e){var t=[];return"true"==e.JSON.isSolution&&t.push(e.htmlElement),t},o.saveUserInput=function(e,t){if(!widget.isFromEditor){var n={};"true"==e.JSON.popup&&(n.open=e.isOpen?"1":"0"),"true"==e.JSON.isSolution&&(n.solved=e.isSolved?"1":"0",e.isSolved&&(t.counter.correct++,t.counter.helped++,t.counter.total++)),t.input.push(n)}},o.clearUserInput=function(e){"true"==e.JSON.popup&&o.setOpenClosed(e,"true"==e.JSON.popupOpen),"true"==e.JSON.isSolution&&(e.isSolved=!1,e.isDoneSolved=!1,e.htmlElement.hide())},o.loadUserInput=function(e,t){widget.isFromEditor||t&&1==t.length&&("true"==e.JSON.popup&&o.setOpenClosed(e,"1"==t[0].open||widget.isPrint&&widget.isPrintAll,!0),"true"==e.JSON.isSolution&&(e.isSolved="1"==t[0].solved,e.isSolved?e.htmlElement.show():e.htmlElement.hide()))},o.refreshEditorSidebarContent=function(e,t){if(o.editor.advancedMode&&(e.append(o.editor.getToggleCheck("scrollbar",t.JSON.fixedColumn,function(e){t.JSON.fixedColumn=e,o.editor.updateContentSidebar()})),"true"==t.JSON.fixedColumn&&e.append(o.editor.getSelectInput("Höhe",["100%","50%","33%"],t.JSON.height,function(e){t.JSON.height=e}))),e.append(o.editor.getToggleCheck("aufklappbar",t.JSON.popup,function(e){t.JSON.popup=e,"true"==t.JSON.popup&&(t.JSON.popupOpen="false"),o.editor.updateContentSidebar()})),"true"==t.JSON.popup&&(e.append(o.editor.getToggleCheck("aufgeklappt",t.JSON.popupOpen,function(e){t.JSON.popupOpen=e})),e.append(o.editor.getTextInput(o.translate("showMoreLabel"),t.JSON.openText,function(e){t.JSON.openText=e})),e.append(o.editor.getTextInput(o.translate("showLessLabel"),t.JSON.closeText,function(e){t.JSON.closeText=e}))),o.editor.advancedMode){var n=o.editor.getToggleCheck("Lösungshilfe?",t.JSON.isSolution,function(e){t.JSON.isSolution=e,o.editor.updateContentSidebar()});e.append(n);var i=$('<i class="fa fa-info-circle" style="display:inline-block;padding-left:0.5em"></i>');$(".sidebarBlockLabel",n).append(i),i.tooltip({container:n,placement:"left",title:"Der Container und Inhalt wird auf der Seite versteckt, bis auf den 'Lösungen'-Button geklickt wird (in der Reihenfolge der aktiven Elemente der Seite). Deaktiviert die Lehperson die Lösungshilfe der Seite, kann der Container nie angezeigt werden."}),e.append(o.editor.getImageFileInput("Hintergrundbild",t.JSON.backgroundURL,function(e){""!=(t.JSON.backgroundURL=e)?(t.JSON.backgroundPosition||(t.JSON.backgroundPosition="center",t.JSON.backgroundPositionV="center"),t.JSON.backgroundSize||(t.JSON.backgroundSize="contain")):(delete t.JSON.backgroundPosition,delete t.JSON.backgroundPositionV,delete t.JSON.backgroundSize),o.editor.updateContentSidebar()})),t.JSON.backgroundURL&&""!=t.JSON.backgroundURL&&(e.append(o.editor.getSelectInput("Bildgrösse",["contain","cover","initial"],t.JSON.backgroundSize,function(e){t.JSON.backgroundSize=e,o.editor.updateContentSidebar()})),e.append(o.editor.getSelectInput("Bildposition",["center","left","right"],t.JSON.backgroundPosition,function(e){t.JSON.backgroundPosition=e})),e.append(o.editor.getSelectInput("Bildausrichtung",["top","center","bottom"],t.JSON.backgroundPositionV,function(e){t.JSON.backgroundPositionV=e}))),e.append(o.editor.getSelectInput(o.translate("FontSize"),["50%","60%","70%","80%","90%","100%","110%","120%","130%","140%","150%"],t.JSON.fontSize&&""!=t.JSON.fontSize?t.JSON.fontSize:"100%",function(e){t.JSON.fontSize=e}))}}}(),function(){var t=new AModule("container_placeholder");t.noSaveData=!0,t.initContent=function(e){},t.refreshContent=function(e){e.htmlElement.html('<div class="container-empty'+(t.editor?" editorContainerEmpty":"")+'"></div>')},t.init=function(){}}(),function(){var e=new AModule("name");e.initContent=function(e){e.JSON.x="x"},e.checkSolution=function(e){var t=widget.findModule("check_solution");return $(".icon",c.inputElement.parent()).delay(t.getNextDelay()).fadeIn(),!0},e.helpSolution=function(e){return!0},e.refreshContent=function(e){e.htmlElement.html("")},e.saveUserInput=function(e,t){t.input.push({value:e.inputElement.val(),correct:e.correct})},e.loadUserInput=function(e,t){e.inputElement.val(""),t&&1==t.length&&(e.inputElement.val(t[0].value),e.correct=t[0].correct)},e.init=function(){},e.refreshEditorSidebarContent=function(e,t){var n=$('<div>Text:<br><input type="hidden"><div class="richtext">'+t.JSON.text+'</div><div class="clozeList"></div></div>');e.append(n)}}(),function(){var W=new AModule("crossword");W.initContent=function(e){e.JSON.questions=[{word:"",question:""},{word:"",question:""},{word:"",question:""}],e.JSON.textSide="left",e.crosswordInputs=[]},W.getCheckableElements=function(e){var t=[];if("true"==e.JSON.nocheck)return t;if(e.crosswordInputs)for(var n=0;n<e.crosswordInputs.length;n++){var i=e.crosswordInputs[n];t.push(i)}return t},W.getInputHTMLElements=function(e){var n=[];return $.each(e.crosswordInputs,function(e,t){n.push({e:t.inputElement.parent(),id:t.id})}),n},W.checkSingleCrosswordInput=function(e,t){var n=$.trim(e.inputElement.val()),i=helper.compareSanitized(e.word,n);return e.correct=i?"true":"false",i},W.checkSolution=function(a){if("true"==a.JSON.nocheck)return!0;var r=widget.findModule("check_solution"),o=!0;return $.each(a.crosswordInputs,function(e,t){var n=$.trim(t.inputElement.val());t.inputElement.parent().removeClass("helped correct wrong alternatives");var i=W.checkSingleCrosswordInput(t,a);a.isChecked&&!i&&""!=n&&(t.helped="true"),i?(t.inputElement.parent().addClass("correct"),r.showHelped&&"true"==t.helped&&t.inputElement.parent().addClass("helped")):((""!=n||t.last&&""!=t.last)&&(t.inputElement.parent().addClass("wrong"),t.last=n),o=!1)}),o},W.helpSolution=function(e){if("true"==e.JSON.nocheck)return!0;for(var t=0;t<e.crosswordInputs.length;t++){var n=e.crosswordInputs[t];if(!W.checkSingleCrosswordInput(n,e)){n.inputElement.parent().removeClass("helped correct wrong alternatives");var i=$.trim(n.inputElement.val()),a=$(".grid_"+n.x+"_"+n.y,e.cross.htmlElement);return widget.scrollToElement(a),n.inputElement.effect("highlight"),n.helped="true",n.last=i,n.inputElement.val(n.word),W.updateInputElement(e,n),!1}}return!0},W.saveUserInput=function(e,t){if(e.crosswordInputs)for(var n=0;n<e.crosswordInputs.length;n++)t.input.push({id:e.crosswordInputs[n].id,v:e.crosswordInputs[n].inputElement.val(),l:e.crosswordInputs[n].last?e.crosswordInputs[n].last:"",c:e.crosswordInputs[n].correct,h:e.crosswordInputs[n].helped}),"true"==e.crosswordInputs[n].correct?t.counter.correct++:e.crosswordInputs[n].last&&""!=e.crosswordInputs[n].last&&t.counter.wrong++,"true"==e.crosswordInputs[n].correct&&"true"==e.crosswordInputs[n].helped&&t.counter.helped++,t.counter.total++},W.clearUserInput=function(e){if(e.crosswordInputs){for(var t=0;t<e.crosswordInputs.length;t++)e.crosswordInputs[t].inputElement.val(""),e.crosswordInputs[t].last=null,e.crosswordInputs[t].helped="false",e.crosswordInputs[t].correct="false",e.crosswordInputs[t].inputElement.parent().removeClass("helped correct wrong alternatives");e.cross&&W.clearCrosswordInput(e)}},W.loadUserInput=function(e,t){if(t)for(var n=0;n<t.length;n++)if(e.crosswordInputs)for(var i=0;i<e.crosswordInputs.length;i++)e.crosswordInputs[i].id==t[n].id&&(e.crosswordInputs[i].inputElement&&e.crosswordInputs[i].inputElement.val(t[n].v),e.crosswordInputs[i].last=t[n].l&&""!=t[n].l?t[n].l:null,e.crosswordInputs[i].helped=t[n].h,e.crosswordInputs[i].correct=t[n].c,W.updateInputElement(e,e.crosswordInputs[i]))},W.refreshContent=function(e){e.crosswordInputs=[];var t=0;if(e.JSON.questions)for(var n=0;n<e.JSON.questions.length;n++)if(e.JSON.questions[n].word&&""!=e.JSON.questions[n].word){t++;var i={};i.id=t,i.word=e.JSON.questions[n].word.toUpperCase(),i.question=e.JSON.questions[n].question,i.inputElement=$('<input type="hidden" value="">'),e.crosswordInputs.push(i)}e.cross=W.createCrossword(e,e.crosswordInputs,e.JSON.solutionword?e.JSON.solutionword:""),W.createCrosswordHTML(e),W.buildSolutionWord(e,e.cross,e.JSON.solutionword?e.JSON.solutionword:""),e.htmlElement.html(""),e.htmlElement.append(e.cross.htmlElement),0==e.crosswordInputs.length&&e.cross.htmlElement.html($('<div style="text-align:center;margin:1em;color:#ccc">Noch keine Fragen / Antworten angegeben.</div>'))},W.setInputElement=function(e,t){var n="";if("-"==t.direction)for(var i=0;i<t.word.length;i++){(a=$(".grid_"+(t.x+i)+"_"+t.y,e.cross.htmlElement).html())&&""!=a||(a=" "),n+=a}if("|"==t.direction)for(i=0;i<t.word.length;i++){var a;(a=$(".grid_"+t.x+"_"+(t.y+i),e.cross.htmlElement).html())&&""!=a||(a=" "),n+=a}t.inputElement.val(n),t.inputElement.parent().removeClass("helped correct wrong alternatives"),W.updateInputElement(e,t),W.checkSingleCrosswordInput(t,e),(n=widget.findModule("save_load"))&&n.save()},W.updateInputElement=function(e,t){for(var n=t.inputElement.val(),i=0;i<t.word.length;i++){var a=null;"-"==t.direction&&(a=$(".grid_"+(t.x+i)+"_"+t.y,e.cross.htmlElement)).html(n.length>i?n[i]:a.html()),"|"==t.direction&&(a=$(".grid_"+t.x+"_"+(t.y+i),e.cross.htmlElement)).html(n.length>i?n[i]:a.html())}e.cross.grid.fixedSolution||W.updateSolutionTerm(e)},W.init=function(){},W.numToRoman=function(e){for(var t="";10<e;)t+="X",e-=10;return 1==e&&(t+="I"),2==e&&(t+="II"),3==e&&(t+="III"),4==e&&(t+="IV"),5==e&&(t+="V"),6==e&&(t+="VI"),7==e&&(t+="VII"),8==e&&(t+="VIII"),9==e&&(t+="IX"),10==e&&(t+="X"),t},W.buildSolutionWord=function(a,r,e){if(""!=(e=e.replace(/ /g,"").toUpperCase())&&0!=r.grid.length){var t=new W.Rc4Random(a.JSON.seed?a.JSON.seed:"seed"),n=new Array;if(r.grid.fixedSolution)for(var i=0;i<e.length;i++){var o=r.grid.firstSolutionX,l=r.grid.firstSolutionY;n.push({x:o,y:l+i,index:i,fixed:null})}else for(i=0;i<e.length;i++){for(var s=new Array,d=r.minY-1;d<r.maxY+2;d++)for(var c=r.minX-1;c<r.maxX+2;c++)r.grid[d][c]&&r.grid[d][c].character.toUpperCase()==e[i]&&s.push({x:c,y:d,fixed:null});for(var u=0;u<s.length;u++)for(var p=0;p<n.length;p++)if(n[p].x==s[u].x&&n[p].y==s[u].y){s.splice(u,1),u--;break}0==s.length&&s.push({x:-1,y:-1,fixed:e[i]});for(p=0;;){p++;var g=Math.floor(t.random()*s.length),h=!0;for(u=0;u<n.length;u++){o=Math.abs(n[u].x-s[g].x),l=Math.abs(n[u].y-s[g].y);o<1&&l<1&&(h=!1)}if(h||!(p<50)){n.push({x:s[g].x,y:s[g].y,index:i,fixed:s[g].fixed});break}}}$.each(n,function(e,t){if(!t.fixed){var n=$(".grid_"+t.x+"_"+t.y,r.htmlElement),i=$('<div style="position:absolute;z-index:2;"><div style="cursor:pointer;position:absolute"><div class="field solution" style="position:absolute"></div>'+(r.grid.fixedSolution?"":'<div style="font-size:0.36em;margin:0.4em;margin-top:2.66em">'+W.numToRoman(t.index+1)+"</div>")+"</div></div>");i.insertBefore(n),i.on("click",function(){W.lastSelectedItem=null,W.selectCrosswordField(a,t.x,t.y)})}}),r.places=n,r.grid.fixedSolution||W.updateSolutionTerm(a)}},W.fakeInput=null,W.lastSelectedItem=null,W.selectCrosswordField=function(n,i,a,e){$(".field,.questionItem").removeClass("blink highlight"),n.lastClickedXY!=i+" "+a&&(n.lastClickItemIndex=0),n.lastClickedXY=i+" "+a;var t=[];if(n.cross.grid[a][i].items){if(W.lastSelectedItem){for(var r=0;r<n.cross.grid[a][i].items.length;r++)n.cross.grid[a][i].items[r]==W.lastSelectedItem&&t.push(W.lastSelectedItem);W.lastSelectedItem=null}if(0==t.length)for(r=0;r<n.cross.grid[a][i].items.length;r++)n.cross.grid[a][i].items[r].x==i&&n.cross.grid[a][i].items[r].y==a&&t.push(n.cross.grid[a][i].items[r]);if(0==t.length)for(r=0;r<n.cross.grid[a][i].items.length;r++)t.push(n.cross.grid[a][i].items[r])}var o=t[n.lastClickItemIndex%t.length];if(1==t.length&&(W.lastSelectedItem=t[0]),n.lastClickItemIndex++,"-"==o.direction)for(r=0;r<o.word.length;r++)$(".grid_"+(o.x+r)+"_"+o.y,n.cross.htmlElement).addClass("highlight");if("|"==o.direction)for(r=0;r<o.word.length;r++)$(".grid_"+o.x+"_"+(o.y+r),n.cross.htmlElement).addClass("highlight");if(o.inputElement.parent().addClass("highlight"),e&&o)return e<0&&("-"==o.direction&&i>o.x&&(i-=1),"|"==o.direction&&a>o.y&&(a-=1)),0<e&&("-"==o.direction&&i<o.x+o.word.length-1&&(i+=1),"|"==o.direction&&a<o.y+o.word.length-1&&(a+=1)),void W.selectCrosswordField(n,i,a,0);var l=$(".grid_"+i+"_"+a,n.cross.htmlElement);widget.scrollToElement(l),l.addClass("blink"),null==W.fakeInput&&(W.fakeInput=$('<textarea autocapitalize="off" autocomplete="off" autocorrect="off" style="font-size:1px;user-select:none;opacity:0.001;width:100%;caret-color: transparent; height:100%;background:transparent; color:transparent;border:0;position:absolute; left:0;top:0;z-index:1000"></textarea>')),W.fakeInput.off(),W.fakeInput.on("click",function(){W.selectCrosswordField(n,i,a)}),W.fakeInput.on("input",function(e){var t=$.trim(W.fakeInput.val());""==t&&" "!=t||($(".field.blink",n.cross.htmlElement).html(t.toUpperCase()),W.fakeInput.val(""),W.setInputElement(n,o),W.selectCrosswordField(n,i,a,1))}),W.fakeInput.on("keydown",function(e){if(8==e.keyCode){var t=$(".field.blink",n.cross.htmlElement).html();$(".field.blink",n.cross.htmlElement).html(""),W.setInputElement(n,o),""!=t&&" "!=t||(W.selectCrosswordField(n,i,a,-1),$(".field.blink",n.cross.htmlElement).html(""))}37==e.keyCode&&W.selectCrosswordField(n,i,a,-1),39==e.keyCode&&W.selectCrosswordField(n,i,a,1)}),W.fakeInput.on("blur",function(e){setTimeout(function(){$(W.fakeInput).is(":focus")||($(".blink",n.cross.htmlElement).removeClass("blink"),W.lastSelectedItem=null)},2e3)}),l.parent().append(W.fakeInput),W.fakeInput.val(""),W.fakeInput.focus()},W.createCrosswordHTML=function(i){function e(e){for(var t="",n=0;n<e.length;n++)t+=(""==t?"":",")+e[n].id;return t}function t(e,t,n){$(".grid_"+e+"_"+t,n).on("click",function(){W.selectCrosswordField(i,e,t)})}if(i.cross.htmlElement=$('<div class="crossword"><div class="questionsCrossword"></div><div class="innerCrossword"></div></div>'),i.cross.htmlElement.addClass(i.JSON.textSide),0<i.cross.grid.length){var n=$("<table></table>");$(".innerCrossword",i.cross.htmlElement).append(n);for(var a=i.cross.minY-1;a<i.cross.maxY+2;a++){var r=$("<tr></tr>");n.append(r);for(var o=i.cross.minX-1;o<i.cross.maxX+2;o++)if(i.cross.grid[a][o]){startIndex=[];for(var l=0;l<i.cross.grid[a][o].items.length;l++)i.cross.grid[a][o].items[l].x==o&&i.cross.grid[a][o].items[l].y==a&&startIndex.push(i.cross.grid[a][o].items[l]);var s=$("<td>"+(0<startIndex.length?'<div class="grid_'+o+"_"+a+'_number" style="z-Index:3;cursor:pointer;position:absolute;font-size:6pt;margin:2px;pointer-events:none;line-height:1em">'+e(startIndex)+"</div>":"")+'<div class="grid_'+o+"_"+a+' field filled" style="position:relative;z-Index:1;"> </div></td>');r.append(s),t(o,a,s)}else{s=$('<td><div class="grid_'+o+"_"+a+' field"></div></div>');r.append(s)}}}var d=$(".questionsCrossword",i.cross.htmlElement),c=d,u=d;"top"!=i.JSON.textSide&&"bottom"!=i.JSON.textSide||400<=i.htmlElement.width()&&(d.addClass("twoColumns"),c=$("<div></div>"),d.append(c),u=$("<div></div>"),d.append(u)),$.each(i.crosswordInputs,function(e,t){var n;"-"==t.direction&&((n=$('<div class="questionItem horizontal"><div><b>'+t.id+'</b><i class="fa fa-fw fa-angle-right"></i></div><div class="questionItemInner"></div></div>')).on("click",function(){W.lastSelectedItem=null,W.selectCrosswordField(i,t.x,t.y)}),$(".questionItemInner",n).html(t.question),n.append(t.inputElement),e%2==0?c.append(n):u.append(n));"|"==t.direction&&((n=$('<div class="questionItem vertical"><div><b>'+t.id+'</b><i class="fa fa-fw fa-angle-down"></i></div><div class="questionItemInner"></div></div>')).on("click",function(){W.lastSelectedItem=null,W.selectCrosswordField(i,t.x,t.y)}),$(".questionItemInner",n).html(t.question),n.append(t.inputElement),e%2==0?c.append(n):u.append(n))})},W.clearCrosswordInput=function(e){for(var t=e.cross.minY-1;t<e.cross.maxY+2;t++)for(var n=e.cross.minX-1;n<e.cross.maxX+2;n++)if(e.cross.grid[t][n]){var i=$(".grid_"+n+"_"+t,e.cross.htmlElement);i.html(""),i.removeClass("xxx")}e.cross.grid.fixedSolution||W.updateSolutionTerm(e)},W.updateSolutionTerm=function(a){var r=a.cross,e=$(".solutionword",r.htmlElement);if(0==e.length&&r.places&&0<r.places.length){for(var t="",n=0;n<r.places.length;n++)t+='<div style="position:relative"><div class="field solution" style="cursor:default;z-Index:2;position:absolute;"></div><div style="cursor:default;z-Index:3;position:absolute;font-size:0.36em;margin:0.4em;margin-top:2.66em">'+W.numToRoman(r.places[n].index+1)+'</div><div class="field filled solutionword'+n+'" style="cursor:default;position:relative"></div></div>';(e=$('<div class="solutionword" style="margin:10px"></div>')).html(t),$(".innerCrossword",r.htmlElement).append(e)}r.places&&0<r.places.length&&$.each(r.places,function(e,t){var n="";if(t.fixed)n=t.fixed;else{var i=$(".grid_"+t.x+"_"+t.y,r.htmlElement);n=$.trim(i.html())}$(".solutionword"+t.index,r.htmlElement).html(n),t.fixed||$(".solutionword"+e,r.htmlElement).parent().on("click",function(){W.lastSelectedItem=null,W.selectCrosswordField(a,t.x,t.y)})})},W.createCrossword=function(e,t,n){n||(n=""),n=n.replace(/ /g,"").toUpperCase();var i=$('<div style="display: none; font-size: 1em; margin: 0; padding:0; height: auto; line-height: 1; border:0;">&nbsp;</div>').appendTo(e.htmlElement),a=i.height();i.remove();for(var r=new W.Rc4Random(e.JSON.seed?e.JSON.seed:"seed"),o=new Array("-","|"),l=0,s=0;s<t.length;s++)l+=2*t[s].word.length;var d=null,c=null,u=new Array(l);for(s=0;s<l;s++)u[s]=new Array(l);var p=[];if(""!=n){if(n.length!=t.length)return W.createCrossword(e,t,"");for(s=0;s<t.length;s++){for(var g=!1,h=0;h<t[s].word.length;h++){var f=Math.floor(t[s].word.length/2),m=Math.max(0,f-h),v=Math.min(t[s].word.length,f+h),S=-1e3;if(t[s].word[m]&&t[s].word[m].toUpperCase()==n[s]&&(S=l/2-(f=m)),t[s].word[v]&&t[s].word[v].toUpperCase()==n[s]&&(S=l/2-(f=v)),-1e3!=S){g=!0,t[s].direction="-",t[s].x=S,t[s].y=s+1,0==s&&(u.firstSolutionX=t[s].x+f,u.firstSolutionY=t[s].y);for(var w=0;w<t[s].word.length;w++)u[s+1][S+w]={character:t[s].word.substr(w,1),items:[t[s]]};p.push(t[s]);break}}if(!g)return W.createCrossword(e,t,"")}u.fixedSolution=!0,c=u,d=t,J=0}else{u.fixedSolution=!1;for(var O=new Array,N=0,J=0;N<100;){for(var b=0;p.length<t.length;){for(C=!0;C;){L=Math.floor(r.random()*t.length),C=!1;for(s=0;s<p.length;s++)p[s].id==t[L].id&&(C=!0);for(s=0;s<O.length;s++)O[s].id==t[L].id&&(C=!0)}var k=t[L];if(k.x=-1,k.y=-1,0<p.length){for(s=0;s<p.length&&!(0<=k.x&&0<=k.y);s++){for(var x=new Array,y=0;y<k.word.length;y++)x.push(!1);for(y=0;y<k.word.length&&!(0<=k.x&&0<=k.y);y++){for(var C=!0;C;){C=x[L=Math.floor(r.random()*k.word.length)]}x[L]=!0;var E=k.word.substr(L,1);if(0<=p[s].word.indexOf(E))for(h=0;h<p[s].word.length&&!(0<=k.x&&0<=k.y);h++)if(p[s].word.substr(h,1)==E){"-"==p[s].direction&&(S=p[s].x+h,z=p[s].y),"|"==p[s].direction&&(S=p[s].x,z=p[s].y+h);for(var I=new Array,T=0;T<o.length;T++)o[T]!=p[s].direction&&I.push(o[T]);for(I.sort(function(e,t){return r.random()-.5});0<I.length;){var M=!1;k.direction=I.pop(),"|"==k.direction&&(u[(z-=L)-1][S]||u.length<=z+k.word.length||u[z+k.word.length][S])&&(M=!0),"-"==k.direction&&(S-=L,(u[z][S-1]||u[z].length<=S+k.word.length||u[z][S+k.word.length])&&(M=!0));for(var D=0;D<k.word.length;D++)"-"==k.direction&&(u[z][S+D]&&(u[z].length<=S+D||u[z][S+D].character!=k.word.substr(D,1))&&(M=!0),u[z-1][S+D]&&D!=L&&(M=!0),u[z+1][S+D]&&D!=L&&(M=!0)),"|"==k.direction&&(u[z+D][S]&&(u.length<=z+D||u[z+D][S].character!=k.word.substr(D,1))&&(M=!0),u[z+D][S-1]&&D!=L&&(M=!0),u[z+D][S+1]&&D!=L&&(M=!0));if(!M){k.x=S,k.y=z,O=new Array;break}}}}}if(-1==k.x&&-1==k.y&&(O.push(k),O.length==t.length-p.length)){b++;for(y=0;y<100&&!(0<=k.x&&0<=k.y);){var L=Math.floor(2*r.random());k.direction=0==L?"-":"|";M=!1;if("-"==k.direction){S=Math.floor(u.length/2)-Math.floor(k.word.length/2);var z=Math.floor(u[0].length/2);S+=(.5<r.random()?-1:1)*Math.floor(r.random()*y),z+=(.5<r.random()?-1:1)*Math.floor(r.random()*y);for(h=0;h<k.word.length;h++)u[z][S+h]&&u[z][S+h].character!=k.word.substr(h,1)&&(M=!0),u[z-1][S+h]&&(M=!0),u[z+1][S+h]&&(M=!0);(u[z][S-1]||u[z][S+k.word.length])&&(M=!0)}if("|"==k.direction){S=Math.floor(u[0].length/2),z=Math.floor(u.length/2)-Math.floor(k.word.length/2);S+=(.5<r.random()?-1:1)*Math.floor(r.random()*y),z+=(.5<r.random()?-1:1)*Math.floor(r.random()*y);for(h=0;h<k.word.length;h++)u[z+h][S]&&u[z+h][S].character!=k.word.substr(h,1)&&(M=!0),u[z+h][S-1]&&(M=!0),u[z+h][S+1]&&(M=!0);(u[z-1][S]||u[z+k.word.length][S])&&(M=!0)}M||(k.x=S,k.y=z),y+=.1}O=new Array}}if(0==p.length&&(k.direction="|",k.x=Math.floor(u[0].length/2),k.y=Math.floor(u.length/2)-Math.floor(k.word.length/2)),0<=k.x&&0<=k.y){function A(e,t){return e?(e.items.push(t.items[0]),e):t}p.push(k);for(D=0;D<k.word.length;D++)"-"==k.direction&&(u[k.y][k.x+D]=A(u[k.y][k.x+D],{items:[k],character:k.word.substr(D,1)})),"|"==k.direction&&(u[k.y+D][k.x]=A(u[k.y+D][k.x],{items:[k],character:k.word.substr(D,1)}))}}var P=u.length,B=0,R=u.length,U=0;for(z=0;z<u.length;z++)for(S=0;S<u[z].length;S++)u[z][S]&&S<P&&(P=S),u[z][S]&&B<S&&(B=S),u[z][S]&&z<R&&(R=z),u[z][S]&&U<z&&(U=z);var _,F=0;if(F="left"==e.JSON.textSide||"right"==e.JSON.textSide?.66*e.htmlElement.innerWidth():e.htmlElement.innerWidth(),b+=0<B-P-(_=Math.floor(F/(2*a))-1)?100*(B-P-_):0,b+=0<U-R-10?1*(U-R-10):0,0==N){c=u,J=b,d=[];for(var H=0;H<t.length;H++)d.push({id:t[H].id,x:t[H].x,y:t[H].y,direction:t[H].direction})}else if(b<J){c=u,J=b,d=[];for(H=0;H<t.length;H++)d.push({id:t[H].id,x:t[H].x,y:t[H].y,direction:t[H].direction})}if(0==J)break;p=[],O=[],u=new Array(l);for(s=0;s<l;s++)u[s]=new Array(l);for(s=0;s<t.length;s++)t[s].x=-1,t[s].y=-1,t[s].direction="";N++}}console.log("Crossword has "+J+" fails");for(P=c.length,R=c.length,B=0,U=0,z=0;z<c.length;z++)for(S=0;S<c[z].length;S++)c[z][S]&&z<R&&(R=z),c[z][S]&&S<P&&(P=S),c[z][S]&&U<z&&(U=z),c[z][S]&&B<S&&(B=S);var V=new Object;V.minX=P,V.minY=R,V.maxX=B,V.maxY=U,V.grid=c;for(H=0;H<d.length;H++)for(s=0;s<t.length;s++)if(t[s].id==d[H].id){t[s].x=d[H].x,t[s].y=d[H].y,t[s].direction=d[H].direction;break}return V.items=t,V},W.Rc4Random=function(e){var a=[],t=0,n=0;function i(){n=(n+a[t=(t+1)%256])%256;var e=a[t];return a[t]=a[n],a[n]=e,a[(a[t]+a[n])%256]}!function(e){for(var t=0;t<256;t++)a[t]=t;var n=0;for(t=0;t<256;t++){n=(n+a[t]+e.charCodeAt(t%e.length))%256;var i=a[t];a[t]=a[n],a[n]=i}}(e),this.random=function(){for(var e=0,t=1,n=0;n<8;n++)e+=i()*t,t*=256;return e/0x10000000000000000}},W.refreshEditorSidebarContent=function(e,t){var n=$("<div></div>");n.html("<b>"+W.translate("Questions")+"</b>"),W.editor.buildSortableList(n,t.JSON.questions,function(e,t){var n=$('<div style="margin-top:1em;"></div>');return n.append(W.editor.getTextInput(W.translate("Question")+" "+(e+1),t.question,function(e){t.question=e},1)),n.append(W.editor.getTextInput(W.translate("Answer")+" "+(e+1),t.word,function(e){t.word=e},1,20)),n},function(){return{question:"",word:""}}),e.append(n);var i=$("<div></div>"),a=$('<div class="btn btn-primary btn-xs">'+W.translate("newRandomOrder")+"</div>");a.on("click",function(){t.JSON.seed=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(0,5),W.editor.inputValueChanged(),W.editor.updateContentSidebar()}),i.append(a);var r=W.editor.getCustomInput(W.translate("alignment")+'<i class="fa fa-info-circle" style="display:inline-block;padding-left:0.5em"></i>',i);$(".fa-info-circle",r).tooltip({container:r,placement:"left",title:"Erstellt zufällig ein neues Kreuzworträtsel aus den eingegebenen Fragen. Kann wiederholt angeklickt werden, bis eine passende Darstellung gefunden wurde."}),e.append(r);var o=W.editor.getTextInput(W.translate("SolutionWord")+'<i class="fa fa-info-circle" style="display:inline-block;padding-left:0.5em"></i>',t.JSON.solutionword,function(e){t.JSON.solutionword=e},1,20);$(".fa-info-circle",o).tooltip({container:o,placement:"left",title:"Wenn die Länge des Lösungswortes mit der Anzahl Fragen übereinstimmt und jeweils ein Buchstabe zur Lösung passt, wird eine kompakte Darstellung mit einem vertikalen Lösungswort verwendet."}),e.append(o),e.append(W.editor.getSelectInput(W.translate("displayMode"),["left","right","top","bottom"],t.JSON.textSide,function(e){t.JSON.textSide=e}))}}(),new AModule("display_version").init=function(){},function(){var u=new AModule("drag_drop_text");u.maxSlotLength=0,u.floatPanel=null,u.allDragSources=[],u.draggingFromSlot=null,u.draggingAccept=null,u.initContent=function(e){e.JSON.text="<p>"+u.translate("drag_drop_text_preset")+"</p>",e.JSON.slots=[],e.JSON.additionals=[],e.slotInputs=[]},u.getConnectedValues=function(n,e){var i=JSON.parse(JSON.stringify(n.JSON.values));if(e.JSON&&e.JSON.slots&&"true"==n.JSON.connected&&n.JSON.connections&&0<n.JSON.connections.length){var t=n.inputElement.val();$.each(e.slotInputs,function(e,t){t.JSON.id!=n.JSON.id&&0<=n.JSON.connections.indexOf(t.JSON.id)&&(i=i.concat(t.JSON.values))});for(var a=!1,r=0;r<e.slotInputs.length;r++){var o=e.slotInputs[r];if(!(n.JSON.connections.indexOf(o.JSON.id)<0))if(o.JSON.id!=n.JSON.id){if(o.inputElement){var l=o.inputElement.val();if(a&&l==t)continue;for(var s=0;s<i.length;s++)if(i[s].value==l){i.splice(s,1);break}}}else a=!0}}return i},u.setSlotInputValue=function(e,t,n){e.inputElement.val(t),e.displayElement.html(e.inputElement.val()),""!=t?(e.displayElement.addClass("slotSourceDraggable"),e.displayElement.data("value",t),u.makeItemDraggable(e.displayElement,e,n)):(e.displayElement.removeClass("slotSourceDraggable"),e.displayElement.draggable("instance")&&e.displayElement.draggable("destroy")),u.checkSingleSlotInput(e,e.content)},u.checkSingleSlotInput=function(e,t){for(var n=$.trim(e.inputElement.val()),i=!1,a=u.getConnectedValues(e,t),r=0;r<a.length;r++)if(a[r].value==n){i=!0;break}return e.correct=i?"true":"false",t.isChecked&&!i&&""!=n&&(e.helped="true"),i},u.getCheckableElements=function(e){var t=[];if("true"==e.JSON.nocheck)return t;if(e.slotInputs)for(var n=0;n<e.slotInputs.length;n++){var i=e.slotInputs[n];"true"!=i.JSON.predefined&&t.push(i)}return t},u.addAlternativeHint=function(n){if(!("true"==n.JSON.connected&&n.JSON.connections&&0<n.JSON.connections.length)){var i=n.JSON.values.length;(1<i||""!=$.trim(n.JSON.altText))&&(n.displayElement.addClass("alternatives"),$(".slotDropSolutionIcon",n.displayElement.parent()).on("click",function(){for(var e=u.translate("alternateSolutionStart")+':<br><div style="height:0.5em"></div>',t=0;t<n.JSON.values.length;t++)n.inputElement.val()!=n.JSON.values[t].value&&(e+='<div class="alternativelist"><i>'+n.JSON.values[t].value+"</i></div>");widget.smallPopup(u.translate("alternateText"),(n.JSON.altText&&""!=n.JSON.altText?n.JSON.altText+"<br>":"")+(1<i?e:""),[{close:!0},{text:u.translate("OK")}])}))}},u.addLastInputHint=function(e){e.displayElement.hasClass("helped")&&e.last&&""!=e.last&&$(".slotDropSolutionIcon",e.displayElement.parent()).on("click",function(){widget.elementPopup(e.displayElement,"<del style='background:#ffe6e6'>"+e.last+"</del>").css("position","initial")})},u.checkSolution=function(a){if("true"==a.JSON.nocheck)return!0;var r=widget.findModule("check_solution"),o=!0;return $.each(a.slotInputs,function(e,t){if("true"!=t.JSON.predefined){t.displayElement.removeClass("helped correct wrong alternatives"),$(".slotDropSolutionIcon",t.displayElement.parent()).hide();var n=$.trim(t.inputElement.val()),i=u.checkSingleSlotInput(t,a);a.isChecked&&!i&&""!=n&&(t.helped="true"),i?(t.displayElement.addClass("correct"),r.showHelped&&"true"==t.helped&&t.displayElement.addClass("helped"),$(".slotDropSolutionIcon",t.displayElement.parent()).off(),u.addLastInputHint(t),u.addAlternativeHint(t),r.delay(function(){$(".slotDropSolutionIcon",t.displayElement.parent()).fadeIn()})):(t.displayElement.addClass("wrong"),t.last=n,r.delay(function(){$(".slotDropSolutionIcon",t.displayElement.parent()).fadeIn()}),o=!1)}}),o},u.helpSolution=function(e){if("true"==e.JSON.nocheck)return!0;for(var t=0;t<e.slotInputs.length;t++){var n=e.slotInputs[t];if("true"!=n.JSON.predefined){var i=$.trim(n.inputElement.val());if(!u.checkSingleSlotInput(n,e)){for(var a=u.getConnectedValues(n,e),r=a[0],o=0;o<a.length;o++)if("false"!=a[o].visible){r=a[o];break}return n.last=i,u.setSlotInputValue(n,r.value,"true"==e.JSON.separated?e.htmlElement:null),u.buildDragList(),n.displayElement.effect("highlight"),n.helped="true",widget.scrollToElement(n.displayElement),!1}}}return!0},u.findSlotByID=function(e,t){for(var n=null,i=0;i<e.JSON.slots.length;i++)e.JSON.slots[i].id==t&&(n=e.JSON.slots[i]);return null==n&&(n={id:t,values:[{value:"",visible:"true"}]},e.JSON.slots.push(n)),n},u.refreshContent=function(r){r.htmlElement.html(""!=$.trim(r.JSON.text)?r.JSON.text:"&nbsp;&nbsp;&nbsp;"),r.slotInputs=[];var i=0;helper.findAndReplaceInElement(r.htmlElement,/##([0-9]+)##/g,function(e,t){var n=u.findSlotByID(r,t);return i++,r.slotInputs.push({id:i,slotID:t,JSON:n,content:r}),'<div class="inputcontainer '+("center"==n.inneralign?"center ":"")+("right"==n.inneralign?"rtl ":"")+'"><input type="hidden" id="'+r.id+"_slot_drop_input_"+i+'"><div class="slot'+(n.displayMode&&"normal"!=n.displayMode?" "+n.displayMode:"")+'" id="'+r.id+"_slot_drop_display_"+i+'">'+("true"==n.predefined&&0<n.values.length?n.values[0].value:"")+'</div><div class="slotDropSolutionIcon"></div></div>'}),$.each(r.slotInputs,function(e,a){a.inputElement=$("#"+r.id+"_slot_drop_input_"+a.id,r.htmlElement),a.displayElement=$("#"+r.id+"_slot_drop_display_"+a.id,r.htmlElement),"true"!=a.JSON.predefined&&(u.setSlotInputValue(a,""),a.displayElement.on("click",function(){u.editor&&setTimeout(function(){u.editorShowSlotDetail(a.JSON.id,r)},10)}),a.displayElement.droppable({hoverClass:"drop-active",accept:".dragItemSource, .slotSourceDraggable",drop:function(e,t){if(null!=u.draggingAccept&&u.draggingAccept!=r.htmlElement)return!1;var n=a.inputElement.val();a.displayElement.removeClass("helped correct wrong alternatives"),u.setSlotInputValue(a,u.draggingElement?u.draggingElement.data("value"):"","true"==r.JSON.separated?r.htmlElement:null),null!=u.draggingFromSlot&&(u.draggingFromSlot.displayElement.removeClass("helped correct wrong alternatives"),u.setSlotInputValue(u.draggingFromSlot,n,"true"==r.JSON.separated?r.htmlElement:null)),u.buildDragList();var i=widget.findModule("save_load");i&&i.save()}}),u.checkSingleSlotInput(a,r))})},u.buildDragList=function(){var r=[],o=[];u.moduleUsed=!1;var l=null,s=null,d=function(e,t,i){var a=$('<div class="dragDropSourcePanel '+u.JSON.side+'"></div>');widget.hasBottomButtons||a.addClass("noButtons"),a.droppable({hoverClass:"drop-active",accept:".dragItemSource, .slotSourceDraggable",drop:function(e,t){if(null!=u.draggingAccept&&u.draggingAccept!=i)return!1;if(null!=u.draggingFromSlot){u.draggingFromSlot.displayElement.removeClass("helped correct wrong alternatives"),u.setSlotInputValue(u.draggingFromSlot,""),u.buildDragList();var n=widget.findModule("save_load");n&&n.save()}}});var n=null;if(u.JSON.additionals)for(var r=0;r<u.JSON.additionals.length;r++)""!=u.JSON.additionals[r]&&e.push(u.JSON.additionals[r]);return n="true"==u.JSON.reuse?helper.uniqueArray(e):helper.subtractArray(e,t),n=helper.natSortArray(n),$.each(n,function(e,t){var n=$('<div class="dragItemSource"></div>');n.html(t),n.data("value",t),u.makeItemDraggable(n,null,i),a.append(n)}),a};widget.forEachContent(function(e){if(e.module!=u)return!0;for(var t=[],i=[],n=0;n<e.JSON.slots.length;n++){if(new RegExp("##"+e.JSON.slots[n].id+"##","gi").exec(e.JSON.text)&&"true"!=e.JSON.slots[n].predefined)for(var a=0;a<e.JSON.slots[n].values.length;a++)""!=e.JSON.slots[n].values[a].value&&t.push(e.JSON.slots[n].values[a].value)}for(n=0;n<e.JSON.additionals.length;n++)""!=e.JSON.additionals[n].value&&t.push(e.JSON.additionals[n].value);if($.each(e.slotInputs,function(e,t){var n=t.inputElement.val();""!=n&&i.push(n)}),"true"==e.JSON.separated)return e.floatPanel&&(e.floatPanel.remove(),e.floatPanel=null),e.floatPanel=d(t,i,e.htmlElement),e.htmlElement.after(e.floatPanel),!0;e.floatPanel&&(e.floatPanel.remove(),e.floatPanel=null);for(n=0;n<t.length;n++)r.push(t[n]);for(n=0;n<i.length;n++)o.push(i[n]);return u.moduleUsed=!0,l=e,s||(s=e),!0}),null!=u.floatPanel&&u.floatPanel.remove(),widget.contentWrapper.removeClass("hasDragDropSourcePanel panelleft panelleft33 panelleft50 panelright panelright33 panelright50 paneltop paneltop10 panelbottom panelbottom10"),u.moduleUsed&&(u.floatPanel=d(r,o),"inline"==u.JSON.side&&l?l.htmlElement.after(u.floatPanel):"inline-before"==u.JSON.side&&s?s.htmlElement.before(u.floatPanel):(widget.contentWrapper.before(u.floatPanel),widget.contentWrapper.addClass("hasDragDropSourcePanel panel"+u.JSON.side))),widget.refreshImages(),widget.refreshMath()},u.makeItemDraggable=function(n,i,a){n.draggable({scroll:!1,appendTo:"body",revert:"invalid",helper:"clone",start:function(e,t){u.draggingElement=n,u.draggingFromSlot=i,u.draggingAccept=a,$(t.helper).width($(this).outerWidth()+1),$(t.helper).addClass("drag-active"),$(this).draggable("option","cursorAt",{left:Math.floor(this.clientWidth/2),top:Math.floor(this.clientHeight/2)}),widget.enableDragScrolling(null)},stop:function(e,t){u.draggingElement=null,widget.disableDragScrolling()}})},u.saveUserInput=function(e,t){if(e.slotInputs)for(var n=0;n<e.slotInputs.length;n++)"true"!=e.slotInputs[n].JSON.predefined&&(t.input.push({id:e.slotInputs[n].JSON.id,v:e.slotInputs[n].inputElement.val(),l:e.slotInputs[n].last?e.slotInputs[n].last:"",c:e.slotInputs[n].correct,h:e.slotInputs[n].helped}),"true"==e.slotInputs[n].correct?t.counter.correct++:e.slotInputs[n].last&&""!=e.slotInputs[n].last&&t.counter.wrong++,"true"==e.slotInputs[n].correct&&"true"==e.slotInputs[n].helped&&t.counter.helped++,t.counter.total++)},u.refreshModuleOnce=null,u.clearUserInput=function(e){if(e.slotInputs){for(var t=0;t<e.slotInputs.length;t++)"true"!=e.slotInputs[t].JSON.predefined&&(e.slotInputs[t].last=null,e.slotInputs[t].helped="false",e.slotInputs[t].correct="false",e.slotInputs[t].displayElement.removeClass("helped correct wrong alternatives"),u.setSlotInputValue(e.slotInputs[t],""));u.refreshModuleOnce||(u.refreshModuleOnce=setTimeout(u.refreshModule,1))}},u.loadUserInput=function(e,t){if(t)for(var n=0;n<t.length;n++)for(var i=0;i<e.slotInputs.length;i++)"true"!=e.slotInputs[i].JSON.predefined&&e.slotInputs[i].JSON.id==t[n].id&&(e.slotInputs[i].inputElement&&u.setSlotInputValue(e.slotInputs[i],t[n].v,"true"==e.JSON.separated?e.htmlElement:null),e.slotInputs[i].last=t[n].l&&""!=t[n].l?t[n].l:null,e.slotInputs[i].helped=t[n].h,e.slotInputs[i].correct=t[n].c);u.buildDragList()},u.getInputHTMLElements=function(e){var n=[];return $.each(e.slotInputs,function(e,t){n.push({e:t.displayElement,id:t.JSON.id})}),n},u.upgradeUserInputVersion=function(e,t,n){if("1"==t)for(var i=0;i<n.length;i++);},u.upgradeContentVersion=function(e,t){if("1"==t&&u.JSON.additionals){for(var n=0;n<u.JSON.additionals.length;n++)""!=u.JSON.additionals[n]&&e.JSON.additionals.push({value:u.JSON.additionals[n]});u.JSON.additionals=null}for(n=0;n<e.JSON.slots.length;n++){var i=e.JSON.slots[n];i.rtl&&(delete i.rtl,i.inneralign="right")}},u.refreshModule=function(){u.refreshModuleOnce=null,u.buildDragList(),u.maxSlotLength=0;var r=null;widget.forEachContent(function(e){if(e.module==u){e,r||(r=e);for(var t=0,n=0;n<e.JSON.slots.length;n++){var i=e.JSON.slots[n];if(new RegExp("##"+i.id+"##","gi").exec(e.JSON.text))for(var a=0;a<i.values.length;a++)t=Math.max(t,helper.measureTextWidth(i.values[a].value,"inputcontainer > slot"+(i.displayMode&&"normal"!=i.displayMode?" "+i.displayMode:"")))}u.maxSlotLength=Math.max(u.maxSlotLength,t);for(n=0;n<e.JSON.additionals.length;n++)""!=e.JSON.additionals[n].value&&(t=Math.max(t,helper.measureTextWidth(e.JSON.additionals[n].value,"inputcontainer > slot")));return u.maxSlotLength=Math.max(u.maxSlotLength,t),!0}}),widget.forEachContent(function(e){if(e.module==u){for(var a=0,r=[],t=0;t<e.JSON.slots.length;t++){var n=e.JSON.slots[t];if(new RegExp("##"+n.id+"##","gi").exec(e.JSON.text))for(var i=r[n.id]=0;i<n.values.length;i++)if("false"!=n.values[i].visible){var o=helper.measureTextWidth(n.values[i].value,"inputcontainer > slot"+(n.displayMode&&"normal"!=n.displayMode?" "+n.displayMode:""));a=Math.max(a,o),r[n.id]=Math.max(r[n.id],o)}}return $.each(e.slotInputs,function(e,t){var n=t.JSON,i="";n.size&&"auto"!=n.size||(i=3+u.maxSlotLength+"px"),0==isNaN(parseInt(n.size))&&(i=3+parseInt(15*n.size)+"px"),"longest"==n.size&&(i=3+a+"px"),"textlength"==n.size&&(i=3+r[n.id]+"px"),"100%"==n.size&&(i="100%",t.displayElement.parent().css("min-width",i)),t.displayElement.css("min-width",i)}),!0}})},u.init=function(){},u.findNextUnusedID=function(e){for(var t=1;;){if(!new RegExp("##("+t+")##","gi").exec(e.JSON.text))return t;t++}},u.refreshEditorSidebarContent=function(e,s){var l=$("<div>"+u.translate("Text")+':<br><div class="richtext">'+s.JSON.text+'</div><div class="clozeWarning"></div><br><div class="slotButtons" style="padding-right:20px"></div><div class="slotList sidebarBlockElement"></div></div>');e.append(l),u.editor.makeRichTextEditor({target:$(".richtext",l),buttons:[{title:u.translate("InsertSlot"),icon:"fa fa-edit",click:function(e,t){var n=0,i=t;if(i=$.trim(i),t.match(/^##([0-9]+)##$/)){var a=t.match(/[0-9]+/);n=a[0],i=""}else n=u.findNextUnusedID(s);for(var r=u.findSlotByID(s,n),o=!1,l=0;l<r.values.length;l++)r.values[l].value==i&&(o=!0);return 0==o&&(0<r.values.length&&""==r.values[0].value?r.values[0].value=i:r.values.push({value:i,visible:"true"})),setTimeout(function(){u.editorShowSlotDetail(n,s)},1),"##"+n+"##"+(""==t?" ":"")}},{title:u.translate("ConvertToClozes"),icon:"fa fa-bars",click:function(e,t){var n=e.content.code();return n=n.replace(/(<p[^>]*?>)(.*?)<\/p>/g,function(e,t,n){for(var i=1,a=0;a<s.JSON.slots.length;a++)i<=parseInt(s.JSON.slots[a].id)&&(i=parseInt(s.JSON.slots[a].id)+1);return u.findSlotByID(s,i).values[0]={value:$.trim(n),visible:"true"},t+"##"+i+"##</p>"}),e.content.html(n),setTimeout(function(){u.editorRefreshSlotButtonList(s,s.JSON.slots[s.JSON.slots.length-1].id)},1),""}}],onChange:function(e){s.JSON.text=e;for(var t,n="",i=new RegExp("##([0-9]+)##","gi"),a={};t=i.exec(e);)a[t[1]]||(a[t[1]]=0),a[t[1]]++;var r=[];for(var o in a)1<a[o]&&r.push(o);0<r.length&&(n+='<div style="color:red;margin:0.5em">Achtung: Lücke '+r.join(" und ")+" wurde mehrfach verwendet. Bitte korrigieren!</div>"),$(".clozeWarning",l).html(n),u.editorRefreshSlotButtonList(s,s.currentSlotID)},onHoverText:function(e){var t=e.match(/##([0-9]+)##/);if(t){var n=t[0].replace(/#/g,"");u.editorShowSlotDetail(n,s)}}}),u.editorRefreshSlotButtonList(s,-1);var t=$("<div></div>");u.editor.buildSortableList(t,s.JSON.additionals,function(e,t){var n=u.editor.getRichTextInput("",t.value,function(e){t.value=helper.stripHTML(e),u.editor.inputValueChanged()},!0,!0,!0);return u.refreshEditorSidebarContentFocusLast&&s.JSON.additionals.length-1==e&&(u.refreshEditorSidebarContentFocusLast=!1,setTimeout(function(){$(".note-editable",n.parent()).trigger("focus")},100)),n},function(){return u.refreshEditorSidebarContentFocusLast=!0,{value:""}}),e.append($("<hr>")),u.editor.advancedMode&&(e.append(u.editor.getToggleCheck(u.translate("withCorrection"),"true"==s.JSON.nocheck?"false":"true",function(e){s.JSON.nocheck="false"==e?"true":"false"})),e.append(u.editor.getToggleCheck(u.translate("separatedArea"),"true"==s.JSON.separated?"true":"false",function(e){s.JSON.separated="true"==e?"true":"false"})));var n=$("<div><b>"+u.translate("editor_globalSettings")+" "+u.translate("title_drag_drop_text")+"</b><br><br></div>");n.append(u.editor.getCustomInput(u.translate("additionalElements"),t)),n.append(u.editor.getSelectInput(u.translate("sidePanel"),["inline","inline-before",u.translate("left")+" 25%",u.translate("right")+" 25%",u.translate("left")+" 33%",u.translate("right")+" 33%",u.translate("left")+" 50%",u.translate("right")+" 50%",u.translate("top")+" 10%",u.translate("top")+" 25%",u.translate("bottom")+" 10%",u.translate("bottom")+" 25%"],"top"==u.JSON.side?u.translate("top")+" 25%":"bottom"==u.JSON.side?u.translate("bottom")+" 25%":"top10"==u.JSON.side?u.translate("top")+" 10%":"bottom10"==u.JSON.side?u.translate("bottom")+" 10%":"left"==u.JSON.side?u.translate("left")+" 25%":"right"==u.JSON.side?u.translate("right")+" 25%":"left33"==u.JSON.side?u.translate("left")+" 33%":"right33"==u.JSON.side?u.translate("right")+" 33%":"left50"==u.JSON.side?u.translate("left")+" 50%":"right50"==u.JSON.side?u.translate("right")+" 50%":u.JSON.side,function(e){e==u.translate("left")+" 25%"&&(u.JSON.side="left"),e==u.translate("right")+" 25%"&&(u.JSON.side="right"),e==u.translate("left")+" 33%"&&(u.JSON.side="left33"),e==u.translate("right")+" 33%"&&(u.JSON.side="right33"),e==u.translate("left")+" 50%"&&(u.JSON.side="left50"),e==u.translate("right")+" 50%"&&(u.JSON.side="right50"),e==u.translate("top")+" 10%"&&(u.JSON.side="top10"),e==u.translate("bottom")+" 10%"&&(u.JSON.side="bottom10"),e==u.translate("top")+" 25%"&&(u.JSON.side="top"),e==u.translate("bottom")+" 25%"&&(u.JSON.side="bottom"),"inline"==e&&(u.JSON.side="inline"),"inline-before"==e&&(u.JSON.side="inline-before")})),n.append(u.editor.getSelectInput(u.translate("Elements")+":",[u.translate("useAgain"),u.translate("useOnce")],"true"==u.JSON.reuse?u.translate("useAgain"):u.translate("useOnce"),function(e){u.JSON.reuse=e==u.translate("useAgain")?"true":"false"})),e.append(n)},u.editorRefreshSlotButtonList=function(r,o){var e=$(".slotButtons",r.sidebarElement);e.html(""),r.currentSlotID=o;var l=0,s=$('<div class="btn-group"></div>');-1!=o&&u.findSlotByID(r,o),$.each(r.JSON.slots,function(e,t){if(new RegExp("##"+t.id+"##","gi").exec(r.JSON.text)){var n=$('<div class="btn btn-'+(t.id==o?"primary":"gray")+' btn-xs">'+u.translate("Cloze")+" "+t.id+"</div>");n.on("click",function(){u.editorShowSlotDetail(t.id,r)}),s.append(n),l++}else{o==t.id&&(o=-1,r.currentSlotID=o,$(".slotList",r.sidebarElement).html(""));for(var i=0;i<r.JSON.slots.length;i++)if(r.JSON.slots[i].connections)for(var a=0;a<r.JSON.slots[i].connections.length;a++)if(r.JSON.slots[i].connections[a]==t.id){r.JSON.slots[i].connections.splice(a,1);break}delete t.connections}});var t=$('<div class="sidebarBlockInputButtons btn-group" style="margin-top:0px"></div>');e.append(t),0==l&&s.append(u.translate("noSlots")),e.append(s)},u.editorShowSlotDetail=function(t,r){u.editorRefreshSlotButtonList(r,t);var e=$(".slotList",r.sidebarElement);if(e.html(""),e.addClass("sideBarSubFrame"),1!=t||0!=r.JSON.slots.length){var a=u.findSlotByID(r,t),i=function(){u.editorShowSlotDetail(t,r),l()},o=$("<div></div>");o.append($('<div class="solutionWarning"></div>'));var l=function(){for(var e="",t=0;t<a.values.length;t++){for(var n=0,i=t;i<a.values.length;i++)a.values[t].value==a.values[i].value&&n++;1<n&&(e+='<div style="color:red;margin:0.5em">Achtung: Lösung '+a.values[t].value+" wurde mehrfach verwendet. Bitte korrigieren!</div>")}$(".solutionWarning",o).html(e)};if(u.editor.buildSortableList(o,a.values,function(e,t){var n=u.editor.getRichTextInput("",t.value,function(e){t.value=helper.stripHTML(e),l(),u.editor.inputValueChanged()},!0,!0,!0);return u.refreshEditorSidebarContentFocusLast&&a.values.length-1==e&&(u.refreshEditorSidebarContentFocusLast=!1,setTimeout(function(){$(".note-editable",n.parent()).trigger("focus")},100)),n},function(){return u.refreshEditorSidebarContentFocusLast=!0,{value:"",visible:"true"}},function(){i()}),e.append(u.editor.getCustomInput(u.translate("Solutions"),o)),l(),u.editor.advancedMode){e.append(u.editor.getRichTextInput(u.translate("alternateSolutionIntro"),a.altText,function(e){a.altText=e},!0,!0)),e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"slots.size",a.size,i)}))),e.append(u.editor.getSelectInput(u.translate("Size"),["auto","longest","textlength","100%","1","2","3","4","5","6","8","10","12","15","20","25","30","35","40","45","50"],a.size,function(e){a.size=e,u.editorShowSlotDetail(t,r)})),e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"slots.displayMode",a.displayMode,i)}))),e.append(u.editor.getSelectInput(u.translate("displayMode"),["normal","underlined"],a.displayMode,function(e){a.displayMode=e,i()}));var n=a.inneralign?a.inneralign:"";e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"slots.inneralign",a.inneralign,i)}))),e.append(u.editor.getContentAlignSelectInput(u.translate("editor_styleAlign"),n,function(e){a.inneralign=e,i()}));var s=function(n,i){if(delete i.connected,delete i.connections,n.connections){var e=n.connections.indexOf(i.id);-1!=e&&n.connections.splice(e,1);for(var a=0;a<n.connections.length;a++)$.each(r.JSON.slots,function(e,t){t.id==n.connections[a]&&t.connections&&-1<t.connections.indexOf(i.id)&&s(t,i)});$.each(r.JSON.slots,function(e,t){t.connections&&0==t.connections.length&&(delete t.connected,delete t.connections)})}},d=function(n,i){n.connected="true",i.connected="true",n.connections||(n.connections=[]),n.connections.push(i.id),i.connections||(i.connections=[]),i.connections.push(n.id);for(var a=0;a<n.connections.length;a++)$.each(r.JSON.slots,function(e,t){t.id==n.connections[a]&&(t.connections&&-1!=t.connections.indexOf(i.id)||d(i,t))});for(a=0;a<i.connections.length;a++)$.each(r.JSON.slots,function(e,t){t.id==i.connections[a]&&(t.connections&&-1!=t.connections.indexOf(n.id)||d(t,n))})};if(e.append(u.editor.getToggleCheck(u.translate("connectedClozes"),a.connected,function(e){"true"==(a.connected=e)?a.connections=[]:function(n){if(n.connections)for(var i=0;i<n.connections.length;i++)$.each(r.JSON.slots,function(e,t){n.connections&&t.id==n.connections[i]&&t.id!=n.id&&(delete t.connected,delete t.connections)});delete n.connected,delete n.connections}(a),i()})),"true"==a.connected){var c=$('<div class="btn-group"><i class="fa fa-link fa-fw" style="float:left;margin-top:5px"></i> </div>');$.each(r.JSON.slots,function(e,t){var n;new RegExp("##"+t.id+"##","gi").exec(r.JSON.text)&&(t.id!=a.id?(n=$('<div class="btn btn-'+(-1!=a.connections.indexOf(t.id)?"primary":"gray")+' btn-xs">'+u.translate("Cloze")+" "+t.id+"</div>")).on("click",function(){-1==a.connections.indexOf(t.id)?d(a,t):s(a,t),u.editor.inputValueChanged(),i()}):n=$('<div class="btn btn-primary btn-xs" style="pointer-events:none">'+u.translate("Cloze")+" "+t.id+"</div>"),c.append(n))}),e.append(c)}}e.append(u.editor.getToggleCheck(u.translate("predefined"),a.predefined,function(e){a.predefined=e,i()}))}}}(),function(){var p=new AModule("flashcards");p.refreshModule=function(){},p.init=function(){p.JSON.cards||(p.JSON.cards=[])},p.findCardByID=function(e){for(var t=0;t<p.JSON.cards.length;t++)if(p.JSON.cards[t].id==e)return p.JSON.cards[t];return null},p.refreshModule=function(){p.tileOptions&&(p.tileOptions.badge=p.JSON.cards.length)},p.initEditor=function(o){p.tileOptions={icon:'<i class="fa fa-file fa-rotate-90"></i>',badge:p.JSON.cards.length},p.editorTile=o.addTile(p.JSON.title,p.tileOptions),p.editorTile.on("click",function(){var r=p.JSON.active,c=JSON.parse(JSON.stringify(p.JSON.cards)),u=-1;o.showModalDialog("<h1>"+p.translate("title_flashcards")+" "+p.translate("Modul")+"</h1>",[{text:p.translate("Cancel"),classname:"btn-default",icon:"fa fa-times"},{text:p.translate("Save"),icon:"fa fa-save",onclick:function(e){p.JSON.active=r;for(var t=0;t<c.length;t++){var n=c[t],i=$("<div></div>");i.html(n.front);var a=$("<div></div>");a.html(n.back),""==$.trim(i.html())&&""==$.trim(a.html())&&(c.splice(t,1),t--)}return p.JSON.cards=c,o.inputValueChanged(),!0}}],function(e){e.append(p.editor.getSelectInput(p.translate("status")+":",[p.translate("active"),p.translate("inactive")],"true"==p.JSON.active?p.translate("active"):p.translate("inactive"),function(e){r=e==p.translate("active")?"true":"false"}));var d=$('<div style="max-height:75vh;overflow:auto;position:relative;margin-top:16px"></div>');!function o(){d.html(""),$(c).each(function(t){var e=$('<div class="sidebarBlockInputButtons btn-group" style="max-width:56px;z-index:1;margin-right:-8px;"></div>');if(d.append(e),u!=t&&e.append(p.editor.getSmallIconBtn("fa-pencil",function(){u=t,o()})),e.append(p.editor.getSmallIconBtn("fa-trash-o",function(){c.splice(t,1),t<=u&&u--,o()})),e.append(p.editor.getSmallIconBtn("fa-angle-up",function(){if(0<t){var e=c[t-1];c[t-1]=c[t],c[t]=e,o()}})),e.append(p.editor.getSmallIconBtn("fa-angle-down",function(){if(t<c.length-1){var e=c[t+1];c[t+1]=c[t],c[t]=e,o()}})),u!=t){var n=$('<div style="display:flex;min-height:32px;padding-right: 64px;"></div>'),i=$('<div style="width:50%;border:1px solid #a9a9a9;padding:8px"></div>'),a=$('<div style="width:50%;border:1px solid #a9a9a9;padding:8px"></div>');n.append(i),n.append(a),i.html(c[t].front),a.html(c[t].back),d.append(n),setTimeout(function(){widget.refreshImages({htmlElement:n}),widget.refreshMath(n.get(0))},1)}else n=$('<div style="display:flex;min-height:32px;padding-right: 64px;"></div>'),i=$('<div style="width:50%;border:1px solid #a9a9a9;padding:8px"></div>'),a=$('<div style="width:50%;border:1px solid #a9a9a9;padding:8px"></div>'),i.append(p.editor.getRichTextInput(p.translate("flashcardfront"),c[u].front,function(e){c[u].front=e},!0,!0,!0)),a.append(p.editor.getRichTextInput(p.translate("flashcardback"),c[u].back,function(e){c[u].back=e},!0,!0,!0)),n.append(i),n.append(a),d.append(n);d.append('<hr style="clear:both">')});var e=$('<button class="btn"><i class="fa fa-plus fa-fw"></i> Karte erstellen</button>');e.on("click",function(){p.JSON.nextCardID||(p.JSON.nextCardID=0),p.JSON.nextCardID++,c.push({id:p.JSON.nextCardID,front:"",back:""}),u=c.length-1,o()}),d.append(e);var l=$('<button style="margin-left:10px" class="btn"><i class="fa fa-table fa-fw"></i> Importieren</button>');l.on("click",function(){l.hide(),s.hide();var e=$('<div style="margin-top:10px"></div>');e.append($("<p>Verwenden Sie eine Zeile pro Karteikarte und trennen Sie Vorder- und Rückseite mit einem Tabulator oder Semikolon.</p>"));var a=$('<textarea style="width:100%;height:200px;margin-bottom:4px"></textarea>');e.append(a);var r=$('<button class="btn btn-primary"><i class="fa fa-arrow-right fa-fw"></i> jetzt importieren</button>');r.on("click",function(){r.hide();var e=$.trim(a.val());if(""!=e)for(var t=e.split("\n"),n=0;n<t.length;n++){var i=[];""!=(i=t[n].match(/\t/)?t[n].split("\t"):t[n].split(";"))[0]&&(p.JSON.nextCardID||(p.JSON.nextCardID=0),p.JSON.nextCardID++,c.push({id:p.JSON.nextCardID,front:i[0],back:1<i.length?i[1]:""}))}u=c.length-1,o()}),e.append(r),d.append(e)}),d.append(l);var s=$('<button style="margin-left:10px" class="btn"><i class="fa fa-external-link fa-fw"></i> Exportieren</button>');s.on("click",function(){var e=function(e){return e=(e=e.replace(/^<p>([\s\S]*)<\/p>$/m,"$1")).replace(/\n/g,"")};l.hide(),s.hide();var t=$('<div style="margin-top:10px"></div>'),n=$('<textarea style="width:100%;height:200px;margin-bottom:4px"></textarea>');t.append(n);for(var i="",a=0;a<c.length;a++)i+=e(c[a].front)+"\t"+e(c[a].back)+"\n";n.val(i),d.append(t)}),d.append(s)}(),e.append(p.editor.getCustomInput(p.translate("flashcards")+":",d))})})}}(),function(){var u=new AModule("highlight_text");u.initContent=function(e){e.JSON.text="<p>"+u.translate("highlight_text_preset")+"</p>",e.JSON.colors=[],e.JSON.groups=[],e.editorSelectedColor=null,e.spanInputs=[]},u.checkSingleSpan=function(e,t){var n,i=e.displayElement.attr("data-color"),a=e.displayElement.attr("data-set");return void 0!==i&&0!=i||(i=""),void 0!==a&&0!=a||(a=""),n=i==a,e.correct=n?"true":"false",n},u.checkSolution=function(r){if("true"==r.JSON.nocheck)return!0;if("true"==r.JSON.predefined)return!0;var o=widget.findModule("check_solution"),l=!0,s=[],d=[],c=-1,i=r.htmlElement.offset().top,e=parseInt(r.htmlElement.css("padding-top"));isNaN(e)||(i+=e);var t=parseInt(r.htmlElement.css("padding-left"));if(isNaN(t)||t,$.each(r.spanInputs,function(e,t){var n=t.displayElement.offset();c!=n.top&&(s.push(0),d.push(n.top),c=n.top),t.displayElement.removeClass("helped correct wrong");var i=t.displayElement.attr("data-set");void 0!==i&&0!=i||(i="");var a=u.checkSingleSpan(t,r);r.isChecked&&!a&&""!=i&&(t.helped="true"),""!=i&&o.delay(function(){t.displayElement.removeClass("helped correct wrong"),"true"==t.correct?(t.displayElement.addClass("correct"),o.showHelped&&"true"==t.helped&&t.displayElement.addClass("helped")):t.displayElement.addClass("wrong")},.5),"false"==t.correct&&(l=!1,s[s.length-1]++)}),r.counterDisplays&&$.each(r.counterDisplays,function(e,t){t.fadeOut("normal",function(){$(this).remove()})}),r.counterDisplays=[],"true"==r.JSON.blockCorrection){var n=0;if($.each(s,function(e,t){n+=t}),0<n){var a=$('<div class="hightlightCounterDisplay"></div>');a.html('<div class="hightlightCounterDisplayLine"></div>'+(99<n?99:n)),a.css("margin-top",d[d.length-1]-i+"px"),r.htmlElement.prepend(a),a.fadeIn(),$(".hightlightCounterDisplayLine",a).css("height",d[d.length-1]-i),r.counterDisplays.push(a)}}else $.each(s,function(e,t){if(0!=t){var n=$('<div class="hightlightCounterDisplay"></div>');n.html(t),n.css("margin-top",d[e]-i+"px"),r.htmlElement.prepend(n),n.fadeIn(),r.counterDisplays.push(n)}});return l},u.getCheckableElements=function(e){var t=[];if("true"==e.JSON.nocheck)return t;if("true"==e.JSON.predefined)return t;if(e.spanInputs)for(var n=0;n<e.spanInputs.length;n++){var i=e.spanInputs[n];t.push(i)}return t},u.getInputValueReadable=function(e,n){var i="";return $.each(e.JSON.colors,function(e,t){t.color==n&&(i=t.type)}),i},u.helpSolution=function(i){if("true"==i.JSON.nocheck)return!0;if("true"==i.JSON.predefined)return!0;var t=!0;return $.each(i.spanInputs,function(e,n){t&&!u.checkSingleSpan(n,i)&&(u.setSpanData(n.displayElement,null),$.each(i.JSON.colors,function(e,t){t.color==n.displayElement.attr("data-color")&&(u.setSpanData(n.displayElement,t),u.checkSingleSpan(n,i))}),n.helped="true",n.displayElement.addClass("highlight"),n.displayElement.effect("highlight",function(){setTimeout(function(){n.displayElement.removeClass("highlight")},1e3)}),widget.scrollToElement(n.displayElement),t=!1)}),t},u.refreshContent=function(l){l.htmlElement.html(""!=$.trim(l.JSON.text)?l.JSON.text.replace(/&nbsp;/g," "):"&nbsp;&nbsp;&nbsp;"),l.htmlElement.addClass("highlightTextContent"),"true"==l.JSON.hideLabels&&l.htmlElement.addClass("highlightHideLabels");var e=widget.findModule("hints");e&&e.refreshContents(l);function s(e){return"\n"==e||" "==e||"."==e||","==e||";"==e||"!"==e||"?"==e||'"'==e||"«"==e||"»"==e}!function i(e,o){$.each(e,function(e,a){if(1==a.nodeType&&"SPAN"==a.nodeName.toUpperCase()){var t=helper.colorToRGB(a.style.backgroundColor);u.setSpanData($(a),null),$(a).addClass("highlightTextSpan"),s($(a).html())||($(a).attr("data-color",t),$(a).addClass("clickable").on("click",function(e){u.clickedWord($(a),l)}))}else if(3==a.nodeType&&"SPAN"!=o.nodeName.toUpperCase()){var r=a.nextSibling,n=function(e){for(var t=[],n="",i=0;i<e.length;i++){var a=e[i];s(a)?(""!=n&&t.push(n),n="",t.push(a)):n+=a}return""!=n&&t.push(n),t}(a.textContent.replace(/\r/g,"\n").replace(/\n\n/g,"\n"));$.each(n,function(e,t){if("\n"!=t){var n=document.createElement("span");n.innerText=t,a.parentNode.insertBefore(n,r),$(n).addClass("highlightTextSpan").attr("data-color",""),s(t)||$(n).addClass("clickable").on("click",function(e){u.clickedWord($(n),l)})}else{var i=document.createElement("br");a.parentNode.insertBefore(i,r)}}),a.parentNode.removeChild(a)}else i($(a).contents(),a)})}(l.htmlElement.contents(),l.htmlElement[0]),function n(e,t){$.each(e,function(e,t){1==t.nodeType&&"SPAN"==t.nodeName.toUpperCase()?0<e&&s(t.innerHTML)&&$(t).prev("span").add(t).wrapAll('<div class="highlightTextSB"></div>'):n($(t).contents(),t)})}(l.htmlElement.contents(),l.htmlElement[0]),$(".highlightTextSB",l.htmlElement).append('<div class="highlightTextSBA"> &nbsp; </div>'),""==$.trim(l.htmlElement.html())&&l.htmlElement.html("&nbsp;&nbsp;&nbsp;"),l.spanInputs=[],$.each($("p",l.htmlElement),function(e,t){""==$(t).html()&&$(t).html("<br>")}),$.each($("span",l.htmlElement),function(e,t){l.spanInputs.push({correct:"false",helped:"false",displayElement:$(t)})}),"true"==l.JSON.predefined&&$.each(l.spanInputs,function(e,n){n.displayElement.css("pointer-events","none"),u.setSpanData(n.displayElement,null),$.each(l.JSON.colors,function(e,t){t.color==n.displayElement.attr("data-color")&&u.setSpanData(n.displayElement,t)})}),setTimeout(function(){FastClick.attach(l.htmlElement.get(0))},10)},u.setSpanData=function(e,t){t&&""!=t?(e.attr("data-set",t.color),e.attr("data-type",t.type),e.css("background-color",t.color)):(e.attr("data-set",""),e.attr("data-type",""),e.css("background-color",""))},u.clickedWord=function(r,o){if("true"==o.JSON.predefined)return!0;var l=widget.findModule("save_load");if(1==o.JSON.colors.length&&(r.removeClass("helped correct wrong"),r.attr("data-set")!=o.JSON.colors[0].color?u.setSpanData(r,o.JSON.colors[0]):u.setSpanData(r,null),l&&l.save()),1<o.JSON.colors.length){var a=$("<div></div>");$.each(o.JSON.groups,function(e,n){var t=$('<div class="hightlightColorSelectorEntry group" style="background-color:'+n.colors[0]+'">'+n.name+"</div>");t.on("click",function(e){e.stopPropagation(),s.fadeOut("normal",function(){$(this).remove()});var a=$("<div></div>");$.each(n.colors,function(e,i){$.each(o.JSON.colors,function(e,t){if(t.color==i){var n=$('<div class="hightlightColorSelectorEntry" style="background-color:'+t.color+';">'+t.type+"</div>");n.on("click",function(e){r.removeClass("helped correct wrong"),u.setSpanData(r,t),l&&l.save(),e.stopPropagation(),s.fadeOut("normal",function(){$(this).remove()})}),a.append(n)}})});var t=$('<div class="hightlightColorSelectorEntry">« zurück</div>');t.on("click",function(e){u.clickedWord(r,o),e.stopPropagation(),s.fadeOut("normal",function(){$(this).remove()})}),a.append(t),s=widget.elementPopup(r,a,"auto")}),a.append(t)}),$.each(o.JSON.colors,function(e,n){var i=null;if($.each(o.JSON.groups,function(e,t){-1!=t.colors.indexOf(n.color)&&(i=t)}),!i){var t=$('<div class="hightlightColorSelectorEntry" style="background-color:'+n.color+';">'+n.type+"</div>");t.on("click",function(e){r.removeClass("helped correct wrong"),u.setSpanData(r,n),l&&l.save(),e.stopPropagation(),s.fadeOut("normal",function(){$(this).remove()})}),a.append(t)}});var e=$('<div class="hightlightColorSelectorEntry">⊘ keins</div>');e.on("click",function(e){r.removeClass("helped correct wrong"),u.setSpanData(r,null),l&&l.save(),e.stopPropagation(),s.fadeOut("normal",function(){$(this).remove()})}),a.append(e);var s=widget.elementPopup(r,a,"auto")}},u.saveUserInput=function(n,i){if("true"==n.JSON.predefined)return!0;n.spanInputs&&$.each(n.spanInputs,function(e,t){u.checkSingleSpan(t,n),t.displayElement.attr("data-color")&&""!=t.displayElement.attr("data-color")||t.displayElement.attr("data-set")&&""!=t.displayElement.attr("data-set")?(i.input.push({v:t.displayElement.attr("data-set"),h:t.helped,c:t.correct}),"true"==t.correct?i.counter.correct++:i.counter.wrong++,"true"==t.correct&&"true"==t.helped&&i.counter.helped++,i.counter.total++):i.input.push(0)})},u.clearUserInput=function(e){if("true"==e.JSON.predefined)return!0;e.counterDisplays&&$.each(e.counterDisplays,function(e,t){t.remove()}),$.each(e.spanInputs,function(e,t){t.helped="false",t.correct="false",t.displayElement&&t.displayElement.removeClass("helped correct wrong"),u.setSpanData(t.displayElement,null)})},u.loadUserInput=function(e,a){if("true"==e.JSON.predefined)return!0;$.each(e.spanInputs,function(n,i){null==a&&i.displayElement&&i.displayElement.removeClass("helped correct wrong"),u.setSpanData(i.displayElement,null),!a||n>a.length-1||void 0!==a[n].v&&($.each(e.JSON.colors,function(e,t){t.color==a[n].v&&u.setSpanData(i.displayElement,t)}),i.correct=a[n].c,i.helped=a[n].h)})},u.getInputHTMLElements=function(e){if("true"==e.JSON.predefined)return[];var n=[];return $.each(e.spanInputs,function(e,t){n.push({e:t.displayElement,id:e})}),n},u.init=function(){},u.refreshEditorSidebarContent=function(e,r){var t=$('<div>Text:<br><div class="richtext">'+r.JSON.text+'</div><br><div class="colorsList"></div></div>');e.append(t);var n=function(){u.editorShowColorDetail(r)};u.editor.advancedMode&&(e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(r,"blockCorrection",r.JSON.blockCorrection,n)}))),e.append(u.editor.getToggleCheck(u.translate("blockCheck")+":",r.JSON.blockCorrection,function(e){r.JSON.blockCorrection=e,n()})),e.append(u.editor.getToggleCheck(u.translate("hideLabels")+":",r.JSON.hideLabels,function(e){r.JSON.hideLabels=e,n()})),e.append(u.editor.getToggleCheck(u.translate("predefined"),r.JSON.predefined,function(e){r.JSON.predefined=e,u.editor.updateContentSidebar()})),"true"!=r.JSON.predefined&&e.append(u.editor.getToggleCheck(u.translate("withCorrection"),"true"==r.JSON.nocheck?"false":"true",function(e){r.JSON.nocheck="false"==e?"true":"false"})));u.editor.makeRichTextEditor({target:$(".richtext",t),buttons:[],onChange:function(e){r.JSON.text=e,n()},onHoverText:function(e,t,n){r.currentSelectedGroup=null,r.currentSelectedText=n;var i=t.getStartPoint().node.parentNode;if(i&&1==i.nodeType&&"SPAN"==i.nodeName.toUpperCase()){var a=helper.colorToRGB(i.style.backgroundColor);$.each(r.JSON.colors,function(e,t){t.color==a&&r.editorSelectedColor!=t&&(r.editorSelectedColor=t)})}}});u.editorShowColorDetail(r)},u.editorShowColorDetail=function(r){var n=[];r.JSON.text.replace(/<span style="[^"]*background-color:([^;"]*)[^"]*">/g,function(e,t){return t=helper.colorToRGB(t),-1==n.indexOf(t)&&n.push(t),e}),$.each(n,function(e,n){var i=!1;$.each(r.JSON.colors,function(e,t){i=i||t.color==n}),i||r.JSON.colors.push({color:n,type:""})});var o=$(".colorsList",r.sidebarElement);o.html(""),$.each(r.JSON.colors,function(e,t){var n=$('<div class="sidebarBlockInputButtons btn-group"></div>');o.append(n),n.append(u.editor.getSmallIconBtn("fa-trash-o",function(){r.JSON.colors.splice(e,1),u.editor.inputValueChanged(),u.editor.updateContentSidebar()}));var i=$('<input class="form-control input-sm" style="display:block" type="text">');i.val(t.type),i.on("change keyup",function(){t.type=$.trim($(this).val()),u.editor.inputValueChanged()});var a=u.editor.getCustomInput('<div class="btn btn-default btn-xs" style="background-color:'+t.color+'">&nbsp;&nbsp;&nbsp;</div> '+u.translate("textTyp")+":",i);$(".btn",a).on("mousedown",function(e){r.currentSelectedGroup&&-1==r.currentSelectedGroup.colors.indexOf(t.color)&&(r.currentSelectedGroup.colors.push(t.color),u.editor.inputValueChanged(),u.editor.updateContentSidebar()),r.currentSelectedText&&r.currentSelectedText.color(r.currentSelectedText.editable,'{"backColor":"'+t.color+'"}'),e.preventDefault()}),o.append(a)});var l=$("<div></div>");if($.each(r.JSON.groups,function(e,i){var t=$('<div class="sidebarBlockInputButtons btn-group"></div>');l.append(t),0==e&&t.append(u.editor.getSmallIconBtn("fa-plus",function(){r.JSON.groups.push({name:"",colors:[]}),r.currentSelectedText=null,r.currentSelectedGroup=r.JSON.groups[r.JSON.groups.length-1],u.editor.updateContentSidebar()})),t.append(u.editor.getSmallIconBtn("fa-trash-o",function(){r.JSON.groups.splice(e,1),u.editor.updateContentSidebar()}));var n=$('<input class="form-control input-sm" style="display:block" type="text">');n.val(i.name),n.on("change keyup",function(){i.name=$.trim($(this).val()),u.editor.inputValueChanged()});var a=$('<div style="margin-bottom:5px;"></div>');$.each(i.colors,function(e,t){var n=$('<div class="btn btn-default btn-xs" style="margin-top:2px;margin-right:4px;background-color:'+t+'"><i class="fa fa-trash-o"></i></div>');n.on("click",function(){var e=i.colors.indexOf(t);-1!=e&&i.colors.splice(e,1),u.editor.inputValueChanged(),u.editor.updateContentSidebar()}),a.append(n)}),n.on("focus",function(){r.currentSelectedGroup!=i&&(r.currentSelectedText=null,r.currentSelectedGroup=i)}),l.append(n),l.append(a)}),u.editor.advancedMode){if(0==r.JSON.groups.length){var e=$('<div class="sidebarBlockInputButtons btn-group" style="margin-top:0px"></div>');o.append(e),e.append(u.editor.getSmallIconBtn("fa-plus",function(){r.JSON.groups.push({name:"",colors:[]}),r.currentSelectedGroup=r.JSON.groups[r.JSON.groups.length-1],r.currentSelectedText=null,u.editor.updateContentSidebar()})),l.append('<div style="padding-top:6px">'+u.translate("noColorGroups")+"</div>")}o.append(u.editor.getCustomInput(u.translate("colorGroups")+":",l))}}}(),function(){var l=new AModule("hints");l.noSaveData=!0,l.hintCounter=0,l.hintTexts=[],l.current=null,l.displayHint=function(e,t,n){l.current&&(l.current.remove(),l.current=null),l.current=widget.smallPopup(e,n,[{close:!0},{text:t}]);var i=widget.findModule("reading_text");i&&i.replaceLinkElements(l.current)},l.refreshContents=function(e){helper.findAndReplaceInElement(e.htmlElement,/@@([^@]+)@@/g,function(e,t){if("false"==l.JSON.active)return"";if(t.match(/^\d+$/)){var n=l.findHintByID(parseInt(t));return n&&n.teacher?"":'<div class="helpcontainerbutton" data-hintID="'+t+'">?</div>'}return l.hintCounter++,l.hintTexts[l.hintCounter]=t,'<div class="helpcontainerbutton" data-hint="'+l.hintCounter+'">?</div>'}),$(".helpcontainerbutton",e.htmlElement).on("click",function(e){if($(this).attr("data-hintID")){var t=l.findHintByID(parseInt($(this).attr("data-hintID")));l.displayHint(l.translate("hint"),l.translate("OK"),t?t.text:"")}else{var n=l.hintTexts[$(this).attr("data-hint")];l.displayHint(l.translate("hint"),l.translate("OK"),n)}e.stopPropagation()})},l.refreshModule=function(){widget.forEachContent(function(e){return l.refreshContents(e),!0}),l.tileOptions&&(l.tileOptions.badge=l.JSON.hints.length)},l.findHintByID=function(e){for(var t=0;t<l.JSON.hints.length;t++)if(l.JSON.hints[t].id==e)return l.JSON.hints[t];return null},l.getNewHintID=function(){var n=0;return $.each(l.JSON.hints,function(e,t){n=Math.max(n,parseInt(t.id))}),n+1},l.init=function(){l.JSON.hints||(l.JSON.hints=[]),widget.bindHTMLProcessor(function(e){l.refreshContents({htmlElement:e})})},l.initEditor=function(n){n.registerGlobalRichTextBtn({id:"hint",title:l.translate("addHint"),icon:"fa fa-question-circle",click:function(e,t){return""==t&&(t=l.translate("hint")),"@@"+t+"@@"}}),n.toggleGlobalRichTextBtn("hint","true"==l.JSON.active),l.tileOptions={icon:'<i class="fa fa-question-circle"></i>',badge:l.JSON.hints.length},l.editorTile=n.addTile(l.JSON.title,l.tileOptions),$.each(l.JSON.hints,function(e,t){l.JSON.nextHintID=Math.max(l.JSON.nextHintID,parseInt(t.id))}),l.editorTile.on("click",function(){var t=l.JSON.active,r=JSON.parse(JSON.stringify(l.JSON.hints)),o=0;n.showModalDialog("<h1>"+l.translate("title_hints")+" "+l.translate("Modul")+"</h1>",[{text:l.translate("Cancel"),classname:"btn-default",icon:"fa fa-times"},{text:l.translate("Save"),icon:"fa fa-save",onclick:function(e){return l.JSON.active=t,l.JSON.hints=r,l.tileOptions.badge=l.JSON.hints.length,n.inputValueChanged(),!0}}],function(e){e.append('<p>In Textelementen lassen sich Hinweise über ein klickbares "?"-Symbol einbinden. Umfangreiche Hinweise können hier erstellt und anschliessend über @@1@@ (Zahl = Hinweisnummer) in Textfelder eingebunden werden.</p>');var a=$("<div></div>");!function n(){if(a.html(""),r.length>o){var e=$('<div class="sidebarBlockInputButtons btn-group"></div>');if(a.append(e),e.append(l.editor.getSmallIconBtn("fa-trash-o",function(){r.splice(o,1),0<o&&o--,n()})),a.append(l.editor.getRichTextInput(l.translate("hint")+" <b>@@"+r[o].id+"@@</b>",r[o].text,function(e){r[o].text=e},!0,!0,!1)),0<o&&((i=$('<button style="float:left;margin-top:8px" class="btn"><i class="fa fa-angle-left fa-fw"></i></button>')).on("click",function(){o--,n()}),a.append(i)),o<r.length-1&&((i=$('<button style="float:right;margin-top:8px" class="btn"><i class="fa fa-angle-right fa-fw"></i></button>')).on("click",function(){o++,n()}),a.append(i)),0<r.length){var t=$('<div style="text-align:center;margin:auto;margin-top:12px;width:160px">'+(o+1)+" / "+r.length+"</div>");a.append(t)}a.append('<hr style="clear:both">')}var i;(i=$('<button class="btn"><i class="fa fa-plus fa-fw"></i> Hinweis erstellen</button>')).on("click",function(){l.JSON.nextHintID||(l.JSON.nextHintID=0);for(var e=0,t=0;t<r.length;t++)e=Math.max(e,r[t].id);l.JSON.nextHintID=e+1,r.push({id:l.JSON.nextHintID,text:"",teacher:!1}),o=r.length-1,n()}),a.append(i)}(),e.append(l.editor.getCustomInput(l.translate("hints")+":",a))})})}}(),function(){var s=new AModule("html_and_files");s.loadedFiles=[],window.widgetData={data:{},callbacks:{},stats:{},actions:{},parameters:{}},s.initContent=function(e){e.JSON.html="",e.JSON.files=[{url:""}],e.JSON.nocheck="true",e.JSON.useClassData="false"},s.refreshContent=function(i){if(window.widgetData.data[i.id]||(window.widgetData.data[i.id]={}),window.widgetData.callbacks[i.id]||(window.widgetData.callbacks[i.id]={}),window.widgetData.stats[i.id]||(window.widgetData.stats[i.id]={}),window.widgetData.parameters[i.id]||(window.widgetData.parameters[i.id]={}),i.JSON.parameters)for(var e=0;e<i.JSON.parameters.length;e++)window.widgetData.parameters[i.id][i.JSON.parameters[e].name]=i.JSON.parameters[e].value;window.widgetData.actions[i.id]||(window.widgetData.actions[i.id]={getParent:function(){return $("#"+i.id)},check:function(e){widget.findModule("check_solution").check(e)},help:function(){widget.findModule("check_solution").help()},save:function(e){widget.findModule("save_load").save(e)},load:function(e){widget.findModule("save_load").load(e)},reset:function(e){widget.findModule("save_load").reset(e)},captureAudioFile:function(e){widget.captureAudioFile(e)},captureImageFile:function(e){widget.captureImageFile(e)}});var a=0,r=0;function t(e){var t=widget.getMediaURLPath(e),n=e.toLowerCase();if("js"==(n=n.split("."))[n.length-1]){s.loadedFiles.push({url:e,type:"script"});var i=document.createElement("script");i.type="text/javascript",i.async=!1,i.src=t,i.addEventListener("load",function(){a++}),r++,document.getElementsByTagName("head")[0].appendChild(i),console.log("Loading HTML embedded file: "+t)}"css"==n[n.length-1]&&(s.loadedFiles.push({url:e,type:"css"}),$("<link/>",{rel:"stylesheet",type:"text/css",href:t}).appendTo("head"),console.log("Loading HTML embedded file: "+t))}if(i.htmlElement.html(""),i.htmlElement.addClass("htmlContainer"),i.htmlElement.css("min-height","1em"),i.JSON.files)for(e=0;e<i.JSON.files.length;e++)if(i.JSON.files[e].url){for(var n=!1,o=0;o<s.loadedFiles.length;o++)if(s.loadedFiles[o].url==i.JSON.files[e].url){n=!0;break}n||t(i.JSON.files[e].url)}var l=function(){r==a?function(){var e=i.JSON.html&&""!=i.JSON.html?i.JSON.html:"";e=(e=e.replace(/(src|href)="([^"]+)"/g,function(e,t,n){return n&&0<n.length&&0!==n.indexOf("http")&&0!==n.indexOf("'")?t+'="'+widget.getMediaURLPath(n)+'"':e})).replace(/(src|href)='([^']+)'/g,function(e,t,n){return n&&0<n.length&&0!==n.indexOf("http")&&0!==n.indexOf('"')?t+"='"+widget.getMediaURLPath(n)+"'":e});var t=i.JSON.html.match(/widgetInit_[^ (]+/),n="<script> "+t+' ("'+i.id+'",window.widgetData.data["'+i.id+'"],window.widgetData.actions["'+i.id+'"], window.widgetData.callbacks["'+i.id+'"],window.widgetData.stats["'+i.id+'"],window.widgetData.parameters["'+i.id+'"]);<\/script>';i.htmlElement.append($(e+(t?n:""))),window.widgetData.callbacks[i.id].onLoad&&window.widgetData.callbacks[i.id].onLoad(window.widgetData.data[i.id]),i.isChecked&&s.checkSolution(i),FastClick.attach(i.htmlElement.get(0))}():setTimeout(l,100)};setTimeout(l,1)},s.getCheckableElements=function(e){var t=[];return"true"==e.JSON.nocheck||window.widgetData&&window.widgetData.callbacks[e.id]&&t.push(e.htmlElement),t},s.checkSolution=function(e){if("true"==e.JSON.nocheck)return!0;if(window.widgetData.callbacks[e.id].onCheck){var t=window.widgetData.callbacks[e.id].onCheck();return window.widgetData.stats[e.id].c=t?"true":"false",t}return!0},s.helpSolution=function(e){if("true"==e.JSON.nocheck)return!0;if(window.widgetData.callbacks[e.id].onHelp){var t=window.widgetData.callbacks[e.id].onHelp();return t||(window.widgetData.stats[e.id].h="true"),t}return!0},s.saveUserInput=function(e,t){if(window.widgetData&&window.widgetData.callbacks[e.id]){var n={},i=!1,a=!1;for(k in t.counter.total=0,window.widgetData.stats[e.id])n[k]=window.widgetData.stats[e.id][k],"total"==k&&$.isNumeric(n[k])&&(t.counter.total=n[k],a=!0),"c"==k&&"true"==n[k]&&(t.counter.correct=1,t.counter.total=1),"c"==k&&"false"==n[k]&&(t.counter.wrong=1,t.counter.total=1),"h"==k&&"true"==n[k]&&(t.counter.helped=1);for(k in window.widgetData.stats[e.id])n[k]=window.widgetData.stats[e.id][k],"correct"==k&&$.isNumeric(n[k])&&(t.counter.correct=n[k],a||(t.counter.total+=t.counter.correct)),"wrong"==k&&$.isNumeric(n[k])&&(t.counter.wrong=n[k],a||(t.counter.total+=t.counter.wrong)),"helped"==k&&$.isNumeric(n[k])&&(t.counter.helped=n[k]),i=!0;if(window.widgetData.callbacks[e.id].onSave&&window.widgetData.callbacks[e.id].onSave(),window.widgetData.data[e.id])for(k in n.d={},window.widgetData.data[e.id]){window.widgetData.data[e.id][k];n.d[k]=window.widgetData.data[e.id][k],i=!0}i&&t.input.push(n),window.widgetData.callbacks[e.id].onSaved&&window.widgetData.callbacks[e.id].onSaved(n.d?n.d:null)}},s.clearUserInput=function(e){if(window.widgetData&&window.widgetData.callbacks[e.id]){for(k in window.widgetData.data[e.id])delete window.widgetData.data[e.id][k];for(k in window.widgetData.stats[e.id])delete window.widgetData.stats[e.id][k];window.widgetData.callbacks[e.id].onReset&&window.widgetData.callbacks[e.id].onReset(),window.widgetData.callbacks[e.id].onSaved&&window.widgetData.callbacks[e.id].onSaved({})}},s.loadUserInput=function(e,t){if(window.widgetData&&window.widgetData.callbacks[e.id]&&t&&1==t.length){if(window.widgetData.data[e.id]||(window.widgetData.data[e.id]={}),window.widgetData.stats[e.id]||(window.widgetData.stats[e.id]={}),window.widgetData.callbacks[e.id]||(window.widgetData.callbacks[e.id]={}),t[0].d)for(k in t[0].d)window.widgetData.data[e.id][k]=t[0].d[k];for(k in window.widgetData.stats[e.id])delete window.widgetData.stats[e.id][k];for(k in t[0])"d"!=k&&(window.widgetData.stats[e.id][k]=t[0][k]);window.widgetData.callbacks[e.id].onLoad&&window.widgetData.callbacks[e.id].onLoad(window.widgetData.data[e.id])}},s.loadClassInput=function(e,t){if(window.widgetData&&window.widgetData.callbacks[e.id]&&window.widgetData.callbacks[e.id].onClassData){if(null==t)return void window.widgetData.callbacks[e.id].onClassData(null);var n={};if(t.students)for(var i=0;i<t.students.length;i++)for(var a=0;a<t.students[i].input.contents.length;a++)if(t.students[i].input.contents[a].id==e.id&&t.students[i].input.contents[a].input&&1==t.students[i].input.contents[a].input.length){var r={Name:t.students[i].Name,ID:t.students[i].ID};for(var o in t.students[i].input.contents[a].input[0].d)r[o]=t.students[i].input.contents[a].input[0].d[o];n[r.ID]=r;break}window.widgetData.callbacks[e.id].onClassData(n)}},s.init=function(){},s.editorInit=function(e){},s.refreshEditorSidebarContent=function(e,a){e.append(s.editor.getHTMLCodeInput(s.translate("htmlCode"),a.JSON.html,function(e){a.JSON.html=e})),e.append(s.editor.getToggleCheck(s.translate("withCorrection"),"true"==a.JSON.nocheck?"false":"true",function(e){a.JSON.nocheck="false"==e?"true":"false"})),e.append(s.editor.getToggleCheck(s.translate("withClassData"),a.JSON.useClassData,function(e){a.JSON.useClassData=e}));var t=$('<div><div class="sidebarBlockLabel" style="padding-top:0;">'+s.translate("Parameters")+'</div><div class="sidebarBlockInput"></div></div>');e.append(t);var n=$("<div></div>");a.JSON.parameters||(a.JSON.parameters=[]),s.editor.buildSortableList(n,a.JSON.parameters,function(e,t){var n=$('<div style="clear:both"><div class="sidebarBlockLabel" style="padding-top:0;"></div><div class="sidebarBlockInput"></div></div>'),i=$('<input type="text" placeholder="Parameter" class="form-control input-sm"/>');i.val(t.name),i.on("change textInput input",function(){t.name=$.trim($(this).val()),s.editor.inputValueChanged()}),$(".sidebarBlockLabel",n).append(i);var a=$('<input type="text" placeholder="Value" class="form-control input-sm"/>');return a.val(t.value),a.on("change textInput input",function(){t.value=$.trim($(this).val()),s.editor.inputValueChanged()}),$(".sidebarBlockInput",n).append(a),n},function(){return{name:"",value:""}}),e.append(n);var i=$("<div></div>");s.editor.buildSortableList(i,a.JSON.files,function(i,n){return s.editor.getFileInput(s.translate("additionalFile")+" "+(i+1),n.url,function(e){n.url=e;for(var t=0;t<s.loadedFiles.length;t++)s.loadedFiles[t].url==e&&(s.loadedFiles.splice(t,1),t--)},!0,function(e,t){for(;a.JSON.files.length<i+t+1;)a.JSON.files.push({url:e});a.JSON.files[i+t].url=e,s.editor.updateContentSidebar();for(var n=0;n<s.loadedFiles.length;n++)s.loadedFiles[n].url==e&&(s.loadedFiles.splice(n,1),n--)})},function(){return{url:""}}),e.append(i)}}(),function(){var n=new AModule("image");n.noSaveData=!0,n.initContent=function(e){e.JSON.url="",e.JSON.width="auto",e.JSON.fullscreen="false"},n.refreshContent=function(e){var t="",n="",i="";"auto"!=e.JSON.width&&(t+="width:"+e.JSON.width+";"),e.JSON.caption&&e.JSON.text&&""!=e.JSON.text&&(n="imagecaption "+e.JSON.caption.replace(" ",""),i=e.JSON.text),e.JSON.url&&""!=e.JSON.url?e.htmlElement.html('<div class="contentImage"><span class="'+n+'" title="'+helper.escapeAttribute(i)+'"></span><img '+("true"==e.JSON.fullscreen?'onclick="if(window.widget) widget.openImagePopup(this.src)"':"")+' onload="if(window.widget) widget.refreshScrollbars()" alt="" style="'+t+'" src="'+widget.getMediaURLPath(e.JSON.url)+'" /></div>'):e.htmlElement.html('<div class="contentImage" style="'+t+'"><span class="'+n+'" title="'+helper.escapeAttribute(i)+'"></span>&nbsp;&nbsp;&nbsp;</div>')},n.refreshEditorSidebarContent=function(e,t){e.append(n.editor.getImageFileInput(n.translate("image"),t.JSON.url,function(e){t.JSON.url=e})),e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(n.editor.getApplyToAllBtn(function(){n.editor.openApplyAttributeToAllDialog(t,"width",t.JSON.width)}))),e.append(n.editor.getSelectInput(n.translate("Size"),["auto","100%","90%","80%","75%","70%","66%","60%","50%","40%","33%","30%","25%","20%","10%"],t.JSON.width,function(e){t.JSON.width=e})),e.append(n.editor.getToggleCheck(n.translate("allowFullscreen"),t.JSON.fullscreen,function(e){t.JSON.fullscreen=e})),e.append(n.editor.getSelectInput(n.translate("Caption"),["none","upper left","upper center","upper right","center left","center center","center right","bottom left","bottom center","bottom right"],t.JSON.caption?t.JSON.caption:"none",function(e){"none"==e?delete t.JSON.caption:t.JSON.caption=e,n.editor.updateContentSidebar()})),t.JSON.caption&&e.append(n.editor.getTextInput(n.translate("CaptionText"),t.JSON.text,function(e){t.JSON.text=e}))}}(),function(){var r=new AModule("image_gallery");r.noSaveData=!0,r.galleries=[],r.initContent=function(e){e.JSON.images=[{url:""},{url:""},{url:""}],e.sliderWidth=100},r.updateSize=function(e){var t=e.htmlElement.width();e.sliderWidth=Math.round(.66*t),t<e.sliderWidth+130&&(e.sliderWidth=t-130),$(".sliderProgressOuter",e.htmlElement).css("width",e.sliderWidth+30+"px"),$(".sliderProgressBar",e.htmlElement).css("width",e.sliderWidth+"px"),$(".sliderProgress",e.htmlElement).css("left",e.sliderWidth/(e.JSON.images.length-1)*e.currentImage+"px"),$(".sliderProgressLabel",e.htmlElement).html(e.currentImage+1+" von "+e.JSON.images.length),widget.refreshScrollbars()},r.refreshInsideContainer=function(e){r.updateSize(e)},r.updateImage=function(e,t,n){var i=$(".imageGalleryCurrent img",e.htmlElement),a=$(".imageGalleryOverlay img",e.htmlElement);i.show().stop().attr("src",widget.getMediaURLPath(e.JSON.images[t].url)).fadeOut("slow"),a.hide().stop().attr("src",widget.getMediaURLPath(e.JSON.images[n].url)).fadeIn("slow",function(){i.get(0)==$(".imageGalleryCurrent img",e.htmlElement).get(0)&&(i.remove(),$(".imageGalleryCurrent",e.htmlElement).append(a),$(".imageGalleryOverlay",e.htmlElement).append($("<img />")),r.updateSize(e),setTimeout(function(){r.updateSize(e)},200))}),r.updateSize(e)},r.refreshContent=function(a){a.htmlElement.html('<div class="imageGallery"><div class="invisiblePlaceholders"></div><div class="currentImageWrapper imageGalleryCurrent"><img onload="if(window.widget) widget.refreshScrollbars()" alt=""/></div><div class="currentImageWrapper imageGalleryOverlay"><img alt=""/></div></div><div class="imageSlider"><div class="imageSliderNumber prev blank">&laquo;</div><div class="sliderProgressOuter"><div class="sliderProgressLabel"></div><div class="sliderProgressBar"><div class="sliderProgress" onclick="event.stopPropagation()"></div></div></div><div class="imageSliderNumber next blank">&raquo;</div></div></div>'),a.currentImage=0,r.updateImage(a,0,0),$.each(a.JSON.images,function(e,t){if(""!=$.trim(t.url)){var n=new Image;n.src=widget.getMediaURLPath(t.url),$(".invisiblePlaceholders",a.htmlElement).append(n)}}),$(".prev",a.htmlElement).on("click",function(){var e=a.currentImage;a.currentImage--,a.currentImage<0&&(a.currentImage=0),r.updateImage(a,e,a.currentImage)}),$(".next",a.htmlElement).on("click",function(){var e=a.currentImage;a.currentImage++,a.currentImage>a.JSON.images.length-1&&(a.currentImage=a.JSON.images.length-1),r.updateImage(a,e,a.currentImage)}),$(".sliderProgressBar",a.htmlElement).on("click",function(e){var t=a.currentImage,n=$(this).parent().offset(),i=e.pageX-n.left-parseInt($(this).css("margin-left"));a.currentImage=Math.round((a.JSON.images.length-1)/a.sliderWidth*i),t!=a.currentImage&&r.updateImage(a,t,a.currentImage)}),$(".sliderProgress",a.htmlElement).draggable({scroll:!1,helper:"self",start:function(e,t){$(this).draggable("option","cursorAt",{left:Math.floor(this.clientWidth/2),top:Math.floor(this.clientHeight/2)})},drag:function(e,t){t.position.top=0,t.position.left<0&&(t.position.left=0),t.position.left>a.sliderWidth&&(t.position.left=a.sliderWidth);var n=a.currentImage;a.currentImage=Math.round((a.JSON.images.length-1)/a.sliderWidth*t.position.left),n!=a.currentImage&&r.updateImage(a,n,a.currentImage)},stop:function(e,t){}}),-1==r.galleries.indexOf(a)&&r.galleries.push(a)},r.init=function(){},r.editorInit=function(e){},r.refreshEditorSidebarContent=function(e,i){var t=$("<div></div>");r.editor.buildSortableList(t,i.JSON.images,function(n,t){return r.editor.getImageFileInput(r.translate("image")+" "+(n+1),t.url,function(e){t.url=e},!1,function(e,t){for(;i.JSON.images.length<n+t+1;)i.JSON.images.push({url:e});i.JSON.images[n+t].url=e,r.editor.updateContentSidebar()})},function(){return{url:""}}),e.append(t)}}(),function(){var E=new AModule("image_map");E.initContent=function(e){e.JSON.text="",e.JSON.url="",e.JSON.areas=[],e.JSON.showAreas="true",e.JSON.useLabels="true",e.JSON.ratio=1},E.colors=["MainColor","MainColorLight","AccentColor","AccentColorLight","Yellow","Red","Green","Blue","Black","White"],E.getCheckableElements=function(e){var t=[];return"true"==e.JSON.nocheck||t.push(e.htmlElement),t},E.getInputHTMLElements=function(e){var t=[];return e.inputElement&&t.push({e:e.inputElement,id:1}),t},E.getInputValueReadable=function(e,t){if(t){var n=t.split(",");return"X: "+n[0]+"  Y: "+n[1]+"  Color: "+E.colors[n[2]]}return""},E.updateMarkerAreas=function(y){$.each(y.areas,function(e,t){t.markers=[],t.wrongColor=[]});var C=100*(y.JSON.ratio?y.JSON.ratio:1);"true"==y.JSON.nocheck?($(".imageMapArea",y.inputElement).remove(),$.each(y.areas,function(e,t){var n="true"==y.JSON.outlines,i=$('<div class="imageMapArea imageMapColors" style="display:none;z-index:0;pointer-events:none;position:absolute;'+(n?"opacity:0.8;border:4px solid; border-color: var(--"+t.color+")":"opacity:0.4;background: var(--"+t.color+")")+';"></div>');i.css({"border-radius":"circle"==t.type?"100%":"0",left:t.x1+"%",top:t.y1+"%",width:t.x2-t.x1+"%",height:t.y2-t.y1+"%",transform:"rotate("+(t.r?t.r:0)+"deg)"}),y.inputElement.append(i),"true"==y.JSON.showAreas&&i.show()})):$.each(y.markers,function(e,x){x.areas=[],x.wrongColorFor=null,x.areaElements||(x.areaElements=[]),$.each(y.areas,function(e,t){if("true"!=t.predefined&&(!x.area||x.area.id==t.id)){var n=!1,i=!0;if("circle"==t.type){var a=t.r?(180<t.r?t.r-360:t.r)*Math.PI/180:0,r=(t.x2+t.x1)/2,o=(t.y2+t.y1)/2,l=(x.x-r)*C,s=100*(x.y-o),d=(t.x2-t.x1)/2,c=(t.y2-t.y1)/2,u=Math.cos(-a),p=Math.sin(-a),g=(u*l-p*s)/C,h=(p*l+u*s)/100;n=g*g/(d*d)+h*h/(c*c)<=1}if("rect"==t.type)if(0!=(a=t.r?t.r*Math.PI/180:0)){var f=(x.x-(t.x2+t.x1)/2)*C,m=100*(x.y-(t.y2+t.y1)/2),v=Math.cos(-a),S=Math.sin(-a),w=(v*f-S*m)/C,O=(S*f+v*m)/100;n=w>=-(t.x2-t.x1)/2&&w<=(t.x2-t.x1)/2&&O>=-(t.y2-t.y1)/2&&O<=(t.y2-t.y1)/2}else n=x.x>=t.x1&&x.x<=t.x2&&x.y>=t.y1&&x.y<=t.y2;if(t.color&&""!=t.color&&(i=t.color==E.colors[x.c]),n&&i){t.markers.push(x),x.areas.push(t);for(var N=!1,J=0;J<x.areaElements.length;J++)if(t.id==x.areaElements[J].area.id){N=!0;break}if(!N){var b="true"==y.JSON.outlines,k=$('<div class="imageMapColors" style="display:none;z-index:0;pointer-events:none;position:absolute;'+(b?"opacity:0.8;border:4px solid; border-color: var(--"+t.color+")":"opacity:0.4;background: var(--"+t.color+")")+';"></div>');k.css({"border-radius":"circle"==t.type?"100%":"0",left:t.x1+"%",top:t.y1+"%",width:t.x2-t.x1+"%",height:t.y2-t.y1+"%",transform:"rotate("+(t.r?t.r:0)+"deg)"}),x.areaElements.push({e:k,area:t}),y.inputElement.append(k)}}n&&!i&&(t.wrongColor.push(x),x.wrongColorFor=t)}})}),$.each(y.markers,function(e,t){t.areaElements||(t.areaElements=[]);for(e=0;e<t.areaElements.length;e++){for(var n=t.areaElements[e].area,i=!1,a=0;a<t.areas.length;a++)if(n.id==t.areas[a].id){i=!0;break}i||(t.areaElements[e].e.remove(),t.areaElements.splice(e,1),e--)}})},E.checkSingleMarker=function(e,t){if(e.correct="false",e.areas||(e.areas=[]),0==e.areas.length)return!1;for(var n=0;n<e.areas.length;n++){for(var i=!1,a=0;a<e.areas[n].markers.length;a++)e.areas[n].markers[a]!=e&&e.areas[n].markers[a].index<e.index&&(i=!0);if(!i)return e.correct="true",!0}return!1},E.checkSolution=function(a){if("true"==a.JSON.nocheck)return!0;if(!a.inputElement)return!0;var r=widget.findModule("check_solution"),o=!0;return $.each(a.markers,function(e,t){t.htmlELement.removeClass("helped correct wrong alternatives"),$(".imageMapSolutionIcon",t.htmlELement).hide();var n=E.checkSingleMarker(t,a);if(!a.isChecked||n||t.initPos||(t.helped="true"),n){if(t.htmlELement.addClass("correct"),r.showHelped&&"true"==t.helped&&t.htmlELement.addClass("helped"),$(".imageMapSolutionIcon",t.htmlELement).off(),t.areaElements)for(var i=0;i<t.areaElements.length;i++)t.areaElements[i].e.off();r.delay(function(){if($(".imageMapSolutionIcon",t.htmlELement).fadeIn(),"true"==a.JSON.showAreas&&t.areaElements)for(var e=0;e<t.areaElements.length;e++)t.areaElements[e].e.fadeIn()})}else t.htmlELement.addClass("wrong"),t.last=t.x+","+t.y+","+t.c,r.delay(function(){$(".imageMapSolutionIcon",t.htmlELement).fadeIn()}),o=!1}),$.each(a.areas,function(e,t){"true"!=t.predefined&&(t.markers&&0!=t.markers.length||(o=!1))}),o},E.helpSolution=function(e){if("true"==e.JSON.nocheck)return!0;if(!e.inputElement)return!0;for(var t=0;t<e.markers.length;t++){var n=e.markers[t];if(!E.checkSingleMarker(n,e)){if(n.htmlELement.removeClass("helped correct wrong alternatives"),"true"==e.JSON.useLabels)n.helped="true",n.last=n.x+","+n.y+","+n.c,n.x=Math.round((n.area.x1+n.area.x2)/2),n.y=Math.round((n.area.y1+n.area.y2)/2);else{var i=null;n.wrongColorFor&&0==n.wrongColorFor.markers.length&&(i=n.wrongColorFor),i||$.each(e.areas,function(e,t){i&&i.markers.length<=t.markers.length||"true"!=t.predefined&&0==t.markers.length&&(i=t)}),i?(n.helped="true",n.last=n.x+","+n.y+","+n.c,n.wrongColorFor==i||(n.x=Math.round((i.x1+i.x2)/2),n.y=Math.round((i.y1+i.y2)/2)),n.c=i.color&&""!=i.color?E.colors.indexOf(i.color):"",n.htmlELement.fadeOut(10,function(){n.htmlELement.fadeIn(2e3)})):(n.htmlELement.fadeOut(2e3,function(){n.htmlELement.remove()}),e.markers.splice(t,1))}return E.updateMarkerAreas(e),E.refreshMarkers(e),!1}}for(t=0;t<e.areas.length;t++){var a=e.areas[t];if("true"!=a.predefined)if(!a.markers||0==a.markers.length)return(n={helped:"true"}).last=n.x+","+n.y+","+n.c,n.x=Math.round((a.x1+a.x2)/2),n.y=Math.round((a.y1+a.y2)/2),n.c=a.color&&""!=a.color?E.colors.indexOf(a.color):"",e.markers.push(n),E.updateMarkerAreas(e),E.refreshMarkers(e),!1}return!0},E.refreshMarkers=function(a){if("true"!=a.JSON.useLabels&&1<a.colors.length){!function i(){a.inputColors||(a.inputColors=$('<div class="imageMapColorSelectorWrapper"></div>'),a.inputElement.append(a.inputColors),$.each(a.colors,function(e,t){var n=$('<div class="imageMapColorSelector imageMapColors"><i class="fa fa-fw"></i></div>');n.on("click",function(e){e.stopPropagation(),a.selectedColor=E.colors.indexOf(t),i()}),n.addClass(t),a.inputColors.append(n)})),$(".imageMapColorSelector",a.inputColors).each(function(e,t){$(this).removeClass("selected"),E.colors.indexOf(a.colors[e])==a.selectedColor&&$(this).addClass("selected")})}()}$.each(a.markers,function(e,i){i.htmlELement||(i.htmlELement=$('<div class="imageMapMarkerWrapper"><div class="imageMapColors imageMapMarker '+(i.c&&""!=i.c?E.colors[i.c]:"")+'"></div><div class="imageMapSolutionIcon"></div></div>'),i.htmlELement.hide(),i.htmlELement.fadeIn(),a.inputElement.append(i.htmlELement),i.htmlELement.draggable({containment:a.inputElement,scroll:!1,start:function(){$(".imageMapMarkerWrapper",a.inputElement).not(this).css({"z-index":"",opacity:.2}),$(this).css("z-index","10"),widget.enableDragScrolling($(this))},drag:function(e,t){i.x=100*parseFloat($(this).position().left/parseFloat(a.inputElement.width())),i.y=100*parseFloat($(this).position().top/parseFloat(a.inputElement.height())),i.htmlELement.removeClass("helped correct wrong alternatives"),i.initPos=!1,i.label&&E.getLabelForMarker(i,i.label)},stop:function(){$(".imageMapMarkerWrapper",a.inputElement).css({opacity:""}),E.updateMarkerAreas(a),E.checkSingleMarker(i,a);var e=widget.findModule("save_load");e&&e.save(),widget.disableDragScrolling()}}),i.htmlELement.on("click",function(e){if(e.stopPropagation(),!("true"==a.JSON.useLabels||a.colors.length<2)){var t=a.colors.indexOf(E.colors[i.c]);t==a.colors.length-1?t=0:t++,i.c=E.colors.indexOf(a.colors[t]),i.htmlELement.removeClass("helped correct wrong alternatives"),E.updateMarkerAreas(a),E.checkSingleMarker(i,a),E.refreshMarkers(a);var n=widget.findModule("save_load");n&&n.save()}})),i.index=e,i.htmlELement.css({left:i.x+"%",top:i.y+"%"});for(var t=0;t<E.colors.length;t++)i.c==t?$(".imageMapColors",i.htmlELement).addClass(E.colors[t]):$(".imageMapColors",i.htmlELement).removeClass(E.colors[t]);"true"==a.JSON.useLabels&&(i.label&&i.label.remove(),i.label=E.getLabelForMarker(i),i.label.addClass("fixedPosition"),i.htmlELement.append(i.label))}),$.each(a.areas,function(e,t){if("true"==t.predefined){var n=$('<div class="imageMapMarkerWrapper"><div class="imageMapColors imageMapMarker '+(t.color&&""!=t.color?t.color:"")+'"></div></div>'),i={};i.x=Math.round((t.x1+t.x2)/2),i.y=Math.round((t.y1+t.y2)/2),n.css({left:i.x+"%",top:i.y+"%"}),a.inputElement.append(n)}})},E.refreshContent=function(o){if(o.inputElement=null,o.inputColors=null,o.areas=[],o.JSON.areas)for(var e=0;e<o.JSON.areas.length;e++)o.areas.push(JSON.parse(JSON.stringify(o.JSON.areas[e])));o.colors=[];for(e=0;e<o.areas.length;e++)o.areas[e].color&&""!=o.areas[e].color&&-1==o.colors.indexOf(o.areas[e].color)&&o.colors.push(o.areas[e].color);if(o.markers||(o.markers=[]),o.htmlElement.html(o.JSON.text&&""!=$.trim(o.JSON.text)&&"<p><br></p>"!=$.trim(o.JSON.text)?o.JSON.text:""),"true"==o.JSON.useLabels&&o.htmlElement.addClass("withLabels"),o.imageLoaded=!1,o.JSON.url&&""!=o.JSON.url){if(o.htmlElement.append($('<div class="imageMapWrapper"><img class="imageMapImage" onload="if(window.widget) widget.refreshScrollbars()" alt="" src="'+widget.getMediaURLPath(o.JSON.url)+'" style="max-width:100%"/><div class="imageMapOverlay"></div></div>')),o.inputElement=$(".imageMapOverlay",o.htmlElement),o.image=$(".imageMapImage",o.htmlElement),o.image.on("load",function(){o.imageLoaded=!0,"true"==o.JSON.useLabels&&setTimeout(function(){var n=0;$.each(o.markers,function(e,t){n=Math.max(n,$(".labelInner",t.label).width()+50)}),$(".imageMapWrapper",o.htmlElement).css({"margin-left":n+"px","margin-right":n+"px"});var e=function(){if(0!=o.image.height()){var n=5e3/o.image.height();$.each(o.markers,function(e,t){-1==t.y&&(t.y=Math.floor(e/2)*n+n,t.initPos=!0)}),E.updateMarkerAreas(o),$.each(o.markers,function(e,t){E.checkSingleMarker(t,o)}),E.refreshMarkers(o)}else setTimeout(e,100)};setTimeout(e,0)},0)}),"true"==o.JSON.useLabels){o.markers=[];o.areas.length;"true"!=o.JSON.sorted&&helper.shuffleArray(o.areas),$.each(o.areas,function(e,t){var n={};n.x=e%2==0?3:97,n.y=-1,n.c=E.colors.indexOf(t.color),(n.area=t).marker=n,o.markers.push(n),E.checkSingleMarker(n,o)}),E.updateMarkerAreas(o),o.image.trigger("load")}else o.inputElement.on("click",function(e){var t=$(this).parent().offset(),n=e.pageX-t.left,i=e.pageY-t.top,a={};a.x=100*parseFloat(n/parseFloat($(this).parent().width())),a.y=100*parseFloat(i/parseFloat($(this).parent().height())),a.c=void 0!==o.selectedColor?o.selectedColor:0<o.colors.length?E.colors.indexOf(o.colors[0]):"",o.markers.push(a),E.updateMarkerAreas(o),E.checkSingleMarker(a,o);var r=widget.findModule("save_load");r&&r.save(),E.refreshMarkers(o)});E.refreshMarkers(o),setTimeout(function(){FastClick.attach(o.htmlElement.get(0))},10)}else o.htmlElement.append($('<div class="imageMapWrapper">&nbsp;&nbsp;&nbsp;<div class="imageMapOverlay"></div></div>'))},E.saveUserInput=function(e,t){if(e.markers)for(var n=0;n<e.markers.length;n++)t.input.push({id:e.markers[n].area?e.markers[n].area.id:n+1,v:e.markers[n].x+","+e.markers[n].y+","+e.markers[n].c,l:e.markers[n].last?e.markers[n].last:"",c:e.markers[n].correct,h:e.markers[n].helped,i:e.markers[n].initPos?1:0}),"true"!=e.JSON.nocheck&&("true"==e.markers[n].correct?t.counter.correct++:e.markers[n].initPos||t.counter.wrong++,"true"==e.markers[n].correct&&"true"==e.markers[n].helped&&t.counter.helped++,t.counter.total++)},E.clearUserInput=function(e){e.markers=[],E.refreshContent(e)},E.loadUserInput=function(e,t){if(t)if("true"==e.JSON.useLabels){for(var n=0;n<e.markers.length;n++)for(var i=0;i<t.length;i++)if(t[i].id==e.markers[n].area.id){var a=t[i].v.split(",");e.markers[n].x=a[0],e.markers[n].y=a[1],e.markers[n].last=t[i].l&&""!=t[i].l?t[i].l:null,e.markers[n].helped=t[i].h,e.markers[n].correct=t[i].c,e.markers[n].initPos=1==t[i].i}}else{$(".imageMapMarkerWrapper",e.htmlElement).remove(),e.markers=[];for(i=0;i<t.length;i++){var r={};a=t[i].v.split(",");r.x=a[0],r.y=a[1],r.c=a[2],r.last=t[i].l&&""!=t[i].l?t[i].l:null,r.helped=t[i].h,r.correct=t[i].c,r.initPos=1==t[i].i,e.markers.push(r)}}E.updateMarkerAreas(e),E.refreshMarkers(e)},E.init=function(){},E.getLabelForMarker=function(e,t){var n=e.isRight;if(e.x<25&&(e.isRight=!1),75<e.x&&(e.isRight=!0),n=e.isRight,e.area){i=null;return(i=t||$('<div class="imageMapColors imageMapMarkerLabel"><div class="labelInner"></div></div>')).css({left:e.x+"%",top:e.y+"%"}),$(".labelInner",i).html(e.area.text?e.area.text:""),n?$(".labelInner",i).css({left:"2em",right:""}):$(".labelInner",i).css({right:"1em",left:""}),i}var i=null;return(i=t||$('<div class="imageMapColors imageMapMarkerLabel" style="z-index:3;position:absolute;width:0;opacity:0.9"><div class="labelInner"></div></div>')).css({left:(n?e.x2:e.x1)+"%",top:(e.y1+e.y2)/2+"%"}),$(".labelInner",i).html(e.text?e.text:"").css({position:"absolute",padding:"8px","box-shadow":"2px 2px 5px rgba(0,0,0,0.2)","border-radius":"4px","white-space":"nowrap","margin-top":"-1.5em"}),n?$(".labelInner",i).css({left:"1em",right:""}):$(".labelInner",i).css({right:"1em",left:""}),i},E.refreshEditorSidebarContent=function(e,h){var l=new Image;h.JSON.url&&""!=h.JSON.url&&(l.onload=function(){h.JSON.ratio!=l.width/l.height&&(h.JSON.ratio=l.width/l.height,E.editor.inputValueChanged())},l.src=widget.getMediaURLPath(h.JSON.url));var t=$("<div>"+E.translate("Task")+':<br><div class="richtext">'+h.JSON.text+"</div></div>");E.editor.makeRichTextEditor({target:$(".richtext",t),onChange:function(e){h.JSON.text=e}}),e.append(t),e.append(E.editor.getImageFileInput(E.translate("image"),h.JSON.url,function(e){h.JSON.url=e,E.editor.updateContentSidebar()})),e.append(E.editor.getToggleCheck(E.translate("useLabels"),h.JSON.useLabels,function(e){h.JSON.useLabels=e,h.markers=null,E.refreshContent(h),E.editor.updateContentSidebar()}));var n=$('<div class="editorCSSBody" style="padding-left:8px;padding-top:0;position:relative"></div>');E.editor.buildSortableList(n,h.JSON.areas,function(u,p){var g="true"==h.JSON.outlines,e=$('<div style="margin-bottom:8px;padding-top:4px;"></div>');e.on("click",function(){if(h.JSON.url&&""!=h.JSON.url)var d=null,c=E.editor.showModalDialog('<div class="imageMapColors imageMapMarkerEditor" style="user-select:none;margin-top:3em;text-align:center"><div class="imageMapPlaceMarkersWrapper editorCSSBody" style="position:relative;display:inline-block"></div></div>',[],function(){var a=$(".imageMapMarkerEditor",c),r=$(".imageMapPlaceMarkersWrapper",c),e=null,o=null;$.each(h.JSON.areas,function(e,t){if(e!=u){var n=$('<div class="markerForm" style="position:absolute;'+(g?"opacity:0.4;border:4px solid; border-color:var(--"+t.color+")":"opacity:0.4;background:var(--"+t.color+")")+';"></div>');if(n.css({"border-radius":"circle"==t.type?"100%":"0",left:t.x1+"%",top:t.y1+"%",width:t.x2-t.x1+"%",height:t.y2-t.y1+"%",transform:"rotate("+(t.r?t.r:0)+"deg)"}),"true"==h.JSON.useLabels&&t.text&&""!=t.text){var i=E.getLabelForMarker(t);r.append(i)}r.append(n)}});var t=null;function l(){"true"==h.JSON.useLabels&&p.text&&""!=p.text&&(t||(t=E.getLabelForMarker(p),r.append(t)),E.getLabelForMarker(p,t))}function s(){e&&e.remove(),(e=$('<div class="markerForm" style="position:absolute;'+(g?"opacity:0.8;border:4px solid; border-color:var(--"+p.color+")":"opacity:0.8;background: var(--"+p.color+")")+';"></div>')).css({"border-radius":"circle"==p.type?"100%":"0",left:p.x1+"%",top:p.y1+"%",width:p.x2-p.x1+"%",height:p.y2-p.y1+"%",transform:"rotate("+(p.r?p.r:0)+"deg)"}),r.append(e),e.draggable({cancel:".ui-rotatable-handle",start:function(e,t){$(this).draggable("option","cursorAt",{left:Math.floor(this.clientWidth/2),top:Math.floor(this.clientHeight/2)})},drag:function(e){var t=Math.abs(p.x1-p.x2),n=Math.abs(p.y1-p.y2),i=$(this).css("transform");$(this).css("transform",""),p.x1=100*parseFloat($(this).position().left/parseFloat(r.width())),p.y1=100*parseFloat($(this).position().top/parseFloat(r.height())),$(this).css("transform",i),p.x2=p.x1+t,p.y2=p.y1+n,l()},stop:function(){E.editor.inputValueChanged()}}),e.resizable({maxHeight:.8*r.height(),maxWidth:.8*r.width(),minHeight:24,minWidth:24,resize:function(){var e=$(this).css("transform");$(this).css("transform",""),p.x2=(parseFloat($(this).position().left)+parseFloat($(this).width()))/parseFloat(r.width())*100,p.y2=(parseFloat($(this).position().top)+parseFloat($(this).height()))/parseFloat(r.height())*100,$(this).css("transform",e),l()},stop:function(){E.editor.inputValueChanged(),s()}}),e.rotatable({angle:p.r?p.r:0,rotate:function(e,t){p.r=t.angle.current,0==t.angle.current&&delete p.r},stop:function(){E.editor.inputValueChanged()}})}!function i(){o&&o.remove(),(o=$('<div class="editorCSSBody" style="position:absolute;right:48px;top:12px;margin-left:8px;display:inline-block" title="Farbe des Markers wählen"></div>')).tooltip(),$.each(E.colors,function(e,t){var n=$('<div class="btn btn-default btn-xs" style="width:2em;height:2em;background: var(--'+t+");margin-top:2px;margin-right:3px;"+(t==p.color?"border:2px solid black":"border:2px solid #eee")+'"><i class="fa fa-fw"></i></div>');n.addClass("imageMapColors"),n.on("click",function(){p.color=t,E.editor.inputValueChanged(),i(),s(),l()}),o.append(n)}),a.append(o)}(),d=function(e){"38"==(e=e||window.event).keyCode?(p.y1=p.y1-.1,e.shiftKey||(p.y2=p.y2-.1),s()):"40"==e.keyCode?(e.shiftKey||(p.y1=p.y1+.1),p.y2=p.y2+.1,s()):"37"==e.keyCode?(p.x1=p.x1-.1,e.shiftKey||(p.x2=p.x2-.1),s()):"39"==e.keyCode&&(e.shiftKey||(p.x1=p.x1+.1),p.x2=p.x2+.1,s())},$(window.parent.document).on("keydown",d);var i=null;!function e(){i&&i.remove(),(i=$('<div style="position:absolute;left:8px;top:12px;display:inline-block" title="Form des Markers wählen"></div>')).tooltip();var t=$('<div class="btn btn-default btn-xs" style="height:2em;margin-top:2px;margin-right:3px;'+("circle"==p.type?"border:2px solid black":"border:2px solid #eee")+'"><i class="fa fa-fw fa-circle"></i></div>');t.on("click",function(){p.type="circle",E.editor.inputValueChanged(),e(),s()}),i.append(t);var n=$('<div class="btn btn-default btn-xs" style="height:2em;margin-top:2px;margin-right:3px;'+("rect"==p.type?"border:2px solid black":"border:2px solid #eee")+'"><i class="fa fa-fw fa-square"></i></div>');n.on("click",function(){p.type="rect",E.editor.inputValueChanged(),e(),s()}),i.append(n),a.append(i)}(),s(),l();var n=$('<img style="pointer-events:none;max-width:100%" alt="">');n.attr("src",widget.getMediaURLPath(h.JSON.url)),n.on("load",function(){s()}),r.append(n)},function(){E.editor.updateContentSidebar(),$(window.parent.document).off("keydown",d)},"80%")});var t=E.editor.getSmallIconBtn("fa-map-marker",function(){});t.addClass("btn-primary"),t.attr("title","Position auf Bild auswählen"),t.tooltip();var n=E.editor.getSmallIconBtn("fa-fw",function(){});n.addClass("imageMapColors"),n.css({background:p.color&&""!=p.color?"var(--"+p.color+")":"var(--"+E.colors[0]+")","margin-left":"8px"});var a=E.editor.getSmallIconBtn("fa-fw",function(){});if($(l).on("load",function(){var e=(p.x2-p.x1)/100*l.width/26,t=(p.y2-p.y1)/100*l.height/26,n=l.width/((p.x2-p.x1)/100*l.width),i=l.height/((p.y2-p.y1)/100*l.height);a.css({"background-position":p.x1*(n/(n-1))+"% "+p.y1*(i/(i-1))+"%","background-repeat":"no-repeat","background-image":"url("+l.src+")","border-radius":"circle"==p.type?"100%":"0","background-size":l.width/e+"px "+l.height/t+"px","margin-left":"8px",width:"26px",height:"26px"})}),e.append(t),e.append(n),e.append(a),"true"==h.JSON.useLabels){var i=$('<div class="sidebarBlockInput" style="position:absolute;left:0px;top:2px;right:48px;margin-left:100px;"></div>');i.on("click",function(e){e.stopPropagation()});var r=$('<input type="text" class="form-control input-sm"/>');r.val(p.text?p.text:""),r.on("change textInput input",function(){p.text=$.trim($(this).val()),E.editor.inputValueChanged()}),i.append(r),e.append(i)}return h.openNewItem&&u==h.JSON.areas.length-1&&(h.openNewItem=!1,e.trigger("click")),e},function(){h.openNewItem=!0;var e=1,t=1;if(0<l.width){var n=Math.max(l.width,l.height);e=n/l.width,t=n/l.height}for(var i=45+10*e,a=45+10*t,r=0,o=0;o<h.JSON.areas.length;o++)r=Math.max(r,h.JSON.areas[o].id);return{id:r+=1,type:"circle",x1:45,y1:45,x2:i,y2:a,r:0,back:"white",color:E.colors[0]}},null,!0),e.append($("<div>"+E.translate("Markers")+":</div>")),e.append(n),E.editor.advancedMode&&("true"==h.JSON.useLabels&&e.append(E.editor.getToggleCheck(E.translate("randomOrder"),"true"==h.JSON.sorted?"false":"true",function(e){h.JSON.sorted="true"==e?"false":"true"})),e.append(E.editor.getToggleCheck(E.translate("withCorrection"),"true"==h.JSON.nocheck?"false":"true",function(e){h.JSON.nocheck="false"==e?"true":"false",E.editor.updateContentSidebar()})),e.append(E.editor.getToggleCheck(E.translate("true"==h.JSON.nocheck?"showAreasNoCheck":"showAreas"),h.JSON.showAreas,function(e){h.JSON.showAreas=e,E.editor.updateContentSidebar()})),"true"==h.JSON.showAreas&&e.append(E.editor.getToggleCheck(E.translate("showAreasOutline"),h.JSON.outlines,function(e){h.JSON.outlines=e,E.editor.updateContentSidebar()})))}}(),function(){var o=new AModule("image_picker");o.initContent=function(e){e.JSON.text="",e.JSON.images=[{correct:"false",url:""},{correct:"false",url:""},{correct:"false",url:""}],e.JSON.width="auto",e.JSON.randomSort="false",e.JSON.hideNav="false"},o.setCorrect=function(e){var t=!1;e.correct="false";for(var n=0;n<e.images.length;n++)"true"==e.images[n].correct&&(t=!0),n==e.currentImage&&(e.correct=e.images[n].correct);t||(e.correct="true")},o.checkSolution=function(e){if("true"==e.JSON.nocheck)return!0;if("true"==e.JSON.predefined)return!0;o.setCorrect(e);var t=widget.findModule("check_solution");return $(".imagePicker",e.htmlElement).removeClass("helped correct wrong"),"true"==e.correct?t.delay(function(){"true"==e.helped&&$(".imagePicker",e.htmlElement).addClass("helped"),$(".imagePicker",e.htmlElement).addClass("correct")}):t.delay(function(){$(".imagePicker",e.htmlElement).addClass("wrong")}),e.isChecked&&"false"==e.correct&&e.isClicked&&(e.helped="true"),"true"==e.correct},o.helpSolution=function(e){if("true"==e.JSON.nocheck)return!0;if("true"==e.JSON.predefined)return!0;o.setCorrect(e);var t=e.correct;if("true"!=t){e.isClicked=!0,e.helped="true",e.correct="true";for(var n=0;n<e.images.length;n++)if("true"==e.images[n].correct){e.currentImage=n,o.updateImage(e);break}widget.scrollToElement(e.htmlElement),e.htmlElement.effect("highlight")}return"true"==t},o.getCheckableElements=function(e){var t=[];return"true"==e.JSON.nocheck?t:"true"==e.JSON.predefined?t:t=[e.htmlElement]},o.updateImage=function(e){e.currentImage<0&&(e.currentImage=0),e.currentImage>e.images.length-1||$(".currentImage",e.htmlElement).attr("src",widget.getMediaURLPath(e.images[e.currentImage].url))},o.refreshContent=function(t){var e="";"auto"!=t.JSON.width&&(e+="width:"+t.JSON.width+";"),t.htmlElement.html((t.JSON.text&&""!=$.trim(t.JSON.text)&&"<p><br></p>"!=$.trim(t.JSON.text)?"<p>"+t.JSON.text+"</p>":"")+'<div class="imagePicker"><div class="invisiblePlaceholders"></div><div class="prevBtn clearBtn"><i class="fa fa-chevron-left"></i></div><div class="nextBtn clearBtn"><i class="fa fa-chevron-right"></i></div><div class="currentImageWrapper"><img onload="if(window.widget) widget.refreshScrollbars()" class="currentImage" style="'+e+'" alt=""/></div></div>'),t.images=[];for(var n=0;n<t.JSON.images.length;n++)if(""!=t.JSON.images[n].url){t.images.push(t.JSON.images[n]);var i=$('<img style="'+e+'">');i.attr("src",widget.getMediaURLPath(t.JSON.images[n].url)),$(".invisiblePlaceholders",t.htmlElement).append(i)}if("true"==t.JSON.hideNav&&($(".prevBtn",t.htmlElement).hide(),$(".nextBtn",t.htmlElement).hide()),FastClick.attach(t.htmlElement.get(0)),$(".currentImageWrapper",t.htmlElement).on("click",function(){$(".nextBtn",t.htmlElement).trigger("click")}),$(".prevBtn",t.htmlElement).on("click",function(){if("true"!=t.JSON.predefined){t.currentImage--,t.currentImage<0&&(t.currentImage=t.images.length-1),o.updateImage(t),o.setCorrect(t),$(".imagePicker",t.htmlElement).removeClass("helped correct wrong"),t.isClicked=!0;var e=widget.findModule("save_load");e&&e.save()}}),$(".nextBtn",t.htmlElement).on("click",function(){if("true"!=t.JSON.predefined){t.currentImage++,t.currentImage>t.images.length-1&&(t.currentImage=0),o.updateImage(t),o.setCorrect(t),$(".imagePicker",t.htmlElement).removeClass("helped correct wrong"),t.isClicked=!0;var e=widget.findModule("save_load");e&&e.save()}}),$.each(t.images,function(e,t){(new Image).src=widget.getMediaURLPath(t.url)}),"true"==t.JSON.randomSort&&helper.shuffleArray(t.images),t.currentImage=0,"true"==t.JSON.predefined){for(n=0;n<t.images.length;n++)if("true"==t.images[n].correct){t.currentImage=n;break}$(".prevBtn",t.htmlElement).css("opacity","0.5"),$(".nextBtn",t.htmlElement).css("opacity","0.5")}o.updateImage(t),o.setCorrect(t)},o.saveUserInput=function(e,t){o.setCorrect(e),t.input.push({v:e.currentImage,c:e.correct,h:e.helped}),"true"==e.correct?t.counter.correct++:t.counter.wrong++,"true"==e.correct&&"true"==e.helped&&t.counter.helped++,t.counter.total++},o.clearUserInput=function(e){if($(".imagePicker",e.htmlElement).removeClass("helped correct wrong"),e.helped="false",e.correct="false",e.currentImage=0,e.isClicked=!1,"true"==e.JSON.randomSort&&helper.shuffleArray(e.images),"true"==e.JSON.predefined)for(var t=0;t<e.images.length;t++)if("true"==e.images[t].correct){e.currentImage=t;break}o.updateImage(e)},o.loadUserInput=function(e,t){t&&1==t.length&&(e.currentImage=parseInt(t[0].v),e.correct=t[0].c,e.helped=t[0].h,o.updateImage(e))},o.init=function(){},o.editorInit=function(e){},o.refreshEditorSidebarContent=function(e,r){var t=$("<div>"+o.translate("Task")+':<br><div class="richtext">'+r.JSON.text+"</div></div>");o.editor.makeRichTextEditor({target:$(".richtext",t),onChange:function(e){r.JSON.text=e}}),e.append(t);var n=$('<div style="padding-left:36px;padding-top:0;position:relative"></div>');o.editor.buildSortableList(n,r.JSON.images,function(n,t){var e=o.editor.getImageFileInput(o.translate("image")+" "+(n+1),t.url,function(e){t.url=e},!1,function(e,t){for(;r.JSON.images.length<n+t+1;)r.JSON.images.push({correct:"false",url:e});r.JSON.images[n+t].url=e,o.editor.updateContentSidebar()}),i=o.editor.getSmallIconBtn("true"==t.correct?"fa-check-square-o":"fa-square-o",function(){t.correct="true"==t.correct?"false":"true",o.editor.updateContentSidebar()});i.css({position:"absolute","margin-left":"-30px","margin-top":"3px"}),i.attr("title","Antwort ist richtig / falsch"),i.tooltip();var a=$("<div></div>");return a.append(i),a.append(e),a},function(){return{correct:"false",url:""}}),e.append($("<div>"+o.translate("Answers")+":</div>")),e.append(n),e.append(o.editor.getToggleCheck(o.translate("randomOrder"),r.JSON.randomSort,function(e){r.JSON.randomSort=e})),e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(o.editor.getApplyToAllBtn(function(){o.editor.openApplyAttributeToAllDialog(r,"width",r.JSON.width)}))),e.append(o.editor.getSelectInput(o.translate("Size"),["auto","100%","90%","80%","75%","70%","66%","60%","50%","40%","33%","30%","25%","20%","10%"],r.JSON.width,function(e){r.JSON.width=e})),o.editor.advancedMode&&(e.append(o.editor.getToggleCheck(o.translate("navigation"),"true"==r.JSON.hideNav?"false":"true",function(e){r.JSON.hideNav="false"==e?"true":"false"})),e.append(o.editor.getToggleCheck(o.translate("predefined"),r.JSON.predefined,function(e){r.JSON.predefined=e})),"true"!=r.JSON.predefined&&e.append(o.editor.getToggleCheck(o.translate("withCorrection"),"true"==r.JSON.nocheck?"false":"true",function(e){r.JSON.nocheck="false"==e?"true":"false"})))}}(),function(){var p=new AModule("matching");p.initContent=function(e){e.JSON.horizontal="true",e.JSON.connector="small",e.JSON.columns=[{sorted:"random",size:"balanced"},{sorted:"random",size:"balanced"}],e.JSON.groups=[{items:[{type:"text",value:"Text A1"},{type:"text",value:"Text A2"}]},{items:[{type:"text",value:"Text B1"},{type:"text",value:"Text B2"}]},{items:[{type:"text",value:"Text C1"},{type:"text",value:"Text C2"}]}]},p.getCheckableElements=function(e){var t=[];if("true"==e.JSON.nocheck)return t;if(e.table&&e.table.rows)for(var n=0;n<e.table.rows.length;n++)if(0<e.table.rows[n].items.length){var i=e.table.rows[n].items[e.table.rows[n].items.length-1].htmlElement;t.push(i)}return t},p.getTableRows=function(i){for(i.table.rows||(i.table.rows=[]);i.table.rows.length<i.JSON.groups.length;){i.table.rows.push({items:[]})}for(var e=0;e<i.table.rows.length;e++)i.table.rows[e].items=[];var a=0;for(e=0;e<i.table.columns.length;e++){var t=i.table.columns[e];$(".matchingItem",t.htmlElement).each(function(e,t){var n=$(t).parent().height();a=Math.max(a,n),i.table.rows[e].items.push({htmlElement:$(t),JSON:$(t).data("JSON")})})}"true"==i.JSON.horizontal&&$(".matchingItemSlot",i.table.htmlElement).css("min-height",a+"px")},p.checkSingleRow=function(a,e){var r=!1;return delete a.group,$.each(e.JSON.groups,function(e,t){for(var n=!0,i=0;i<a.items.length;i++)if(t.items[i].value!=a.items[i].JSON.value){n=!1;break}n&&(a.group=t),r=r||n}),a.correct=r?"true":"false",r},p.checkSolution=function(t){if("true"==t.JSON.nocheck)return!0;var a=widget.findModule("check_solution"),r=!0;return $.each(t.table.rows,function(e,n){var i=p.checkSingleRow(n,t);t.isChecked&&!i&&t.hasDragged&&(n.helped="true"),$.each(n.items,function(e,t){t.htmlElement.removeClass("helped correct wrong"),$(".matchingCorrectionItem",t.htmlElement).hide(),i?(t.htmlElement.addClass("correct"),a.showHelped&&"true"==n.helped&&t.htmlElement.addClass("helped")):(t.htmlElement.addClass("wrong"),r=!1),a.delay(function(){$(".matchingCorrectionItem",t.htmlElement).fadeIn()})})}),r},p.helpSolution=function(e){if("true"==e.JSON.nocheck)return!0;widget.findModule("check_solution");for(var t=!0,n=!1,i=[],a=0;a<e.table.rows.length;a++){var r=e.table.rows[a],o=p.checkSingleRow(r,e);r.group&&i.push(r.group),o||(t=!1)}if(!t)for(a=0;a<e.table.rows.length;a++){if("true"!=(r=e.table.rows[a]).correct){for(var l=0;l<e.JSON.groups.length;l++)if(-1==i.indexOf(e.JSON.groups[l])&&e.JSON.groups[l].items[0].value==r.items[0].JSON.value){for(var s=a+1;s<e.table.rows.length;s++)for(var d=e.table.rows[s],c=0;c<d.items.length;c++)if(e.JSON.groups[l].items[c].value==d.items[c].JSON.value){r.items[c].htmlElement.swap(d.items[c].htmlElement);var u=r.items[c];r.items[c]=d.items[c],d.items[c]=u,0,r.items[c].htmlElement.effect("highlight")}r.helped="true",a>=e.table.rows.length-2&&(e.table.rows[e.table.rows.length-1].helped="true"),n=!0,widget.scrollToElement(e.htmlElement);break}if(n)break}}return t},p.refreshContent=function(s){var t=$('<div class="matchingTable matched '+("big"==s.JSON.connector?"bigConnect":"smallConnect")+'"></div>');"true"==s.JSON.horizontal?t.addClass("horizontal"):t.addClass("vertical"),s.table||(s.table={}),s.table.htmlElement=t,s.htmlElement.append(t),$.each(s.JSON.columns,function(a,e){var r=$('<div class="matchingColumn" style="'+("true"==s.JSON.horizontal?"width:"+(e.size&&""!=e.size&&"balanced"!=e.size?e.size:Math.floor(100/s.JSON.columns.length)+'%"'):"")+'"></div>'),o="fixed"==s.JSON.columns[a].sorted;s.table.columns||(s.table.columns=[]),s.table.columns[a]||(s.table.columns[a]={}),s.table.columns[a].htmlElement=r,s.table.columns[a].items=[],s.table.columns[a].JSON=e,$.each(s.JSON.groups,function(e,t){var n=$('<div class="matchingItem '+("text"!=t.items[a].type||o?"":"isText")+'"><i class="matchingSortArrow fa fa-arrows"></i><div class="matchingCorrectionItem"></div></div>');"image"==t.items[a].type&&(n.append($('<img src="'+widget.getMediaURLPath(t.items[a].value)+'" />')),n.append($('<div class="'+("true"==s.JSON.imageContain?"backgroundContain":"backgroundCover")+'" style="background-image:url(\''+widget.getMediaURLPath(t.items[a].value)+"')\"></div>"))),"text"==t.items[a].type&&n.append($("<span>"+t.items[a].value+"</span>")),n.data("JSON",t.items[a]),n.attr("index",e);var i=$('<div class="matchingItemSlot" '+("true"!=s.JSON.horizontal?'style="width:'+Math.floor(100/s.JSON.groups.length)+'%;"':"")+"></div>");i.append(n),r.append(i),s.table.columns[a].items.push({htmlElement:n,JSON:t.items[a]})}),t.append(r)}),$(".matchingItem img",s.htmlElement).each(function(e,t){$(t).on("load",function(){p.getTableRows(s)})}),setTimeout(function(){p.getTableRows(s)},100),$.each(s.table.columns,function(e,t){t.getIndexArray=function(){var e=[];return $(".matchingItem",t.htmlElement).each(function(){e.push($(this).attr("index"))}),e};var l=null;$(".matchingItem",t.htmlElement).draggable({revert:"invalid",cursor:"move",cancel:".fixed",containment:t.htmlElement,revertDuration:200,start:function(){l=$(this).parent(),$(this).addClass("being-dragged"),s.table.htmlElement.removeClass("matched"),$(".matchingItem",s.table.htmlElement).each(function(e,t){$(this).removeClass("correct good helped wrong")}),widget.enableDragScrolling($(this))},stop:function(){$(this).removeClass("being-dragged"),s.table.htmlElement.addClass("matched"),widget.disableDragScrolling()}}),$(".matchingItemSlot",t.htmlElement).droppable({hoverClass:"drop-hover",accept:".matchingItem",drop:function(e,t){var n=$(t.draggable[0]),i=n.offset(),a=$(e.target),r=a.offset();$(".matchingItem",e.target).appendTo(l).css({opacity:0}).animate({opacity:1},200),n.appendTo(a).css({left:i.left-r.left,top:i.top-r.top}).animate({left:0,top:0},200),s.hasDragged=!0,p.getTableRows(s),$.each(s.table.rows,function(e,t){p.checkSingleRow(t,s)});var o=widget.findModule("save_load");o&&o.save()}}),t.htmlElement.disableSelection()}),p.mixOrder(s)},p.mixOrder=function(r,o){$.each(r.table.columns,function(e,n){var i="fixed"==r.table.columns[e].JSON.sorted;if(!o&&n.mixedOrder)return $.each(n.mixedOrder,function(e,t){$(".matchingItem",n.htmlElement).each(function(){i&&$(this).addClass("fixed"),$(this).attr("index")==t&&$(this).parent().parent().append($(this).parent())})}),void p.getTableRows(r);if(n.mixedOrder=[],"fixed"==r.table.columns[e].JSON.sorted||"ordered"==r.table.columns[e].JSON.sorted)$.each(n.items,function(e,t){n.mixedOrder.push(e),i&&t.htmlElement.addClass("fixed"),t.htmlElement.parent().append(t.htmlElement)});else if("random"==r.table.columns[e].JSON.sorted){for(var a=!0,t=0;1<n.items.length&&a&&t<50;)t++,$(".matchingItem",n.htmlElement).each(function(){.5<Math.random()&&$(this).parent().parent().append($(this).parent())}),a=!1,p.getTableRows(r),$.each(r.table.rows,function(e,t){var n=p.checkSingleRow(t,r);a=a||n});n.mixedOrder=n.getIndexArray()}}),p.getTableRows(r)},p.clearUserInput=function(e){$.each(e.table.columns,function(e,t){t.mixedOrder=null}),p.mixOrder(e);for(var t=0;t<e.table.rows.length;t++){var n=e.table.rows[t];n.helped="false",n.correct="false"}e.hasDragged=!1,$(".matchingItem",e.table.htmlElement).each(function(e,t){$(this).removeClass("correct helped wrong")})},p.saveUserInput=function(e,t){for(var i={positions:[],rows:[]},n=0;n<e.table.rows.length;n++){var a=e.table.rows[n];p.checkSingleRow(a,e),i.rows[n]={c:a.correct,h:a.helped},"true"==a.correct?t.counter.correct++:t.counter.wrong++,"true"==a.correct&&"true"==a.helped&&t.counter.helped++,t.counter.total++}$.each(e.table.columns,function(e,t){var n=t.getIndexArray();i.positions[e]=n.join(",")}),t.input.push(i)},p.loadUserInput=function(e,i){if(p.mixOrder(e),i&&1==i.length&&i[0].positions&&i[0].positions.length==e.table.columns.length&&i[0].rows.length==e.table.rows.length){$.each(e.table.columns,function(e,n){var t=i[0].positions[e].split(",");$.each(t,function(e,t){$(".matchingItem",n.htmlElement).each(function(){$(this).attr("index")==t&&$(this).parent().parent().append($(this).parent())})})}),p.getTableRows(e);for(var t=0;t<e.table.rows.length;t++){var n=e.table.rows[t];n.correct=i[0].rows[t].c,n.helped=i[0].rows[t].h}}},p.init=function(){},p.refreshEditorSidebarContent=function(e,r){var t=$("<div></div>");if((n=$('<div class="btn btn-'+("true"==r.JSON.horizontal?"primary":"gray")+' btn-xs">'+p.translate("horizontal")+"</div>")).on("click",function(){r.JSON.horizontal="true",p.editor.inputValueChanged(),p.editor.updateContentSidebar()}),t.append(n),(n=$('<div class="btn btn-'+("true"!=r.JSON.horizontal?"primary":"gray")+' btn-xs">'+p.translate("vertical")+"</div>")).on("click",function(){r.JSON.horizontal="false",p.editor.inputValueChanged(),p.editor.updateContentSidebar()}),t.append(n),e.append(p.editor.getCustomInput(p.translate("align"),t)),p.editor.advancedMode){var n;t=$("<div></div>");(n=$('<div class="btn btn-'+("small"==r.JSON.connector?"primary":"gray")+' btn-xs">'+p.translate("smallConnector")+"</div>")).on("click",function(){r.JSON.connector="small",p.editor.inputValueChanged(),p.editor.updateContentSidebar()}),t.append(n),(n=$('<div class="btn btn-'+("big"==r.JSON.connector?"primary":"gray")+' btn-xs">'+p.translate("largeConnector")+"</div>")).on("click",function(){r.JSON.connector="big",p.editor.inputValueChanged(),p.editor.updateContentSidebar()}),t.append(n),e.append(p.editor.getCustomInput(p.translate("connector"),t))}var i=$("<div></div>");$.each([2,3,4,5,6,7,8],function(e,n){var t=$('<div class="btn btn-'+(n==r.JSON.columns.length?"primary":"gray")+' btn-xs">'+n+"</div>");t.on("click",function(){if(n!=r.JSON.columns.length){if(n>r.JSON.columns.length)for(;n>r.JSON.columns.length;)r.JSON.columns.push({sorted:"random"}),$.each(r.JSON.groups,function(e,t){t.items.push({type:"text",value:""})});else r.JSON.columns.splice(n,999),$.each(r.JSON.groups,function(e,t){t.items.splice(n,999)});p.editor.inputValueChanged(),p.editor.updateContentSidebar()}}),i.append(t)}),e.append(p.editor.getCustomInput(p.translate("true"!=r.JSON.horizontal?"rowCount":"columnCount"),i));var o=$("<div></div>");$.each(r.JSON.columns,function(e,t){var n,i=$('<div><div class="sidebarBlockLabel">&nbsp;&nbsp;'+p.translate("true"!=r.JSON.horizontal?"row":"column")+" "+(e+1)+': &nbsp;</div> <div class="sidebarBlockInput"></div></div>'),a=$(".sidebarBlockInput",i);(n=$('<div style="margin-top:0" class="btn btn-'+("random"==t.sorted?"primary":"gray")+' btn-xs">'+p.translate("randomOrder")+"</div>")).on("click",function(){"random"!=t.sorted&&(t.sorted="random",p.mixOrder(r,!0),p.editor.inputValueChanged(),p.editor.updateContentSidebar())}),a.append(n),(n=$('<div style="margin-top:0" class="btn btn-'+("ordered"==t.sorted?"primary":"gray")+' btn-xs">'+p.translate("givenOrder")+"</div>")).on("click",function(){"ordered"!=t.sorted&&(t.sorted="ordered",p.mixOrder(r,!0),p.editor.inputValueChanged(),p.editor.updateContentSidebar())}),a.append(n),(n=$('<div style="margin-top:0" class="btn btn-'+("fixed"==t.sorted?"primary":"gray")+' btn-xs">'+p.translate("fixedOrder")+"</div>")).on("click",function(){"fixed"!=t.sorted&&(t.sorted="fixed",p.mixOrder(r,!0),p.editor.inputValueChanged(),p.editor.updateContentSidebar())}),a.append(n),"true"==r.JSON.horizontal&&i.append(p.editor.getSelectInput("&nbsp;&nbsp;"+p.translate("Size"),["balanced","100%","90%","80%","75%","70%","66%","60%","50%","40%","33%","30%","25%","20%","10%"],t.size,function(e){t.size=e,p.editor.inputValueChanged()})),o.append(i)}),p.editor.advancedMode&&(e.append($("<div>"+p.translate("true"!=r.JSON.horizontal?"rowSorting":"columnSorting")+"</div>")),e.append(o));var a=$("<div></div>");p.editor.buildSortableList(a,r.JSON.groups,function(e,s){var d=$('<div style="margin-bottom:12px; border: 1px solid #ccc; padding: 8px;"></div>');return $.each(r.JSON.columns,function(t,e){var n=$('<div style="display:flex;width:100%"></div>'),i=$('<div style="white-space: nowrap;margin-right:4px"></div>'),a=$('<div class="btn btn-'+("text"==s.items[t].type?"primary":"gray")+' btn-xs">'+p.translate("text")+"</div>");a.on("click",function(){"text"!=s.items[t].type&&(s.items[t].type="text",s.items[t].value="",p.editor.inputValueChanged(),p.editor.updateContentSidebar())}),i.append(a);var r=$('<div class="btn btn-'+("image"==s.items[t].type?"primary":"gray")+' btn-xs">'+p.translate("image")+"</div>");if(r.on("click",function(){"image"!=s.items[t].type&&(s.items[t].type="image",s.items[t].value="",p.editor.inputValueChanged(),p.editor.updateContentSidebar())}),i.append(r),n.append(i),"text"==s.items[t].type){var o=p.editor.getRichTextInput("",s.items[t].value,function(e){s.items[t].value=helper.stripHTML(e),p.editor.inputValueChanged()},!0,!0);o.css("width","100%"),n.append(o)}if("image"==s.items[t].type){var l=p.editor.getImageFileInput("",s.items[t].value,function(e){s.items[t].value=e});$(".sidebarBlockLabel",l).remove(),$(".sidebarBlockInput",l).css("margin","0px"),l.css("width","100%"),n.append(l)}d.append(n)}),d},function(){var n={items:[]};return $.each(r.JSON.columns,function(e,t){n.items.push({type:"text",value:""})}),n}),e.append(p.editor.getCustomInput(p.translate("true"!=r.JSON.horizontal?"columns":"rows"),$("<div></div>"))),e.append(a),e.append(p.editor.getToggleCheck(p.translate("imageContain"),r.JSON.imageContain,function(e){r.JSON.imageContain=e})),p.editor.advancedMode&&e.append(p.editor.getToggleCheck(p.translate("withCorrection"),"true"==r.JSON.nocheck?"false":"true",function(e){r.JSON.nocheck="false"==e?"true":"false"}))}}(),function(){var c=new AModule("media_input");c.initContent=function(e){e.JSON.types=["text"],e.JSON.text="",e.selectedType="",e.inputElement=null},c.getCheckableElements=function(e){var t=[];return"true"==e.JSON.nocheck||t.push(e.htmlElement),t},c.getInputHTMLElements=function(e){var t=[];return e.inputElement&&t.push({e:e.inputElement,id:1}),t},c.getInputValueReadable=function(e,t){return t?0===t.indexOf("http")?"File":t:""},c.addAlternativeTextHint=function(e){var t=$.trim(e.inputElement.val());e.JSON.altText&&""!=e.JSON.altText&&helper.stripHTML(e.JSON.altText)!=t&&(e.inputElement.addClass("alternatives"),$(".mediaSolutionIcon",e.inputElement.parent()).on("click",function(){widget.smallPopup(c.translate("alternateSolution"),e.JSON.altText,[{close:!0},{text:c.translate("OK")}])}))},c.checkInput=function(e){if(!e.inputElement)return!1;var t=""!=$.trim(e.inputElement.val());return"true"==e.JSON.nocheck&&(t=!0),e.correct=t?"true":"false",t},c.checkSolution=function(e){if("true"==e.JSON.nocheck)return!0;var t=widget.findModule("check_solution"),n=!0,i=$.trim(e.inputElement.val());e.inputElement.removeClass("helped correct wrong alternatives"),$(".mediaSolutionIcon",e.inputElement.parent()).hide();var a=c.checkInput(e);return e.isChecked&&!a&&""!=i&&(e.helped="true"),a?(e.inputElement.addClass("correct"),t.showHelped&&"true"==e.helped&&e.inputElement.addClass("helped"),$(".mediaSolutionIcon",e.inputElement.parent()).off(),c.addAlternativeTextHint(e),t.delay(function(){$(".mediaSolutionIcon",e.inputElement.parent()).fadeIn()})):(e.inputElement.addClass("wrong"),t.delay(function(){$(".mediaSolutionIcon",e.inputElement.parent()).fadeIn()}),n=!1),n},c.helpSolution=function(e){return"true"==e.JSON.nocheck||(!!c.checkInput(e)||("text"!=e.selectedType||(e.inputElement.removeClass("helped correct wrong alternatives"),"text"==e.selectedType&&(e.inputElement.val(e.JSON.altText&&""!=helper.stripHTML(e.JSON.altText)?helper.stripHTML(e.JSON.altText):"..."),e.helped="true",e.inputElement.trigger("keydown")),e.inputElement.effect("highlight"),widget.scrollToElement(e.inputElement),!1)))},c.refreshWordCounter=function(n){n.inputElement&&setTimeout(function(){var e=$.trim(n.inputElement.val()).match(/\S+/g),t=e?e.length:0;$(".inputwordcounter",n.htmlElement).text(t<2?"":t+" "+c.translate("Words"))},10)},c.askForRest=function(e,t){widget.smallPopup(c.translate("resetInput"),'<div style="float:left;margin-right:1em;"><i class="fa fa-fw fa-trash-o" style="font-size:3em; color: #ff2d55;"></i></div>'+c.translate("resetInputStart"),[{text:c.translate("Cancel"),classname:"clearBtn"},{text:c.translate("Reset"),onclick:function(e){return t&&t(),!0}}])},c.refreshTypeSelection=function(n){if(1==n.JSON.types.length&&(n.selectedType=n.JSON.types[0]),!n.selectedType||""==n.selectedType){var e='<div class="mediainputcontainer" style="padding-right:28px;text-align:inherit">';-1!=n.JSON.types.indexOf("text")&&(e+='<button class="checkBtn" style="min-width:3em;margin:2px;margin-right:8px" contenttype="text"><i class="fa fa-fw fa-font"></i></button>'),-1!=n.JSON.types.indexOf("audio")&&(e+='<button class="checkBtn" style="min-width:3em;margin:2px;margin-right:8px" contenttype="audio"><i class="fa fa-fw fa-microphone"></i></button>'),-1!=n.JSON.types.indexOf("image")&&(e+='<button class="checkBtn" style="min-width:3em;margin:2px;margin-right:8px" contenttype="image"><i class="fa fa-fw fa-camera"></i></button>'),-1!=n.JSON.types.indexOf("file")&&(e+='<button class="checkBtn" style="min-width:3em;margin:2px;margin-right:8px" contenttype="file"><i class="fa fa-fw fa-paperclip fa-rotate-270"></i></button>'),e+='<input class="mediaInput" type="hidden"><div class="mediaSolutionIcon"></div></div>',$(".mediaInnerContent",n.htmlElement).html(e),n.inputElement=$("input",n.htmlElement),$(".checkBtn",n.htmlElement).each(function(e,t){$(t).on("click",function(){n.selectedType=$(t).attr("contenttype"),c.refreshTypeSelection(n),$(".recordBtn",n.htmlElement).trigger("click"),$("textarea",n.htmlElement).focus()})})}if("text"==n.selectedType){n.JSON.lines&&""!=n.JSON.lines||(n.JSON.lines="2");var t="min-height:"+parseInt(n.JSON.lines)*("true"==n.JSON.dlh?3:1.5)+"em";e='<div class="mediainputcontainer'+("true"==n.JSON.dlh?" doubleLineHeight":"")+("true"==n.JSON.cw?" wordcounter":"")+'" style="width:100%;padding:0;'+t+'"><textarea style="width:100%;'+t+'" class="mediaInput multiline '+("true"==n.JSON.unchecked?"unchecked ":"")+'" autocorrect="off" autocomplete="off" autocapitalize="off" spellcheck="false" id="'+n.id+'_text_input" oninput="widget.replaceGermanQuotes(event)"></textarea>'+("true"==n.JSON.cw?'<div class="inputwordcounter"></div>':"")+'<div class="mediaSolutionIcon"></div></div>';if($(".mediaInnerContent",n.htmlElement).html(e),n.inputElement=$("#"+n.id+"_text_input"),widget.autoExpandTextarea(n.inputElement),1<n.JSON.types.length)(d=$('<i class="mediaResetBtn fa fa-trash-o"></i>')).on("click",function(e){c.askForRest(n,function(){n.inputElement.val(""),n.inputElement.trigger("change"),n.selectedType="",c.refreshTypeSelection(n)})}),widget.JSON.remoteClassData||widget.JSON.remoteUserData||$(".mediainputcontainer",n.htmlElement).append(d);n.inputElement.on("keydown",function(){n.inputElement.removeClass("helped correct wrong alternatives"),"true"==n.JSON.cw&&c.refreshWordCounter(n)}),n.inputElement.on("check",function(){n.inputElement.removeClass("helped correct wrong alternatives"),c.checkInput(n),"true"==n.JSON.cw&&c.refreshWordCounter(n)}),n.inputElement.on("change",function(){n.inputElement.trigger("check");var e=widget.findModule("save_load");e&&e.save(),"true"==n.JSON.cw&&c.refreshWordCounter(n)})}if("audio"==n.selectedType){e='<div class="mediainputcontainer" style="width:4.5em;">';e+='<input class="mediaInput" type="hidden"><div class="mediaSolutionIcon"></div></div>',$(".mediaInnerContent",n.htmlElement).html(e),$(".mediainputcontainer",n.htmlElement).append(i);var i=$(".mediainputcontainer",n.htmlElement);(s=$('<button class="checkBtn recordBtn" style="margin:2px;min-width:3em"><i class="fa fa-microphone fa-fw"></i></button>')).on("click",function(){widget.captureAudioFile(function(e){e&&e.URL&&(n.inputElement.val(e.URL),n.inputElement.trigger("change"),"audio"!=n.selectedType&&(n.selectedType="audio",c.refreshTypeSelection(n)),s.hide(),a.show(),d.show())})}),i.append(s);var a=$('<button class="checkBtn playBtn" style="pointer-events:all;margin:2px;pointer-events:all;min-width:3em"><i class="fa fa-microphone"></i><i style="margin-left:4px" class="fa fa-play"></i></button>'),r=null;a.on("click",function(){var e=n.inputElement.val();""!=e&&(r||(r=new Audio).addEventListener("ended",function(){r.currentTime=0,o.hide(),a.show(),d.show()}),r.src=e,r.play(),o.show(),a.hide())}),a.hide(),i.append(a);var o=$('<button class="checkBtn stopBtn" style="pointer-events:all;margin:2px;pointer-events:all;min-width:3em"><i class="fa fa-pause fa-fw"></i></button>');o.on("click",function(e){r.pause(),r.currentTime=0,o.hide(),a.show()}),o.hide(),i.append(o),(d=$('<i class="mediaResetBtn fa fa-trash-o"></i>')).on("click",function(e){c.askForRest(n,function(){n.inputElement.val(""),n.inputElement.trigger("change"),s.show(),a.hide(),d.hide(),e.stopPropagation(),1<n.JSON.types.length&&(n.selectedType="",c.refreshTypeSelection(n))})}),1==n.JSON.types.length&&d.hide(),widget.JSON.remoteClassData||i.append(d),n.inputElement=$(".mediaInput",n.htmlElement),n.inputElement.on("check",function(){n.inputElement.removeClass("helped correct wrong alternatives"),""!=n.inputElement.val()&&(s.hide(),a.show(),d.show()),1<n.JSON.types.length&&d.show(),c.checkInput(n)}),n.inputElement.on("change",function(){n.inputElement.trigger("check");var e=widget.findModule("save_load");e&&e.save()})}if("image"==n.selectedType){e='<div class="mediainputcontainer" style="width:4.5em;">';e+='<input class="mediaInput" type="hidden"><div class="mediaSolutionIcon"></div></div>',$(".mediaInnerContent",n.htmlElement).html(e),$(".mediainputcontainer",n.htmlElement).append(i);i=$(".mediainputcontainer",n.htmlElement);var l=$('<div class="checkBtn imageDisplay"  style="pointer-events:all"></div>');i.append(l),l.on("click",function(){widget.openImagePopup(n.inputElement.val())}),l.hide(),(s=$('<button class="checkBtn recordBtn" style="margin:2px;min-width:3em"><i class="fa fa-camera fa-fw"></i></button>')).on("click",function(){widget.captureImageFile(function(e){e&&e.URL&&(n.inputElement.val(e.URL),n.inputElement.trigger("change"),"image"!=n.selectedType&&(n.selectedType="image",c.refreshTypeSelection(n)),s.hide(),l.show(),d.show())})}),i.append(s),(d=$('<i class="mediaResetBtn fa fa-trash-o"></i>')).on("click",function(e){c.askForRest(n,function(){n.inputElement.val(""),n.inputElement.trigger("change"),s.show(),l.hide(),d.hide(),e.stopPropagation(),1<n.JSON.types.length&&(n.selectedType="",c.refreshTypeSelection(n))})}),1==n.JSON.types.length&&d.hide(),widget.JSON.remoteClassData||widget.JSON.remoteUserData||i.append(d),n.inputElement=$(".mediaInput",n.htmlElement),n.inputElement.on("check",function(){n.inputElement.removeClass("helped correct wrong alternatives");var e=n.inputElement.val();""!=e&&(s.hide(),l.css("background-image","url("+e+")"),l.show(),d.show()),1<n.JSON.types.length&&d.show(),c.checkInput(n)}),n.inputElement.on("change",function(){n.inputElement.trigger("check");var e=widget.findModule("save_load");e&&e.save()})}if("file"==n.selectedType){e='<div class="mediainputcontainer" style="width:4.5em;">';e+='<input class="mediaInput" type="hidden"><div class="mediaSolutionIcon"></div></div>',$(".mediaInnerContent",n.htmlElement).html(e),$(".mediainputcontainer",n.htmlElement).append(i);var s,d;i=$(".mediainputcontainer",n.htmlElement),a=$('<button class="checkBtn playBtn" style="pointer-events:all;margin:2px;min-width:3em"><i class="fa fa-paperclip fa-rotate-270"></i><i style="margin-left:4px" class="fa fa-download"></i></button>');i.append(a),a.on("click",function(e){e.stopPropagation(),e.preventDefault(),window.parent?window.parent.postMessage("OPENWINDOW|"+n.inputElement.val(),"*"):window.open(n.inputElement.val(),"_system")}),a.hide(),(s=$('<button class="checkBtn recordBtn" style="margin:2px;min-width:3em"><i class="fa fa-fw fa-paperclip fa-rotate-270"></button>')).on("click",function(){widget.captureFileUpload(function(e){e&&e.URL&&(n.inputElement.val(e.URL),n.inputElement.trigger("change"),"file"!=n.selectedType&&(n.selectedType="file",c.refreshTypeSelection(n)),s.hide(),a.show(),d.show())},n.JSON.extension&&""!=n.JSON.extension?n.JSON.extension:null)}),i.append(s),(d=$('<i class="mediaResetBtn fa fa-trash-o"></i>')).on("click",function(e){c.askForRest(n,function(){n.inputElement.val(""),n.inputElement.trigger("change"),s.show(),a.hide(),d.hide(),e.stopPropagation(),1<n.JSON.types.length&&(n.selectedType="",c.refreshTypeSelection(n))})}),1==n.JSON.types.length&&d.hide(),widget.JSON.remoteClassData||widget.JSON.remoteUserData||i.append(d),n.inputElement=$(".mediaInput",n.htmlElement),n.inputElement.on("check",function(){n.inputElement.removeClass("helped correct wrong alternatives"),""!=n.inputElement.val()&&(s.hide(),a.show(),d.show()),1<n.JSON.types.length&&d.show(),c.checkInput(n)}),n.inputElement.on("change",function(){n.inputElement.trigger("check");var e=widget.findModule("save_load");e&&e.save()})}},c.refreshContent=function(e){widget.isEditor&&(e.selectedType=""),e.htmlElement.html((e.JSON.text&&""!=$.trim(e.JSON.text)&&"<p><br></p>"!=$.trim(e.JSON.text)?e.JSON.text:"")+'<div class="mediaInnerContent"></div>'),c.refreshTypeSelection(e),c.checkInput(e)},c.saveUserInput=function(e,t){t.input.push({id:1,v:e.inputElement.val(),c:e.correct?e.correct:"false",h:e.helped?e.helped:"false",t:e.selectedType}),"true"==e.correct&&t.counter.correct++,t.counter.total++,console.log("Saved "+e.id)},c.clearUserInput=function(e){e.helped="false",e.correct="false",e.selectedType="",e.inputElement.val(""),e.inputElement.trigger("change"),e.inputElement.removeClass("helped correct wrong alternatives"),c.refreshTypeSelection(e),console.log("Cleared "+e.id)},c.loadUserInput=function(e,t){if(t)for(var n=0;n<t.length;n++)e.inputElement&&(e.selectedType!=t[n].t&&(e.selectedType=t[n].t,c.refreshTypeSelection(e)),e.inputElement.val(t[n].v),e.inputElement.trigger("check"),"text"==e.selectedType&&widget.autoExpandTextarea(e.inputElement)),e.correct=t[n].c;console.log("Loaded "+e.id)},c.init=function(){},c.refreshEditorSidebarContent=function(e,n){var t=$("<div>"+c.translate("Task")+':<br><div class="richtext">'+n.JSON.text+"</div></div>");c.editor.makeRichTextEditor({target:$(".richtext",t),onChange:function(e){n.JSON.text=e}}),e.append(t);var i=$('<div style="margin-top:1em"></div>');i.html(c.translate("acceptTypes")+":"),e.append(i),e.append(c.editor.getToggleCheck(c.translate("acceptText"),0<=n.JSON.types.indexOf("text")?"true":"false",function(e){var t=n.JSON.types.indexOf("text");-1!=t&&n.JSON.types.splice(t,1),"true"!=e&&0!=n.JSON.types.length||n.JSON.types.push("text"),c.editor.updateContentSidebar()})),e.append(c.editor.getToggleCheck(c.translate("acceptAudio"),0<=n.JSON.types.indexOf("audio")?"true":"false",function(e){var t=n.JSON.types.indexOf("audio");-1!=t&&n.JSON.types.splice(t,1),"true"!=e&&0!=n.JSON.types.length||n.JSON.types.push("audio"),c.editor.updateContentSidebar()})),e.append(c.editor.getToggleCheck(c.translate("acceptImage"),0<=n.JSON.types.indexOf("image")?"true":"false",function(e){var t=n.JSON.types.indexOf("image");-1!=t&&n.JSON.types.splice(t,1),"true"!=e&&0!=n.JSON.types.length||n.JSON.types.push("image"),c.editor.updateContentSidebar()})),e.append(c.editor.getToggleCheck(c.translate("acceptFile"),0<=n.JSON.types.indexOf("file")?"true":"false",function(e){var t=n.JSON.types.indexOf("file");-1!=t&&n.JSON.types.splice(t,1),"true"!=e&&0!=n.JSON.types.length||n.JSON.types.push("file"),c.editor.updateContentSidebar()})),c.editor.advancedMode&&e.append(c.editor.getToggleCheck(c.translate("withCorrection"),"true"==n.JSON.nocheck?"false":"true",function(e){n.JSON.nocheck="false"==e?"true":"false"})),0<=n.JSON.types.indexOf("text")&&(e.append(c.editor.getNumberInput(c.translate("lines"),n.JSON.lines,function(e){n.JSON.lines=e},1,20)),c.editor.advancedMode&&(e.append(c.editor.getToggleCheck(c.translate("doubleLineHeight"),n.JSON.dlh,function(e){n.JSON.dlh=e})),e.append(c.editor.getToggleCheck(c.translate("countWords"),n.JSON.cw,function(e){n.JSON.cw=e}))),e.append(c.editor.getRichTextInput(c.translate("alternateSolution"),n.JSON.altText,function(e){n.JSON.altText=e},!0,!0))),c.editor.advancedMode&&0<=n.JSON.types.indexOf("file")&&e.append(c.editor.getTextInput(c.translate("fileextension"),n.JSON.extension,function(e){n.JSON.extension=e.replace(/\./g,"")},1,20))}}(),function(){var o=new AModule("multiple_choice");o.initContent=function(e){e.JSON.text="<p>"+o.translate("multiple_choice_preset")+"</p>",e.JSON.fields=[{text:o.translate("Answer")+" 1",checked:"true"},{text:o.translate("Answer")+" 2",checked:"false"},{text:o.translate("Answer")+" 3",checked:"false"}],e.JSON.single="false",e.JSON.horizontal="false",e.fieldInputs=[]},o.upgradeContentVersion=function(e,t){"1"==t&&(e.JSON.text="")},o.checkSolution=function(n){if("true"==n.JSON.nocheck)return!0;if("true"==n.JSON.predefined)return!0;var a=widget.findModule("check_solution"),i=!0,r=!1,o=!1;return $.each(n.fieldInputs,function(e,t){i=i&&(t.inputElement.hasClass("checked")?"true":"false")==t.JSON.checked,"true"==t.JSON.checked&&(r=!0),t.inputElement.hasClass("checked")&&(o=!0)}),$.each(n.fieldInputs,function(e,t){t.container.removeClass("helped correct wrong"),a.delay(function(){t.inputElement.removeClass("helped correct wrong");var i=!0;$.each(n.fieldInputs,function(e,t){var n=t.inputElement.hasClass("checked")?"true":"false";i=i&&n==t.JSON.checked,"true"==n&&!0}),$.each(n.fieldInputs,function(e,t){var n=t.inputElement.hasClass("checked")?"true":"false";i&&n==t.JSON.checked&&"true"==t.JSON.checked&&t.inputElement.addClass("correct")}),i?(t.container.addClass("correct"),a.showHelped&&"true"==n.helped&&t.container.addClass("helped")):t.container.addClass("wrong")}),i=i&&(t.inputElement.hasClass("checked")?"true":"false")==t.JSON.checked}),r||(i=!0),n.correct=i?"true":"false",n.isChecked&&!i&&o&&(n.helped="true"),i},o.helpSolution=function(e){if("true"==e.JSON.nocheck)return!0;if("true"==e.JSON.predefined)return!0;var n=!0;return $.each(e.fieldInputs,function(e,t){n=n&&(t.inputElement.hasClass("checked")?"true":"false")==t.JSON.checked}),n||(e.helped="true",$.each(e.fieldInputs,function(e,t){t.container.removeClass("helped correct wrong"),"true"==t.JSON.checked?t.inputElement.addClass("checked"):t.inputElement.removeClass("checked"),t.inputElement.effect("highlight")}),widget.scrollToElement(e.htmlElement)),n},o.getCheckableElements=function(e){var t=[];return"true"==e.JSON.nocheck?t:"true"==e.JSON.predefined?t:t=e.JSON.fields},o.getInputValueReadable=function(e,t){var n="";if(t)for(var i=t.split(","),a=0;a<i.length;a++)"0"==i[a]&&(n+=o.translate("no")+" "),"1"==i[a]&&(n+=o.translate("yes")+" ");return n},o.refreshContent=function(a){a.htmlElement.html(a.JSON.text&&""!=$.trim(a.JSON.text)&&"<p><br></p>"!=$.trim(a.JSON.text)?a.JSON.text:"");var r=$('<span class="multipleChoiceContainer'+("true"==a.JSON.horizontal&&"true"==a.JSON.spread?" spread":"")+'"></span>');a.htmlElement.append(r),a.fieldInputs=[],$.each(a.JSON.fields,function(e,t){var n=$('<div class="multipleChoice'+(""==$.trim(a.JSON.text)||"<p><br></p>"==$.trim(a.JSON.text)?" nospace":"")+("true"==a.JSON.horizontal?" horizontal":"")+'"><div class="outer"><div class="input"></div></div><div><span></span></div></div>');if(r.append(n),"true"==a.JSON.buttonMode?(n.addClass("buttonMode"),$(".outer",n).html('<div class="input">'+t.text+"</div>")):$("span",n).html(t.text),"true"==a.JSON.predefined)return n.css("pointer-events","none"),void("true"==t.checked&&$(".input",n).addClass("checked"));var i={inputElement:$(".input",n),container:n,JSON:a.JSON.fields[e]};n.on("click",function(){$.each(a.fieldInputs,function(e,t){t.container.removeClass("helped correct wrong"),t.inputElement.removeClass("helped correct wrong")}),"true"==a.JSON.single&&$.each(a.fieldInputs,function(e,t){t.inputElement.removeClass("checked")}),i.inputElement.toggleClass("checked"),a.correct=!0,$.each(a.fieldInputs,function(e,t){a.correct=a.correct&&(t.inputElement.hasClass("checked")?"true":"false")==t.JSON.checked}),a.correct=a.correct?"true":"false";var e=widget.findModule("save_load");e&&e.save()}),FastClick.attach(n.get(0)),a.fieldInputs.push(i)})},o.saveUserInput=function(e,t){var i=[],a=!0,r=!1,o=!1;e.fieldInputs&&$.each(e.fieldInputs,function(e,t){var n=t.inputElement.hasClass("checked")?"true":"false";i.push("true"==n?"1":"0"),a=a&&n==t.JSON.checked,"true"==t.JSON.checked&&(r=!0),"true"==n&&(o=!0)}),r||(a=!0),e.correct=a?"true":"false",t.input.push({v:i.join(","),c:e.correct,h:e.helped}),"true"==e.correct?t.counter.correct++:o&&t.counter.wrong++,"true"==e.correct&&"true"==e.helped&&t.counter.helped++,t.counter.total++},o.clearUserInput=function(e){$.each(e.fieldInputs,function(e,t){t.container.removeClass("helped correct wrong"),t.inputElement.removeClass("checked helped correct wrong")}),e.helped="false",e.correct="false"},o.loadUserInput=function(e,t){if(t&&1==t.length){for(var n=t[0].v.split(","),i=0;i<e.fieldInputs.length&&("1"!=n[i]||(e.fieldInputs[i].inputElement.addClass("checked"),"true"!=e.JSON.single));i++);e.correct=t[0].c,e.helped=t[0].h}},o.getInputHTMLElements=function(e){var n=[];return $.each(e.fieldInputs,function(e,t){n.push({e:t.inputElement,id:0})}),n},o.init=function(){},o.editorInit=function(e){},o.refreshEditorSidebarContent=function(e,r){var t=$("<div>"+o.translate("Question")+':<br><div class="richtext">'+r.JSON.text+"</div></div>");o.editor.makeRichTextEditor({target:$(".richtext",t),onChange:function(e){r.JSON.text=e}}),e.append(t);var n=$('<div style="padding-left:36px;padding-top:0;position:relative"></div>');o.editor.buildSortableList(n,r.JSON.fields,function(n,t){var e=o.editor.getRichTextInput("",t.text,function(e){t.text=$.trim(e),o.editor.inputValueChanged()},!0,!0),i=o.editor.getSmallIconBtn("true"==t.checked?"fa-check-square-o":"fa-square-o",function(){t.checked="true"==t.checked?"false":"true","true"==r.JSON.single&&$.each(r.JSON.fields,function(e,t){e!=n&&(t.checked="false")}),o.editor.updateContentSidebar()});i.css({position:"absolute","margin-left":"-30px","margin-top":"3px"}),i.attr("title","Antwort ist richtig / falsch"),i.tooltip(),o.refreshEditorSidebarContentFocusLast&&r.JSON.fields.length-1==n&&(o.refreshEditorSidebarContentFocusLast=!1,setTimeout(function(){$(".note-editable",e.parent()).trigger("focus")},100));var a=$("<div></div>");return a.append(i),a.append(e),a},function(){return o.refreshEditorSidebarContentFocusLast=!0,{text:"",checked:"false"}}),e.append($("<div>"+o.translate("Answers")+":</div>")),e.append(n),o.editor.advancedMode&&(e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(o.editor.getApplyToAllBtn(function(){o.editor.openApplyAttributeToAllDialog(r,"single",r.JSON.single)}))),e.append(o.editor.getToggleCheck(o.translate("singleChoice"),r.JSON.single,function(e){if(r.JSON.single=e,"true"==r.JSON.single){var n=!0,i=!1;$.each(r.JSON.fields,function(e,t){"true"==t.checked&&(n?n=!1:(t.checked="false",i=!0))}),i&&o.editor.updateContentSidebar()}})),e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(o.editor.getApplyToAllBtn(function(){o.editor.openApplyAttributeToAllDialog(r,"horizontal",r.JSON.horizontal)}))),e.append(o.editor.getToggleCheck(o.translate("horizontal"),r.JSON.horizontal,function(e){r.JSON.horizontal=e,o.editor.updateContentSidebar()})),"true"==r.JSON.horizontal&&e.append(o.editor.getToggleCheck(o.translate("spreadout"),r.JSON.spread,function(e){r.JSON.spread=e})),e.append(o.editor.getToggleCheck(o.translate("buttonMode"),r.JSON.buttonMode,function(e){r.JSON.buttonMode=e})),e.append(o.editor.getToggleCheck(o.translate("predefined"),r.JSON.predefined,function(e){r.JSON.predefined=e})),"true"!=r.JSON.predefined&&e.append(o.editor.getToggleCheck(o.translate("withCorrection"),"true"==r.JSON.nocheck?"false":"true",function(e){r.JSON.nocheck="false"==e?"true":"false"})))}}(),function(){var l=new AModule("notes");l.notePopup=null,l.notes=[],l.addbtn=null,l.isActive=!1,l.setAddNoteMode=function(e){e?(l.isActive=!0,l.addbtn&&l.addbtn.addClass("active"),widget.contentElement.parent().one("touchstart mousedown",function(e){if(l.isActive){if((e=e.originalEvent?e.originalEvent:e).touches&&0==e.touches.length)return;e.preventDefault(),e.stopPropagation(),e.touches&&(e=e.touches[0]),l.setAddNoteMode(!1);for(var t=0,n=0;n<l.notes.length;n++)l.notes[n].JSON.id>t&&(t=l.notes[n].JSON.id);for(var i=$(e.target),a=null;i.parent()&&i!=i.parent()&&0!=i.length;){if(i.hasClass("columnContainer")){a=i.parent();break}i=i.parent()}var r={JSON:{id:t+1,w:widget.JSON.id,u:widget.userID,author:widget.user&&widget.user.name?widget.user.name:"",text:"",x:e.pageX-16-widget.contentElement.parent().offset().left,y:e.pageY-widget.contentElement.parent().offset().top}};if(a){r.JSON.parent=a.attr("id");var o=a.offset();r.JSON.x=e.pageX-16-o.left,r.JSON.y=e.pageY-o.top,r.JSON.y=r.JSON.y+i.data("jsp").getContentPositionY()}l.createNote(r)}}),window.parent&&window.parent.postMessage("SETADDNOTEMODE|1","*")):(l.isActive=!1,l.addbtn&&l.addbtn.removeClass("active"),window.parent&&window.parent.postMessage("SETADDNOTEMODE|0","*"))},l.refreshModule=function(){if("true"==l.JSON.active&&!l.editor&&"1"==helper.getURLParam("inapp")){if(l.notes=[],widget.JSON.remoteUserMessages)for(var e=0;e<widget.JSON.remoteUserMessages.length;e++){"widgetNote"==(t=widget.JSON.remoteUserMessages[e]).Type&&widget.JSON.remoteUserID!=t.JSON.u&&l.notes.push(t)}else for(e=0;e<widget.JSON.userMessages.length;e++){var t;"widgetNote"==(t=widget.JSON.userMessages[e]).Type&&l.notes.push(t)}l.notes.sort(function(e,t){return e.JSON.id-t.JSON.id}),$(".stickyNote").remove(),$.each(l.notes,function(e,n){var i=$('<div class="stickyNote'+(widget.JSON.remoteUserMessages||widget.userID!=n.JSON.u?" bubble":"")+'"><div class="stickyNoteInner">'+n.JSON.id+"</div></div>");if(n.JSON.c&&i.addClass(n.JSON.c),i.attr("id","stickyNote_"+n.ID),i.on("touchend mouseup",function(e){l.isDragging||l.openNoteDialog(n)}),n.JSON.parent){var t=$("#"+n.JSON.parent+" > .columnContainer > div > .containerContent");0==t.length?(delete n.JSON.parent,widget.contentElement.parent().append(i)):t.append(i)}else widget.contentElement.parent().append(i);n.JSON.x>i.parent().width()&&(n.JSON.x=i.parent().width()-52,i.css("left",n.JSON.x+"px")),widget.userID==n.JSON.u&&i.draggable({cursor:"move",containment:n.JSON.parent?i.parent():widget.contentElement.parent(),start:function(){l.setAddNoteMode(!1),i.addClass("being-dragged"),i.offset().left,i.offset().top,l.isDragging=!0},stop:function(){i.removeClass("being-dragged"),l.isDragging=!1;var e=parseFloat(i.css("left")).toFixed(2),t=parseFloat(i.css("top")).toFixed(2);Math.abs(e-n.JSON.x)<2&&Math.abs(t-n.JSON.y)<2||(n.JSON.x=e,n.JSON.y=t,l.updateNote(n))}});var a=n.JSON.y;i.css({left:n.JSON.x+"px",top:a+"px"})})}},l.createNote=function(a){a.Type="widgetNote",a.ID=0,widget.JSON.remoteUserMessages?(a.User=widget.JSON.remoteUserID,a.JSON.to=widget.JSON.remoteUserID,a.isNew=1):(a.User=widget.userID,a.isNew=0),a.Data=JSON.stringify(a.JSON),l.waitingForMessageID&&window.removeEventListener("message",l.waitingForMessageID),l.waitingForMessageID=function(e){if(0===e.data.indexOf("USERMESSAGEADDEDID|")){var t=e.data.split("|"),n=t[1];if(t.splice(0,2),l.waitingForLastMessage==t.join("|"))if(a.ID=n,window.removeEventListener("message",l.waitingForMessageID),l.waitingForMessageID=!1,widget.JSON.remoteUserMessages){a.JSON.linked=n;var i={ID:0,isNew:0,Type:"studentWidgetNote",User:widget.userID,Data:JSON.stringify(a.JSON)};l.waitingForLastMessage=JSON.stringify(i),l.waitingForMessageID=function(e){if(0===e.data.indexOf("USERMESSAGEADDEDID|")){var t=e.data.split("|"),n=t[1];t.splice(0,2),l.waitingForLastMessage==t.join("|")&&(i.ID=n,widget.JSON.userMessages.push(i),window.removeEventListener("message",l.waitingForMessageID),l.waitingForMessageID=!1,a.JSON.linked=i.ID,widget.JSON.remoteUserMessages.push(a),l.notePopup&&l.notePopup.remove(),a.newNote=!0,l.openNoteDialog(a),l.refreshModule())}},window.addEventListener("message",l.waitingForMessageID),window.parent.postMessage("ADDUSERMESSAGE|"+JSON.stringify(i),"*"),console.log("adding studentWidgetNote message.")}else widget.JSON.userMessages.push(a),l.notePopup&&l.notePopup.remove(),a.newNote=!0,l.openNoteDialog(a),l.refreshModule()}},window.addEventListener("message",l.waitingForMessageID),l.waitingForLastMessage=JSON.stringify(a),window.parent.postMessage("ADDUSERMESSAGE|"+l.waitingForLastMessage,"*"),console.log("adding widgetNote message.")},l.getNoteByID=function(e){if(widget.JSON.remoteUserMessages){for(var t=0;t<widget.JSON.remoteUserMessages.length;t++)if(widget.JSON.remoteUserMessages[t].ID==e)return widget.JSON.remoteUserMessages[t]}else for(t=0;t<widget.JSON.userMessages.length;t++)if(widget.JSON.userMessages[t].ID==e)return widget.JSON.userMessages[t]},l.updateNote=function(e){if(delete(e=l.getNoteByID(e.ID)).newNote,widget.JSON.remoteUserMessages?e.isNew=1:e.isNew=0,e.Data=JSON.stringify(e.JSON),window.parent&&window.parent.postMessage("UPDATEUSERMESSAGE|"+JSON.stringify(e),"*"),$("#stickyNote_"+e.ID).removeClass("c1 c2 c3 c4 c5").addClass(e.JSON.c?e.JSON.c:"c1"),e.JSON.linked){var t=null;if(widget.JSON.remoteUserMessages)for(var n=0;n<widget.JSON.remoteUserMessages.length;n++){if((i=widget.JSON.remoteUserMessages[n]).ID==e.JSON.linked){t=i;break}}for(n=0;n<widget.JSON.userMessages.length;n++){var i;if((i=widget.JSON.userMessages[n]).ID==e.JSON.linked){t=i;break}}t&&(t.Data=e.Data,t.JSON=JSON.parse(t.Data),console.log("Updating linked userMessage."),window.parent&&window.parent.postMessage("UPDATEUSERMESSAGE|"+JSON.stringify(t),"*"))}l.refreshModule()},l.deleteNote=function(e){if(window.parent&&window.parent.postMessage("DELETEUSERMESSAGE|"+e.ID,"*"),widget.JSON.remoteUserMessages){for(var t=0;t<widget.JSON.remoteUserMessages.length;t++)if(widget.JSON.remoteUserMessages[t].ID==e.ID){widget.JSON.remoteUserMessages.splice(t,1);break}}else for(t=0;t<widget.JSON.userMessages.length;t++)if(widget.JSON.userMessages[t].ID==e.ID){widget.JSON.userMessages.splice(t,1);break}if(e.JSON.linked){var n=null;if(widget.JSON.remoteUserMessages)for(t=0;t<widget.JSON.remoteUserMessages.length;t++){if((i=widget.JSON.remoteUserMessages[t]).ID==e.JSON.linked){n=i;break}}for(t=0;t<widget.JSON.userMessages.length;t++){var i;if((i=widget.JSON.userMessages[t]).ID==e.JSON.linked){n=i;break}}n&&(console.log("Deleting linked userMessage."),window.parent&&window.parent.postMessage("DELETEUSERMESSAGE|"+n.ID,"*"))}l.notePopup&&l.notePopup.remove(),l.refreshModule()},l.openNoteDialog=function(e){window.parent&&window.parent.postMessage("OPENWIDGETNOTE|"+JSON.stringify(e),"*")},l.init=function(){window.addEventListener("message",function(e){if("string"==(typeof e.data).toLowerCase()){if(0===e.data.indexOf("WIDGETNOTECHANGED|")){for(var t=e.data.substring("WIDGETNOTECHANGED|".length),n=JSON.parse(t),i=0;i<l.notes.length;i++)if(l.notes[i].ID==n.ID){l.notes[i].JSON=n.JSON;break}l.updateNote(n)}if(0===e.data.indexOf("WIDGETNOTEDELETE|")){t=e.data.substring("WIDGETNOTEDELETE|".length),n=JSON.parse(t);l.deleteNote(n)}}})},l.initEditor=function(e){}}(),function(){var a=new AModule("numbering");a.noSaveData=!0,a.initContent=function(e){e.JSON.style="numeric",e.JSON.list="1",e.JSON.positionclass=10,e.JSON.alignclass="right"},a.refreshModule=function(){var e=[];function t(e){for(var t=String(+e).split(""),n=["","C","CC","CCC","CD","D","DC","DCC","DCCC","CM","","X","XX","XXX","XL","L","LX","LXX","LXXX","XC","","I","II","III","IV","V","VI","VII","VIII","IX"],i="",a=3;a--;)i=(n[+t.pop()+10*a]||"")+i;return Array(+t.join("")+1).join("M")+i}widget.forEachContent(function(n){if(n.module!=a)return!0;var i=null;return $.each(e,function(e,t){t.list==n.JSON.list&&t.style==n.JSON.style&&(i=t)}),null==i&&(e.push({list:n.JSON.list,style:n.JSON.style,num:0}),i=e[e.length-1]),"numeric"==n.JSON.style&&n.htmlElement.html(i.num+1+". "),"alpha"==n.JSON.style&&n.htmlElement.html(String.fromCharCode(i.num+"a".charCodeAt(0))+") "),"ALPHA"==n.JSON.style&&n.htmlElement.html(String.fromCharCode(i.num+"A".charCodeAt(0))+") "),"roman"==n.JSON.style&&n.htmlElement.html(t(i.num+1).toLowerCase()+". "),"ROMAN"==n.JSON.style&&n.htmlElement.html(t(i.num+1)+". "),i.num++,!0})},a.init=function(){},a.refreshEditorSidebarContent=function(e,n){e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(a.editor.getApplyToAllBtn(function(){a.editor.openApplyAttributeToAllDialog(n,"style",n.JSON.style)}))),e.append(a.editor.getSelectInput(a.translate("NumberStyle"),["numeric","alpha","ALPHA","roman","ROMAN"],n.JSON.style,function(t){n.JSON.style=t,widget.forEachContent(function(e){return e.module!=a||e.JSON.list==n.JSON.list&&(e.JSON.style=t),!0})})),e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(a.editor.getApplyToAllBtn(function(){a.editor.openApplyAttributeToAllDialog(n,"list",n.JSON.list)}))),e.append(a.editor.getSelectInput(a.translate("List"),["1","2","3","4","5"],n.JSON.list,function(e){n.JSON.list=e}))}}(),function(){var i=new AModule("plain_text");i.noSaveData=!0,i.initContent=function(e){e.JSON.text="<p>"+i.translate("plain_text_preset")+"</p>"},i.refreshContent=function(e){e.htmlElement.html("<p>"+(""!=$.trim(e.JSON.text)?e.JSON.text:"&nbsp;&nbsp;&nbsp;")+"</p>")},i.init=function(){},i.initEditor=function(e){},i.refreshEditorSidebarContent=function(e,t){var n=$("<div>"+i.translate("Text")+'<br><div class="richtext">'+t.JSON.text+"</div></div>");i.editor.makeRichTextEditor({target:$(".richtext",n),onChange:function(e){t.JSON.text=e}}),e.append(n)}}(),function(){var i=new AModule("popup_text");i.noSaveData=!0,i.initContent=function(e){e.JSON.text=i.translate("popup_text_preset"),e.JSON.openText=i.translate("showMore"),e.JSON.closeText=i.translate("showLess")},i.refreshContent=function(t){var n=$('<div class="popupTextCaption"></div>');n.html('<i class="fa fa-fw fa-caret-right"></i> '+t.JSON.openText);var i=$('<div class="popupTextContent"></div>');i.html(""!=$.trim(t.JSON.text)?t.JSON.text:"&nbsp;&nbsp;&nbsp;"),i.hide(),t.isOpen=!1,n.on("click",function(e){return t.isOpen?(t.isOpen=!1,i.slideUp("fast",function(){n.removeClass("open"),n.html('<i class="fa fa-fw fa-caret-right"></i> '+t.JSON.openText)})):(t.isOpen=!0,n.addClass("open"),i.slideDown("fast",function(){n.html('<i class="fa fa-fw fa-caret-down"></i> '+t.JSON.closeText)})),e.preventDefault(),!1}),t.htmlElement.empty(),t.htmlElement.addClass("popupTextContainer"),t.htmlElement.append(n),t.htmlElement.append(i)},i.init=function(){},i.initEditor=function(e){},i.refreshEditorSidebarContent=function(e,t){var n=$("<div>"+i.translate("Text")+'<br><div class="richtext">'+t.JSON.text+"</div></div>");i.editor.makeRichTextEditor({target:$(".richtext",n),onChange:function(e){t.JSON.text=e}}),e.append(n),e.append(i.editor.getTextInput(i.translate("showMoreLabel"),t.JSON.openText,function(e){t.JSON.openText=e})),e.append(i.editor.getTextInput(i.translate("showLessLabel"),t.JSON.closeText,function(e){t.JSON.closeText=e}))}}(),function(){var e=new AModule("print");e.refreshModule=function(){e.buttonPrint&&e.buttonPrint.remove(),e.buttonPrint=null,widget.allowPrint&&(e.buttonPrint=$('<i class="fa fa-fw fa-print" style="cursor:pointer" title="Print"></i>').on("click",function(){e.print(e.buttonPrint)}),$(".rightMenu.item-1").append(e.buttonPrint))},e.print=function(n){var e=widget.printInput,t=new Date,i="edulo_"+widget.JSON.title+"_"+t.getYear()+"_"+(t.getMonth()+1)+"_"+t.getDay()+".pdf",a="https://content.edulo.com/api/toPDF.php?sendurl=1&filename="+(i=i.replace(/"<>#%\{\}\|\\\^~\[\]`;\?:@=&/g,""))+"&guid="+widget.JSON.GUID+"&input="+e+"&check=1";n&&($(n).css({"pointer-events":"none",opacity:.5}),$(n).removeClass("fa-print"),$(n).addClass("fa-spin fa-spinner")),$.ajax({url:a,method:"GET",crossDomain:!0,dataType:"json",success:function(e){if(n&&e.url){$(n).css({"pointer-events":"initial",opacity:1}),$(n).removeClass("fa-spin fa-spinner"),$(n).addClass("fa-print");var t=document.createElement("a");t.href=e.url,t.download=i,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}}),console.log("PRINTING")},e.init=function(){}}(),function(){var u=new AModule("punctuate");u.initContent=function(e){e.JSON.text="<p>"+u.translate("punctuate_preset")+"</p>",e.JSON.s1Active="true",e.JSON.s2Active="true",e.JSON.s3Active="true",e.JSON.s4Active="true",e.JSON.s5Active="true",e.JSON.s6Active="true",e.JSON.s7Active="true",e.JSON.s8Active="true",e.JSON.s9Active="false",e.JSON.s10Active="false",e.JSON.quotes="„ “",e.spanInputs=[]},u.checkSingleSpan=function(e,t){var n=e.displayElement.attr("data-punctuation"),i=e.displayElement.attr("data-set"),a=!1;return void 0!==n&&0!=n||(n=""),void 0!==i&&0!=i||(i=""),a=n==i,n.match(/\(.\)/)&&(n[1]==i&&(a=!0),""==i&&(a=!0)),e.correct=a?"true":"false",a},u.checkSolution=function(r){if("true"==r.JSON.predefined)return!0;if("true"==r.JSON.nocheck)return!0;var o=widget.findModule("check_solution"),l=!0,s=[],d=[],c=-1,i=r.htmlElement.offset().top,e=parseInt(r.htmlElement.css("padding-top"));isNaN(e)||(i+=e);var t=parseInt(r.htmlElement.css("padding-left"));if(isNaN(t)||t,$.each(r.spanInputs,function(e,t){var n=t.displayElement.offset();c!=n.top&&(s.push(0),d.push(n.top),c=n.top),t.displayElement.removeClass("helped correct wrong");var i=t.displayElement.attr("data-set");void 0!==i&&0!=i||(i="");var a=u.checkSingleSpan(t,r);r.isChecked&&!a&&""!=i&&(t.helped="true"),""!=i&&o.delay(function(){t.displayElement.removeClass("helped correct wrong"),"true"==t.correct?(t.displayElement.addClass("correct"),o.showHelped&&"true"==t.helped&&t.displayElement.addClass("helped")):t.displayElement.addClass("wrong")},.5),"false"==t.correct&&(l=!1,s[s.length-1]++)}),r.counterDisplays&&$.each(r.counterDisplays,function(e,t){t.fadeOut("normal",function(){$(this).remove()})}),r.counterDisplays=[],"true"==r.JSON.blockCorrection){var n=0;if($.each(s,function(e,t){n+=t}),0<n){var a=$('<div class="punctuateCounterDisplay"></div>');a.html('<div class="punctuateCounterDisplayLine"></div>'+n),a.css("margin-top",d[d.length-1]-i+"px"),r.htmlElement.prepend(a),a.fadeIn(),$(".punctuateCounterDisplayLine",a).css("height",d[d.length-1]-i),r.counterDisplays.push(a)}}else $.each(s,function(e,t){if(0!=t){var n=$('<div class="punctuateCounterDisplay"></div>');n.html(t),n.css("margin-top",d[e]-i+"px"),r.htmlElement.prepend(n),n.fadeIn(),r.counterDisplays.push(n)}});return l},u.helpSolution=function(i){if("true"==i.JSON.predefined)return!0;if("true"==i.JSON.nocheck)return!0;var a=!0;return $.each(i.spanInputs,function(e,t){if(a&&!u.checkSingleSpan(t,i)){var n=t.displayElement.attr("data-punctuation");n.match(/\(.\)/)&&(n=n[1]),u.setSpanData(t.displayElement,n,i),t.helped="true",t.displayElement.addClass("highlight"),t.displayElement.effect("highlight",function(){setTimeout(function(){t.displayElement.removeClass("highlight")},1e3)}),widget.scrollToElement(t.displayElement),a=!1}}),a},u.getCheckableElements=function(e){var t=[];if("true"==e.JSON.nocheck)return t;if("true"==e.JSON.predefined)return t;if(e.spanInputs)for(var n=0;n<e.spanInputs.length;n++){var i=e.spanInputs[n];t.push(i)}return t},u.refreshContent=function(o){if(o.punctuations=[],"true"==o.JSON.s1Active&&o.punctuations.push({text:u.translate("punctuate_1"),value:"."}),"true"==o.JSON.s2Active&&o.punctuations.push({text:u.translate("punctuate_2"),value:"?"}),"true"==o.JSON.s3Active&&o.punctuations.push({text:u.translate("punctuate_3"),value:"!"}),"true"==o.JSON.s4Active&&o.punctuations.push({text:u.translate("punctuate_4"),value:","}),"true"==o.JSON.s5Active&&o.punctuations.push({text:u.translate("punctuate_5"),value:":"}),"true"==o.JSON.s6Active&&o.punctuations.push({text:u.translate("punctuate_6"),value:";"}),"true"==o.JSON.s7Active){var e=$("<span>").html(o.JSON.text).text();e.match(/"/)&&o.punctuations.push({text:u.translate("punctuate_7"),value:'"'}),e.match(/„/)&&o.punctuations.push({text:u.translate("punctuate_7"),value:"„"}),e.match(/“/)&&o.punctuations.push({text:u.translate("punctuate_7"),value:"“"}),e.match(/«/)&&o.punctuations.push({text:u.translate("punctuate_7"),value:"«"}),e.match(/»/)&&o.punctuations.push({text:u.translate("punctuate_7"),value:"»"})}"true"==o.JSON.s9Active&&o.punctuations.push({text:u.translate("punctuate_9"),value:"/"}),"true"==o.JSON.s10Active&&o.punctuations.push({text:u.translate("punctuate_10"),value:"-"}),o.htmlElement.html(""!=$.trim(o.JSON.text)?o.JSON.text.replace(/&nbsp;/g," "):"&nbsp;&nbsp;&nbsp;"),o.htmlElement.addClass("punctuateTextContent"),FastClick.attach(o.htmlElement.get(0));var t=widget.findModule("hints");t&&t.refreshContents(o);function l(e){return"\n"==e||" "==e}function s(e){for(var t=0;t<o.punctuations.length;t++)if(o.punctuations[t].value==e||3==e.length&&o.punctuations[t].value==e[1])return!0;return!1}!function n(e,i){$.each(e,function(e,a){if(1==a.nodeType&&"SPAN"==a.nodeName.toUpperCase())(s($(a).html())||l($(a).html()))&&($(a).addClass("punctuateTextSpan"),$(a).attr("data-punctuation",$(a).html()),$(a).addClass("clickable").on("click",function(e){u.clickedWord($(a),o)}));else if(3==a.nodeType&&"SPAN"!=i.nodeName.toUpperCase()){var r=a.nextSibling,t=function(e){for(var t=[],n="",i=0;i<e.length;i++){var a=e[i],r=!1;if("("==e[i]&&e.length>i+2&&")"==e[i+2]&&s(e[i+1])&&(r=!0),l(a)||s(a)||r){if(""!=n&&t.push(n),n="",0<t.length&&s(t[t.length-1])&&l(a))continue;0<t.length&&l(t[t.length-1])&&(s(a)||r)&&t.pop(),r?(t.push(e[i]+e[i+1]+e[i+2]),i+=2):t.push(a)}else n+=a}return""!=n&&t.push(n),t}(a.textContent.replace(/\r/g,"\n").replace(/\n\n/g,"\n"));$.each(t,function(e,t){if("\n"!=t){var n=document.createElement("span");n.innerText=t,a.parentNode.insertBefore(n,r),s(t)?$(n).addClass("punctuateTextSpan").attr("data-punctuation",t):$(n).addClass("punctuateTextSpan").attr("data-punctuation",""),(s(t)||l(t))&&$(n).addClass("clickable").on("click",function(e){u.clickedWord($(n),o)})}else{var i=document.createElement("br");a.parentNode.insertBefore(i,r)}}),a.parentNode.removeChild(a)}else n($(a).contents(),a)})}(o.htmlElement.contents(),o.htmlElement[0]),function n(e,t){$.each(e,function(e,t){1==t.nodeType&&"SPAN"==t.nodeName.toUpperCase()?0<e&&(l(t.innerHTML)||s(t.innerHTML))&&$(t).prev("span").add(t).wrapAll('<div class="punctuateTextSB"></div>'):n($(t).contents(),t)})}(o.htmlElement.contents(),o.htmlElement[0]),$(".punctuateTextSB",o.htmlElement).append('<div class="punctuateTextSBA"> &nbsp; </div>'),""==$.trim(o.htmlElement.html())&&o.htmlElement.html("&nbsp;&nbsp;&nbsp;"),o.spanInputs=[],$.each($("p",o.htmlElement),function(e,t){""==$(t).html()&&$(t).html("<br>")}),$.each($("span",o.htmlElement),function(e,t){(s($(t).html())||l($(t).html()))&&o.spanInputs.push({correct:"false",helped:"false",displayElement:$(t)})}),$.each(o.spanInputs,function(e,t){u.setSpanData(t.displayElement,null,o)}),"true"==o.JSON.predefined&&$.each(o.spanInputs,function(e,t){t.displayElement.css("pointer-events","none");var n=t.displayElement.attr("data-punctuation");n.match(/\(.\)/)&&(n=n[1]),u.setSpanData(t.displayElement,n,o)})},u.setSpanData=function(e,t,n){t&&""!=t?(e.attr("data-set",t),e.html(t),";"!=t&&","!=t&&":"!=t||e.html(t+"&nbsp;&nbsp;"),"."!=t&&"!"!=t&&"?"!=t||e.html("&nbsp;"+t+"&nbsp;&nbsp;"),'"'!=t&&"/"!=t&&"-"!=t||e.html("&nbsp;"+t+"&nbsp;"),"»"!=t&&"“"!=t||e.html("&nbsp;"+t+"&nbsp;&nbsp;"),"«"!=t&&"„"!=t||e.html("&nbsp;&nbsp;"+t+"&nbsp;"),e.addClass("hasvalue")):(e.attr("data-set",""),e.html("&nbsp;&nbsp;"),e.removeClass("hasvalue"))},u.clickedWord=function(i,a){if("true"==a.JSON.predefined)return!0;var r=widget.findModule("save_load");if(1==a.punctuations.length&&(i.removeClass("helped correct wrong"),i.attr("data-set")!=a.punctuations[0].value?u.setSpanData(i,a.punctuations[0].value,a):u.setSpanData(i,null,a),r&&r.save()),1<a.punctuations.length){var o=$('<div style="min-width:'+a.punctuations.length/2*35+'px"></div>');$.each(a.punctuations,function(e,t){var n=$('<div class="punctuateSelectorEntry">'+t.value+"</div>");n.on("click",function(e){i.removeClass("helped correct wrong"),u.setSpanData(i,t.value,a),r&&r.save(),e.stopPropagation(),l.fadeOut("normal",function(){$(this).remove()})}),o.append(n)});var e=$('<div class="punctuateSelectorEntry">⊘ keins</div>');e.on("click",function(e){i.removeClass("helped correct wrong"),u.setSpanData(i,null,a),r&&r.save(),e.stopPropagation(),l.fadeOut("normal",function(){$(this).remove()})}),o.append(e);var l=widget.elementPopup(i,o,"auto")}},u.saveUserInput=function(n,i){if("true"==n.JSON.predefined)return!0;$.each(n.spanInputs,function(e,t){u.checkSingleSpan(t,n),t.displayElement.attr("data-punctuation")&&""!=t.displayElement.attr("data-punctuation")||t.displayElement.attr("data-set")&&""!=t.displayElement.attr("data-set")?(i.input.push({v:t.displayElement.attr("data-set"),h:t.helped,c:t.correct}),"true"==t.correct?i.counter.correct++:i.counter.wrong++,"true"==t.correct&&"true"==t.helped&&i.counter.helped++,i.counter.total++):i.input.push(0)})},u.clearUserInput=function(n){if("true"==n.JSON.predefined)return!0;n.counterDisplays&&$.each(n.counterDisplays,function(e,t){t.remove()}),$.each(n.spanInputs,function(e,t){t.helped="false",t.correct="false",t.displayElement&&t.displayElement.removeClass("wrong correct"),u.setSpanData(t.displayElement,null,n)})},u.loadUserInput=function(n,i){if("true"==n.JSON.predefined)return!0;$.each(n.spanInputs,function(e,t){null==i&&t.displayElement&&t.displayElement.removeClass("wrong correct"),u.setSpanData(t.displayElement,null,n),!i||e>i.length-1||void 0!==i[e].v&&(u.setSpanData(t.displayElement,i[e].v,n),t.correct=i[e].c,t.helped=i[e].h)})},u.getInputHTMLElements=function(e){if("true"==e.JSON.predefined)return[];var n=[];return $.each(e.spanInputs,function(e,t){n.push({e:t.displayElement,id:e})}),n},u.init=function(){},u.refreshEditorSidebarContent=function(e,t){var n=$("<div>"+u.translate("Text")+':<br><div class="richtext">'+t.JSON.text+'</div><br><div class="colorsList"></div></div>');e.append(n),u.editor.advancedMode&&(e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(u.editor.getApplyToAllBtn(function(){u.editor.openApplyAttributeToAllDialog(t,"blockCorrection",t.JSON.blockCorrection)}))),e.append(u.editor.getToggleCheck(u.translate("blockCheck")+":",t.JSON.blockCorrection,function(e){t.JSON.blockCorrection=e}))),e.append(u.editor.getToggleCheck(u.translate("punctuate_1"),t.JSON.s1Active,function(e){t.JSON.s1Active=e})),e.append(u.editor.getToggleCheck(u.translate("punctuate_2"),t.JSON.s2Active,function(e){t.JSON.s2Active=e})),e.append(u.editor.getToggleCheck(u.translate("punctuate_3"),t.JSON.s3Active,function(e){t.JSON.s3Active=e})),e.append(u.editor.getToggleCheck(u.translate("punctuate_4"),t.JSON.s4Active,function(e){t.JSON.s4Active=e})),e.append(u.editor.getToggleCheck(u.translate("punctuate_5"),t.JSON.s5Active,function(e){t.JSON.s5Active=e})),e.append(u.editor.getToggleCheck(u.translate("punctuate_6"),t.JSON.s6Active,function(e){t.JSON.s6Active=e})),e.append(u.editor.getToggleCheck(u.translate("punctuate_7"),t.JSON.s7Active,function(e){t.JSON.s7Active=e})),e.append(u.editor.getToggleCheck(u.translate("punctuate_9"),t.JSON.s9Active,function(e){t.JSON.s9Active=e})),e.append(u.editor.getToggleCheck(u.translate("punctuate_10"),t.JSON.s10Active,function(e){t.JSON.s10Active=e}));u.editor.makeRichTextEditor({target:$(".richtext",n),buttons:[],onChange:function(e){t.JSON.text=e}});u.editor.advancedMode&&(e.append(u.editor.getToggleCheck(u.translate("predefined"),t.JSON.predefined,function(e){t.JSON.predefined=e,u.editor.updateContentSidebar()})),"true"!=t.JSON.predefined&&e.append(u.editor.getToggleCheck(u.translate("withCorrection"),"true"==t.JSON.nocheck?"false":"true",function(e){t.JSON.nocheck="false"==e?"true":"false"})))}}(),function(){var h=new AModule("read_text");h.linkCounter=0,h.lineCounter=0,h.links=[],h.markMode=!1,h.markModeUnmark=!1,h.allowMarking=!1,h.readingTexts=[],h.refElements=[],h.initContent=function(e){e.JSON.text="<p>"+h.translate("read_text_preset")+"</p>",e.spans=[],e.marks=""},h.refreshContent=function(u){u.htmlElement.addClass("readTextContent"),u.htmlElement.html(""!=$.trim(u.JSON.text)?u.JSON.text:"&nbsp;&nbsp;&nbsp;"),function n(e,t){$.each(e,function(e,a){if(3==a.nodeType){var r=a.nextSibling,t=function(e){for(var t,n=[],i="",a=0;a<e.length;a++){var r=e[a];"\n"!=(t=r)&&" "!=t?i+=r:(""!=i&&n.push(i),i="",n.push(r))}return""!=i&&n.push(i),n}(a.textContent.replace(/\r/g,"\n").replace(/\n\n/g,"\n"));$.each(t,function(e,t){if("\n"!=t){var n=document.createElement("span");n.innerText=t,a.parentNode.insertBefore(n,r)}else{var i=document.createElement("br");a.parentNode.insertBefore(i,r)}}),a.parentNode.removeChild(a)}else n($(a).contents(),a)})}(u.htmlElement.contents(),u.htmlElement[0]),u.spans=[],$.each($("p",u.htmlElement),function(e,t){""==$(t).html()&&$(t).html("<br>")}),$.each($("span",u.htmlElement),function(e,t){u.spans.push($(t))});var p=null,g=null;h.allowMarking&&u.htmlElement.on("mousedown touchstart",function(e){var t=e.pageX,n=e.pageY;if(e.originalEvent&&e.originalEvent.touches){var i=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t=i.pageX,n=i.pageY}for(var a=0;a<u.spans.length;a++)u.spans[a].myoffset=u.spans[a].offset(),u.spans[a].mywidth=u.spans[a].width(),u.spans[a].myheight=u.spans[a].height();for(a=0;a<u.spans.length;a++)if(""!=$.trim(u.spans[a].html())){var r=u.spans[a].myoffset,o=t-r.left,l=n-r.top;if(o<u.spans[a].mywidth&&0<o&&l<u.spans[a].myheight&&0<l)return e.stopPropagation(),e.preventDefault(),h.markMode=!0,h.markModeUnmark=u.spans[a].hasClass("marked"),p=u.spans[a],e.handled=!0}}),h.allowMarking&&u.htmlElement.on("mouseup touchend",function(e){if(h.markMode){var t=widget.findModule("save_load");t&&t.save()}h.markMode=!1,g=p=null}),h.allowMarking&&u.htmlElement.on("mousemove touchmove",function(e){if(!h.markMode)return!0;var t=e.pageX,n=e.pageY;if(e.originalEvent&&e.originalEvent.touches){var i=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0];t=i.pageX,n=i.pageY}for(var a=0;a<u.spans.length;a++)if(""!=$.trim(u.spans[a].html())){var r=u.spans[a].myoffset,o=t-r.left,l=n-r.top;if(o<u.spans[a].mywidth&&0<o&&l<u.spans[a].myheight&&0<l){var s=u.spans[a];if(s.index()<p.index()&&(s=p,p=u.spans[a]),null!=g&&g.get(0)!=u.spans[a].get(0)&&!h.markModeUnmark){var d=p,c=g;c.index()<d.index()&&(c=p,d=g),d.nextUntil(c,"span").andSelf().add(c).removeClass("marked")}return g=u.spans[a],e.stopPropagation(),e.preventDefault(),h.markModeUnmark?s.get(0)!=p.get(0)&&p.nextUntil(s,"span").andSelf().add(s).removeClass("marked"):s.get(0)!=p.get(0)&&p.nextUntil(s,"span").andSelf().add(s).addClass("marked"),e.handled=!0}}}),u.marks||(u.marks=""),h.refreshMarks(u)},h.saveUserInput=function(e,t){},h.loadUserInput=function(e,t){},h.clearUserInput=function(e){},h.refreshMarks=function(e){for(var t=0;t<e.marks.length&&!(t>=e.spans.length);t++)"0"==e.marks[t]&&e.spans[t].removeClass("marked"),"1"==e.marks[t]&&e.spans[t].addClass("marked")},h.refreshLineNumbers=function(i){var a=(0<i.spans.length?i.spans[0].offset():i.htmlElement.offset()).top,r=[],o=[],l=-9999999;$.each(i.spans,function(e,t){if(t.data("line",h.lineCounter),""!=$.trim(t.html())){var n=t.offset();l<n.top&&(h.lineCounter++,l=n.top,r.push(h.lineCounter),o.push(n.top),t.attr("id","readTextLine_"+h.lineCounter),t.data("line",h.lineCounter))}}),i.counterDisplays&&$.each(i.counterDisplays,function(e,t){t.remove()}),i.counterDisplays=[],$.each(r,function(e,t){if(t%5==0){var n=$('<div class="readTextLineDisplay"></div>');n.html(t),n.css("margin-top",o[e]-a+"px"),i.htmlElement.prepend(n),i.counterDisplays.push(n)}})},h.refreshRefElements=function(){$(".readTextLinkBtn").each(function(e,t){var n=h.links[$(t).attr("data-link")],i=n.text;if(""!=i)for(var a=i.split(/[ \n]/),r=0;r<h.readingTexts.length;r++)for(e=0;e<h.readingTexts[r].spans.length;e++){var o=h.readingTexts[r].spans[e];line1=o.data("line");var l=o.text();if(l==a[0]||0===l.indexOf(a[0])){var s=!1;l="";for(var d=e;d<h.readingTexts[r].spans.length;d++){if((l+=h.readingTexts[r].spans[d].text())==i||0===l.indexOf(i)){line2=h.readingTexts[r].spans[d].data("line"),s=!0;break}if(l.length>i.length)break}if(s){var c="";c=""!=line2&&line1!=line2?h.JSON.linkBtnText+line1+"-"+line2:h.JSON.linkBtnText+line1,n.lineFrom=parseInt(line1),n.lineTo=parseInt(""!=line2?line2:line1),n.label=c,$(t).html(c)}}}})},h.replaceRefElements=function(e){helper.findAndReplaceInElement(e,/§§([0-9]+)(-[0-9]+)?(|[^§]*)?§§/g,function(e,t,n,i){h.linkCounter++,n=n?n.replace(/-/g,""):"";var a=i=i?i.replace("|",""):"";return""==i&&(a=""!=n?h.JSON.linkBtnText+t+"-"+n:h.JSON.linkBtnText+t),h.links[h.linkCounter]={lineFrom:parseInt(t),lineTo:parseInt(""!=n?n:t),label:a,text:""},'<div class="readTextLinkBtn" data-link="'+h.linkCounter+'">'+a+"</div>"}),0<h.readingTexts.length&&helper.findAndReplaceInElement(e,/§§([^§]+?)§§/g,function(e,t){h.linkCounter++;for(var n=t.split(/[ \n]/),i=0;i<h.readingTexts.length;i++)for(var a=0;a<h.readingTexts[i].spans.length;a++){var r=h.readingTexts[i].spans[a];line1=r.data("line");var o=r.text();if(o==n[0]||0===o.indexOf(n[0])){var l=!1;o="";for(var s=a;s<h.readingTexts[i].spans.length;s++){if((o+=h.readingTexts[i].spans[s].text())==t||0===o.indexOf(t)){line2=h.readingTexts[i].spans[s].data("line"),l=!0;break}if(o.length>t.length)break}if(l){var d="";return d=""!=line2&&line1!=line2?h.JSON.linkBtnText+line1+"-"+line2:h.JSON.linkBtnText+line1,h.links[h.linkCounter]={lineFrom:parseInt(line1),lineTo:parseInt(""!=line2?line2:line1),label:d,text:t},'<div class="readTextLinkBtn" data-link="'+h.linkCounter+'">'+d+"</div>"}}}return"&nbsp;"}),$(".readTextLinkBtn",e).on("click",function(e){widget.forEachContent(function(e){return e.module!=h||$("span.highlight",e.htmlElement).removeClass("highlight"),!0});var t=h.links[$(this).attr("data-link")];widget.scrollToElement("readTextLine_"+t.lineTo);for(var n=document.getElementById("readTextLine_"+t.lineFrom);n;){if($(n).addClass("highlight"),n.nextSibling)n=n.nextSibling;else{if(!n.parentNode.nextSibling)break;n=n.parentNode.nextSibling.firstChild}if(3==n.nodeType&&(n=n.parentNode),n.id&&n.id.match("readTextLine_"+(t.lineTo+1)))break}$(".smallPopupContainer").fadeOut("normal",function(){$(this).remove()}),e.stopPropagation()})},h.refreshInsideContainer=function(e){h.refreshModule()},h.refreshModule=function(){h.lineCounter=0,h.linkCounter=0,h.readingTexts=[],widget.forEachContent(function(e){return h.replaceRefElements(e.htmlElement),!0}),setTimeout(function(){h.readingTexts=[],h.lineCounter=0,widget.forEachContent(function(e){return e.module!=h||(h.readingTexts.push(e),h.refreshLineNumbers(e)),!0}),widget.forEachContent(function(e){return h.replaceRefElements(e.htmlElement),!0}),h.refreshRefElements(),widget.refreshScrollbars()},100)},h.init=function(){widget.bindHTMLProcessor(function(e){h.replaceRefElements(e)})},h.initEditor=function(e){},h.refreshEditorSidebarContent=function(e,t){var n=$("<div>"+h.translate("Text")+'<br><div class="richtext">'+t.JSON.text+"</div></div>");h.editor.makeRichTextEditor({target:$(".richtext",n),onChange:function(e){t.JSON.text=e}}),e.append(n)}}(),function(){var c=new AModule("save_load");c.lastCheckFlag=!1,c.buildWidgetSaveData=function(a){var r=!1,o={id:widget.JSON.id,contents:[]};return"1"==widget.JSON.asTest&&(o.test=widget.testData?widget.testData:null,o.test&&o.test.d&&!o.test.ds&&(o.test.ds=1,r=!0),o.test&&o.test.s&&!o.test.ss&&(o.test.ss=1,r=!0)),widget.forEachContent(function(e){var t=null;if(a&&a.contents)for(var n=0;n<a.contents.length;n++)a.contents[n].id==e.id&&(t=a.contents[n]);var i={id:e.id,_v:e.module.JSON.version,counter:{total:0,correct:0,helped:0,wrong:0},input:[]};for(n=0;n<o.contents.length;n++)o.contents[n].id==i.id&&(o.contents.splice(n,1),n--);return e.module.noSaveData||(o.contents.push(i),"saveUserInput"in e.module&&e.module.saveUserInput(e,i),t&&JSON.stringify(i.input)==JSON.stringify(t.input)||(r=!0)),!0}),widget.forEachModule(function(e){var t=null;if(a&&a.modules)for(var n=0;n<a.modules.length;n++)a.modules[n].id==e.name&&(t=a.modules[n]);if("saveUserModuleInput"in e){o.modules||(o.modules=[]);var i={id:e.name,_v:e.JSON.version,input:[]};o.modules.push(i),e.saveUserModuleInput(i),t&&JSON.stringify(i.input)==JSON.stringify(t.input)||(r=!0)}return!0}),{data:o,hadChanges:r}},c.save=function(e){if(widget.JSON.remoteUserData&&""!=widget.JSON.remoteUserData||"1"==widget.JSON.asTest&&widget.testData&&widget.testData.d&&widget.testData.ds)"function"==typeof e&&e();else if("true"!=c.JSON.active||c.editor)"function"==typeof e&&e();else{var t=helper.getLocalStorage("widgetinput|"+widget.JSON.id),n=null;t&&(n=JSON.parse(t));var i=c.buildWidgetSaveData(n),a=i.hadChanges,r=helper.getLocalStorage("widgetchecked|"+widget.JSON.id);a=a||r!=c.lastCheckFlag,c.lastCheckFlag=r;var o=JSON.stringify(i.data);if(helper.setLocalStorage("widgetinput|"+widget.JSON.id,o),0==a)return console.log("No changes"),void("function"==typeof e&&e());var l=Math.floor((new Date).getTime()/1e3),s=helper.getLocalStorage("allwidgets");s&&(allwidgets=JSON.parse(s));for(var d=0;d<allwidgets.length;d++)allwidgets[d].id&&allwidgets[d].id==widget.JSON.id&&(allwidgets[d].synctime=l);helper.setLocalStorage("allwidgets",JSON.stringify(allwidgets)),window.parent&&window.parent.postMessage("WIDGETINPUTCHANGED|"+widget.JSON.id+"|"+l+"|"+o,"*"),console.log("All saved"),"function"==typeof e&&e()}},c.lastLoadData=null,c.firstLoad=!0,c.getCounters=function(){var e=[];if(widget.JSON.remoteClassData)return e;var t="";if((t=widget.JSON.remoteUserData&&""!=widget.JSON.remoteUserData?widget.JSON.remoteUserData:helper.getLocalStorage("widgetinput|"+widget.JSON.id))&&(widgetinput=JSON.parse(t)),widgetinput&&widgetinput.contents)for(var n=0;n<widgetinput.contents.length;n++)if(widgetinput.contents[n].counter){var i={id:widgetinput.contents[n].id,total:widgetinput.contents[n].counter.total,correct:widgetinput.contents[n].counter.correct,helped:widgetinput.contents[n].counter.helped,wrong:widgetinput.contents[n].counter.wrong};e.push(i)}return e},c.load=function(e){if("true"==c.JSON.active&&!c.editor){var t="";if(widget.JSON.remoteClassData)return;t=widget.JSON.remoteUserData&&""!=widget.JSON.remoteUserData?widget.JSON.remoteUserData:helper.getLocalStorage("widgetinput|"+widget.JSON.id),c.lastCheckFlag=helper.getLocalStorage("widgetchecked|"+widget.JSON.id);var i=c.lastLoadData?JSON.parse(c.lastLoadData):null;c.lastLoadData=t;var a=null;t&&(a=JSON.parse(t)),"1"==widget.JSON.asTest&&a&&(widget.testData=widget.testData||a.test);var r=!1;c.firstLoad&&(r=!0),c.firstLoad=!1,a&&a.contents&&widget.forEachContent(function(e){for(var t=0;t<a.contents.length;t++)if(a.contents[t].id==e.id){if(i)for(var n=0;n<i.contents.length;n++)if(a.contents[t].id==i.contents[n].id&&JSON.stringify(a.contents[t].input)==JSON.stringify(i.contents[n].input))return!0;"upgradeUserInputVersion"in e.module&&a.contents[t]._v&&a.contents[t]._v!=e.module.JSON.version&&e.module.upgradeUserInputVersion(e,a.contents[t]._v,a.contents[t].input),"loadUserInput"in e.module&&e.module.loadUserInput(e,a.contents[t].input)}return r=!0},function(){var e=widget.findModule("check_solution");e&&r&&e.reloadCheck()}),a&&a.modules&&widget.forEachModule(function(e){for(var t=0;t<a.modules.length;t++)if(a.modules[t].id==e.name){if(i)for(var n=0;n<i.modules.length;n++)if(a.modules[t].id==i.modules[n].id&&JSON.stringify(a.modules[t].input)==JSON.stringify(i.modules[n].input))return!0;"upgradeUserModuleInputVersion"in e&&a.modules[t]._v&&a.modules[t]._v!=e.JSON.version&&e.upgradeUserModuleInputVersion(a.modules[t]._v,a.modules[t].input),"loadUserModuleInput"in e&&e.loadUserModuleInput(a.modules[t].input)}return r=!0},function(){var e=widget.findModule("check_solution");e&&r&&e.reloadCheck()}),"function"==typeof e&&e()}},c.reset=function(t){widget.JSON.remoteUserData&&""!=widget.JSON.remoteUserData||"1"==widget.JSON.asTest&&widget.testData&&widget.testData.d?"function"==typeof t&&t():c.editor||widget.smallPopup(c.translate("resetExercise"),'<div style="float:left;margin-right:1em;"><i class="fa fa-fw fa-trash-o" style="font-size:3em; color: #ff2d55;"></i></div>'+c.translate("resetExerciseStart"),[{text:c.translate("Cancel"),classname:"clearBtn"},{text:c.translate("Reset"),onclick:function(e){helper.setLocalStorage("widgetinput|"+widget.JSON.id,null),helper.setLocalStorage("widgetchecked|"+widget.JSON.id,null);return function(){widget.forEachContent(function(e){e.isChecked&&(e.isChecked=!1),"clearUserInput"in e.module&&e.module.clearUserInput(e)}),widget.forEachModule(function(e){"clearUserModuleInput"in e&&e.clearUserModuleInput()}),console.log("All cleared"),window.parent&&window.parent.postMessage("WIDGETINPUTRESET|"+widget.JSON.id,"*");var e=widget.findModule("check_solution");e&&e.buttonHelp&&e.buttonHelp.show(),e&&(e.isOK=!1),"function"==typeof t&&t()}(),!0}}])},c.refreshModule=function(){c.lastLoadData=null,c.editor||c.load()},c.init=function(){if(!c.editor){c.loaded=!1,(widget.JSON.remoteUserData&&""!=widget.JSON.remoteUserData||"1"==widget.JSON.asTest)&&setInterval(function(){(widget.JSON.remoteUserData&&""!=widget.JSON.remoteUserData||"1"==widget.JSON.asTest&&widget.testData&&widget.testData.d)&&($("#contentWrapperOuter > div").each(function(e,t){"contentWrapper"!=$(t).attr("id")&&$(t).css("pointer-events","none")}),widget.isFixedColumnWidget()?($(".containerContent",widget.contentElement).css("pointer-events","none"),widget.contentElement.css("pointer-events","")):widget.contentElement.css("pointer-events","none"))},500);var t=function(){if(0==c.loaded&&(c.loaded=!0,widget.checkModulesLoaded()),widget.getModulesLoaded()){var e=widget.findModule("check_solution");e&&(e.wasReloaded=!1),c.refreshModule()}else setTimeout(t,10)};setTimeout(t,10),$(window).on("beforeunload unload",function(){c.loaded&&c.save()})}}}(),function(){var t=new AModule("send_feedback");t.feedbackPopup=null,t.refreshFeedbackBtn=function(){if($(".feedbackMessage",widget.headlineElement).remove(),"true"==t.JSON.active&&!t.editor&&widget.isTeacher&&widget.userID!=widget.JSON.owner&&"1"!=helper.getURLParam("inapp")){var e;widget.findModule("cloud");(e=$('<div class="feedbackMessage"><i class="fa fa-flag"></i></div>')).on("click",t.openFeedbackDialog),$(".rightMenu.item-2",widget.headlineElement).append(e),$(window).trigger("resize")}},t.refreshModule=function(){t.refreshFeedbackBtn()},t.openFeedbackDialog=function(){null!=t.feedbackPopup&&0<t.feedbackPopup.parent().length||(t.feedbackPopup=widget.largePopup(t.translate("sendFeedback"),'<div class="content"><textarea placeholder="'+t.translate("feedbackPlaceholder")+'" class="feedbackText multiline"></textarea></div><span class="errorTextSpan"></span>',[{close:!0},{text:t.translate("Cancel")},{text:t.translate("Send"),onclick:function(){var e=$(".feedbackText",t.feedbackPopup).val();return""==$.trim(e)?$(".feedbackText",t.feedbackPopup).focus():$.post(t.JSON.serverRoot+t.JSON.sendFeedbackEndPoint,{userid:widget.userID,widgetid:widget.JSON.id,feedback:e,collectionid:widget.JSON.collectionid?widget.JSON.collectionid:0},function(e){"FAILED"==e.result&&$(".errorTextSpan",t.feedbackPopup).html(t.translate(e.error)),"OK"==e.result&&widget.smallPopup(" ",'<div class="content" style="text-align:center">'+t.translate("feedbackThankYou")+"</div>",[{close:!0},{text:"OK"}])}),!1}}]),widget.autoExpandTextarea($(".feedbackText",t.feedbackPopup)))},t.init=function(){},t.initEditor=function(e){}}(),function(){var o=new AModule("sorting_list");o.initContent=function(e){e.JSON.items=[{value:"Beispiel 1"},{value:"Beispiel 2"},{value:"Beispiel 3"}],e.JSON.horizontal="false",e.correct="false",e.helped="false",e.hasDragged=!1},o.checkSingleItem=function(e){return $(e).attr("index")==$(e).index()},o.getCheckableElements=function(e){var t=[];return"true"==e.JSON.nocheck||t.push(e.htmlElement),t},o.checkSolution=function(n){if("true"==n.JSON.nocheck)return!0;var i=widget.findModule("check_solution"),a=!0;return $(".sortingListItem",n.listElement).each(function(e,t){o.checkSingleItem($(t))||(a=!1)}),$(".sortingListItem",n.listElement).each(function(e,t){i.delay(function(){$(t).removeClass("helped good correct wrong"),o.checkSingleItem($(t))?(a?$(t).addClass("correct"):$(t).addClass("good"),i.showHelped&&"true"==n.helped&&$(t).addClass("helped")):$(t).addClass("wrong")})}),n.correct=a?"true":"false",n.isChecked&&!a&&n.hasDragged&&(n.helped="true"),a},o.helpSolution=function(t){if("true"==t.JSON.nocheck)return!0;widget.findModule("check_solution");var n=!0;if($(".sortingListItem",t.listElement).each(function(e,t){o.checkSingleItem($(t))||(n=!1)}),!n){for(var e=[],i=0;i<t.JSON.items.length;i++)e.push(i);$.each(e,function(e,n){$(".sortingListItem",t.listElement).each(function(e,t){$(t).attr("index")==n&&$(t).parent().append($(t))})}),widget.scrollToElement(t.htmlElement),t.helped="true",t.htmlElement.effect("highlight")}return n},o.refreshContent=function(a){var n=0;$.each(a.JSON.items,function(e,t){n=Math.max(n,t.value.length+2)});a.htmlElement.html('<div><ul style="width:100%;max-width:100%;" class="sortingList'+("true"==a.JSON.horizontal?" horizontal":"")+'"></ul></div>'),a.listElement=$("ul",a.htmlElement),$.each(a.JSON.items,function(e,t){var n=$('<li class="sortingListItem"><i class="fa fa-arrows"></i><div class="sortingListItemArrow"></div> </li>');n.append('<span style="pointer-events:none">'+t.value+"</span>"),n.attr("index",e),a.listElement.append(n)});var r=!1;a.listElement.sortable({forcePlaceholderSize:!0,revert:!1,placeholder:"sortingListItemPlaceholder",tolerance:"pointer",cursor:"move",delay:100,start:function(e,t){var i;$(".sortingListItem",a.listElement).each(function(e,t){$(this).removeClass("correct good helped wrong")}),t.helper.addClass("being-dragged"),t.placeholder.attr("class",t.item.attr("class")+" "+t.placeholder.attr("class")),"true"==a.JSON.horizontal&&t.placeholder.css("width",t.item.outerWidth()+"px"),i=t,r||(r=!0,$(".sortingListItem:not(.being-dragged,.sortable-clone)",a.listElement).each(function(){var e=$(this),t=e.clone();e.data("clone",t),e.css("visibility","hidden");var n=e.position();t.css("left",n.left).css("top",n.top).css("width",e.width()).css("height",e.height()).css("position","absolute").css("z-index","2").addClass("sortable-clone"),i.item.parent().append(t)})),widget.enableDragScrolling($(this))},change:function(e,t){$("> .sortingListItem:not(.being-dragged,.sortable-clone)",t.item.parent()).each(function(){var e=$(this),t=e.data("clone");if(t){t.stop(!0,!1);var n=e.position();t.animate({left:n.left,top:n.top},500)}})},beforeStop:function(e,t){$(".being-dragged",t.item.parent()).removeClass("being-dragged"),$(".sortable-clone",a.listElement).remove(),$(".sortingListItem",a.listElement).css("visibility",""),r=!1,widget.disableDragScrolling()},update:function(e,t){a.hasDragged=!0,a.correct=!0,$(".sortingListItem",a.listElement).each(function(e,t){$(this).removeClass("correct good helped wrong"),a.correct=a.correct&&o.checkSingleItem($(t))}),a.correct=a.correct?"true":"false";var n=widget.findModule("save_load");n&&n.save()}}),a.listElement.disableSelection(),o.mixOrder(a)},o.mixOrder=function(n){if(n.mixedOrder)$.each(n.mixedOrder,function(e,t){$(".sortingListItem",n.listElement).each(function(){$(this).attr("index")==t&&$(this).parent().append($(this))})});else{n.mixedOrder=[];for(var e=!0;1<n.JSON.items.length&&e;)$(".sortingListItem",n.listElement).each(function(){.5<Math.random()&&$(this).parent().append($(this))}),e=!1,$(".sortingListItem",n.listElement).each(function(){e=e||o.checkSingleItem($(this))});n.mixedOrder=n.listElement.sortable("toArray",{attribute:"index"})}},o.clearUserInput=function(e){e.mixedOrder=null,o.mixOrder(e),e.hasDragged=!1,e.helped="false",e.correct="false",$(".sortingListItem",e.listElement).each(function(e,t){$(this).removeClass("correct helped good wrong")})},o.saveUserInput=function(e,t){var n=!0;$(".sortingListItem",e.listElement).each(function(e,t){o.checkSingleItem($(t))||(n=!1)}),e.correct=n?"true":"false";var i=e.listElement.sortable("toArray",{attribute:"index"});t.input.push({p:i.join(","),c:e.correct,h:e.helped}),"true"==e.correct?t.counter.correct++:t.counter.wrong++,"true"==e.correct&&"true"==e.helped&&t.counter.helped++,t.counter.total++},o.loadUserInput=function(n,e){if(o.mixOrder(n),n.correct="false",n.helped="false",e&&1==e.length){var t=e[0].p.split(",");$.each(t,function(e,t){$(".sortingListItem",n.listElement).each(function(){$(this).attr("index")==t&&$(this).parent().append($(this))})}),n.correct=e[0].c,n.helped=e[0].h}},o.getInputHTMLElements=function(e){return[{e:e.listElement,id:0}]},o.init=function(){},o.refreshEditorSidebarContentFocusLast=!1,o.refreshEditorSidebarContent=function(e,i){var t=$("<div></div>");o.editor.buildSortableList(t,i.JSON.items,function(e,t){var n=o.editor.getRichTextInput("",t.value,function(e){t.value=$.trim(e),o.editor.inputValueChanged()},!0,!0,!0);return o.refreshEditorSidebarContentFocusLast&&i.JSON.items.length-1==e&&(o.refreshEditorSidebarContentFocusLast=!1,setTimeout(function(){$(".note-editable",n.parent()).trigger("focus")},100)),n},function(){return o.refreshEditorSidebarContentFocusLast=!0,{value:""}}),e.append($("<div>"+o.translate("Elements")+":</div>")),e.append(t),e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(o.editor.getApplyToAllBtn(function(){o.editor.openApplyAttributeToAllDialog(i,"horizontal",i.JSON.horizontal)}))),e.append(o.editor.getToggleCheck(o.translate("horizontal"),i.JSON.horizontal,function(e){i.JSON.horizontal=e})),o.editor.advancedMode&&e.append(o.editor.getToggleCheck(o.translate("withCorrection"),"true"==i.JSON.nocheck?"false":"true",function(e){i.JSON.nocheck="false"==e?"true":"false"}))}}(),function(){var a=new AModule("system_info");a.panel=null,a.refreshModule=function(){if(a.panel&&a.panel.remove(),"true"==a.JSON.active){a.panel=$('<div class="systemInfoPanel"></div>');for(var e=0,t=0;t<localStorage.length;t++)countKey=localStorage.key(t),countValue=localStorage.getItem(localStorage.key(t)),countValue&&(itemLength=countKey.length+countValue.length,e+=itemLength);e=Math.round(16*e/8192);var n=Math.round(100*e/2560);a.panel.append('<div style="position:relative;background:#eee;width:100px;height:10pt"><div style="position:absolute;background:#aaa;width:'+n+'px;height:10pt"></div><div style="position:absolute;width:100px;text-align:center;font-size">'+e+" kb</div></div>");var i=$('<div class="btn btn-xs btn-primary">&times;</div>');i.on("click",function(){widget.smallPopup("LocalStorage des Buches löschen","In einigen Fällen kann es Probleme geben, wenn alte Daten im Buch vorhanden sind, die nicht mehr zu den aktuellen Modulen passen (speziell jetzt am Anfang).",[{close:!0},{text:"LÖSCHEN",onclick:function(){localStorage.clear(),widget.smallPopup("Zurückgesetzt","localStorage wurde zurückgesetzt. Öffne das Buch erneut!",[])}}])}),a.panel.append(i),widget.body.append(a.panel)}},a.init=function(){},a.initEditor=function(e){}}(),function(){var s=new AModule("table");s.noSaveData=!0,s.tableCellID=0,s.initContent=function(e){e.JSON.fixedLayout="false",e.JSON.cols=4,e.JSON.contents=[],e.JSON.colpadding=5,e.JSON.width="auto"},s.refreshContent=function(e){var t=Math.ceil(e.contents.length/e.JSON.cols),n="";"auto"!=e.JSON.width&&(n="width:"+e.JSON.width+";");for(var i='<table style="'+n+'" class="contentTable '+("true"==e.JSON.fixedLayout?"fixedLayout":"")+'">',a=0,r=0;r<t;r++){i+="<tr>";for(var o=0;o<e.JSON.cols;o++)a>e.contents.length-1||(s.tableCellID++,e.contents[a].tableCellID="tableCell_"+s.tableCellID,i+='<td style="padding: 0px '+e.JSON.colpadding+"px;"+(0==o?"padding-left:0px;":"")+(o==e.JSON.cols-1?"padding-right:0px;":"")+("true"==e.JSON.fixedLayout?"width:"+100/e.JSON.cols+"%;":"")+'" id="'+e.contents[a].tableCellID+'"></td>',a++);i+="</tr>"}i+="</table>",e.htmlElement.html(i)},s.refreshCellLayout=function(){var i=!1;widget.forEachContent(function(e){if(e.module!=s)return!0;var t=$("table",e.htmlElement).outerWidth();if(widget.contentElement.innerWidth()-30<t)for(var n=0;n<e.contents.length;n++){e.contents[n].htmlElement;$.each(e.contents[n].htmlElement.find("*"),function(e,t){if(t.style.width&&0<t.style.width.indexOf("px")){var n=Math.round(parseInt(t.style.width)-30);0<n&&(t.style.width=n+"px",i=!0)}})}return!0},function(){i&&setTimeout(function(){s.refreshCellLayout()},1)})},s.refreshModule=function(){widget.forEachContent(function(e){if(e.module!=s)return!0;for(var t=0;t<e.contents.length;t++)$("#"+e.contents[t].tableCellID).append(e.contents[t].htmlElement);return!0}),s.refreshCellLayout()},s.expandTable=function(e,t,n){var i=e.contents.length,a=Math.floor(i/t);if(t<n){for(var r=0;r<n-t;r++)for(var o=0;o<a;o++)widget.addContent({type:s.editor.lastSelectedContentType},e);for(r=0;r<n-t;r++)for(o=0;o<a;o++)widget.moveContent(e.contents[e.contents.length-1],(t+(r+1))*(o+1)-1)}else{var l=0;for(r=0;r<t-n;r++)for(o=0;o<a;o++)widget.removeContent(e.contents[(n+(r+1))*(o+1)-1-l]),l++}},s.init=function(){},s.refreshEditorSidebarContent=function(e,a){e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(s.editor.getApplyToAllBtn(function(){s.editor.openApplyAttributeToAllDialog(a,"fixedLayout",a.JSON.fixedLayout)}))),e.append(s.editor.getToggleCheck("Fixed-Layout",a.JSON.fixedLayout,function(e){a.JSON.fixedLayout=e})),e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(s.editor.getApplyToAllBtn(function(){s.editor.openApplyAttributeToAllDialog(a,"width",a.JSON.width)}))),e.append(s.editor.getSelectInput("Breite",["auto","100%","50%","25%","10%"],a.JSON.width,function(e){a.JSON.width=e})),e.append(s.editor.getNumberInput("Anzahl Spalten",a.JSON.cols,function(e){var t=parseInt(a.JSON.cols);a.JSON.cols=parseInt(e),s.expandTable(a,t,a.JSON.cols)},1,50)),e.append($('<div class="sidebarBlockInputButtons btn-group"></div>').append(s.editor.getApplyToAllBtn(function(){s.editor.openApplyAttributeToAllDialog(a,"colpadding",a.JSON.colpadding)}))),e.append(s.editor.getSelectInput("Spaltenabstand",["0","1","5","10","15","20","25","30","50","100"],a.JSON.colpadding,function(e){a.JSON.colpadding=e})),e.append(s.editor.getButtonInput("Zeile hinzufügen",'<i class="fa fa-plus"></i>',function(){s.editor.openContentTypeDialog("",function(e){for(var t=null,n=0;n<a.JSON.cols;n++){var i=widget.addContent({type:e},a);null==t&&(t=i)}a=t,s.editor.inputValueChanged(),s.editor.updateContentSidebar()})})),e.append(s.editor.getButtonInput("Zeile löschen",'<i class="fa fa-minus"></i>',function(){widget.removeContent(a.contents[a.contents.length-1]);for(var e=1;e<a.JSON.cols&&a.contents.length%a.JSON.cols!=0;e++)widget.removeContent(a.contents[a.contents.length-1]);s.editor.updateContentSidebar()}))}}(),function(){var n=new AModule("table_cell");n.noSaveData=!0,n.initContent=function(e){e.JSON.isTableCell="0,0"},n.refreshContent=function(e){var t=e.JSON.isTableCell.split(",");e.htmlElement.html('<div class="table-cell-empty">'+(n.editor?parseInt(t[0])+1+" - "+(parseInt(t[1])+1):"<p>&nbsp;</p>")+"</div>")},n.init=function(){}}(),function(){var i=new AModule("table_container");i.noSaveData=!0,i.initContent=function(e){e.JSON.contents=[],e.JSON.columns=[]},i.refreshContent=function(e){e.htmlElement.addClass("tableContainer"),e.htmlElement.html(0==e.contents.length?"&nbsp;&nbsp;&nbsp;":"")},i.refreshModule=function(){widget.forEachContent(function(e){if(e.module!=i)return!0;for(var t=0;t<e.contents.length;t++)if(e.htmlElement.append(e.contents[t].htmlElement),e.contents[t].htmlElement.wrapInner('<div class="tableContainerCell"></div>'),e.contents[t].JSON.isTableCell){e.contents[t].htmlElement.addClass("tableCell");var n=e.contents[t].JSON.isTableCell.split(",");1<n.length&&(e.contents[t].htmlElement.addClass("row"+n[0]),e.contents[t].htmlElement.addClass("col"+n[1]),parseInt(n[0])%2==0?e.contents[t].htmlElement.addClass("rowEven"):e.contents[t].htmlElement.addClass("rowOdd"),parseInt(n[1])%2==0?e.contents[t].htmlElement.addClass("colEven"):e.contents[t].htmlElement.addClass("colOdd"))}return!0})},i.init=function(){}}(),function(){var J=new AModule("video_player");J.noSaveData=!0,J.initContent=function(e){e.JSON.url="",e.JSON.image=""},J.refreshInsideContainer=function(e){e.scaledAlready=!1,J.rescaleVideo(e)},J.rescaleVideo=function(i){if(!i.scaledAlready&&0!=(t=i.htmlElement.width())){if(i.JSON.image&&""!=i.JSON.image){var a=new Image;a.onload=function(){if(!i.scaledAlready){var e=a.width,t=a.height;if(0!=e&&0!=t){var n=i.htmlElement.width();n<e&&(t/=e/n,e=n),$(".v-player",i.htmlElement).css({width:e+"px",height:t+"px"}),widget.refreshScrollbars()}}},a.src=widget.getMediaURLPath(i.JSON.image),a.complete&&a.onload()}var e=$(".v-video",i.htmlElement).get(0);if(e){var t,n=e.videoWidth,r=e.videoHeight;if(0!=n&&0!=r)(t=i.htmlElement.width())<n&&(r/=n/t,n=t),$(".v-player",i.htmlElement).css({width:n+"px",height:r+"px"}),i.scaledAlready=!0}}},J.refreshContent=function(t){if(t.JSON.embed&&""!=t.JSON.embed)t.htmlElement.html(t.JSON.embed);else{if(t.scaledAlready=!1,"IOS"==helper.getDevicePlatform()){console.log("Using iOS video player."),t.htmlElement.html('<div class="v-player" style="width:100%;display:inline-block"><video controls="true" preload webkit-playsinline="true" playsinline="true" class="v-video" '+(t.JSON.image&&""!=t.JSON.image?'poster="'+widget.getMediaURLPath(t.JSON.image)+'"':"")+'><source src="'+(t.JSON.url&&""!=t.JSON.url?widget.getMediaURLPath(t.JSON.url):"")+'" type="video/mp4"></video></div>'),$(".v-video",t.htmlElement).get(0).addEventListener("loadedmetadata",function(){J.rescaleVideo(t),widget.refreshScrollbars()})}else{function n(){u.style.opacity=1}function e(){c.play(),p.classList.remove("ended"),p.classList.remove("paused"),p.classList.add("playing")}function i(){c.pause(),p.classList.remove("playing"),p.classList.add("paused")}function a(){c.paused?e():i()}function r(e){l(e)}function o(){d.classList.remove("scrubbing"),d.removeEventListener("mousemove",r),e(),document.removeEventListener("mouseup",o)}function l(e){var t=f.getBoundingClientRect(),n=e.pageX-(t.left+document.body.scrollLeft);n<0?n=0:n>f.offsetWidth&&(n=f.offsetWidth);var i=n/f.offsetWidth*100,a=c.duration*i/100,r=s(c.duration*i/100);m.setAttribute("aria-valuenow",c.currentTime);var o=a/c.duration*100;m.style.width=o+"%",S.style.left=o+"%",w.innerHTML=r,c.currentTime=c.duration*i/100}function s(e){e=Number(e);var t=Math.floor(e/3600),n=Math.floor(e%3600/60),i=Math.floor(e%3600%60);return(0<t?t+":":"")+(n<10?"0":"")+n+":"+(i<10?"0":"")+i}t.htmlElement.html('<div class="v-player" style="width:100%;display:inline-block"><video preload webkit-playsinline="true" playsinline="true" class="v-video nocontrols" '+(t.JSON.image&&""!=t.JSON.image?'poster="'+widget.getMediaURLPath(t.JSON.image)+'"':"")+'><source src="'+(t.JSON.url&&""!=t.JSON.url?widget.getMediaURLPath(t.JSON.url):"")+'" type="video/mp4"></video><div class="v-controls"><button class="play paused" aria-label="Play"><div class="play-icon"><svg viewBox="0 0 20 20" preserveAspectRatio="xMidYMid" width="20" height="20"><polygon fill="#fff" points="1,0 20,10 1,20"/></svg></div><div class="pause-icon"><svg viewBox="0 0 20 20" preserveAspectRatio="xMidYMid"  width="20" height="20"><rect fill="#fff" width="6" height="20" x="0" y="0" /><rect fill="#fff" width="6" height="20" x="12" y="0" /></svg></div><div class="replay-icon"><svg viewBox="-387 605 16 16" width="20" height="20"><path fill="#fff" d="M-387 606v4c0 .6.4 1 1 1h4c.6 0 1-.4 1-1s-.4-1-1-1h-1.5c1.1-1.2 2.7-2 4.5-2 3.3 0 6 2.7 6 6s-2.7 6-6 6c-2.3 0-4.4-1.3-5.4-3.4-.2-.5-.8-.7-1.3-.5-.5.2-.7.8-.5 1.3 1.3 2.8 4.2 4.6 7.2 4.6 4.4 0 8-3.6 8-8s-3.6-8-8-8c-2.3 0-4.5 1-6 2.7V606c0-.6-.4-1-1-1s-1 .4-1 1z"></path></svg></div></button><div class="play-bar"><div class="progress"><div class="loaded" role="progressbar" aria-label="loaded"></div><div class="played" role="progressbar" aria-label="played"></div><div class="ghost-timecode" role="presentation" aria-hidden="true"><span></span></div><div class="timecode" role="presentation" aria-hidden="true"><span></span></div></div><div class="volume" role="slider" aria-label="Volume" aria-valuemin="0" aria-valuemax="1" tabindex="0"><div></div><div></div><div></div><div></div><div></div></div><button class="fullscreen" title="Toggle full screen" aria-label="Fullscreen"><div class="enter-fullscreen"><svg preserveAspectRatio="xMidYMid" tabindex="-1"><polyline class="fill" points="6,6 5.9,2 4.9,3 2.9,1 1,2.9 3,4.9 2,5.9" transform="translate(6,6)"></polyline><polyline class="fill" points="6,6 5.9,2 4.9,3 2.9,1 1,2.9 3,4.9 2,5.9" transform="translate(6,6) rotate(90)"></polyline><polyline class="fill" points="6,6 5.9,2 4.9,3 2.9,1 1,2.9 3,4.9 2,5.9" transform="translate(6,6) rotate(180)"></polyline><polyline class="fill" points="6,6 5.9,2 4.9,3 2.9,1 1,2.9 3,4.9 2,5.9" transform="translate(6,6) rotate(270)"></polyline></svg></div><div class="exit-fullscreen"><svg preserveAspectRatio="xMidYMid" tabindex="-1"><polyline class="fill" points="-1,-1 -1.1,-5 -2.1,-4 -4.1,-6 -6,-4.1 -4,-2.1 -5,-1.1" transform="translate(6,6) "></polyline> <polyline class="fill" points="-1,-1 -1.1,-5 -2.1,-4 -4.1,-6 -6,-4.1 -4,-2.1 -5,-1.1" transform="translate(6,6) rotate(90)"></polyline><polyline class="fill" points="-1,-1 -1.1,-5 -2.1,-4 -4.1,-6 -6,-4.1 -4,-2.1 -5,-1.1" transform="translate(6,6) rotate(180)"></polyline><polyline class="fill" points="-1,-1 -1.1,-5 -2.1,-4 -4.1,-6 -6,-4.1 -4,-2.1 -5,-1.1" transform="translate(6,6) rotate(270)"></polyline></svg></div></button></div></div></div>');var d=$(".v-player",t.htmlElement).get(0),c=$(".v-video",t.htmlElement).get(0),u=$(".v-controls",t.htmlElement).get(0),p=$(".v-controls .play",t.htmlElement).get(0),g=$(".v-controls .volume",t.htmlElement).get(0),h=$(".v-controls .fullscreen",t.htmlElement).get(0),f=$(".v-controls .progress",t.htmlElement).get(0),m=$(".v-controls .progress .played",t.htmlElement).get(0),v=$(".v-controls .progress .loaded",t.htmlElement).get(0),S=$(".v-controls .timecode",t.htmlElement).get(0),w=$(".v-controls .timecode span",t.htmlElement).get(0),O=$(".v-controls .ghost-timecode",t.htmlElement).get(0),N=$(".v-controls .ghost-timecode span",t.htmlElement).get(0);c.addEventListener("click",a),p.addEventListener("click",a),g.addEventListener("click",function(e){for(var t=g.firstElementChild,n=g.getBoundingClientRect(),i=e.pageX-(n.left+document.body.scrollLeft),a=0,r=0;r<5;r++){if(t){if(a<i){if(t.classList.remove("fill-0","fill-1","fill-2"),(4.8<i?Math.floor(i/4.8):0)===r){var o=i%(a||4.8);0<o&&Math.floor(o)<=1?t.classList.add("fill-1"):2===Math.floor(o)&&t.classList.add("fill-2")}}else t.classList.add("fill-0");t=t.nextElementSibling}a+=4.8}g.setAttribute("aria-valuenow",parseFloat(i/g.offsetWidth).toFixed(2)),g.setAttribute("aria-valuetext",Math.round(i/g.offsetWidth*100)+"%"),c.volume=i/g.offsetWidth}),h.addEventListener("click",function(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),h.classList.remove("is-fullscreen")):(c.requestFullscreen?c.requestFullscreen():c.msRequestFullscreen?d.msRequestFullscreen():c.mozRequestFullScreen?d.mozRequestFullScreen():c.webkitRequestFullscreen&&c.webkitRequestFullscreen(),h.classList.add("is-fullscreen"))}),f.addEventListener("mousemove",function(e){if(!isNaN(c.duration)){var t=f.getBoundingClientRect(),n=(e.pageX-(t.left+document.body.scrollLeft))/f.offsetWidth*100,i=s(c.duration*n/100);O.style.opacity=1,O.style.left=n+"%",N.innerHTML=i}}),f.addEventListener("mouseout",function(){O.style.opacity=0}),f.addEventListener("mousedown",function(e){i(),l(e),d.classList.add("scrubbing"),d.addEventListener("mousemove",r),document.addEventListener("mouseup",o)}),c.addEventListener("loadedmetadata",function(){m.setAttribute("aria-valuemin",0),m.setAttribute("aria-valuemax",c.duration),v.setAttribute("aria-valuemin",0),v.setAttribute("aria-valuemax",c.duration);var e=s(c.duration);S.style.opacity=1,w.innerHTML=e,n(),J.rescaleVideo(t),widget.refreshScrollbars()}),c.addEventListener("timeupdate",function(){m.setAttribute("aria-valuenow",c.currentTime);var e=c.currentTime/c.duration*100;m.style.width=e+"%";var t=s(c.currentTime);S.style.left=e+"%",w.innerHTML=t}),c.addEventListener("progress",function(){if(0<c.buffered.length){var e=c.buffered.end(c.buffered.length-1),t=c.duration,n=e/t*100;0<t&&(v.style.width=n+"%",v.setAttribute("aria-valuenow",n))}}),c.addEventListener("ended",function(){c.pause(),n(),p.classList.remove("playing"),p.classList.add("ended")})}J.rescaleVideo(t)}},J.refreshEditorSidebarContent=function(e,t){t.JSON.embed&&""!=t.JSON.embed||(e.append(J.editor.getVideoFileInput(J.translate("VideoFile"),t.JSON.url,function(e){t.JSON.url=e})),e.append(J.editor.getImageFileInput(J.translate("VideoFilePoster")+" ("+J.translate("optional")+")",t.JSON.image,function(e){t.JSON.image=e}))),(J.editor.advancedMode||t.JSON.embed&&""!=t.JSON.embed)&&e.append(J.editor.getHTMLCodeInput(J.translate("embedCode"),t.JSON.embed,function(e){t.JSON.embed=e,J.editor.updateContentSidebar()}))}}();